{
    "source": "BDSA",
    "name": "BDSA-2019-0687",
    "title": "Xen Vulnerable to Denial-of-Service (DoS) and Privilege Escalation via Race Condition in 'steal_page()' Function",
    "description": "Xen is vulnerable to denial-of-service (DoS) and privilege escalation due to erroneous implementation of race condition protections. Mishandling of reference counting rules upon the introduction of some protections opened the code up to other race conditions. An attacker with access to a PV guest could leverage these flaws to cause resource exhaustion or escalate their privileges.",
    "technicalDescription": "This problem stems from the `steal_page` function that is meant to protect the code from unknown races. The logic of this function can lead to states which erroneously violate the rules of a proper `struct page`, introducing other race conditions. Under normal circumstances `refcount > 0` indicates that owner is not `NULL` and `PGC_allocated` that `refcount` itself is bigger than `0`.\n\nIn some scenarios `count_info` can cause `refcount` to go to `0` while `PGC_allocated` flag is set. The `steal_page` function can then return a page with `PGC_allocated` set, but a `NULL` owner, and page not on the `page_list`. Subsequently `page_get_owner_and_reference` can return `NULL` regardless of having successfully retrieved a reference on the page causing a leak.\n\nAnother part of the problem is that `steal_page`relies on holding `d->page_alloc` lock to prevent the `owner` from changing during execution. This approach is ineffective as `page->owner` remains non-NULL for some time after the count has been set to `0`. This allows the page to be freed and re-allocated to a different domain (guest) between the `page_get_owner` check and the `count_info`\ncheck.\n\nAn attacker with access to a single PV guest could leverage these flaws to cause denial-of-service via memory leak. A cooperating pair of PV and HVM/PVH guests can get a writable pagetable entry, allowing information disclosure or privilege escalation. The vendor has not ruled out the possibility of privilege escalation with the use of a single PV guest or a pair of PV guests. Both of the attacks are hard to exploit due to the nature of the race conditions.\n\nVulnerable hosts:\n* Only x86 systems are vulnerable.\n* Only systems which run PV guests are vulnerable.  Systems which run only HVM/PVH guests are not vulnerable.",
    "publishedDate": "2019-03-12T15:27:41.564Z",
    "updatedDate": "2019-11-29T17:00:07.734Z",
    "disclosureDate": "2019-03-05T00:00:00.000Z",
    "solution": "Fixed in versions:\n\n* [**4.10.4**](https://downloads.xenproject.org/release/xen/) by [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=dfc7e3ce9d974c7af07d7f8c7b55a32257246f4f) commit.\n* [**4.11.2**](https://downloads.xenproject.org/release/xen/) by [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=4298abd32733ddb728035fdcb36557091e84441f) commit.\n* [**4.12.0-rc5**](https://downloads.xenproject.org/release/xen/) by [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=3d4868a481eebed232eeacba36ea28e5dee5e946) commit.",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 6.2,
        "impactSubscore": 10.0,
        "exploitabilitySubscore": 1.9,
        "severity": "MEDIUM",
        "accessVector": "LOCAL",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "COMPLETE",
        "integrityImpact": "COMPLETE",
        "availabilityImpact": "COMPLETE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.6
        },
        "vector": "(AV:L/AC:H/Au:N/C:C/I:C/A:C/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.1,
        "impactSubscore": 6.0,
        "exploitabilitySubscore": 1.4,
        "severity": "HIGH",
        "attackVector": "LOCAL",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "CHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.1
        },
        "vector": "CVSS:3.0/AV:L/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:H/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Jan Beulich (SUSE)",
    "workaround": "Vendor supplied patches can be applied to vulnerable versions to mitigate this vulnerability.  The patch and corresponding versions can be found [here](http://xenbits.xen.org/xsa/advisory-292.html).\n\nAlternatively, running only HVM or PVH guests will avoid these vulnerabilities.",
    "vendorFixDate": "2019-03-05T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 7.1,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0687",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-362"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-17342",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0687/ranges"
            },
            {
                "rel": "reference",
                "href": "https://downloads.xenproject.org/release/xen/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=3d4868a481eebed232eeacba36ea28e5dee5e946",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=4298abd32733ddb728035fdcb36557091e84441f",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=516250dac6a868443b31c924c08de9ab6fea1322",
                "label": "INTRODUCTORY_COMMIT"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=dfc7e3ce9d974c7af07d7f8c7b55a32257246f4f",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/xsa/advisory-287.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/xsa/advisory-287.html",
                "label": "WORKAROUND"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0687/default-remediation-status"
            }
        ]
    }
}