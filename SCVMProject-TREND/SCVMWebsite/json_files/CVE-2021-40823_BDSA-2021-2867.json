{
    "source": "BDSA",
    "name": "BDSA-2021-2867",
    "title": "matrix-js-sdk Vulnerable to Encryption Key Theft",
    "description": "matrix-js-sdk is vulnerable to encryption key theft via a logic error in the room key sharing functionality. In some circumstances it might be possible to trick vulnerable clients into disclosing encryption keys for messages previously sent by the client to user accounts later compromised by an attacker. \n\nExploiting this vulnerability requires an attacker gaining control over the recipient's account. They must either compromise their credentials directly or compromise their homeserver. The greatest risk is to users in encrypted rooms containing malicious servers.",
    "technicalDescription": "This issue is an implementation bug rather than a problem with the protocol or specification. \n\nMatrix includes support for key sharing - a Matrix client without the keys to decrypt a message can request those keys from that user's other devices or the original sender's device. The recommended strategy is to share the keys automatically only to verified devices of the same user. The implementation did not sufficiently verify the identity of the device requesting the keyshare, meaning that a compromised account can impersonate the device requesting the keys, creating this vulnerability.",
    "publishedDate": "2021-09-29T10:25:11.811Z",
    "updatedDate": "2021-09-29T10:25:11.798Z",
    "disclosureDate": "2021-09-13T00:00:00.000Z",
    "solution": "Fixed in [**12.4.1**](https://github.com/matrix-org/matrix-js-sdk/releases/tag/v12.4.1).\n\nThe latest stable releases can be found [here](https://github.com/matrix-org/matrix-js-sdk).",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 3.5,
        "impactSubscore": 2.9,
        "exploitabilitySubscore": 6.8,
        "severity": "LOW",
        "accessVector": "NETWORK",
        "accessComplexity": "MEDIUM",
        "authentication": "SINGLE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "NONE",
        "availabilityImpact": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 2.6
        },
        "vector": "(AV:N/AC:M/Au:S/C:P/I:N/A:N/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 5.7,
        "impactSubscore": 3.6,
        "exploitabilitySubscore": 2.1,
        "severity": "MEDIUM",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "NONE",
        "availabilityImpact": "NONE",
        "privilegesRequired": "LOW",
        "scope": "UNCHANGED",
        "userInteraction": "REQUIRED",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.0
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:N/A:N/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Denis Kasak",
    "workaround": "The vendor has given the following advice for mitigation:\n> If you are unable to upgrade, consider keeping vulnerable clients offline until you can. If vulnerable clients are offline, they cannot be tricked into disclosing keys. They may safely return online once updated.",
    "vendorFixDate": "2021-09-13T00:00:00.000Z",
    "discoveryDate": "2021-08-23T00:00:00.000Z",
    "vendorNotifiedDate": "2021-09-08T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 5.0,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2867",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-320"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-40823",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2867/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/matrix-org/matrix-js-sdk",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/matrix-org/matrix-js-sdk/releases/tag/v12.4.1",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://matrix.org/blog/2021/09/13/vulnerability-disclosure-key-sharing",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://matrix.org/blog/2021/09/13/vulnerability-disclosure-key-sharing",
                "label": "WORKAROUND"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2867/default-remediation-status"
            }
        ]
    }
}