{
    "source": "BDSA",
    "name": "BDSA-2021-2102",
    "title": "Icinga Vulnerable to Privilege Escalation via PKI Ticket Salt Exposure",
    "description": "Icinga contains a privilege escalation vulnerability. An authenticated attacker can take advantage of this in order to obtain the attribute `ticket_salt` which is used to generate and verify PKI tickets, which will allow them to escalate their privileges to those of an API user.\n\n**Note:** The vendor has stated that you are affected by this vulnerability if your cluster has API users with the `objects/query/ApiListener` permission, possibly via some wildcard permission like `objects/query/*`",
    "technicalDescription": "This vulnerability exists due to the API responses for `ApiListener` objects containing the `ticket_salt` attribute. This salt is used to generate and verify PKI tickets, and by knowing it a user can create valid tickets for arbitrary CNs. An authenticated attacker can take advantage of this in order to obtain certificates which will authenticate them as an API user. \n\nThe vendor has mitigated against this issue by ensuring that `lib/remote/apilistener.ti` is configured to hide the `ticket_salt` attribute.",
    "publishedDate": "2021-07-16T13:01:01.155Z",
    "updatedDate": "2021-07-16T14:56:26.350Z",
    "disclosureDate": "2021-07-15T00:00:00.000Z",
    "solution": "Fixed in [**2.11.10**](https://github.com/Icinga/icinga2/releases/tag/v2.11.10) by [this](https://github.com/Icinga/icinga2/commit/caf697b86842fce3cb2ebbf9172bc747e54a8627) commit, and in [**2.12.5**](https://github.com/Icinga/icinga2/releases/tag/v2.12.5) by [this](https://github.com/Icinga/icinga2/commit/b5b83fa51564662ff2e78d7529ff77e1085d4522) commit.\n\nThe latest stable releases are available [here](https://icinga.com/get-started/download/).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 6.5,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 8.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "SINGLE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.8
        },
        "vector": "(AV:N/AC:L/Au:S/C:P/I:P/A:P/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.3,
        "impactSubscore": 5.5,
        "exploitabilitySubscore": 2.8,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "LOW",
        "privilegesRequired": "LOW",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.2
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:L/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "workaround": "The vendor has provided the following [workaround](https://github.com/Icinga/icinga2/security/advisories/GHSA-98wp-jc6q-x5q5)\n\nEither specify queryable types explicitly.\n```\nobject ApiUser \"r/o\" {\n  password = \"123456\"\n  permissions = [ \"objects/query/Host\", \"objects/query/Service\" ]\n}\n```\nOr filter out ApiListener objects.\n```\nobject ApiUser \"r/o\" {\n  password = \"123456\"\n  permissions = [ {\n    permission = \"objects/query/*\"\n    filter = {{ obj.type != \"ApiListener\" }}\n  } ]\n}\n```",
    "vendorFixDate": "2021-07-09T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 7.2,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2102",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-267"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-32739",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2102/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/Icinga/icinga2/commit/b5b83fa51564662ff2e78d7529ff77e1085d4522",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/Icinga/icinga2/commit/caf697b86842fce3cb2ebbf9172bc747e54a8627",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/Icinga/icinga2/releases/tag/v2.11.10",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/Icinga/icinga2/releases/tag/v2.12.5",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/Icinga/icinga2/security/advisories/GHSA-98wp-jc6q-x5q5",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/Icinga/icinga2/security/advisories/GHSA-98wp-jc6q-x5q5",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://icinga.com/blog/2021/07/15/releasing-icinga-2-12-5-and-2-11-10/",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://icinga.com/get-started/download/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2102/default-remediation-status"
            }
        ]
    }
}