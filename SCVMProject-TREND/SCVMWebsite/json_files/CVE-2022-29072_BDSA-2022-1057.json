{
    "source": "BDSA",
    "name": "BDSA-2022-1057",
    "title": "7-Zip Vulnerable to Privilege Escalation and Command Execution via Malicious '.7z' File submitted to 'Help>Contents' Section",
    "description": "7-Zip is vulnerable to improper authorization and heap-based buffer overflow issues. A local attacker could insert a malicious `.7z` file in order to elevate their privileges and execute malicious commands on the server.\n\n**Note** This vulnerability only affects installations on Windows systems.",
    "technicalDescription": "This vulnerability only affects installations on Windows systems. It stems from misconfiguration of `7z.dll` file and a heap-based buffer overflow in `7zFM.exe` file. The exploitation can be done using the application help file \n`7-zip.chm`. This file works in the `Help>Contents` section. Because of the misconfiguration and heap-based buffer overflow issues, an attacker can use a malicious `.7z` file to inject and start a `cmd.exe` process under the `7zFM.exe` process. The attacker can accomplish this by including the following payload in the malicious file: \n`psexec -s cmd.exe -nobanner`. Because of improper authorization for `7z.dll` file, executing this payload can lead to `cmd.exe` being run with `NT AUTHORITY\\SYSTEM` privileges. With these elevated privileges, the attacker can then execute malicious commands on the server.\n\nAs demonstrated in the PoC, the attacker will first need local access to the server in order to create a crafted `.7z` file called `privesc.7z`. After this, the attacker can run the application and go to `Help > Contents` section. When the crafted file is dragged onto this section, the malicious code contained within the file will execute and result in a `cmd.exe` process being spawned. Results from the `whoami` command prove that the attacker will have \n`NT AUTHORITY\\SYSTEM` privileges. Using these elevated privileges, the attacker can execute malicious commands on the server.\n\n**Note** The vendor is stating that this vulnerability is stemming from the `hh.exe` file which falls under Microsoft's purview. Microsoft are disputing this by stating that a command injection via `hh.exe` would result in a child process being created under `hh.exe` and not `7zFM.exe`. As a result, it is being disputed as to who is going to fix this vulnerability.",
    "publishedDate": "2022-04-19T13:36:52.957Z",
    "updatedDate": "2022-09-07T13:09:49.281Z",
    "disclosureDate": "2022-04-16T00:00:00.000Z",
    "exploitPublishDate": "2022-04-16T00:00:00.000Z",
    "solution": "",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 6.8,
        "impactSubscore": 10.0,
        "exploitabilitySubscore": 3.1,
        "severity": "MEDIUM",
        "accessVector": "LOCAL",
        "accessComplexity": "LOW",
        "authentication": "SINGLE",
        "confidentialityImpact": "COMPLETE",
        "integrityImpact": "COMPLETE",
        "availabilityImpact": "COMPLETE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "WORKAROUND",
            "reportConfidence": "CONFIRMED",
            "score": 5.8
        },
        "vector": "(AV:L/AC:L/Au:S/C:C/I:C/A:C/E:POC/RL:W/RC:C)"
    },
    "cvss3": {
        "baseScore": 7.8,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 1.8,
        "severity": "HIGH",
        "attackVector": "LOCAL",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "LOW",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "WORKAROUND",
            "reportConfidence": "CONFIRMED",
            "score": 7.2
        },
        "vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H/E:P/RL:W/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": true,
    "underReview": true,
    "parentAdvisory": false,
    "credit": "kagancapar",
    "workaround": "The following workarounds have been suggested for mitigating this vulnerability:\n* the `7-zip.chm` file should be deleted from the server\n* the application should only have read and run permissions for all users",
    "bdsaTags": [],
    "overallScore": 7.2,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-1057",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-122"
            },
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-77"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2022-29072",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-1057/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kagancapar/CVE-2022-29072",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kagancapar/CVE-2022-29072",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kagancapar/CVE-2022-29072",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://sourceforge.net/p/sevenzip/bugs/2337/",
                "label": "ADVISORY"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-1057/default-remediation-status"
            }
        ]
    }
}