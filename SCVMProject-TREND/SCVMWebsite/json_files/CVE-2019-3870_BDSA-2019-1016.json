{
    "source": "BDSA",
    "name": "BDSA-2019-1016",
    "title": "Samba Vulnerable to Arbitrary Write in Active Directory DC 'private/' Directory",
    "description": "Samba is vulnerable to arbitrary writes due to incorrectly set file permissions upon provision of a new Active Directory DC. Some files within the `private/` subdirectory get created world-writable allowing any local attacker to modify their contents.",
    "technicalDescription": "The `private/` subdirectory is normally owned by root (with `0700` permissions) but some upgraded installations may have inherited other permissions from earlier versions of Samba. The `0755` permissions were the default before Samba 4.8 and some current installations may be still running with these insecure permissions.\n\nFiles created within the directory are set to `0666` which makes them world-writable. They include a sample `krb5.conf` file and a list of DNS names (`dns_update_list`) and `servicePrincipalName` (`spn_update_list` ) values to update.\n\nThe impact may vary based on how these files are used in a particular environment. For example, the sample `krb5.conf` might be used by Kerberos tools or as the system-wide `krb5.conf` (via a symlink), which would have serious security implications.",
    "publishedDate": "2019-04-12T14:31:31.406Z",
    "updatedDate": "2019-05-13T15:32:49.785Z",
    "disclosureDate": "2019-04-08T00:00:00.000Z",
    "exploitPublishDate": "2019-04-08T00:00:00.000Z",
    "solution": "Please note that upgrading Samba will not change the file or directory permissions in existing installations. It will prevent the issue from occurring in new installations. Permissions have to be changed manually in order to remediate the issue.\n\nIf Samba is installed in the default location run the following command as root:\n```\nchmod 0700 /usr/local/samba/private\n```\nThe `private/` directory can be found using:\n```\nsmbd -b | grep PRIVATE_DIR\n```\nAlternatively all world-writable permissions within the directory may be removed by running:\n```\nchmod o-w /usr/local/samba/private/*\n```\n\nFixed in [**4.9.6**](https://www.samba.org/samba/download/) by the following commits:\n* [Commit 1](https://github.com/samba-team/samba/commit/c92ac5ada094a2f3f10f15b65d6ba5c771261acd),\n* [Commit 2](https://github.com/samba-team/samba/commit/30db48655f7aae97586d9143b0c0e00308392115),\n* [Commit 3](https://github.com/samba-team/samba/commit/65a175aac08bc69eaaf6b4e011eb59b262e3417b),\n* [Commit 4](https://github.com/samba-team/samba/commit/83cc536a42003bf2df0a5a121b07df33c1ffd96a), and\n* [Commit 5](https://github.com/samba-team/samba/commit/b708ce3f1ac863dea8051b51b717bced2a433546).\n\nFixed in [**4.10.2**](https://www.samba.org/samba/download/) by the following commits:\n* [Commit 1](https://github.com/samba-team/samba/commit/8e0a6867c4e3480c0269c87821b54f1451656ae7),\n* [Commit 2](https://github.com/samba-team/samba/commit/9a4029b5d3be1f42da49d4e635f4637f76f01a22),\n* [Commit 3](https://github.com/samba-team/samba/commit/ebb9b7fa9ead90906ff71fed68c30d093ab9c15a),\n* [Commit 4](https://github.com/samba-team/samba/commit/0b712415db68dd5f0a082c036ba051f2b857aa2a), and\n* [Commit 5](https://github.com/samba-team/samba/commit/c25ee5bd463d2d433a1b0a868e5d63e3490bc7fd).",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 3.2,
        "impactSubscore": 4.9,
        "exploitabilitySubscore": 3.1,
        "severity": "LOW",
        "accessVector": "LOCAL",
        "accessComplexity": "LOW",
        "authentication": "SINGLE",
        "confidentialityImpact": "NONE",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "HIGH",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 2.8
        },
        "vector": "(AV:L/AC:L/Au:S/C:N/I:P/A:P/E:H/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 6.1,
        "impactSubscore": 4.2,
        "exploitabilitySubscore": 1.8,
        "severity": "MEDIUM",
        "attackVector": "LOCAL",
        "attackComplexity": "LOW",
        "confidentialityImpact": "NONE",
        "integrityImpact": "LOW",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "LOW",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "HIGH",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.8
        },
        "vector": "CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:H/E:H/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Bj\u00f6rn Baumbach (Samba Team, SerNet)",
    "workaround": "If Samba is installed in the default location run the following command as root:\n```\nchmod 0700 /usr/local/samba/private\n```\nThe `private/` directory can be found using:\n```\nsmbd -b | grep PRIVATE_DIR\n```\nAlternatively all world-writable permissions within the directory may be removed by running:\n```\nchmod o-w /usr/local/samba/private/*\n```",
    "vendorFixDate": "2019-03-21T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 5.8,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-1016",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-277"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-3870",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-1016/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/samba-team/samba/commit/0b712415db68dd5f0a082c036ba051f2b857aa2a",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/samba-team/samba/commit/30db48655f7aae97586d9143b0c0e00308392115",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/samba-team/samba/commit/65a175aac08bc69eaaf6b4e011eb59b262e3417b",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/samba-team/samba/commit/83cc536a42003bf2df0a5a121b07df33c1ffd96a",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/samba-team/samba/commit/8e0a6867c4e3480c0269c87821b54f1451656ae7",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/samba-team/samba/commit/9a4029b5d3be1f42da49d4e635f4637f76f01a22",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/samba-team/samba/commit/b708ce3f1ac863dea8051b51b717bced2a433546",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/samba-team/samba/commit/c25ee5bd463d2d433a1b0a868e5d63e3490bc7fd",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/samba-team/samba/commit/c92ac5ada094a2f3f10f15b65d6ba5c771261acd",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/samba-team/samba/commit/ebb9b7fa9ead90906ff71fed68c30d093ab9c15a",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://www.samba.org/samba/download/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://www.samba.org/samba/security/CVE-2019-3870.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.samba.org/samba/security/CVE-2019-3870.html",
                "label": "WORKAROUND"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-1016/default-remediation-status"
            }
        ]
    }
}