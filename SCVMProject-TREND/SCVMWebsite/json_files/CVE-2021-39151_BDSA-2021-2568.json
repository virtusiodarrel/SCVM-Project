{
    "source": "BDSA",
    "name": "BDSA-2021-2568",
    "title": "XStream Vulnerable to Remote Code Execution (RCE) via Unsafe 'KeyStoreResolver$KeyStoreIterator' Class Deserialization",
    "description": "XStream is vulnerable to remote code execution (RCE) due to the unsafe demarshalling of the `KeyStoreResolver$KeyStoreIterator` subclass. A remote attacker could execute arbitrary code on a vulnerable server by causing that server to deserialize a maliciously crafted serialized object.",
    "technicalDescription": "The `KeyStoreResolver` class contains the `KeyStoreIterator` subclass. This subclass implements the `Iterator` interface, and is used to retrieve `Certificate` objects from a certificate store. It is capable of sending requests to an LDAP server in order to retrieve certificate information when used in conjunction with JNDI classes such as `com.sun.jndi.ldap.LdapBindingEnumeration`.\n\nThe JNDI specification states that special reference entries can be used in an LDAP directory. These reference entries can refer the JNDI class that has submitted an LDAP request to a remote server that hosts a factory class. This factory class can be used to instantiate classes that cannot be stored in the LDAP server directly. However, this functionality can be abused by attackers. An attacker could host a crafted factory class on a remote server that will execute a malicious payload once it has been downloaded by the JNDI application and instantiated. The attacker has to be able to control the URL that the application will submit the LDAP request to, and must host an LDAP server with a reference entry that points to the malicious factory class.\n\nIf a server uses XStream to deserialize input from an untrusted source, then the attacker can use a serialized `KeyStoreIterator` instance with entries that specify such an LDAP server. Whenever the application attempts to iterate through the entries in order to obtain the certificates, it will fetch and instantiate the malicious factory class. `KeyStoreResolver$KeyStoreIterator` must be in the classpath in order for the attack to be successful.\n\nThe vulnerability was fixed by the implementation of a whitelisting approach. Classes which are not included in the whitelist will not be deserialized by XStream.",
    "publishedDate": "2021-08-24T14:58:43.178Z",
    "updatedDate": "2021-08-25T18:29:45.907Z",
    "disclosureDate": "2021-08-22T00:00:00.000Z",
    "exploitPublishDate": "2021-08-22T00:00:00.000Z",
    "solution": "Fixed in version [**1.4.18**](https://github.com/x-stream/xstream/releases/tag/XSTREAM_1_4_18) by [this](https://github.com/x-stream/xstream/commit/652d72f38b33938c54fd3b2ef626cb7dce38001c) commit.\n\nThe latest stable releases can be found [here](https://github.com/x-stream/xstream/releases).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 5.1,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 4.9,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.0
        },
        "vector": "(AV:N/AC:H/Au:N/C:P/I:P/A:P/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.1,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 2.2,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.3
        },
        "vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Smi1e (DBAPPSecurity WEBIN Lab)",
    "workaround": "Users can manually prevent the deserialization of problematic classes by following the [guidance](https://x-stream.github.io/security.html#workaround) provided by the vendor.",
    "vendorFixDate": "2021-05-26T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 7.3,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2568",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-502"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-39151",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2568/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/x-stream/xstream/commit/652d72f38b33938c54fd3b2ef626cb7dce38001c",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/x-stream/xstream/releases",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/x-stream/xstream/releases/tag/XSTREAM_1_4_18",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/x-stream/xstream/security/advisories/GHSA-hph2-m3g5-xxv4",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://x-stream.github.io/CVE-2021-39151.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://x-stream.github.io/CVE-2021-39151.html",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://x-stream.github.io/security.html#workaround",
                "label": "WORKAROUND"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2568/default-remediation-status"
            }
        ]
    }
}