{
    "source": "BDSA",
    "name": "BDSA-2020-1099",
    "title": "GLPI Vulnerable to Remote Code Execution (RCE) via PHP/GZIP Polyglot File Created During Backup",
    "description": "GLPI is vulnerable to remote code execution (RCE). An attacker with `Maintenance` privileges could input malicious data into certain GLPI provided fields which would enable remote code execution once database backups are created.",
    "technicalDescription": "When creating backups, GLPI takes GET parameter `fichier` as a filename in `/front/backup.php`. This allows for a full control of the backup's location in the shared webroot. Furthermore, GLPI compresses database fields into gzip files using DEFLATE algorithm, which due to the nature of its workings leaves some blocks uncompressed. An attacker could deterministically find the uncompressed block's location and put arbitrary PHP code in it. This means that a single carefully crafted field in the database could be part of a PHP/GZIP polyglot backup file, which after its creation could be directly accessed by the attacker in order to have its PHP part executed. Although backup creation requires a Technician account (giving `Maintenance` privileges), the backup query does not have cross-site request forgery (CSRF) protection, meaning that an unprivileged attacker could send a crafted backup link to a legitimate Technician user and wait until it is clicked. However, a successful exploitation requires the attacker being able to control parts of the database, which normally requires having a GLPI account. The credited researcher mentions that in theory this vulnerability could also be exploited by an attacker without a valid account as it is possible to modify the database via failed logins, but doing so in practice is hard and currently there is no proof of concept for such exploitation.",
    "publishedDate": "2020-05-15T08:51:58.807Z",
    "updatedDate": "2021-06-18T15:16:29.525Z",
    "disclosureDate": "2020-05-12T00:00:00.000Z",
    "exploitPublishDate": "2020-05-12T00:00:00.000Z",
    "solution": "Fixed in [**9.4.6**](https://github.com/glpi-project/glpi/releases/tag/9.4.6) by [this](https://github.com/glpi-project/glpi/commit/ad748d59c94da177a3ed25111c453902396f320c) commit.\n\nThe latest stable releases are available [here](https://glpi-project.org/downloads/).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 6.0,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 6.8,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "MEDIUM",
        "authentication": "SINGLE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.0
        },
        "vector": "(AV:N/AC:M/Au:S/C:P/I:P/A:P/E:F/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.0,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 2.1,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "LOW",
        "scope": "UNCHANGED",
        "userInteraction": "REQUIRED",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.4
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:H/A:H/E:F/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Almond Offensive Security",
    "workaround": "The official workaround for this vulnerability is deleting the `front/backup.php` file.",
    "vendorFixDate": "2020-04-28T00:00:00.000Z",
    "vendorNotifiedDate": "2020-04-27T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 7.4,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-1099",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-20"
            },
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-352"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2020-11060",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-1099/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/glpi-project/glpi/commit/ad748d59c94da177a3ed25111c453902396f320c",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/glpi-project/glpi/releases/tag/9.4.6",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/glpi-project/glpi/security/advisories/GHSA-cvvq-3fww-5v6f",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/glpi-project/glpi/security/advisories/GHSA-cvvq-3fww-5v6f",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://glpi-project.org/downloads/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://offsec.almond.consulting/playing-with-gzip-rce-in-glpi.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://offsec.almond.consulting/playing-with-gzip-rce-in-glpi.html",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://www.exploit-db.com/exploits/49992",
                "label": "EXPLOIT"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-1099/default-remediation-status"
            }
        ]
    }
}