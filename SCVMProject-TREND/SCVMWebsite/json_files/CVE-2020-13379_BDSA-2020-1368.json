{
    "source": "BDSA",
    "name": "BDSA-2020-1368",
    "title": "Grafana Vulnerable to Server Side Request Forgery (SSRF) via Incorrect Access Control in Avatar Feature",
    "description": "Grafana contains a server side request forgery (SSRF) vulnerability due to incorrect access control in the avatar feature. An unauthenticated attacker could force the application to send HTTP requests to any URL and receive the returned results. This could allow an attacker to obtain sensitive information about the network hosting the application or potentially cause denial-of-service (DoS).",
    "technicalDescription": "The issue occurs in `pkg/api/avatar/avatar.go`. The `Handler()` function did not sufficiently validate the avatar hash value, allowing an unauthenticated attacker to abuse the functionality to make the application request any supplied URL and return the results to the attacker. Any user with access to the Grafana instance could abuse this issue and obtain sensitive information or cause a DoS.",
    "publishedDate": "2020-06-10T16:29:24.148Z",
    "updatedDate": "2020-12-17T16:22:44.866Z",
    "disclosureDate": "2020-06-03T00:00:00.000Z",
    "exploitPublishDate": "2020-07-06T00:00:00.000Z",
    "solution": "Fixed in **[7.0.2](https://github.com/grafana/grafana/releases/tag/v7.0.2)** by [this](https://github.com/grafana/grafana/commit/7a9c0e31ec) commit.\n\nFixed in **[6.7.4](https://github.com/grafana/grafana/releases/tag/v6.7.4)** by [this](https://github.com/grafana/grafana/commit/7031b922c6) commit.\n\nThe latest stable releases can be found [here](https://github.com/grafana/grafana/releases).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 6.4,
        "impactSubscore": 4.9,
        "exploitabilitySubscore": 10.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "NONE",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.0
        },
        "vector": "(AV:N/AC:L/Au:N/C:P/I:N/A:P/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.2,
        "impactSubscore": 4.2,
        "exploitabilitySubscore": 3.9,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "NONE",
        "availabilityImpact": "LOW",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.4
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:L/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Justin Gardner @rhynorater",
    "workaround": "To mitigate this vulnerability the vendor recommends blocking access to the avatar feature by blocking the `/avatar/*` URL via a web application firewall, load balancer, reverse proxy, or similar. Or alternatively by restricting access to Grafana.",
    "vendorFixDate": "2020-05-19T00:00:00.000Z",
    "vendorNotifiedDate": "2020-05-14T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 7.4,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-1368",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-918"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2020-13379",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-1368/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/grafana/grafana/commit/7031b922c6",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/grafana/grafana/commit/7a9c0e31ec",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/grafana/grafana/releases/tag/v6.7.4",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/grafana/grafana/releases/tag/v7.0.2",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://grafana.com/blog/2020/06/03/grafana-6.7.4-and-7.0.2-released-with-important-security-fix/",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://grafana.com/blog/2020/06/03/grafana-6.7.4-and-7.0.2-released-with-important-security-fix/",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://www.exploit-db.com/exploits/48638",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://www.openwall.com/lists/oss-security/2020/06/09/2",
                "label": "ADVISORY"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-1368/default-remediation-status"
            }
        ]
    }
}