{
    "source": "BDSA",
    "name": "BDSA-2018-4831",
    "title": "mod_auth_mellon Vulnerable to Authentication Bypass via Special HTTP Headers",
    "description": "mod_auth_mellon is vulnerable to authentication bypass. An attacker could add special HTTP headers to bypass authentication.",
    "technicalDescription": "The vulnerability occurs if `mod_auth_mellon` is configured with the require valid user directive to only let authenticated users through and Apache is configured as a reverse proxy. An attacker could bypass authentication by adding special HTTP headers that are normally used to start  Enhanced Client or Proxy (ECP).\n\nWhen the client initiates ECP flow, the Service Provider (SP) responds with HTTP 200 and a signed XML document that contains the `samlp:AuthnRequest` element but not the requested content.\n\nTo get access to the protected resource, the ECP client determines the IDP (Identity Provider) and sends the document to it. The ECP then receives a `samlp:Response` from the IDP and sends that to the SP.\n\nInternally the Authorization check is normally carried out using the function `am_check_uid()` set to apache's `ap_hook_check_user_id()` hook. This usually responds with `OK` without any actual authentication being done. \n\nIn the Usual flow the `ap_hook_handler` handles this request, during the process Mellon registers function `am_handler()` which should run first `(APR_HOOK_FIRST)`. This function identifies that the request is an ECP request and returns the ECP `AuthnRequest` document. \n\nHowever, in this case the proxy module is also active, this module intercepts the request before the `ap_hook_handler` and winning a 'race-condition' handles it first. Resulting in bypassing the authentication check due to the ECP flow not triggering, so the request reaches the protected resource via `mod_proxy` and returning it without authentication.\n\nThe fix modifies the handlers from `mod_proxy.c` to run after the  `ap_hook_handler()`.",
    "publishedDate": "2019-04-08T15:53:35.015Z",
    "updatedDate": "2019-04-08T15:53:35.003Z",
    "disclosureDate": "2018-10-05T00:00:00.000Z",
    "exploitPublishDate": "2019-03-12T00:00:00.000Z",
    "solution": "Fixed in version [**0.14.2**](https://github.com/Uninett/mod_auth_mellon/releases/tag/v0.14.2) by [this](https://github.com/Uninett/mod_auth_mellon/commit/e09a28a30e13e5c22b481010f26b4a7743a09280) commit",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 2.6,
        "impactSubscore": 2.9,
        "exploitabilitySubscore": 4.9,
        "severity": "LOW",
        "accessVector": "NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "NONE",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 2.0
        },
        "vector": "(AV:N/AC:H/Au:N/C:N/I:P/A:N/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 5.9,
        "impactSubscore": 3.6,
        "exploitabilitySubscore": 2.2,
        "severity": "MEDIUM",
        "attackVector": "NETWORK",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "NONE",
        "integrityImpact": "HIGH",
        "availabilityImpact": "NONE",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.3
        },
        "vector": "CVSS:3.0/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:H/A:N/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "bmesegue",
    "workaround": "",
    "vendorFixDate": "2019-03-05T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 5.3,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2018-4831",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-288"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-3878",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2018-4831/ranges"
            },
            {
                "rel": "reference",
                "href": "https://bugzilla.redhat.com/show_bug.cgi?id=1576719",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/Uninett/mod_auth_mellon/commit/e09a28a30e13e5c22b481010f26b4a7743a09280",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/Uninett/mod_auth_mellon/commit/e09a28a30e13e5c22b481010f26b4a7743a09280",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/Uninett/mod_auth_mellon/pull/196",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://github.com/Uninett/mod_auth_mellon/releases/tag/v0.14.2",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2018-4831/default-remediation-status"
            }
        ]
    }
}