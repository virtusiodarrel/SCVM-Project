{
    "source": "BDSA",
    "name": "BDSA-2021-3435",
    "title": "Samba Vulnerable to Domain Compromise via Unreliable Authentication Provided to Non-Samba Applications",
    "description": "Samba as an Active Directory Domain Controller does not provide a way for Linux applications to obtain a reliable security identifier (SID) in the issued Kerberos tickets. The lack of secure identification in non-Samba applications could result in the confusion of one Kerberos user for another. This could be exploited in order to compromise the domain.",
    "technicalDescription": "There is a lack of secure authentication provision which allows vulnerabilities such as `CVE-2020-25717` (`BDSA-2021-3390`) to appear in AD Kerberos accepting services. Although the AD PAC provides reliable authentication, the most useful information is kept in a buffer which is NDR encoded, which means that only Samba and applications which use Samba components under the hood (such as FreeIPA and SSSD) decode PAC. To fix this issue, Samba now provides an extension to `UPN_DNS_INFO`, a component of the AD PAC, in a way that can be parsed using basic pointer handling. This will allow non-Samba applications to avoid confusing one Kerberos user for another, even if they have the same string name (due to the gap between time of ticket printing by the KDC and time of ticket acceptance).",
    "publishedDate": "2021-11-12T16:15:43.754Z",
    "updatedDate": "2021-11-12T16:15:43.741Z",
    "disclosureDate": "2021-11-09T00:00:00.000Z",
    "solution": "Fixed in:\n* [**4.15.2**](https://github.com/samba-team/samba/releases/tag/samba-4.15.2)\n* [**4.14.10**](https://github.com/samba-team/samba/releases/tag/samba-4.14.10)\n* [**4.13.14**](https://github.com/samba-team/samba/releases/tag/samba-4.13.14)\n\nThe latest stable releases can be found [here](https://download.samba.org/pub/samba/).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 3.6,
        "impactSubscore": 4.9,
        "exploitabilitySubscore": 3.9,
        "severity": "LOW",
        "accessVector": "NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "SINGLE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 2.6
        },
        "vector": "(AV:N/AC:H/Au:S/C:P/I:P/A:N/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.2,
        "impactSubscore": 5.8,
        "exploitabilitySubscore": 1.8,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "NONE",
        "privilegesRequired": "LOW",
        "scope": "CHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.1
        },
        "vector": "CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:C/C:H/I:H/A:N/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Andrew Bartlett",
    "workaround": "The vendor provides the following workaround:\n\n\"It would be prudent to pre-create disabled users in Active Directory matching on all privileged names not held in Active Directory, eg\n```\n samba-tool user add root -H ldap://$SERVER -U$USERNAME%$PASSWORD --random-password\n samba-tool user add ubuntu -H ldap://$SERVER -U$USERNAME%$PASSWORD --random-password\n ...\n ```\n (repeat for eg all system users under 1000 in `/etc/passwd` or special to any other AD-connected services, eg perhaps `admin` for a web-app)\n\nIf running a Microsoft Windows Active Directory, setting `ms-DS-MachineAccountQuota` to 0 in the Active Directory domain would be advised, if possible.\"",
    "vendorFixDate": "2021-11-08T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 7.1,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-3435",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-285"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2020-25721",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-3435/ranges"
            },
            {
                "rel": "reference",
                "href": "https://download.samba.org/pub/samba/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/samba-team/samba/releases/tag/samba-4.13.14",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/samba-team/samba/releases/tag/samba-4.14.10",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/samba-team/samba/releases/tag/samba-4.15.2",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://www.samba.org/samba/security/CVE-2020-25721.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.samba.org/samba/security/CVE-2020-25721.html",
                "label": "WORKAROUND"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-3435/default-remediation-status"
            }
        ]
    }
}