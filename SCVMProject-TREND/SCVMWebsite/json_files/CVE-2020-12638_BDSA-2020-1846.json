{
    "source": "BDSA",
    "name": "BDSA-2020-1846",
    "title": "Espressif ESP-IDF Vulnerable to Encryption Bypass via Forged Wi-Fi Beacon Frame",
    "description": "Espressif ESP-IDF, a development framework used in ESP32 series system-on-chip microcontrollers, is vulnerable to wireless WPA2 encryption bypass. An unauthenticated attacker could send crafted Wi-Fi beacons to force the affected devices to transmit frames without encryption and thus potentially reveal sensitive data. Although this is a severe information disclosure flaw, it does not allow the attacker to bypass network-layer protections (such as TLS) or obtain any access to the Wi-Fi access point. However, it does allow the attacker to force the affected devices to connect to a rogue access point, essentially allowing man-in-the-middle (MitM) attacks.",
    "technicalDescription": "This vulnerability can be exploited by spoofing a beacon from the access point with the privacy bit set to zero. This causes Espressif devices to switch to the open authentication mode and send out unencrypted traffic until it receives a beacon frame from the original access point again. Since this results in an inconsistent connection in terms of encryption, the attacker may use Channel Switch Announcement to switch the affected devices' operating frequency, forcing them to disconnect from the original access point and connect to a rogue one. In this case the attacker would not only be able to read, but also replay and manipulate the traffic.",
    "publishedDate": "2020-07-27T11:06:37.344Z",
    "updatedDate": "2021-09-30T15:35:58.011Z",
    "disclosureDate": "2020-07-23T00:00:00.000Z",
    "exploitPublishDate": "2020-07-23T00:00:00.000Z",
    "solution": "Fixed in ESP-IDF:\n* [**3.2.4**](https://github.com/espressif/esp-idf/releases/tag/v3.2.4) by [this](https://github.com/espressif/esp-idf/commit/a5c8cdd30) commit.\n* [**3.3.3**](https://github.com/espressif/esp-idf/releases/tag/v3.3.3) by [this](https://github.com/espressif/esp-idf/commit/4891fcea78574257235747b645f5ed928fad3a6e) commit.\n* [**4.0.2**](https://github.com/espressif/esp-idf/releases/tag/v4.0.2) by [this](https://github.com/espressif/esp-idf/commit/68b272f5) commit.\n* [**4.1-rc**](https://github.com/espressif/esp-idf/releases/tag/v4.1-rc) by [this](https://github.com/espressif/esp-idf/commit/b6e2163e5ec9288903a99cfd99ea06ae7bf8cd9a) commit.\n* [**4.2-rc**](https://github.com/espressif/esp-idf/releases/tag/v4.2-rc) by [this](https://github.com/espressif/esp-idf/commit/ad5c4eb3f5c2c4942b2669cc232561ab78bdfd62) commit.\n* [This](https://github.com/espressif/esp-idf/commit/a280fb32) commit in the **release/v3.1** branch. It is not yet included in any release.\n\nFixed in ESP8266 NON-OS SDK  by [this](https://github.com/espressif/ESP8266_NONOS_SDK/commit/be2f86d30c46267ae4fed66f08138c1881eb71c1) commit. It is not yet included in any release.\n\nFixed in ESP8266 RTOS SDK by:\n* [**3.4-rc**](https://github.com/espressif/ESP8266_RTOS_SDK/releases/tag/v3.4-rc) by [this](https://github.com/espressif/ESP8266_RTOS_SDK/commit/65a1809ee8563fb0a7430593dccec07e07d95fb6) commit and [this](https://github.com/espressif/ESP8266_RTOS_SDK/commit/da3362ecab9106e28dd869e346041831296707fd) commit.\n* [This](https://github.com/espressif/ESP8266_RTOS_SDK/commit/9c72c21b563576ed7f9d54a4358422109f747b29) commit in **release/v3.3** branch. It is not yet included in any release.\n* [This](https://github.com/espressif/ESP8266_RTOS_SDK/commit/3cbc3d87) commit in **release/v3.2** branch. It is not yet included in any release.\n* [This](https://github.com/espressif/ESP8266_RTOS_SDK/commit/4b1ff5c3) commit in **release/v3.1** branch. It is not yet included in any release.\n* [This](https://github.com/espressif/ESP8266_RTOS_SDK/commit/6ef5c2c24c6a7f2a552806d31d348eb4e484b7c8) commit in **release/v3.0** branch. It is not yet included in any release.\n* [This](https://github.com/espressif/ESP8266_RTOS_SDK/commit/db188200bc7aa19feeb) commit in **release/v2.1** branch. It is not yet included in any release.",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 5.8,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 6.5,
        "severity": "MEDIUM",
        "accessVector": "ADJACENT_NETWORK",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.6
        },
        "vector": "(AV:A/AC:L/Au:N/C:P/I:P/A:P/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 9.6,
        "impactSubscore": 6.0,
        "exploitabilitySubscore": 2.8,
        "severity": "HIGH",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "CHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 8.6
        },
        "vector": "CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Lukas Bachschwell",
    "workaround": "To work around this issue the credited researcher suggests increasing the log level of the Espressif SDK and looking for `WIFI_EVENT_STA_AUTHMODE_CHANGED` event. This would show when Wi-Fi connection switches to a less secure authentication mode, making it trivial to detect attacks and disconnect from the network.",
    "vendorFixDate": "2020-07-03T00:00:00.000Z",
    "vendorNotifiedDate": "2020-05-30T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 8.6,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-1846",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-300"
            },
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-311"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2020-12638",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-1846/ranges"
            },
            {
                "rel": "reference",
                "href": "https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-guides/wifi.html#wifi-event-sta-authmode-change",
                "label": "LINK"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/ESP8266_NONOS_SDK/commit/be2f86d30c46267ae4fed66f08138c1881eb71c1",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/ESP8266_RTOS_SDK/commit/3cbc3d87",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/ESP8266_RTOS_SDK/commit/4b1ff5c3",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/ESP8266_RTOS_SDK/commit/65a1809ee8563fb0a7430593dccec07e07d95fb6",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/ESP8266_RTOS_SDK/commit/6ef5c2c24c6a7f2a552806d31d348eb4e484b7c8",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/ESP8266_RTOS_SDK/commit/9c72c21b563576ed7f9d54a4358422109f747b29",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/ESP8266_RTOS_SDK/commit/da3362ecab9106e28dd869e346041831296707fd",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/ESP8266_RTOS_SDK/commit/db188200bc7aa19feeb",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/ESP8266_RTOS_SDK/releases/tag/v3.4-rc",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/esp-idf/commit/4891fcea78574257235747b645f5ed928fad3a6e",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/esp-idf/commit/68b272f5",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/esp-idf/commit/a280fb32",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/esp-idf/commit/a5c8cdd30",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/esp-idf/commit/ad5c4eb3f5c2c4942b2669cc232561ab78bdfd62",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/esp-idf/commit/b6e2163e5ec9288903a99cfd99ea06ae7bf8cd9a",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/esp-idf/releases/tag/v3.2.4",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/esp-idf/releases/tag/v3.3.3",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/esp-idf/releases/tag/v4.0.2",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/esp-idf/releases/tag/v4.1-rc",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/esp-idf/releases/tag/v4.2-rc",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://lbsfilm.at/blog/wpa2-authenticationmode-downgrade-in-espressif-microprocessors",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://lbsfilm.at/blog/wpa2-authenticationmode-downgrade-in-espressif-microprocessors",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://lbsfilm.at/blog/wpa2-authenticationmode-downgrade-in-espressif-microprocessors",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://www.espressif.com/sites/default/files/advisory_downloads/Security%20advisory_%20authentication%20bypass.pdf",
                "label": "ADVISORY"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-1846/default-remediation-status"
            }
        ]
    }
}