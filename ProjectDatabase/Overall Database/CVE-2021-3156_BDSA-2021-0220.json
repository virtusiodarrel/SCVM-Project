{
    "source": "BDSA",
    "name": "BDSA-2021-0220",
    "title": "Sudo Vulnerable to Privilege Escalation via Heap-Based Buffer Overflow in 'set_cmnd'",
    "description": "Sudo contains a privilege escalation vulnerability.  This vulnerability allows a local attacker to use the `sudoedit` (or `sudo -e`) utility to escalate their privileges to root.\n\nThis vulnerability is listed as exploitable by the Cybersecurity & Infrastructure Security Agency in their [Known Exploited Vulnerabilities Catalog](https://www.cisa.gov/known-exploited-vulnerabilities-catalog).",
    "technicalDescription": "Sudo expects special characters to be escaped when being ran in shell mode (using either the `-s` or `-i ` flags).  The sudoers policy plugin will then remove the escape characters before evaluating the sudoers policy. \n\nThe heap based buffer overflow occurs in the `set_cmnd()` function in `plugins/sudoers/sudoers.c`. When removing the escape characters, if the string being parsed ends with a backslash character, the function will read beyond the buffer. \n\nPrivilege escalation can be achieved using this heap buffer overflow when used in conjunction with `sudoedit` using the `-s` or `-i` options.  This sets an internal flag which states that shell mode is enabled.  Since no command is being ran, the arguments  are not escaped.  The code path to decide if escape characters need to be removed does not check whether a command is actually being run, just that the shell flag is set. This inconsistency is what can lead to privilege escalation.",
    "publishedDate": "2021-01-27T14:32:59.213Z",
    "updatedDate": "2022-05-09T13:32:56.812Z",
    "disclosureDate": "2021-01-26T00:00:00.000Z",
    "exploitPublishDate": "2021-01-26T00:00:00.000Z",
    "solution": "Fixed in [**1.9.5p2**](https://github.com/sudo-project/sudo/releases/tag/SUDO_1_9_5p2) by commits:\n* [Commit 1](https://github.com/sudo-project/sudo/commit/1f8638577d0c80a4ff864a2aad80a0d95488e9a8),\n* [Commit 2](https://github.com/sudo-project/sudo/commit/b301b46b79c6e2a76d530fa36d05992e74952ee8),\n* [Commit 3](https://github.com/sudo-project/sudo/commit/c4d384082fdbc8406cf19e08d05db4cded920a55).\n\nThe latest stable releases are available [here](https://github.com/sudo-project/sudo/releases).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 4.6,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 3.9,
        "severity": "LOW",
        "accessVector": "LOCAL",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 3.8
        },
        "vector": "(AV:L/AC:L/Au:N/C:P/I:P/A:P/E:F/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.4,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 2.5,
        "severity": "HIGH",
        "attackVector": "LOCAL",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.8
        },
        "vector": "CVSS:3.1/AV:L/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H/E:F/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Qualys Security",
    "workaround": "",
    "vendorFixDate": "2021-01-23T00:00:00.000Z",
    "vendorNotifiedDate": "2021-01-13T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 7.8,
    "_meta": {
        "allow": [],
        "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/BDSA-2021-0220",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro.app.blackduck.com/api/cwes/CWE-270"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/CVE-2021-3156",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/BDSA-2021-0220/ranges"
            },
            {
                "rel": "reference",
                "href": "https://bugzilla.redhat.com/show_bug.cgi?id=1917684",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/sudo-project/sudo/commit/1f8638577d0c80a4ff864a2aad80a0d95488e9a8",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/sudo-project/sudo/commit/b301b46b79c6e2a76d530fa36d05992e74952ee8",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/sudo-project/sudo/commit/c4d384082fdbc8406cf19e08d05db4cded920a55",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/sudo-project/sudo/releases",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/sudo-project/sudo/releases/tag/SUDO_1_9_5p2",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://www.cisa.gov/known-exploited-vulnerabilities-catalog",
                "label": "EXPLOIT"
            },
            {
                "rel": "reference",
                "href": "https://www.exploit-db.com/exploits/49521",
                "label": "EXPLOIT"
            },
            {
                "rel": "reference",
                "href": "https://www.openwall.com/lists/oss-security/2021/01/26/3",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.sudo.ws/alerts/unescape_overflow.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.sudo.ws/repos/sudo/rev/SUDO_1_9_5p2",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://www.sudo.ws/stable.html#1.9.5p2",
                "label": "ADVISORY"
            }
        ]
    }
}