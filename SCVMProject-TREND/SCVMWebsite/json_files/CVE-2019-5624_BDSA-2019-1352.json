{
    "source": "BDSA",
    "name": "BDSA-2019-1352",
    "title": "Metasploit Framework Vulnerable to Remote Code Execution (RCE) via Path Traversal in ZIP Import",
    "description": "Metasploit Framework is vulnerable to remote code execution (RCE) due to missing path validation when importing ZIP files. An attacker could leverage this flaw by tricking a user into downloading and importing a malicious archive into a Metasploit project. This can result in arbitrary code execution on the underlying host with the privilege level of a root user.",
    "technicalDescription": "This flaw lies in the `import_msf_zip()` function of the `zip.rb` source file.  Contrary to the usage documentation of the Rubyzip library used for extracting archives, Metasploit does not perform adequate validation of the entry name and the destination path before calling `Entry#extract`. This leaves it vulnerable to a path traversal attack which can be used to perform an arbitrary write to disk. With an appropriately crafted payload the flaw can be further leveraged to achieve remote code execution (RCE) on the target host. Additionally, as the `extract` operation is run as root, this can lead to a complete compromise of the system.",
    "publishedDate": "2019-05-02T10:04:28.273Z",
    "updatedDate": "2019-05-02T10:04:28.264Z",
    "disclosureDate": "2019-04-24T00:00:00.000Z",
    "exploitPublishDate": "2019-04-24T00:00:00.000Z",
    "solution": "Fixed in [**4.17.52**](https://github.com/rapid7/metasploit-framework/releases) by [this](https://github.com/rapid7/metasploit-framework/commit/bd5ab45fe7ed43c2867b5e8e8cf6762b0cd91f3f) commit.\n\nFixed in [**5.0.17**](https://github.com/rapid7/metasploit-framework/releases) by the following commits:\n* [Commit 1](https://github.com/rapid7/metasploit-framework/commit/6bf824d200b72a3974738b447c7d4977e9d3e016),\n* [Commit 2](https://github.com/rapid7/metasploit-framework/commit/04dcd8a1f9d69b0937567b3ce4b3c79ab7a35e5e), and\n* [Commit 3](https://github.com/rapid7/metasploit-framework/commit/cf7096f8ba899a93c254f9e83417865257681d1a).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 9.3,
        "impactSubscore": 10.0,
        "exploitabilitySubscore": 8.6,
        "severity": "HIGH",
        "accessVector": "NETWORK",
        "accessComplexity": "MEDIUM",
        "authentication": "NONE",
        "confidentialityImpact": "COMPLETE",
        "integrityImpact": "COMPLETE",
        "availabilityImpact": "COMPLETE",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.7
        },
        "vector": "(AV:N/AC:M/Au:N/C:C/I:C/A:C/E:F/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 7.8,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 1.8,
        "severity": "HIGH",
        "attackVector": "LOCAL",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "REQUIRED",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.2
        },
        "vector": "CVSS:3.0/AV:L/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H/E:F/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "@voidsec, @polict",
    "workaround": "",
    "vendorFixDate": "2019-04-12T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 7.2,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-1352",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-22"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-5624",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-1352/ranges"
            },
            {
                "rel": "reference",
                "href": "https://blog.doyensec.com/2019/04/24/rubyzip-bug.html",
                "label": "EXPLOIT"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rapid7/metasploit-framework/commit/04dcd8a1f9d69b0937567b3ce4b3c79ab7a35e5e",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rapid7/metasploit-framework/commit/6bf824d200b72a3974738b447c7d4977e9d3e016",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rapid7/metasploit-framework/commit/bd5ab45fe7ed43c2867b5e8e8cf6762b0cd91f3f",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rapid7/metasploit-framework/commit/cf7096f8ba899a93c254f9e83417865257681d1a",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rapid7/metasploit-framework/releases",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://help.rapid7.com/metasploit/release-notes/archive/2019/04/#20190416",
                "label": "ADVISORY"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-1352/default-remediation-status"
            }
        ]
    }
}