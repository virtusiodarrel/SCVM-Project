{
    "source": "BDSA",
    "name": "BDSA-2021-2730",
    "title": "HAProxy Vulnerable to HTTP Request Smuggling or Response-Splitting Attacks via Integer Overflow in 'htx.h'",
    "description": "HAProxy is vulnerable to HTTP request smuggling or response-splitting attacks due to an integer overflow within the `htx.h` file. An attacker could exploit this via a crafted HTTP header. Successful exploitation could lead to impacts such as sensitive data exposure, security control bypass, data modification, command execution, reflected cross-site scripting (XSS), and hijacking of user sessions.",
    "technicalDescription": "This issue occurs in the `htx_add_header()` and `htx_add_trailer()` functions of the `src/htx.c` file because they failed to check the length of the HTTP header name. This can result in bits of the header name length running over in to the header value length which could allow the ability to forge certain header names upon input. The `content-length` header field was most vulnerable since it is de-duplicated on input, before being indexed. Successful injection after the initial de-duplication stage could result in a request smuggling, or a response splitting attack. It was mitigated by the addition of a length check within both functions.",
    "publishedDate": "2021-09-09T13:56:03.395Z",
    "updatedDate": "2021-12-08T11:28:40.137Z",
    "disclosureDate": "2021-09-07T00:00:00.000Z",
    "exploitPublishDate": "2021-09-07T00:00:00.000Z",
    "solution": "Fixed in:\n* [**2.0.25**](http://git.haproxy.org/?p=haproxy-2.0.git;a=tag;h=ec59611a92619a348c97842ce2695e82a2712e90) by [this](http://git.haproxy.org/?p=haproxy-2.0.git;a=commit;h=50b2fa6b6e5f8b6c5b50dca51a20111ea0bec7d4) commit,\n* [**2.2.17**](http://git.haproxy.org/?p=haproxy-2.2.git;a=tag;h=885b5f29d2ce30b73ff7a57b07db7f072a2d913c) by [this](http://git.haproxy.org/?p=haproxy-2.2.git;a=commit;h=0a5d4e699607f5e116980a70f09d5d3a79bb4ca8) commit,\n* [**2.3.14**](http://git.haproxy.org/?p=haproxy-2.3.git;a=tag;h=a1a2687025b33c6fce1c964c6bd02ebfec8e4825) by [this](http://git.haproxy.org/?p=haproxy-2.3.git;a=commit;h=ac19a3112534668258fb6d1b5e77cb9acc9e348f) commit,\n* [**2.4.4**](http://git.haproxy.org/?p=haproxy-2.4.git;a=tag;h=4ac7a8c528f25794522f6f3bac2e78bab4c7969b) by [this](http://git.haproxy.org/?p=haproxy-2.4.git;a=commit;h=1fd2566683f6fb66b180ce9c3d9062ddaa81d6d7) commit.\n\nThe latest stable releases can be found [here](http://www.haproxy.org/).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 7.8,
        "impactSubscore": 6.9,
        "exploitabilitySubscore": 10.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "NONE",
        "integrityImpact": "COMPLETE",
        "availabilityImpact": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 6.1
        },
        "vector": "(AV:N/AC:L/Au:N/C:N/I:C/A:N/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.6,
        "impactSubscore": 4.0,
        "exploitabilitySubscore": 3.9,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "NONE",
        "integrityImpact": "HIGH",
        "availabilityImpact": "NONE",
        "privilegesRequired": "NONE",
        "scope": "CHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.7
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:N/I:H/A:N/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Ori Hollander of JFrog Security",
    "workaround": "The vendor proposes the following workaround for those unable to upgrade immediately:\n\n```\nfrontend myfrontend\n   http-request deny if { req.hdr_cnt(content-length) gt 1 }\n   http-response deny if { res.hdr_cnt(content-length) gt 1 }\n```\n\nThese lines reject requests or responses that have more than one Content-Length header.",
    "vendorFixDate": "2021-09-03T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 7.7,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2730",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-113"
            },
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-190"
            },
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-444"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-40346",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2730/ranges"
            },
            {
                "rel": "reference",
                "href": "http://git.haproxy.org/?p=haproxy-2.0.git;a=commit;h=50b2fa6b6e5f8b6c5b50dca51a20111ea0bec7d4",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "http://git.haproxy.org/?p=haproxy-2.0.git;a=tag;h=ec59611a92619a348c97842ce2695e82a2712e90",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "http://git.haproxy.org/?p=haproxy-2.2.git;a=commit;h=0a5d4e699607f5e116980a70f09d5d3a79bb4ca8",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "http://git.haproxy.org/?p=haproxy-2.2.git;a=tag;h=885b5f29d2ce30b73ff7a57b07db7f072a2d913c",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "http://git.haproxy.org/?p=haproxy-2.3.git;a=commit;h=ac19a3112534668258fb6d1b5e77cb9acc9e348f",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "http://git.haproxy.org/?p=haproxy-2.3.git;a=tag;h=a1a2687025b33c6fce1c964c6bd02ebfec8e4825",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "http://git.haproxy.org/?p=haproxy-2.4.git;a=commit;h=1fd2566683f6fb66b180ce9c3d9062ddaa81d6d7",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "http://git.haproxy.org/?p=haproxy-2.4.git;a=tag;h=4ac7a8c528f25794522f6f3bac2e78bab4c7969b",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "http://www.haproxy.org/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://git.haproxy.org/?p=haproxy-2.2.git;a=commit;h=a3d2a16fada001dcee7897e49a68235d92539cdc",
                "label": "INTRODUCTORY_COMMIT"
            },
            {
                "rel": "reference",
                "href": "https://jfrog.com/blog/critical-vulnerability-in-haproxy-cve-2021-40346-integer-overflow-enables-http-smuggling/",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://jfrog.com/blog/critical-vulnerability-in-haproxy-cve-2021-40346-integer-overflow-enables-http-smuggling/",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://security-tracker.debian.org/tracker/CVE-2021-40346",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.haproxy.com/blog/september-2021-duplicate-content-length-header-fixed/",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.haproxy.com/blog/september-2021-duplicate-content-length-header-fixed/",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://www.mail-archive.com/haproxy@formilux.org/msg41114.html",
                "label": "ADVISORY"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2730/default-remediation-status"
            }
        ]
    }
}