{
    "source": "BDSA",
    "name": "BDSA-2019-0800",
    "title": "Consul Vulnerable to Privilege Escalation via ACL Token Replication (Multi-Datacenter)",
    "description": "Consul setups that meet a specific set of pre-conditions are vulnerable to privilege escalation due to an issue with the ACL system. An attacker could leverage this flaw to gain the privileges of one other arbitrary ACL token within secondary datacenters.\n\nOnly Consul servers must be upgraded as the clients are unaffected.",
    "technicalDescription": "It is possible to obtain the privileges for a specific token if the following conditions are met:\n* Secondary datacenters have ACL token replication enabled.\n* Replication tokens must have been assigned to the Consul servers in secondary datacenters.\n* ACLs must give the read privilege to the assigned replication token (but not write).\n\nGiven these conditions are met, the process of ACL token replication may erroneously inject a token with a secret of `<hidden>` into the local state store. This would allow other clients to pass the string `<hidden>` as the token to various API calls instead of the correct secret. An attacker could then assume the privilege level of that token and gain unauthorized access to sensitive resources. Such substitution is possible because the same string is utilized to redact the value of the token in some internal endpoints as a security mechanism. In the worst case scenario the token will be capable of unrestricted access in the secondary datacenter.\n\nIn order to detect whether a secondary datacenter is affected issue the following command in Consul CLI:\n```\nconsul acl token read -token \"<hidden>\" -self\n```\nNOTE: This command should be run from the secondary datacenter on a Consul node with the HTTP API enabled on localhost:8500. If the setup requires another method please refer to the documentation [here](https://www.consul.io/docs/commands/acl/acl-token.html#common-subcommand-options).",
    "publishedDate": "2019-03-21T16:57:36.168Z",
    "updatedDate": "2019-03-21T16:57:36.156Z",
    "disclosureDate": "2019-03-04T00:00:00.000Z",
    "solution": "Fixed in [**1.4.3**](https://www.consul.io/downloads.html) by [this](https://github.com/hashicorp/consul/commit/90040f8bffb311e6cd8599273e95b607175e311f) commit.\n\nIf the conditions outlined in the technical description have been met, the vulnerable token will automatically be invalidated and removed on upgrade.",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 5.1,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 4.9,
        "severity": "LOW",
        "accessVector": "NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 3.8
        },
        "vector": "(AV:N/AC:H/Au:N/C:P/I:P/A:P/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.1,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 2.2,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.1
        },
        "vector": "CVSS:3.0/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "workaround": "If not using local tokens (which require token replication), disabling token replication is the simplest way to remediate without upgrading.\n\nDisable token replication:\n1. Set the `acl.token_replication` configuration to `false` for Consul servers in the secondary datacenters.\n2. Perform a rolling restart of the Consul servers within those secondary datacenters.",
    "vendorFixDate": "2019-03-04T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 7.1,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0800",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-20"
            },
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-269"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-8336",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0800/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/hashicorp/consul/commit/90040f8bffb311e6cd8599273e95b607175e311f",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/hashicorp/consul/issues/5423",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/hashicorp/consul/issues/5423",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://www.consul.io/docs/commands/acl/acl-token.html#common-subcommand-options",
                "label": "LINK"
            },
            {
                "rel": "reference",
                "href": "https://www.consul.io/downloads.html",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0800/default-remediation-status"
            }
        ]
    }
}