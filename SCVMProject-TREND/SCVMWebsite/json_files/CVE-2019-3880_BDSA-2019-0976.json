{
    "source": "BDSA",
    "name": "BDSA-2019-0976",
    "title": "Samba Vulnerable to Arbitrary Write and Information Disclosure via Symlink Traversal in 'winreg'",
    "description": "Samba is vulnerable to symlink-based attacks due to insufficient validation of supplied pathnames. An authenticated attacker with write permissions could leverage this flaw to write or detect files outside the Samba share.",
    "technicalDescription": "Samba contains a flaw in its implementation of the Windows registry service API. The `winreg_SaveKey` request is not properly validated, and vulnerable to symlink traversal attacks. An attacker could leverage this flaw to create a new registry hive file within Samba share, limited only by their unix permissions. If the attacker is able to create symlinks on the Samba share he can also use them to create a new registry hive file outside the Samba share (limited by unix permissions on the host).\n\nOther share protection mechanisms such as \"read only\" or share ACLs will not prevent the attacker from being able to create new registry hive files. This file can be created under any share definition, restricted only by the unix write permission. Existing files can not be overwritten.\n\nThis vulnerability can also allow an attacker to confirm the existence of files with a specified name.",
    "publishedDate": "2019-04-09T15:51:44.756Z",
    "updatedDate": "2019-04-09T15:51:44.741Z",
    "disclosureDate": "2019-04-08T00:00:00.000Z",
    "solution": "Fixed in:\n* [**4.8.11**](https://www.samba.org/samba/download/) by [this](https://github.com/samba-team/samba/commit/9a3ee861e43f84d48ef47998ceeb3bbf29f0c948) commit,\n* [**4.9.6**](https://www.samba.org/samba/download/) by [this](https://github.com/samba-team/samba/commit/d53121af8028bb39c1d61e0f5c26ae1d30ab6351) commit, and\n* [**4.10.2**](https://www.samba.org/samba/download/) by [this](https://github.com/samba-team/samba/commit/67c837789f321c42230bfc3592652ce858f68da1) commit.\n\nAdditionally a manual patch for the unsupported **4.5.x** can be found [here](https://attachments.samba.org/attachment.cgi?id=15001).",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 6.5,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 8.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "SINGLE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.8
        },
        "vector": "(AV:N/AC:L/Au:S/C:P/I:P/A:P/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 6.3,
        "impactSubscore": 3.4,
        "exploitabilitySubscore": 2.8,
        "severity": "MEDIUM",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "LOW",
        "integrityImpact": "LOW",
        "availabilityImpact": "LOW",
        "privilegesRequired": "LOW",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.5
        },
        "vector": "CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Michael Hanselmann",
    "workaround": "* Ensure the areas of the filesystem being exported by all share definitions do not contain symlinks which link to areas outside the share. This will limit the attacker to being able to create the registry hive files to only within the share.\n* If the server is exporting SMB1 shares, and the global parameter `unix extensions` is set to `yes` (default), then an attacker can create symlinks pointing outside the share definitions. Such symlinks can then be used to write the files to wherever the symlink points to. This can be mitigated by either setting the global parameter `min protocol = SMB2` or (if SMB1 is required) setting `unix extensions = no` in the `smb.conf` file.",
    "vendorFixDate": "2019-03-21T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 5.5,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0976",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-61"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-3880",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0976/ranges"
            },
            {
                "rel": "reference",
                "href": "https://attachments.samba.org/attachment.cgi?id=15001",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://bugzilla.samba.org/show_bug.cgi?id=13851",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/samba-team/samba/commit/67c837789f321c42230bfc3592652ce858f68da1",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/samba-team/samba/commit/9a3ee861e43f84d48ef47998ceeb3bbf29f0c948",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/samba-team/samba/commit/d53121af8028bb39c1d61e0f5c26ae1d30ab6351",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://www.samba.org/samba/download/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://www.samba.org/samba/security/CVE-2019-3880.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.samba.org/samba/security/CVE-2019-3880.html",
                "label": "WORKAROUND"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0976/default-remediation-status"
            }
        ]
    }
}