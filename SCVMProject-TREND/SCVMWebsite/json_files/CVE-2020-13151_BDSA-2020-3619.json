{
    "source": "BDSA",
    "name": "BDSA-2020-3619",
    "title": "Aerospike Database Vulnerable to OS Command Execution via Insufficient Blacklisting of Functions for Lua User-Defined Functions (UDFs)",
    "description": "Aerospike Database does not properly implement blacklisting of functions for Lua UDFs. This could allow attackers to use certain functions in registered Lua UDFs to execute arbitrary commands on any particular host in the cluster.",
    "technicalDescription": "This vulnerability exists because the application does not block certain functions, like `io.popen()`, while handling Lua UDFs. This could allow attackers to register UDFs containing such functions on any server in the cluster. The attackers can then use these UDFs to execute arbitrary commands on these servers. As demonstrated in the PoC, an attacker can register a UDF which executes and displays the results of arbitrary commands. Then, by creating datasets on any server, the attacker can execute the UDF in the context of these datasets and view the results of any command. Exploiting this vulnerability can also allow attackers to open a reverse shell on the affected server.\n\n**Note** This vulnerability has only be demonstrated to be exploitable for the community edition of the application. The attack is proven to be easy for the community edition because it does not provide authentication services. This exploitability of this vulnerability has not been tested on the enterprise edition.",
    "publishedDate": "2020-12-07T10:19:24.619Z",
    "updatedDate": "2020-12-07T10:19:24.609Z",
    "disclosureDate": "2020-08-01T00:00:00.000Z",
    "exploitPublishDate": "2020-08-01T00:00:00.000Z",
    "solution": "Fixed in [**4.5.3.21**](https://github.com/aerospike/aerospike-server/releases/tag/4.5.3.21) by [this](https://github.com/aerospike/aerospike-server/commit/e4210e67d2c94be6f5b2f9498e17b8797fd4835c) commit.\n\nFixed in [**4.6.0.19**](https://github.com/aerospike/aerospike-server/releases/tag/4.6.0.19) by [this](https://github.com/aerospike/aerospike-server/commit/e85a2f1af8b35ec319ed3c5af3a2688fa745763c) commit.\n\nFixed in [**4.7.0.17**](https://github.com/aerospike/aerospike-server/releases/tag/4.7.0.17) by [this](https://github.com/aerospike/aerospike-server/commit/c319c35a6ab5f4c238e47b67067763d1da60d4be) commit.\n\nFixed in [**4.8.0.13**](https://github.com/aerospike/aerospike-server/releases/tag/4.8.0.13) by [this](https://github.com/aerospike/aerospike-server/commit/a405a4c9d58c575915dc0c54533579d1232f59ca) commit.\n\nFixed in [**4.9.0.10**](https://github.com/aerospike/aerospike-server/releases/tag/4.9.0.10) by [this](https://github.com/aerospike/aerospike-server/commit/aa32a09f487653a2d8896efae526b7a139f7bd1f) commit.\n\nFixed in [**5.0.0.7**](https://github.com/aerospike/aerospike-server/releases/tag/5.0.0.7) by [this](https://github.com/aerospike/aerospike-server/commit/7644d13688bb914a384cf8a40da3645085636cd3) commit.\n\nFixed in [**5.1.0.1**](https://github.com/aerospike/aerospike-server/releases/tag/5.1.0.1) by [this](https://github.com/aerospike/aerospike-server/commit/9bc98b652b9c0afed0cf4fb93405b647ace83e3b) commit.\n\nThe latest stable releases are available [here](https://www.aerospike.com/download/).",
    "severity": "CRITICAL",
    "cvss2": {
        "baseScore": 7.5,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 10.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 6.2
        },
        "vector": "(AV:N/AC:L/Au:N/C:P/I:P/A:P/E:F/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 9.8,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 3.9,
        "severity": "CRITICAL",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 9.1
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H/E:F/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Matt S",
    "workaround": "The following workaround has been suggested:\n\n> Patch and firewall off backend servers if you\u2019re on the community edition (ideally, they should only respond to the web apps fronting them). If you\u2019re on the enterprise version, ensure you have strong authentication and minimize permission and access.",
    "vendorFixDate": "2020-08-17T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 9.1,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-3619",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-78"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2020-13151",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-3619/ranges"
            },
            {
                "rel": "reference",
                "href": "https://b4ny4n.github.io/network-pentest/2020/08/01/cve-2020-13151-poc-aerospike.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://b4ny4n.github.io/network-pentest/2020/08/01/cve-2020-13151-poc-aerospike.html",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://b4ny4n.github.io/network-pentest/2020/08/01/cve-2020-13151-poc-aerospike.html",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://github.com/aerospike/aerospike-server/commit/7644d13688bb914a384cf8a40da3645085636cd3",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/aerospike/aerospike-server/commit/9bc98b652b9c0afed0cf4fb93405b647ace83e3b",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/aerospike/aerospike-server/commit/a405a4c9d58c575915dc0c54533579d1232f59ca",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/aerospike/aerospike-server/commit/aa32a09f487653a2d8896efae526b7a139f7bd1f",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/aerospike/aerospike-server/commit/c319c35a6ab5f4c238e47b67067763d1da60d4be",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/aerospike/aerospike-server/commit/e4210e67d2c94be6f5b2f9498e17b8797fd4835c",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/aerospike/aerospike-server/commit/e85a2f1af8b35ec319ed3c5af3a2688fa745763c",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/aerospike/aerospike-server/releases/tag/4.5.3.21",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/aerospike/aerospike-server/releases/tag/4.6.0.19",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/aerospike/aerospike-server/releases/tag/4.7.0.17",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/aerospike/aerospike-server/releases/tag/4.8.0.13",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/aerospike/aerospike-server/releases/tag/4.9.0.10",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/aerospike/aerospike-server/releases/tag/5.0.0.7",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/aerospike/aerospike-server/releases/tag/5.1.0.1",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/b4ny4n/CVE-2020-13151",
                "label": "EXPLOIT"
            },
            {
                "rel": "reference",
                "href": "https://www.aerospike.com/download/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://www.exploit-db.com/exploits/49067",
                "label": "EXPLOIT"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-3619/default-remediation-status"
            }
        ]
    }
}