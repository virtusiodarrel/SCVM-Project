{
    "source": "BDSA",
    "name": "BDSA-2022-1976",
    "title": "Mbed TLS Vulnerable to Heap Buffer Overread via Invalid ClientHello Message",
    "description": "Certain configurations of DTLS server (Mbed TLS) contain a buffer over-read issue which can be triggered by sending an invalid ClientHello message. The DTLS server would then read up to 255 bytes of the heap buffer past the end of the message. Apart from the disclosed bytes, the vulnerability can also result in a server crash.",
    "technicalDescription": "Vulnerable are only those configurations that have `MBEDTLS_SSL_DTLS_CLIENT_PORT_REUSE` enabled and `MBEDTLS_SSL_IN_CONTENT_LEN` is small - 258 bytes if using `mbedtls_ssl_cookie_check`, and possibly up to 571 bytes with a custom cookie check function. On this setup the vulnerability will be triggered if the declared length of the cookie extends past the end of the message. DTLS server would then over-read the message buffer of size `MBEDTLS_SSL_IN_CONTENT_LEN` and continue reading up to 255 bytes, which is the cookie length limit.\n\n**Note:** the default value of `MBEDTLS_SSL_IN_CONTENT_LEN` is large enough to avoid the vulnerability. In addition to this, the `mbedtls_ssl_cookie_check()` function does not read the cookie if its length is unexpected.",
    "publishedDate": "2022-07-19T14:32:05.373Z",
    "updatedDate": "2022-07-19T14:32:05.361Z",
    "disclosureDate": "2022-07-11T00:00:00.000Z",
    "solution": "Fixed in **[2.28.1](https://github.com/ARMmbed/mbedtls/releases/tag/mbedtls-2.28.1)** by [this](https://github.com/ARMmbed/mbedtls/commit/e5af9fabf) commit and in **[3.2.0](https://github.com/ARMmbed/mbedtls/releases/tag/mbedtls-3.2.0)** by [this](https://github.com/ARMmbed/mbedtls/commit/c8183cc49) commit.\n\nThe latest stable releases can be found [here](https://github.com/Mbed-TLS/mbedtls/releases).",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 4.0,
        "impactSubscore": 4.9,
        "exploitabilitySubscore": 4.9,
        "severity": "LOW",
        "accessVector": "NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "NONE",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 3.0
        },
        "vector": "(AV:N/AC:H/Au:N/C:N/I:P/A:P/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 6.5,
        "impactSubscore": 4.2,
        "exploitabilitySubscore": 2.2,
        "severity": "MEDIUM",
        "attackVector": "NETWORK",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "NONE",
        "integrityImpact": "LOW",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.7
        },
        "vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:L/A:H/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Cybeats PSI Team",
    "workaround": "The vendor presents the following workaround:\n> A sufficiently large value of `MBEDTLS_SSL_IN_CONTENT_LEN` avoids the vulnerability. The threshold depends on the exact configuration. For example:\n> \n> With default options regarding DTLS and only support for AEAD ciphersuites, and using the default cookie check function `mbedtls_ssl_cookie_check()`, the threshold is 210 bytes.\n> \n> With `MBEDTLS_SSL_DTLS_CONNECTION_ID` enabled, the threshold can be up to 258 bytes if using `mbedtls_ssl_cookie_check()`.\n> \n> In the worst case, with a custom cookie check function, the threshold can be up to 571 bytes.\n> \n> Turning off `MBEDTLS_SSL_DTLS_CLIENT_PORT_REUSE` also avoids the vulnerability.",
    "vendorFixDate": "2022-06-06T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 5.7,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-1976",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-126"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2022-35409",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-1976/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/ARMmbed/mbedtls/commit/c8183cc49",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/ARMmbed/mbedtls/commit/e5af9fabf",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/ARMmbed/mbedtls/releases/tag/mbedtls-2.28.1",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/ARMmbed/mbedtls/releases/tag/mbedtls-3.2.0",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/Mbed-TLS/mbedtls/releases",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://mbed-tls.readthedocs.io/en/latest/security-advisories/advisories/mbedtls-security-advisory-2022-07.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://mbed-tls.readthedocs.io/en/latest/security-advisories/advisories/mbedtls-security-advisory-2022-07.html",
                "label": "WORKAROUND"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-1976/default-remediation-status"
            }
        ]
    }
}