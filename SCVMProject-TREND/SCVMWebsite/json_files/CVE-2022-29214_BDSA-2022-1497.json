{
    "source": "BDSA",
    "name": "BDSA-2022-1497",
    "title": "next-auth Vulnerable to Open Redirects via 'redirect' Function",
    "description": "next-auth is vulnerable to open redirects due to the unsafe dynamic construction of URLs. A remote attacker could trick a victim into visiting a malicious domain by tricking that victim into clicking on a crafted link.",
    "technicalDescription": "The `redirect()` function, of file `packages/next-auth/src/core/lib/default-callbacks.ts`, dynamically constructs URLs that are to be used for redirect operations. Insufficient restrictions are placed on the URLs that can be returned by this function. An attacker that can leverage this issue to cause a victim to be redirected to a malicious domain.",
    "publishedDate": "2022-05-30T13:03:13.780Z",
    "updatedDate": "2022-05-30T13:03:13.767Z",
    "disclosureDate": "2022-05-10T00:00:00.000Z",
    "solution": "Fixed in version [**4.3.3**](https://github.com/nextauthjs/next-auth/releases/tag/next-auth%40v4.3.3) by [this](https://github.com/nextauthjs/next-auth/commit/afdb3c8d7c4c1b20848bb43b72036897379c56ad) commit, and in version [**3.29.3**](https://www.npmjs.com/package/next-auth/v/3.29.3). \n\nThe latest stable releases can be found [here](https://www.npmjs.com/package/next-auth).",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 4.3,
        "impactSubscore": 2.9,
        "exploitabilitySubscore": 8.6,
        "severity": "LOW",
        "accessVector": "NETWORK",
        "accessComplexity": "MEDIUM",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "NONE",
        "availabilityImpact": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 3.2
        },
        "vector": "(AV:N/AC:M/Au:N/C:P/I:N/A:N/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 4.7,
        "impactSubscore": 1.4,
        "exploitabilitySubscore": 2.8,
        "severity": "MEDIUM",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "LOW",
        "integrityImpact": "NONE",
        "availabilityImpact": "NONE",
        "privilegesRequired": "NONE",
        "scope": "CHANGED",
        "userInteraction": "REQUIRED",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.1
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:N/A:N/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Ry0taK",
    "workaround": "The vendor has stated [here](https://github.com/nextauthjs/next-auth/security/advisories/GHSA-q2mx-j4x2-2h74) that the following workaround can be implemented:\n\n> If you are not able to upgrade for any reason, you can add the following configuration to your `callbacks` option:\n\n`// async redirect(url, baseUrl) { // v3\nasync redirect({ url, baseUrl }) { // v4\n    // Allows relative callback URLs\n    if (url.startsWith(\"/\")) return ``${baseUrl}${url}``\n    // Allows callback URLs on the same origin\n    else if (new URL(url).origin === baseUrl) return url\n    return baseUrl\n}`",
    "vendorFixDate": "2022-04-20T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 4.1,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-1497",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-601"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2022-29214",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-1497/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nextauthjs/next-auth/commit/afdb3c8d7c4c1b20848bb43b72036897379c56ad",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nextauthjs/next-auth/releases/tag/next-auth%40v4.3.3",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nextauthjs/next-auth/security/advisories/GHSA-q2mx-j4x2-2h74",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nextauthjs/next-auth/security/advisories/GHSA-q2mx-j4x2-2h74",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://www.npmjs.com/package/next-auth",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://www.npmjs.com/package/next-auth/v/3.29.3",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-1497/default-remediation-status"
            }
        ]
    }
}