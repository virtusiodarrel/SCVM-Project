{
    "source": "BDSA",
    "name": "BDSA-2019-4628",
    "title": "Grafana Vulnerable to Information Disclosure via Arbitrary File Read with 'newMysqlQueryEndpoint' Function",
    "description": "Grafana is vulnerable to an arbitrary file read issue due to how user input used to connect with MySQL servers is not sanitized.\n\nAn attacker could abuse this flaw in order to connect to a malicious MySQL server and read arbitrary files from the Grafana server, potentially revealing sensitive information like user passwords.",
    "technicalDescription": "Grafana is vulnerable to an arbitrary file read issue because the `newMysqlQueryEndpoint()` function in the `pkg/tsdb/mysql/mysql.go` file does not sanitize the user input used to create the Data Source Name (DSN) strings that allow Grafana to connect to a MySQL server. \n\nThe `datasource` fields are passed to `Sprintf()` to create the full connection string `cnnstr ` without any sanitization, which allows an attacker to alter the resulting DSN string.\n\nAn authenticated attacker can inject the `allowAllFiles` parameter into the DSN string to permit LOCAL INFILE requests and enable a malicious MySQL server to request content from files on the Grafana system.",
    "publishedDate": "2020-09-04T14:47:19.623Z",
    "updatedDate": "2020-09-04T14:47:19.617Z",
    "disclosureDate": "2019-11-06T00:00:00.000Z",
    "exploitPublishDate": "2020-08-27T00:00:00.000Z",
    "solution": "Fixed in [**6.4.4**](https://github.com/grafana/grafana/releases/tag/v6.4.4) by [this](https://github.com/grafana/grafana/commit/092e51408a7b81b742e284263dee5a896eb326d6) commit.\n\nThe latest stable releases are available [here](https://github.com/grafana/grafana/releases).",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 4.0,
        "impactSubscore": 2.9,
        "exploitabilitySubscore": 8.0,
        "severity": "LOW",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "SINGLE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "NONE",
        "availabilityImpact": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 3.1
        },
        "vector": "(AV:N/AC:L/Au:S/C:P/I:N/A:N/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 6.8,
        "impactSubscore": 4.0,
        "exploitabilitySubscore": 2.3,
        "severity": "MEDIUM",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "NONE",
        "availabilityImpact": "NONE",
        "privilegesRequired": "HIGH",
        "scope": "CHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 6.1
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:C/C:H/I:N/A:N/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Yuriy Dyachenko",
    "workaround": "",
    "vendorFixDate": "2019-11-06T00:00:00.000Z",
    "vendorNotifiedDate": "2019-10-28T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 6.1,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-4628",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-200"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-19499",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-4628/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/grafana/grafana/blob/master/CHANGELOG.md#644-2019-11-06",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/grafana/grafana/commit/092e51408a7b81b742e284263dee5a896eb326d6",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/grafana/grafana/commit/8f90c6115d111b35b5be52b0bab0ca67ba76aa43",
                "label": "INTRODUCTORY_COMMIT"
            },
            {
                "rel": "reference",
                "href": "https://github.com/grafana/grafana/pull/20192",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/grafana/grafana/releases/tag/v6.4.4",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://swarm.ptsecurity.com/grafana-6-4-3-arbitrary-file-read/",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://swarm.ptsecurity.com/grafana-6-4-3-arbitrary-file-read/",
                "label": "POC"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-4628/default-remediation-status"
            }
        ]
    }
}