{
    "source": "BDSA",
    "name": "BDSA-2021-2629",
    "title": "Xen Vulnerable to Privilege Escalation via Grant Table V2 Status Pages Access Race-Condition",
    "description": "Xen is vulnerable to privilege escalation, information exposure and denial-of-service (DoS) issues due to how, under certain circumstances, grant table version 2 status pages can remain accessible after they have been deallocated.\n\nA malicious guest could abuse this issue and trigger racing requests to insert mappings of the status pages and cause them to be mapped in multiple locations which are left accessible and could lead to information exposure, stability issues or potentially allow the guest to elevate its privileges to that of the host.\n\n**Note**: The vendor has stated [here](https://xenbits.xenproject.org/xsa/advisory-379.html) that only x86 `HVM` and `PVH` guests that are permitted to use grant table v2 interfaces can leverage this vulnerability.  x86 `PV` guests cannot leverage this vulnerability.  On Arm systems, grant table v2 use is explicitly unsupported.",
    "technicalDescription": "Xen is vulnerable to privilege escalation, information exposure and denial-of-service (DoS) issues because, while grant table version 2 status pages are deallocated when a guest switches back from version 2 to version 1, the hypervisor only tracks one use of the pages in guest space which could mean that racing requests from the guest to insert mappings of the status pages will result in them being mapped to multiple locations. In this case, the guest switching back from grant table v2 to v1 could allow the guest to retain access to a page that was freed and in some cases, re-used for other purposes.\n\nTo remedy this issue, the vendor has reworked the `xenmem_add_to_physmap_one()` function in the `xen/arch/x86/mm/p2m.c` file and moved both the `get_gfn()` and `put_gfn()` calls to avoid race conditions.",
    "publishedDate": "2021-09-01T14:49:43.949Z",
    "updatedDate": "2022-08-25T10:43:16.471Z",
    "disclosureDate": "2021-08-25T00:00:00.000Z",
    "solution": "Fixed in:\n* the **staging-4.11** branch by [this](https://github.com/xen-project/xen/commit/3882d451ec15472d8c17e228d6ec760d698fbe10) commit,\n* the **staging-4.12** branch by [this](https://github.com/xen-project/xen/commit/90ae827632671b3631ed2ded6d57d8445a00c607) commit,\n* Fixed in [**4.13.4**](https://github.com/xen-project/xen/releases/tag/RELEASE-4.13.4) by [this](https://github.com/xen-project/xen/commit/53e797c042df61c99cbca6d7e6aecaa568821bb6) commit,\n* Fixed in [**4.14.3**](https://github.com/xen-project/xen/releases/tag/RELEASE-4.14.3) by [this](https://github.com/xen-project/xen/commit/98bcd536c24ea35dcaed84cc35ce0f6c938ba9d6) commit,\n* Fixed in [**4.15.1**](https://github.com/xen-project/xen/releases/tag/RELEASE-4.15.1) by [this](https://github.com/xen-project/xen/commit/d40287a000ec20252006d92c51a69f14be808fd5) commit,\n* the **staging** branch by [this](https://github.com/xen-project/xen/commit/f147422bf9476fb8161b43e35f5901571ed17c35) commit.\n\nThe above commits have not yet been included in any release.",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 3.5,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 1.5,
        "severity": "LOW",
        "accessVector": "LOCAL",
        "accessComplexity": "HIGH",
        "authentication": "SINGLE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 2.6
        },
        "vector": "(AV:L/AC:H/Au:S/C:P/I:P/A:P/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 7.0,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 1.0,
        "severity": "MEDIUM",
        "attackVector": "LOCAL",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "LOW",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 6.1
        },
        "vector": "CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:H/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Jan Beulich of SUSE",
    "workaround": "The vendor has suggested [here](https://xenbits.xenproject.org/xsa/advisory-379.html) that it is possible to mitigate this vulnerability by only running `PV` guests, or by suppressing the use of grant table v2 interfaces for `HVM` or `PVH` guests.",
    "vendorFixDate": "2021-08-25T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 6.1,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2629",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-362"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-28697",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2629/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/commit/3882d451ec15472d8c17e228d6ec760d698fbe10",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/commit/53e797c042df61c99cbca6d7e6aecaa568821bb6",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/commit/90ae827632671b3631ed2ded6d57d8445a00c607",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/commit/98bcd536c24ea35dcaed84cc35ce0f6c938ba9d6",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/commit/d40287a000ec20252006d92c51a69f14be808fd5",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/commit/f147422bf9476fb8161b43e35f5901571ed17c35",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/releases/tag/RELEASE-4.13.4",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/releases/tag/RELEASE-4.14.3",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/releases/tag/RELEASE-4.15.1",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xenproject.org/xsa/advisory-379.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xenproject.org/xsa/advisory-379.html",
                "label": "WORKAROUND"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2629/default-remediation-status"
            }
        ]
    }
}