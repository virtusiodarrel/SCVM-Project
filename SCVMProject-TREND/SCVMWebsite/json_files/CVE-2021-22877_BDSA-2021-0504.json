{
    "source": "BDSA",
    "name": "BDSA-2021-0504",
    "title": "Nextcloud Server Vulnerable to Improper Access Control and Privilege Escalation via 'oc_storages_credentials'",
    "description": "Nextcloud Server contains an improper access control vulnerability. This could allow an attacker to trick an admin user into incorrectly populating the stored credentials for other users which could grant the attacker escalated privileges.",
    "technicalDescription": "This vulnerability occurs during the transfer of credentials from the session table `oc_storages_credentials` to the database entries `password::logincredentials/credentials`. \n\nIf an attacker tricks an admin authenticated user into navigating to the user list settings page (`https://cloud.example.org/settings/users`) then the table `oc_storages_credentials` will get pre-populated for all users with incorrect admin credentials. In addition to this when the user does subsequently log in, the entry for their credentials does not get updated. This information gets transferred from the session table to the database and there is insufficient validation to check that the user for whom the credentials get stored is the same as the current user in the session. This could result in incorrect credentials being stored for users, which could allow ordinary users escalated privileges as the admin `LDAP / AD` password is stored for every user. \n\nThe vendor has mitigated against this by ensuring that session credentials are only stored for the current user.",
    "publishedDate": "2021-03-04T13:01:15.936Z",
    "updatedDate": "2021-03-04T13:01:15.932Z",
    "disclosureDate": "2021-01-25T00:00:00.000Z",
    "exploitPublishDate": "2021-03-01T00:00:00.000Z",
    "solution": "Fixed in [**21.0.0beta7**](https://github.com/nextcloud/server/releases/tag/v21.0.0beta7) by [this](https://github.com/nextcloud/server/commit/6129a851873287dde1f922b9d6f3aa4624a07133) commit, and in [**20.0.6**](https://github.com/nextcloud/server/releases/tag/v20.0.6) by [this](https://github.com/nextcloud/server/commit/1dcfab0d7647e1bddf2e1325bf59dba91180580b) commit.\n\nThe latest stable releases are available [here](https://github.com/nextcloud/server/releases).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 4.9,
        "impactSubscore": 4.9,
        "exploitabilitySubscore": 6.8,
        "severity": "LOW",
        "accessVector": "NETWORK",
        "accessComplexity": "MEDIUM",
        "authentication": "SINGLE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 3.9
        },
        "vector": "(AV:N/AC:M/Au:S/C:P/I:P/A:N/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.7,
        "impactSubscore": 5.8,
        "exploitabilitySubscore": 2.3,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "NONE",
        "privilegesRequired": "LOW",
        "scope": "CHANGED",
        "userInteraction": "REQUIRED",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.8
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:H/A:N/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Alexander Hofst\u00e4tter",
    "workaround": "",
    "vendorFixDate": "2021-01-20T00:00:00.000Z",
    "vendorNotifiedDate": "2020-12-18T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 7.8,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-0504",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-255"
            },
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-284"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-22877",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-0504/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nextcloud/server/commit/1dcfab0d7647e1bddf2e1325bf59dba91180580b",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nextcloud/server/commit/6129a851873287dde1f922b9d6f3aa4624a07133",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nextcloud/server/pull/25224",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nextcloud/server/pull/25225",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nextcloud/server/releases",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nextcloud/server/releases/tag/v20.0.6",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nextcloud/server/releases/tag/v21.0.0beta7",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://hackerone.com/reports/1061591",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://hackerone.com/reports/1061591",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://nextcloud.com/security/advisory/?id=NC-SA-2021-004",
                "label": "ADVISORY"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-0504/default-remediation-status"
            }
        ]
    }
}