{
    "source": "BDSA",
    "name": "BDSA-2019-4178",
    "title": "Ampache Vulnerable to SQL Injection (SQLi) via 'rule_1_input' Parameter in 'search.php'",
    "description": "Ampache is vulnerable to SQL injection (SQLi) due to insufficient validation of user controlled input. This could allow the attacker to obtain sensitive information, such as administrator passwords or modify data in the database.",
    "technicalDescription": "In the case that the `rule_1` parameter has the value `last_play` in a search, the value of the `rule_1_input` parameter can be used to exploit an SQLi vulnerability.\n\nThe `last_play` case in the `song_to_sql` function in  `lib/class/search.class.php` uses the value of `rule_1_input` in an SQL query without sufficient validation. \n\nThe vulnerable value is being escaped by `Dba::escape` in the `clean_request` function. The `Dba::escape` function calls the `PDO::quote` function on the value to escape special characters and make the input a string, however this function then returns the string after removing the quotes added by the `PDO::quote` function. This allows for malicious input to be included in an SQL query where the value is not a string, such as in the case of an integer.\n\nThe SQL query in the case of `last_play` the value of `rule_1_input` is of type `days` which is an integer and therefore the query does not have string delimiters around the value, allowing an attacker to include arbitrary SQL commands.",
    "publishedDate": "2020-01-14T09:27:34.864Z",
    "updatedDate": "2020-01-14T09:27:34.856Z",
    "disclosureDate": "2019-08-21T00:00:00.000Z",
    "exploitPublishDate": "2019-08-21T00:00:00.000Z",
    "solution": "Fixed in version [**4.0.0**](https://github.com/ampache/ampache/releases/tag/4.0.0) by these commits:\n* [Commit 1](https://github.com/ampache/ampache/commit/b9bb70cf9a05ea5f73a51c2e8e213f2c81e6b56d)\n* [Commit 2](https://github.com/ampache/ampache/commit/006480b5320b265f5009c4df41eb98260ef5b6af).",
    "severity": "CRITICAL",
    "cvss2": {
        "baseScore": 7.5,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 10.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.9
        },
        "vector": "(AV:N/AC:L/Au:N/C:P/I:P/A:P/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 10.0,
        "impactSubscore": 6.0,
        "exploitabilitySubscore": 3.9,
        "severity": "CRITICAL",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "CHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 9.0
        },
        "vector": "CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "TarlogicSecurity",
    "workaround": "",
    "vendorFixDate": "2019-06-25T00:00:00.000Z",
    "vendorNotifiedDate": "2019-04-25T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 9.0,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-4178",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-89"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-12385",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-4178/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/ampache/ampache/commit/006480b5320b265f5009c4df41eb98260ef5b6af",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/ampache/ampache/commit/b9bb70cf9a05ea5f73a51c2e8e213f2c81e6b56d",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/ampache/ampache/commit/d7b228017c4d3254cd54e163971f3e32bf125af6",
                "label": "INTRODUCTORY_COMMIT"
            },
            {
                "rel": "reference",
                "href": "https://github.com/ampache/ampache/issues/1872",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/ampache/ampache/releases/tag/4.0.0",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://www.tarlogic.com/en/blog/vulnerabilities-in-ampache/",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.tarlogic.com/en/blog/vulnerabilities-in-ampache/",
                "label": "POC"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-4178/default-remediation-status"
            }
        ]
    }
}