{
    "source": "BDSA",
    "name": "BDSA-2019-0183",
    "title": "APT Vulnerable to Remote Code Execution (RCE) via Man-In-The-Middle-Controlled Redirects",
    "description": "APT package manager is vulnerable to remote code execution (RCE) due to improper handling of HTTP redirects during package upgrade which does not sanitize fields transmitted over the wire. An attacker who is able to attain a man-in-the-middle (MITM) position between the end client and the package source could leverage this flaw to inject malicious content into the HTTP connection. This can lead to arbitrary code execution as root (given apt's permissions) and a complete compromise of the host.",
    "technicalDescription": "This flaw lies in the `pkgAcqMethod::Redirect` function of the `apt-pkg/acquire-method.cc` source file. Insufficient validation of the `NewURI` parameter used during redirects may allow an attacker to inject rogue content into the connection. The crafted value may contain control characters like `%0a` (` \\n` encoded) which makes injections possible. APT will then use the malicious string injected in the header which can result in arbitrary code execution. In order to exploit this flaw an attacker has to be positioned between the host running APT and the source of the package (or control the package mirror), when a package upgrade is taking place.",
    "publishedDate": "2019-01-23T16:11:06.172Z",
    "updatedDate": "2019-05-14T15:22:49.215Z",
    "disclosureDate": "2019-01-22T00:00:00.000Z",
    "exploitPublishDate": "2019-01-22T00:00:00.000Z",
    "solution": "Fixed on **Debian** in:\n* [**1.0.9.8.5**](https://github.com/Debian/apt/releases) by [this](https://github.com/Debian/apt/commit/7deeaffbe401b007d478c0554a2e6cb7148134e8) commit,\n* [**1.4.9**](https://github.com/Debian/apt/releases) by [this](https://github.com/Debian/apt/commit/ba245013f2801b102fdaa305fbc1bbf8b04866f8) commit, and\n* [**1.8.0_alpha3.1**](https://github.com/Debian/apt/releases) by [this](https://github.com/Debian/apt/commit/c31d65e76810f72c356e381818174bf100605de7) commit.\n\nIt is recommended to disable redirects prior to upgrading using:\n```\napt -o Acquire::http::AllowRedirect=false update\napt -o Acquire::http::AllowRedirect=false upgrade\n```\nThis is known to break some proxies when used against security.debian.org. If that happens, administrators can switch their security APT source to use:\n```\ndeb http://cdn-fastly.deb.debian.org/debian-security stable/updates main\n```\nIf upgrading without redirects is impossible in a setup then the package can be downloaded manually using (using wget/curl) and installed  using using dpkg -i. The source archives can be found [here](https://lists.debian.org/debian-security-announce/2019/msg00010.html).\n\nFixed on **Ubuntu** in:\n\nUbuntu 12.04 ESM (Precise Pangolin):\t**0.8.16~exp12ubuntu10.28**\nUbuntu 14.04 LTS (Trusty Tahr):\t[**1.0.1ubuntu2.19**](https://launchpad.net/ubuntu/trusty/+source/apt)\nUbuntu 16.04 LTS (Xenial Xerus):\t[**1.2.29ubuntu0.1**](https://launchpad.net/ubuntu/xenial/+source/apt)\nUbuntu 18.04 LTS (Bionic Beaver):\t[**1.6.6ubuntu0.1**](https://launchpad.net/ubuntu/bionic/+source/apt)\nUbuntu 18.10 (Cosmic Cuttlefish):\t[**1.7.0ubuntu0.1**](https://launchpad.net/ubuntu/cosmic/+source/apt)",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 7.6,
        "impactSubscore": 10.0,
        "exploitabilitySubscore": 4.9,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "COMPLETE",
        "integrityImpact": "COMPLETE",
        "availabilityImpact": "COMPLETE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 6.0
        },
        "vector": "(AV:N/AC:H/Au:N/C:C/I:C/A:C/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 7.5,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 1.6,
        "severity": "MEDIUM",
        "attackVector": "NETWORK",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "REQUIRED",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 6.7
        },
        "vector": "CVSS:3.0/AV:N/AC:H/PR:N/UI:R/S:U/C:H/I:H/A:H/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Max Justicz",
    "workaround": "",
    "vendorFixDate": "2019-01-18T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 6.7,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0183",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-20"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-3462",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0183/ranges"
            },
            {
                "rel": "reference",
                "href": "https://bugs.launchpad.net/ubuntu/%2Bsource/apt/%2Bbug/1812353",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/Debian/apt/commit/7deeaffbe401b007d478c0554a2e6cb7148134e8",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/Debian/apt/commit/ba245013f2801b102fdaa305fbc1bbf8b04866f8",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/Debian/apt/commit/c31d65e76810f72c356e381818174bf100605de7",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/Debian/apt/releases",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://justi.cz/security/2019/01/22/apt-rce.html",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://launchpad.net/ubuntu/bionic/+source/apt",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://launchpad.net/ubuntu/cosmic/+source/apt",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://launchpad.net/ubuntu/trusty/+source/apt",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://launchpad.net/ubuntu/xenial/+source/apt",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://lists.debian.org/debian-security-announce/2019/msg00010.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://lists.debian.org/debian-security-announce/2019/msg00010.html",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://people.canonical.com/~ubuntu-security/cve/2019/CVE-2019-3462.html",
                "label": "ADVISORY"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0183/default-remediation-status"
            }
        ]
    }
}