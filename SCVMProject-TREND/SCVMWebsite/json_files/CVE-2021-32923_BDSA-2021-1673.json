{
    "source": "BDSA",
    "name": "BDSA-2021-1673",
    "title": "HashiCorp Vault Vulnerable Insufficient Session Expiration via Authentication Tokens",
    "description": "HashiCorp Vault is vulnerable to insufficient session expiry. An attacker can take advantage of this in order to renew their nearly-expired token leases and dynamic secret leases, and subsequently ensure they will be treated as non-expiring.",
    "technicalDescription": "The authentication method and the dynamic secrets functionality used in Vault involve using tokens which have a lease which is issued on successful authentication. These leases have a time-to-live (TTL), and the lease can be renewed until the maximum TTL is reached.\nThis vulnerability exists due to Vault allowing for the renewal of token leases and dynamic secret leases which are nearly-expired (i.e. within 1 second of their maximum TTL). When this occurs the leases are then subsequently treated as non-expiring, which results in these tokens and dynamic secrets living past their lifetime and not being revoked.\n\nThe vendor has mitigated against this by updating the `revokeCommon()`, `updatePendingInternal()` and `nonexpiringToken()` function in file `vault/expiration.go` to ensure that the only non-expiring tokens are root tokens. \nIn addition to this, the `vendor/github.com/hashicorp/vault/sdk/framework/lease.go` and `sdk/framework/lease.go` files have been updated to ensure the maximum TTL can't be exceeded.",
    "publishedDate": "2021-06-04T15:07:12.493Z",
    "updatedDate": "2021-06-04T15:07:12.486Z",
    "disclosureDate": "2021-05-20T00:00:00.000Z",
    "solution": "Fixed in:\n* [**1.5.9**](https://github.com/hashicorp/vault/releases/tag/v1.5.9) by [this](https://github.com/hashicorp/vault/commit/be41aff15ece5b81849fc7fd0ce9f8132f33b1ae) commit,\n* [**1.6.5**](https://github.com/hashicorp/vault/releases/tag/v1.6.5) by [this](https://github.com/hashicorp/vault/commit/a481a59f59745fe1e2efeca7a75a986f2c3ffb1d) commit,\n* [**1.7.2**](https://github.com/hashicorp/vault/releases/tag/v1.7.2) by [this](https://github.com/hashicorp/vault/commit/a671890555c78de61cef44ec1a47fe114ee766ee) commit.\n\nThe latest stable releases are available [here](https://github.com/hashicorp/vault/releases).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 5.5,
        "impactSubscore": 4.9,
        "exploitabilitySubscore": 8.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "SINGLE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.0
        },
        "vector": "(AV:N/AC:L/Au:S/C:P/I:P/A:N/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.1,
        "impactSubscore": 5.2,
        "exploitabilitySubscore": 2.8,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "NONE",
        "privilegesRequired": "LOW",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.1
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:N/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "workaround": "",
    "vendorFixDate": "2021-05-19T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 7.1,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-1673",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-613"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-32923",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-1673/ranges"
            },
            {
                "rel": "reference",
                "href": "https://discuss.hashicorp.com/t/hcsec-2021-15-vault-renewed-nearly-expired-leases-with-incorrect-non-expiring-ttls/24603",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/hashicorp/vault/commit/a481a59f59745fe1e2efeca7a75a986f2c3ffb1d",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/hashicorp/vault/commit/a671890555c78de61cef44ec1a47fe114ee766ee",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/hashicorp/vault/commit/be41aff15ece5b81849fc7fd0ce9f8132f33b1ae",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/hashicorp/vault/releases",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/hashicorp/vault/releases/tag/v1.5.9",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/hashicorp/vault/releases/tag/v1.6.5",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/hashicorp/vault/releases/tag/v1.7.2",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-1673/default-remediation-status"
            }
        ]
    }
}