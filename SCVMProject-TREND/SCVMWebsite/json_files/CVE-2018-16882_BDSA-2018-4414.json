{
    "source": "BDSA",
    "name": "BDSA-2018-4414",
    "title": "Linux Kernel Vulnerable to Denial-of-Service (DoS) via Use-After-Free (UAF) in Nested Posted Interrupt Processing",
    "description": "Linux kernel is vulnerable to denial-of-service (DoS) due to incorrect tracking of memory during posted interrupt processing in KVM. Only systems with the nested virtualization enabled that also support posted interrupts are affected. An attacker can exploit a use-after-free (UAF) bug to crash the kernel or possibly execute arbitrary code.",
    "technicalDescription": "This flaw lies in the `nested_get_vmcs12_pages()` function of the `/arch/x86/kvm/vmx.c` source file. The function will unmap the `pi_desc_page` without resetting the `pi_desc` descriptor address if an error is encountered during processing of a posted interrupt address. The same memory region is then accessed by the `pi_test_and_clear_on()` function resulting in use-after-free (UAF). Only systems where the `nested` and `enable_apicv` variables are set to true (`1`) are vulnerable.\n\nAn attacker can exploit this flaw by firstly calling `vmlaunch` with a valid `posted_intr_desc_addr` but an invalid `MSR_EFER`, which will cache `pi_desc_page` and `pi_desc`. Following it with another call to `vmlanuch` with a valid `EFER` but an invalid `posted_intr_desc_addr`, will unmap and release the `pi_desc_page` and set it to `NULL`. \n\nThis will effectively create a dangling pointer which can then be dereferenced by a forced inter-processor interrupt (IPI) in L2 guest code. The IPI will subsequently call `vmx_complete_nested_posted_interrupt()` and `pi_test_and_clear_on()`, which will in turn dereference the bad pointer.\n\nDangling pointers can be used to cause kernel crash and denial-of-service (DoS), but are also known to lead to arbitrary code execution in some scenarios.\n\nThe flaw has been introduced in **4.14-rc1** by [this](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5e2f30b756a37bd80c5b0471d0e10d769ab2eb9a) commit.",
    "publishedDate": "2018-12-19T12:41:19.889Z",
    "updatedDate": "2019-01-02T13:31:16.839Z",
    "disclosureDate": "2018-12-18T00:00:00.000Z",
    "solution": "Fixed in:\n* [**4.14.91**](https://www.kernel.org/) by [this](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cc70f14956fa0ea84ee1a3a5b79347730c6c2d08) commit,\n* [**4.19.13**](https://www.kernel.org/) by [this](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1972ca04708330b0edd52956e644e3974065a613) commit, and\n* [**4.20**](https://www.kernel.org/) by [this](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c2dd5146e9fe1f22c77c1b011adf84eea0245806) commit.",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 2.4,
        "impactSubscore": 4.9,
        "exploitabilitySubscore": 1.5,
        "severity": "LOW",
        "accessVector": "LOCAL",
        "accessComplexity": "HIGH",
        "authentication": "SINGLE",
        "confidentialityImpact": "NONE",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 1.8
        },
        "vector": "(AV:L/AC:H/Au:S/C:N/I:P/A:P/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 6.4,
        "impactSubscore": 4.7,
        "exploitabilitySubscore": 1.1,
        "severity": "MEDIUM",
        "attackVector": "LOCAL",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "NONE",
        "integrityImpact": "LOW",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "LOW",
        "scope": "CHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.6
        },
        "vector": "CVSS:3.0/AV:L/AC:H/PR:L/UI:N/S:C/C:N/I:L/A:H/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": true,
    "parentAdvisory": false,
    "credit": "Cfir Cohen (Google)",
    "workaround": "",
    "vendorFixDate": "2018-12-18T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 5.6,
    "_meta": {
        "allow": [],
        "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/BDSA-2018-4414",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro.app.blackduck.com/api/cwes/CWE-416"
            },
            {
                "rel": "cwes",
                "href": "https://trendmicro.app.blackduck.com/api/cwes/CWE-825"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/CVE-2018-16882",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/BDSA-2018-4414/ranges"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1972ca04708330b0edd52956e644e3974065a613",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c2dd5146e9fe1f22c77c1b011adf84eea0245806",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cc70f14956fa0ea84ee1a3a5b79347730c6c2d08",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://seclists.org/oss-sec/2018/q4/262",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.kernel.org/",
                "label": "VENDOR_UPGRADE"
            }
        ]
    }
}