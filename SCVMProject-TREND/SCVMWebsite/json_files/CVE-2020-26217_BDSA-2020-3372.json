{
    "source": "BDSA",
    "name": "BDSA-2020-3372",
    "title": "Xstream Vulnerable to Remote Code Execution (RCE) via Incomplete Blacklist for Unmarshalling Specially Crafted Input",
    "description": "Xstream is vulnerable to remote code execution (RCE) through specially crafted input. A remote attacker is able to execute arbitrary system commands on the host machine if Xstream's security framework has been configured with a default blacklist, rather than the more secure whitelisting method.",
    "technicalDescription": "The default blacklist of classes that are to be denied unmarshalling from XML, JSON or any other supported format is incomplete. Specifically, the `java.lang.ProcessBuilder` class and `javax.imageio.ImageIO$ContainsFilter` can be leveraged by an attacker to execute arbitrary system commands, and these are not on the default blacklist. \n\nThis same issue has been reported before with regards to the Struts framework (BDSA-2017-0903, CVE-2017-9805), but has gone unpatched in upstream Xstream until now.\n\nNote that the blacklisting method is not the recommended way to configure Xstream's [security framework](https://x-stream.github.io/security.html#framework). The whitelisting method of only allowing specific types is deemed to be much more secure.",
    "publishedDate": "2020-11-17T10:49:52.743Z",
    "updatedDate": "2021-07-05T09:28:31.478Z",
    "disclosureDate": "2020-11-16T00:00:00.000Z",
    "exploitPublishDate": "2020-11-16T00:00:00.000Z",
    "solution": "Fixed in **[1.4.14](https://github.com/x-stream/xstream/releases/tag/XSTREAM_1_4_14)** by [this](https://github.com/x-stream/xstream/commit/0fec095d534126931c99fd38e9c6d41f5c685c1a) commit.\n\nThe latest stable releases are available [here](https://github.com/x-stream/xstream/releases/).",
    "severity": "CRITICAL",
    "cvss2": {
        "baseScore": 7.5,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 10.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.9
        },
        "vector": "(AV:N/AC:L/Au:N/C:P/I:P/A:P/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 10.0,
        "impactSubscore": 6.0,
        "exploitabilitySubscore": 3.9,
        "severity": "CRITICAL",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "CHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 9.0
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Zhihong Tian and Hui Lu, (Guangzhou University)",
    "workaround": "The vendor has supplied the following workarounds if you rely on the blacklisting feature and are unable to upgrade to **1.4.14**.\n\nFor version **1.4.13**\nAdd two lines to XStream's setup code:\n> \n> ```\n> xstream.denyTypes(new String[]{ \"javax.imageio.ImageIO$ContainsFilter\" });\n> xstream.denyTypes(new Class[]{ java.lang.ProcessBuilder.class });\n> ```\n>\nFor versions **1.4.7** to **1.4.12** deny at least the following types: javax.imageio.ImageIO$ContainsFilter, java.beans.EventHandler, java.lang.ProcessBuilder, java.lang.Void and void.\n>```\n> xstream.denyTypes(new String[]{ \"javax.imageio.ImageIO$ContainsFilter\" });\n> xstream.denyTypes(new Class[]{ java.lang.ProcessBuilder.class, java.beans.EventHandler.class, java.lang.ProcessBuilder.class, java.lang.Void.class, void.class });\n> ```\n\nFor versions **1.4.6** or below, register a converter to prevent the unmarshalling of the currently know critical types of the Java runtime.\n> ```\n> xstream.registerConverter(new Converter() {\n>   public boolean canConvert(Class type) {\n>     return type != null && (type == java.beans.EventHandler.class || type == java.lang.ProcessBuilder.class || type == java.lang.Void.class || void.class || type.getName().equals(\"javax.imageio.ImageIO$ContainsFilter\") || Proxy.isProxy(type));\n>   }\n> \n>   public Object unmarshal(HierarchicalStreamReader reader, UnmarshallingContext context) {\n>     throw new ConversionException(\"Unsupported type due to security reasons.\");\n>   }\n> \n>   public void marshal(Object source, HierarchicalStreamWriter writer, MarshallingContext context) {\n>     throw new ConversionException(\"Unsupported type due to security reasons.\");\n>   }\n> }, XStream.PRIORITY_LOW);\n> ```",
    "vendorFixDate": "2020-09-24T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 9.0,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-3372",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-184"
            },
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-502"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2020-26217",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-3372/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/x-stream/xstream/commit/0fec095d534126931c99fd38e9c6d41f5c685c1a",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/x-stream/xstream/releases/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/x-stream/xstream/releases/tag/XSTREAM_1_4_14",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/x-stream/xstream/security/advisories/GHSA-mw36-7c6c-q4q2",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://x-stream.github.io/CVE-2020-26217.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://x-stream.github.io/CVE-2020-26217.html",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://x-stream.github.io/CVE-2020-26217.html",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://x-stream.github.io/security.html#framework",
                "label": "LINK"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-3372/default-remediation-status"
            }
        ]
    }
}