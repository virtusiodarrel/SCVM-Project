{
    "source": "BDSA",
    "name": "BDSA-2021-0933",
    "title": "Synapse Vulnerable to Restrictions Bypass via Transitional IPv6 Addresses",
    "description": "Synapse is vulnerable to restriction bypass on the IP blacklist. Successfully exploiting this could allow and attacker to make requests to internal infrastructure on dual-stack networks.",
    "technicalDescription": "This vulnerability exists due to the default IP blacklist in Synapse including IPv4 addresses, and not including the relevant IPv6 addresses. This means that any requests which were made to user provided domains were not restricted to external IP addresses whenever transitional IPv6 addresses were used. Successfully exploiting this could allow and attacker to make requests to internal infrastructure on dual-stack networks.\n\nThis issue affects outbound requests to federation identity servers when:\n* Calculating the key validity for third-party invite events,\n* sending push notifications,\n* and generating URL previews.\n\nThe vendor has mitigated against this by converting blacklisted IPv4 addresses to compatible IPv6 addresses.",
    "publishedDate": "2021-04-14T10:32:25.866Z",
    "updatedDate": "2021-04-14T10:32:25.856Z",
    "disclosureDate": "2021-04-12T00:00:00.000Z",
    "solution": "Fixed in [**1.28-rc1**](https://github.com/matrix-org/synapse/releases/tag/v1.28.0rc1) by [this](https://github.com/matrix-org/synapse/commit/4ca054a4eaa714d0befb4fc30b19a1131e52c9cc) commit. \n\nThe latest stable releases are available [here](https://github.com/matrix-org/synapse/releases).",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 6.4,
        "impactSubscore": 4.9,
        "exploitabilitySubscore": 10.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.7
        },
        "vector": "(AV:N/AC:L/Au:N/C:P/I:P/A:N/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 6.5,
        "impactSubscore": 2.5,
        "exploitabilitySubscore": 3.9,
        "severity": "MEDIUM",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "LOW",
        "integrityImpact": "LOW",
        "availabilityImpact": "NONE",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.7
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:N/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "workaround": "The vendor has provided the following [workaround](https://github.com/matrix-org/synapse/security/advisories/GHSA-5wrh-4jwv-5w78):\n\n\"Outbound requests to the following address ranges can be blocked by a firewall, if unused for internal communication between systems:\n* `::ffff/80`\n* `::0000/80` (note that this IP range is considered deprecated by the IETF)\n* `2002::/16` (note that this IP range is considered deprecated by the IETF)\"",
    "vendorFixDate": "2021-02-03T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 5.7,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-0933",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-358"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-21392",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-0933/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/matrix-org/synapse/commit/4ca054a4eaa714d0befb4fc30b19a1131e52c9cc",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/matrix-org/synapse/releases",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/matrix-org/synapse/releases/tag/v1.28.0rc1",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/matrix-org/synapse/security/advisories/GHSA-5wrh-4jwv-5w78",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/matrix-org/synapse/security/advisories/GHSA-5wrh-4jwv-5w78",
                "label": "WORKAROUND"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-0933/default-remediation-status"
            }
        ]
    }
}