{
    "source": "BDSA",
    "name": "BDSA-2018-3714",
    "title": "Firefox and Firefox ESR Vulnerable to Privilege Escalation via WebExtension Content Scripts",
    "description": "Firefox and Firefox ESR are vulnerable to privilege escalation due to race conditions in the extension content script scheduler. An attacker could take advantage of this to run content scripts anywhere when the document navigates during the execution of a content script.",
    "technicalDescription": "Two time-of-check-time-of-use (TOCTOU) race conditions in the scheduler of extension content scripts make it possible for an extension to run scripts in a principal that it shouldn't have access to. \n\nFirstly when an extension is just installed or when a content process starts up, the `injectExtensionScripts` function is called to run content scripts in existing pages. The `matchesWindow` function is called for each script and the scripts are run in three batches: `document_start`, `document_end` and `document_idle`. However the script does not check that the inner window has not changed.     \n\nSecondly when a new document is loaded, the `CheckContentScripts`function checks whether a script should run via `script->Matches(aDocInfo)` and then loads the script by calling `loadContentScript`. The issue is that `aDocInfo` has a fixed value, but this may not be the case for the document.",
    "publishedDate": "2018-10-25T11:13:52.472Z",
    "updatedDate": "2019-11-13T16:41:08.148Z",
    "disclosureDate": "2018-10-23T00:00:00.000Z",
    "exploitPublishDate": "2018-08-15T00:00:00.000Z",
    "solution": "Fixed by [this](https://hg.mozilla.org/mozilla-central/rev/a7848dcb339e) commit and [this](https://hg.mozilla.org/mozilla-central/rev/eef3785a6b44) commit in:\n* Firefox  [**63**](https://www.mozilla.org/en-GB/firefox/new/)\n* Firefox ESR [**60.3**](https://www.mozilla.org/en-US/firefox/organizations/)",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 5.8,
        "impactSubscore": 4.9,
        "exploitabilitySubscore": 8.6,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "MEDIUM",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.5
        },
        "vector": "(AV:N/AC:M/Au:N/C:P/I:P/A:N/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 6.1,
        "impactSubscore": 2.7,
        "exploitabilitySubscore": 2.8,
        "severity": "MEDIUM",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "LOW",
        "integrityImpact": "LOW",
        "availabilityImpact": "NONE",
        "privilegesRequired": "NONE",
        "scope": "CHANGED",
        "userInteraction": "REQUIRED",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.5
        },
        "vector": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Rob Wu",
    "workaround": "",
    "vendorFixDate": "2018-10-23T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 5.5,
    "_meta": {
        "allow": [],
        "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/BDSA-2018-3714",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro.app.blackduck.com/api/cwes/CWE-367"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/CVE-2018-12396",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/BDSA-2018-3714/ranges"
            },
            {
                "rel": "reference",
                "href": "https://bugzilla.mozilla.org/show_bug.cgi?id=1483602",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://bugzilla.mozilla.org/show_bug.cgi?id=1483602",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://hg.mozilla.org/mozilla-central/rev/a7848dcb339e",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://hg.mozilla.org/mozilla-central/rev/eef3785a6b44",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://www.mozilla.org/en-GB/firefox/new/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://www.mozilla.org/en-US/firefox/organizations/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://www.mozilla.org/en-US/security/advisories/mfsa2018-26/",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.mozilla.org/en-US/security/advisories/mfsa2018-27/",
                "label": "ADVISORY"
            }
        ]
    }
}