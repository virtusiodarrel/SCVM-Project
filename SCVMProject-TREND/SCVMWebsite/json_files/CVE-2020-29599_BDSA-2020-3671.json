{
    "source": "BDSA",
    "name": "BDSA-2020-3671",
    "title": "ImageMagick Vulnerable to Shell Command Execution via PDF Password Functionality",
    "description": "ImageMagick is vulnerable to a shell command execution issue due a lack of sufficient input sanitization being applied on user supplied passwords for the PDF password protection functionality.\n\nAn attacker could inject malicious shell commands into the supplied password in order to cause ImageMagick to execute these commands when password protecting a PDF file.",
    "technicalDescription": "ImageMagick is vulnerable to shell command execution because the `-authenticate` parameter that is used to set a password for an encrypted PDF is not sufficiently sanitized. ImageMagick, when not compiled with a third-party library that handles PDF parsing, runs the `gs` shell command and includes the supplied password in the `sPDFPassword` parameter.\n\nAn attacker could inject a malicious password directly via the `-authenticate` parameter, or through the authenticate attribute when using ImageMagick Scripting Language (MSL).\n\n**Note**: The MSL attack vector is only viable from versions **7.0.10-35** and **6.9.11-35** forward. Before this, the authenticate attribute was mishandled.",
    "publishedDate": "2020-12-08T14:53:44.581Z",
    "updatedDate": "2020-12-08T14:54:05.035Z",
    "disclosureDate": "2020-11-21T00:00:00.000Z",
    "exploitPublishDate": "2020-11-21T00:00:00.000Z",
    "solution": "Fixed in [**7.0.10-40**](https://github.com/ImageMagick/ImageMagick/releases/tag/7.0.10-40) by the following commits:\n* [Commit 1](https://github.com/ImageMagick/ImageMagick/commit/7a7ef5e0721ef908afd3d1d24b309292d2b762f3)\n* [Commit 2](https://github.com/ImageMagick/ImageMagick/commit/c8e5e248aab839464c2581bfb0bd306ab3e6ff76)\n* [Commit 3](https://github.com/ImageMagick/ImageMagick/commit/ffb8da39c9063ff64681dd1e5407116a64e2df07)\n* [Commit 4](https://github.com/ImageMagick/ImageMagick/commit/a9e63436aa04c805fe3f9e2ed242dfa4621df823)\n* [Commit 5](https://github.com/ImageMagick/ImageMagick/commit/68154c05cf40a80b6f2e2dd9fdc4428570f875f0)\n* [Commit 6](https://github.com/ImageMagick/ImageMagick/commit/89a1c73ee2693ded91a72d00bdf3aba410f349f1)\n\nFixed in [**6.9.11-40**](https://github.com/ImageMagick/ImageMagick6/releases/tag/6.9.11-40) by the following commits:\n* [Commit 1](https://github.com/ImageMagick/ImageMagick6/commit/a2b3dd8455da2f17849b55e6b6ddcce587e4a323)\n* [Commit 2](https://github.com/ImageMagick/ImageMagick6/commit/7b0cce080345e5b7ef26d122f18809c93a19a80e)\n* [Commit 3](https://github.com/ImageMagick/ImageMagick6/commit/875fdf773d6e822364f876bed14c1785a01b45a7)\n* [Commit 4](https://github.com/ImageMagick/ImageMagick6/commit/ab2e97d2f7520d1d9ff36ef421caf2a899e14ce4)\n* [Commit 5](https://github.com/ImageMagick/ImageMagick6/commit/869e38717fa91325da87c2a4cedc148a770a07ec)\n* [Commit 6](https://github.com/ImageMagick/ImageMagick6/commit/226804980651bb4eb5f3ba3b9d7e992f2eda4710)\n\nThe latest stable releases are available [here](https://imagemagick.org/script/download.php).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 7.5,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 10.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.9
        },
        "vector": "(AV:N/AC:L/Au:N/C:P/I:P/A:P/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 9.8,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 3.9,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 8.8
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Alex Inf\u00fchr",
    "workaround": "If PDF handling is not required, a workaround, suggested [here](https://insert-script.blogspot.com/2020/11/imagemagick-shell-injection-via-pdf.html), is to disable the PDF coder via the `policy.xml` file. Configuration of `policy.xml` is documented [here](https://imagetragick.com/).",
    "vendorFixDate": "2020-11-19T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 8.8,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-3671",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-77"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2020-29599",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-3671/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/ImageMagick/ImageMagick/commit/68154c05cf40a80b6f2e2dd9fdc4428570f875f0",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/ImageMagick/ImageMagick/commit/7a7ef5e0721ef908afd3d1d24b309292d2b762f3",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/ImageMagick/ImageMagick/commit/89a1c73ee2693ded91a72d00bdf3aba410f349f1",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/ImageMagick/ImageMagick/commit/a9e63436aa04c805fe3f9e2ed242dfa4621df823",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/ImageMagick/ImageMagick/commit/c8e5e248aab839464c2581bfb0bd306ab3e6ff76",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/ImageMagick/ImageMagick/commit/ffb8da39c9063ff64681dd1e5407116a64e2df07",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/ImageMagick/ImageMagick/discussions/2779",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/ImageMagick/ImageMagick/discussions/2851",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/ImageMagick/ImageMagick/releases/tag/7.0.10-40",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/ImageMagick/ImageMagick6/commit/226804980651bb4eb5f3ba3b9d7e992f2eda4710",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/ImageMagick/ImageMagick6/commit/7b0cce080345e5b7ef26d122f18809c93a19a80e",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/ImageMagick/ImageMagick6/commit/869e38717fa91325da87c2a4cedc148a770a07ec",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/ImageMagick/ImageMagick6/commit/875fdf773d6e822364f876bed14c1785a01b45a7",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/ImageMagick/ImageMagick6/commit/a2b3dd8455da2f17849b55e6b6ddcce587e4a323",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/ImageMagick/ImageMagick6/commit/ab2e97d2f7520d1d9ff36ef421caf2a899e14ce4",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/ImageMagick/ImageMagick6/releases/tag/6.9.11-40",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://imagemagick.org/script/download.php",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://imagetragick.com/",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://insert-script.blogspot.com/2020/11/imagemagick-shell-injection-via-pdf.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://insert-script.blogspot.com/2020/11/imagemagick-shell-injection-via-pdf.html",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://insert-script.blogspot.com/2020/11/imagemagick-shell-injection-via-pdf.html",
                "label": "WORKAROUND"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-3671/default-remediation-status"
            }
        ]
    }
}