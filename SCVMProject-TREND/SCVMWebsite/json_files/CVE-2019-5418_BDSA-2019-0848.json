{
    "source": "BDSA",
    "name": "BDSA-2019-0848",
    "title": "Ruby on Rails Vulnerable to File Content Disclosure via Path Traversal in Action View",
    "description": "Ruby on Rails (Rails) contains a file content disclosure vulnerability. A flaw in the Action View framework could allow an attacker to supply specially crafted accept headers and calls to render arbitrary files on the server. If successful, the contents of the file will be disclosed. In addition, an attacker could exploit this vulnerability to read the Rails secret file and use the information in combination with other known issues for remote code execution (RCE).",
    "technicalDescription": "The file `actionpack/lib/action_dispatch/http/mime_negotiation.rb` accepts requests even if the format is not from a registered mime type. This could allow an attacker to expose files using specially crafted accept headers and calls to `render file:`. Path traversal is also possible, allowing the attacker to read files outside the current working directory. Rendering templates are not affected.\n\nFor example, the following snippet would expose the contents of `file.txt.`:\n\n```\nclass UserController < ApplicationController\n  def index\n    render file: \"#{Rails.root}/file.txt\"\n  end\nend\n```\n\nTo exploit remotely, an attacker could intercept a HTTP request and replace the Accept header with a malicious payload.\n\nExample: `../../../../../../../../../../etc/passwd{{`.\n\nTo achieve remote code execution (RCE), the attacker could read the contents of the files `credentials.yml.enc` and `master.key`. `credentials.yml.enc` contains the `secret_key_base` value which can be exploited to send arbitrary commands via a request to `/rails/active_storage/disk/:encoded_key/*filename(.:format) => `.",
    "publishedDate": "2019-03-28T15:54:28.116Z",
    "updatedDate": "2019-03-28T15:54:28.097Z",
    "disclosureDate": "2019-03-13T00:00:00.000Z",
    "exploitPublishDate": "2019-03-23T00:00:00.000Z",
    "solution": "Fixed in:\n\n* **[6.0.0.beta3](https://github.com/rails/rails/releases/tag/v6.0.0.beta3)** by [this](https://github.com/rails/rails/commit/f4c70c2222180b8d9d924f00af0c7fd632e26715) commit,\n* **[5.2.2.1](https://github.com/rails/rails/releases/tag/v5.2.2.1)** by [this](https://github.com/rails/rails/commit/d7fac9c09a535ec7f11bb9aa8addb4af37b7d4b5) commit,\n* **[5.1.6.2](https://github.com/rails/rails/releases/tag/v5.1.6.2)** by [this](https://github.com/rails/rails/commit/92c025d7f17ff256ac50f5e3bc014bb1a016d1ec) commit,\n* **[5.0.7.2](https://github.com/rails/rails/releases/tag/v5.0.7.2)** by [this](https://github.com/rails/rails/commit/c79dcbce9bfd20fe7f72ca431c49965ee39bd645) commit,\n* **[4.2.11.1](https://github.com/rails/rails/releases/tag/v4.2.11.1)** by [this](https://github.com/rails/rails/commit/58ed245e80a8710fbe31e91417bfd19f9f934cc4) commit.",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 5.0,
        "impactSubscore": 2.9,
        "exploitabilitySubscore": 10.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "NONE",
        "availabilityImpact": "NONE",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.1
        },
        "vector": "(AV:N/AC:L/Au:N/C:P/I:N/A:N/E:F/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 7.5,
        "impactSubscore": 3.6,
        "exploitabilitySubscore": 3.9,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "NONE",
        "availabilityImpact": "NONE",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.0
        },
        "vector": "CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N/E:F/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "John Hawthorn",
    "workaround": "This vulnerability can be mitigated by specifying a file format during rendering.\n\nFor example, changing: `render file: \"#{Rails.root}/some/file\"` to `render file: \"#{Rails.root}/some/file\", formats: [:html]` prevents attack.\n\nPatches also exist in:\n\n* [6-0-action-view-file-disclosure.patch](https://seclists.org/oss-sec/2019/q1/att-178/6-0-action-view-file-disclosure.patch) - Patch for 6.0 series\n* [5-2-action-view-file-disclosure.patch](https://seclists.org/oss-sec/2019/q1/att-178/5-2-action-view-file-disclosure.patch) - Patch for 5.2 series\n* [5-1-action-view-file-disclosure.patch](https://seclists.org/oss-sec/2019/q1/att-178/5-1-action-view-file-disclosure.patch) - Patch for 5.1 series\n* [5-0-action-view-file-disclosure.patch](https://seclists.org/oss-sec/2019/q1/att-178/5-0-action-view-file-disclosure.patch) - Patch for 5.0 series\n* [4-2-action-view-file-disclosure.patch](https://seclists.org/oss-sec/2019/q1/att-178/5-0-action-view-file-disclosure.patch) - Patch for 4.2 series",
    "vendorFixDate": "2019-03-05T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 7.0,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0848",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-200"
            },
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-22"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-5418",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0848/ranges"
            },
            {
                "rel": "reference",
                "href": "https://chybeta.github.io/2019/03/16/Analysis-for%E3%80%90CVE-2019-5418%E3%80%91File-Content-Disclosure-on-Rails/",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://github.com/mpgn/CVE-2019-5418",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/mpgn/Rails-doubletap-RCE/blob/master/exploit.rb",
                "label": "EXPLOIT"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rails/rails/commit/58ed245e80a8710fbe31e91417bfd19f9f934cc4",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rails/rails/commit/92c025d7f17ff256ac50f5e3bc014bb1a016d1ec",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rails/rails/commit/c79dcbce9bfd20fe7f72ca431c49965ee39bd645",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rails/rails/commit/d7fac9c09a535ec7f11bb9aa8addb4af37b7d4b5",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rails/rails/commit/f4c70c2222180b8d9d924f00af0c7fd632e26715",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rails/rails/releases/tag/v4.2.11.1",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rails/rails/releases/tag/v5.0.7.2",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rails/rails/releases/tag/v5.1.6.2",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rails/rails/releases/tag/v5.2.2.1",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rails/rails/releases/tag/v6.0.0.beta3",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://groups.google.com/forum/#!topic/rubyonrails-security/pFRKI96Sm8Q",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://packetstormsecurity.com/files/152178/Rails-5.2.1-Arbitrary-File-Content-Disclosure.html",
                "label": "EXPLOIT"
            },
            {
                "rel": "reference",
                "href": "https://seclists.org/oss-sec/2019/q1/att-178/5-0-action-view-file-disclosure.patch",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://seclists.org/oss-sec/2019/q1/att-178/5-1-action-view-file-disclosure.patch",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://seclists.org/oss-sec/2019/q1/att-178/5-2-action-view-file-disclosure.patch",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://seclists.org/oss-sec/2019/q1/att-178/6-0-action-view-file-disclosure.patch",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://weblog.rubyonrails.org/2019/3/13/Rails-4-2-5-1-5-1-6-2-have-been-released/",
                "label": "ADVISORY"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0848/default-remediation-status"
            }
        ]
    }
}