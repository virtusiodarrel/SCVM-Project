{
    "source": "BDSA",
    "name": "BDSA-2020-0798",
    "title": "squid Vulnerable to Remote Code Execution (RCE) via Stack Overflow in ESI Expression Evaluation",
    "description": "If ESI is enabled, squid is vulnerable to remote code execution (RCE) or denial-of-service (DoS) due to stack overflow when evaluating ESI expressions provided by a malicious upstream server.",
    "technicalDescription": "The vulnerability lies in `src/esi/Expression.cc`. When handling `<esi:when>` tags, parsed ESI attribute contents are added to the stack in `addmember()` which doesn't check the limits of the  fixed size buffer `stackmember`.\n\nA maliciously crafted ESI expression served to the proxy could trigger a buffer overwrite leading to memory corruption and a denial-of-service (DoS) through application crash. According to the credited researcher, this could also potentially be used to achieve remote code execution, but it is unlikely due to alignment issues, stack cookies, as well as the fact the the attacker only controls 8 of the 32 bytes that will be overwritten when adding a struct `_stackmember`.",
    "publishedDate": "2020-04-17T15:23:32.579Z",
    "updatedDate": "2021-08-03T10:50:51.062Z",
    "disclosureDate": "2020-04-14T00:00:00.000Z",
    "exploitPublishDate": "2020-04-14T00:00:00.000Z",
    "solution": "Fixed in [**4.11**](http://www.squid-cache.org/Versions/v4/) by [this](https://github.com/squid-cache/squid/commit/9f27bcc53bc1d673072a827b84e01c17d746559b)  and [this](https://github.com/squid-cache/squid/commit/f66e113ee7f6dbbc767c853752ea5585c9e7cca8) commit.\n\nFixed in [**5.0.2**](http://www.squid-cache.org/Versions/v5/).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 7.5,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 10.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.9
        },
        "vector": "(AV:N/AC:L/Au:N/C:P/I:P/A:P/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 9.8,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 3.9,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 8.8
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Jeriko One",
    "workaround": "",
    "vendorFixDate": "2020-03-16T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 8.8,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-0798",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-121"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-12519",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-0798/ranges"
            },
            {
                "rel": "reference",
                "href": "http://www.squid-cache.org/Versions/v4/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "http://www.squid-cache.org/Versions/v5/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/squid-cache/squid/commit/9f27bcc53bc1d673072a827b84e01c17d746559b",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/squid-cache/squid/commit/f66e113ee7f6dbbc767c853752ea5585c9e7cca8",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://gitlab.com/jeriko.one/security/-/blob/master/squid/CVEs/CVE-2019-12519.txt",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://gitlab.com/jeriko.one/security/-/blob/master/squid/CVEs/CVE-2019-12519.txt",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://www.openwall.com/lists/oss-security/2020/04/23/1",
                "label": "ADVISORY"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-0798/default-remediation-status"
            }
        ]
    }
}