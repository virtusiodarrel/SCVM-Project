{
    "source": "BDSA",
    "name": "BDSA-2019-0906",
    "title": "Kubernetes Vulnerable to Arbitrary Code Execution via Directory Traversal in 'kubectl cp' Implementation",
    "description": "Kubernetes is vulnerable to arbitrary code execution due to how it handles copying files between containers and the user machine. An attacker who is able to breach a container or trick a victim into downloading a malicious image can exploit this flaw via a maliciously crafted `tar` archive. Unsafe handling of the extraction process can be leveraged via a symlink attack technique to overwrite arbitrary files on the host.",
    "technicalDescription": "The `kubectl cp` command used to copy files between containers and the host will firstly crate a `tar` archive and then extract it in the target destination. If files are packed or extracted inside a container, `kubectl` will make use of the container's `tar` binary for the operation. Otherwise, if the archive is to be created or unpacked on the host, `kubectl` will rely on the `tar` parsing code located in `cmd/cp/cp.go`.\n\nIf an attacker is able to control the contents of the `tar` archive prepared in the container they can try to abuse the logic of `cp.go` to overwrite system files. If that malicious archive is copied to the host by the user `copyFromPod()` will make a call to vulnerable `untarAll()` in order to extract the files.\n\nEven though the function uses `clean()` to strip path traversal strings (`../`) it opens up another attack vector - it can both create and follow symbolic links from the tar headers. An attacker can abuse this functionality by crafting an archive containing a header with a symbolic link, and a subsequent header to a file inside a directory with the same name as the symlink. This can be leveraged to overwrite files that the symlink points to, which can lead to arbitrary code execution.\n\nSystem can be compromised by overwriting files such as `/etc/profile`, `.bashrc` or cron files.",
    "publishedDate": "2019-04-02T14:20:57.555Z",
    "updatedDate": "2019-07-29T13:30:57.584Z",
    "disclosureDate": "2019-03-28T00:00:00.000Z",
    "exploitPublishDate": "2019-03-28T00:00:00.000Z",
    "solution": "Fixed in:\n* [**1.11.9**](https://github.com/kubernetes/kubernetes/releases/tag/v1.11.9) by [this](https://github.com/kubernetes/kubernetes/commit/2f9ad66eaca587e516d5edd5edd070efc118b31f) commit,\n* [**1.12.7**](https://github.com/kubernetes/kubernetes/releases/tag/v1.12.7) by [this](https://github.com/kubernetes/kubernetes/commit/38a3162748adb2ca733fd4de9558fc77f60cfa8e) commit,\n* [**1.13.5**](https://github.com/kubernetes/kubernetes/releases/tag/v1.13.5) by [this](https://github.com/kubernetes/kubernetes/commit/b18e16e5ca330fccaef34798cabf64fd9f23409b) commit and\n* [**1.14.0**](https://github.com/kubernetes/kubernetes/releases/tag/v1.14.0) by [this](https://github.com/kubernetes/kubernetes/commit/ee7edb77659902afbe2f7b872159cf9f952a8e23) commit.",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 5.1,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 4.9,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.0
        },
        "vector": "(AV:N/AC:H/Au:N/C:P/I:P/A:P/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 7.5,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 1.6,
        "severity": "MEDIUM",
        "attackVector": "NETWORK",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "REQUIRED",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 6.7
        },
        "vector": "CVSS:3.0/AV:N/AC:H/PR:N/UI:R/S:U/C:H/I:H/A:H/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Ariel Zelivansky",
    "workaround": "",
    "vendorFixDate": "2019-03-05T00:00:00.000Z",
    "vendorNotifiedDate": "2019-03-04T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 6.7,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0906",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-59"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-1002101",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0906/ranges"
            },
            {
                "rel": "reference",
                "href": "https://discuss.kubernetes.io/t/announce-security-release-of-kubernetes-kubectl-potential-directory-traversal-releases-1-11-9-1-12-7-1-13-5-and-1-14-0-cve-2019-1002101/5712",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kubernetes/kubernetes/commit/2f9ad66eaca587e516d5edd5edd070efc118b31f",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kubernetes/kubernetes/commit/38a3162748adb2ca733fd4de9558fc77f60cfa8e",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kubernetes/kubernetes/commit/b18e16e5ca330fccaef34798cabf64fd9f23409b",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kubernetes/kubernetes/commit/ee7edb77659902afbe2f7b872159cf9f952a8e23",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kubernetes/kubernetes/releases/tag/v1.11.9",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kubernetes/kubernetes/releases/tag/v1.12.7",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kubernetes/kubernetes/releases/tag/v1.13.5",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kubernetes/kubernetes/releases/tag/v1.14.0",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://www.twistlock.com/labs-blog/disclosing-directory-traversal-vulnerability-kubernetes-copy-cve-2019-1002101/",
                "label": "POC"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0906/default-remediation-status"
            }
        ]
    }
}