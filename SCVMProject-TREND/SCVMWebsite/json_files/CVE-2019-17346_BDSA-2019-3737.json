{
    "source": "BDSA",
    "name": "BDSA-2019-3737",
    "title": "Xen Vulnerable to Denial-of-service (DoS) and Privilege Escalation via Logic Flaw in TLB Flushing",
    "description": "Xen is vulnerable to a denial-of-service (DoS) and privilege escalation.  This allows an attacker with a PV guest machine to crash the host.  An attacker may also be able to access data associated with other guests, this may lead to privilege escalation.",
    "technicalDescription": "The DoS is due to a logic flaw existing in TLB flushes when using Process Context Identifiers (PCID).\n\nThis flaw lies in the `switch_cr3_cr4()` function of the `/xen/arch/x86/flushtlb.c` source file. Changes that introduced the use of Process Context Identifiers (PCID) have affected the TLB flushing logic, breaking it in some cases. Xen may fail to perform TLB flushes leading to excessive accumulation of TLB entries which will not be purged.\n\nPart of the problem is that the CR3 (control register 3) values used for contexts run with PCID enabled have `CR3.NOFLUSH` flag set on them. This means that CR3 write does not result in any flushing. If the second CR4 write gets skipped or doesn't perform a flush, there is no other mechanism to purge the TLB entries if the PCID doesn't change (otherwise the \"just in case\" flush would do so).\n\nMalicious PV guests could leverage this flaw to crash the underlying host or possibly achieve privilege escalation. Even if not attacked, affected setups are likely to experience issues with stability.\n\nOnly systems running x86 PV guests with at least one PCID-enabled guest are vulnerable.",
    "publishedDate": "2019-11-29T16:58:39.692Z",
    "updatedDate": "2019-11-29T16:58:39.674Z",
    "disclosureDate": "2019-03-05T00:00:00.000Z",
    "solution": "Fixed in versions:\n\n* [**4.10.4**](https://downloads.xenproject.org/release/xen/) by [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=a595111d0cd2f16caa33e28a08461240c03ab92b) commit.\n* [**4.11.2**](https://downloads.xenproject.org/release/xen/) by [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=6c197f96bdacb752e6f576e413e8cc05328cc0a3) commit.\n* [**4.12.0-rc5**](https://downloads.xenproject.org/release/xen/) by [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=6e5f22ba437d78c0a84b9673f7e2cfefdbc62f4b) commit.",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 5.3,
        "impactSubscore": 7.8,
        "exploitabilitySubscore": 3.2,
        "severity": "LOW",
        "accessVector": "ADJACENT_NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "NONE",
        "availabilityImpact": "COMPLETE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 3.9
        },
        "vector": "(AV:A/AC:H/Au:N/C:P/I:N/A:C/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 5.9,
        "impactSubscore": 4.2,
        "exploitabilitySubscore": 1.6,
        "severity": "MEDIUM",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "LOW",
        "integrityImpact": "NONE",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.2
        },
        "vector": "CVSS:3.0/AV:A/AC:H/PR:N/UI:N/S:U/C:L/I:N/A:H/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Sergey Dyasli and Andrew Cooper of Citrix.",
    "workaround": "Vendor supplied patches can be applied to vulnerable versions to mitigate this vulnerability.  The patch and corresponding versions can be found [here](http://xenbits.xen.org/xsa/advisory-292.html).\n\nMitigation instructions from vendor:\n* Running only HVM or PVH guests will prevent exploitation.\n* Running only 32-bit PV guests with HVM or PVH guests will also prevent exploitation, given Dom0 is also 32-bit or is not using PCID.  Making a 64-bit Dom0 not use PCID can be achieved by setting `xpti=no-dom0 pcid=xpti`.\n* Disabling use of PCID, by passing `pcid=0` or `invpcid=0` hypervisor command line argument, will also prevent exploitation (however re-introducing the XPTI performance regression).\n* Disabling the watchdog timer will remove the only known way of reliably creating problematic TLB entries, reducing potential for exploitation to a degree.",
    "vendorFixDate": "2019-03-05T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 5.2,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-3737",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-270"
            },
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-400"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-17346",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-3737/ranges"
            },
            {
                "rel": "reference",
                "href": "http://xenbits.xen.org/xsa/advisory-292.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "http://xenbits.xen.org/xsa/advisory-292.html",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://downloads.xenproject.org/release/xen/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=6c197f96bdacb752e6f576e413e8cc05328cc0a3",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=6e5f22ba437d78c0a84b9673f7e2cfefdbc62f4b",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=a595111d0cd2f16caa33e28a08461240c03ab92b",
                "label": "PATCH"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-3737/default-remediation-status"
            }
        ]
    }
}