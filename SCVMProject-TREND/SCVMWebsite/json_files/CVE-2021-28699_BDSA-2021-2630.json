{
    "source": "BDSA",
    "name": "BDSA-2021-2630",
    "title": "Xen Vulnerable to Denial-of-Service (DoS) via Flawed Validation of Grant-v2 Status Frames Array Bounds",
    "description": "Xen is vulnerable to denial-of-service (DoS) conditions due to how an array capacity check in the `gnttab_get_status_frames()` function is flawed and can incorrectly allow too many `GFNs` to be written and overflow the array.\n\nA malicious or simply buggy guest could trigger this issue and cause system-wide instability.\n\n**Note**: The vendor has stated [here](https://xenbits.xenproject.org/xsa/advisory-382.html) that apart from the DoS impact of this issue, they cannot rule out the possibility that this issue could be exploited to achieve information disclosure or privilege escalation effects. The vendor has also stated that only 32-bit x86 guests that are permitted to use grant table version 2 interfaces can exploit this vulnerability. 64-bit x86 guests cannot leverage this vulnerability, but note that `HVM` and `PVH` guests are free to alter their 'bitness' as they see fit. On Arm systems, grant table v2 use is explicitly unsupported.\n\nOnly guests permitted to have `8177` or more grant table frames can leverage this vulnerability.",
    "technicalDescription": "Xen is vulnerable to denial-of-service (DoS) conditions because the array capacity check in the `gnttab_get_status_frames()` function within the `xen/common/grant_table.c` file is flawed. This check converts the `op.nr_frames` using the `grant_to_status_frames()` function which can inadvertently allow for 8 times as many GFNs to be written as actually fit in the array.",
    "publishedDate": "2021-09-01T15:54:03.404Z",
    "updatedDate": "2022-08-25T10:42:37.429Z",
    "disclosureDate": "2021-08-25T00:00:00.000Z",
    "solution": "Fixed in:\n* the **staging-4.11** branch by [this](https://github.com/xen-project/xen/commit/ec4654ce64d87f14567008cfb42568fd434f1bed) commit,\n* the **staging-4.12** branch by [this](https://github.com/xen-project/xen/commit/9e39b7f71ac79eef0cdff3fa38e6fd9402ecdda7) commit,\n*  [**4.13.4**](https://github.com/xen-project/xen/releases/tag/RELEASE-4.13.4) by [this](https://github.com/xen-project/xen/commit/985b3e50cda925fb2755b49b3c4a1c7a339d8ae4) commit,\n* [**4.14.3**](https://github.com/xen-project/xen/releases/tag/RELEASE-4.14.3) by [this](https://github.com/xen-project/xen/commit/66f5e867c6e3d400af354ab72e924fa7b3ada733) commit,\n* [**4.15.1**](https://github.com/xen-project/xen/releases/tag/RELEASE-4.15.1) by [this](https://github.com/xen-project/xen/commit/8a8b16c44e3e4cae097224511b72dfd7b059152b) commit",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 4.1,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 2.7,
        "severity": "LOW",
        "accessVector": "LOCAL",
        "accessComplexity": "MEDIUM",
        "authentication": "SINGLE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 3.0
        },
        "vector": "(AV:L/AC:M/Au:S/C:P/I:P/A:P/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 6.6,
        "impactSubscore": 4.7,
        "exploitabilitySubscore": 1.8,
        "severity": "MEDIUM",
        "attackVector": "LOCAL",
        "attackComplexity": "LOW",
        "confidentialityImpact": "LOW",
        "integrityImpact": "LOW",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "LOW",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.8
        },
        "vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:H/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Jan Beulich (SUSE)",
    "workaround": "The vendor has stated [here](https://xenbits.xenproject.org/xsa/advisory-382.html) that this issue can be avoided by limiting the number of grants Xen would allow guests to establish using the `gnttab_max_frames` Xen command line option and the `max_grant_frames` xl domain configuration setting. For Xen **4.14** onwards, it is possible to alter the system-wide upper bound of the number of grants Xen would allow guests to establish by writing to the `/params/gnttab_max_frames` hypervisor file system node. Changing the value this way only affects guests that are yet to be created on the respective host.\n\nThe vendor has also suggested that suppressing the use of grant table v2 interfaces for 32-bit x86 guests will can also avoid this vulnerability.",
    "vendorFixDate": "2021-08-25T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 5.8,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2630",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-120"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-28699",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2630/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/commit/18b1be5e324bcbe2f10898b116db641d404b3d30",
                "label": "INTRODUCTORY_COMMIT"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/commit/66f5e867c6e3d400af354ab72e924fa7b3ada733",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/commit/8a8b16c44e3e4cae097224511b72dfd7b059152b",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/commit/985b3e50cda925fb2755b49b3c4a1c7a339d8ae4",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/commit/9e39b7f71ac79eef0cdff3fa38e6fd9402ecdda7",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/commit/ec4654ce64d87f14567008cfb42568fd434f1bed",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/commit/ec820035b875cdbedce5e73f481ce65963ede9ed",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/releases/tag/RELEASE-4.13.4",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/releases/tag/RELEASE-4.14.3",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/releases/tag/RELEASE-4.15.1",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xenproject.org/xsa/advisory-382.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xenproject.org/xsa/advisory-382.html",
                "label": "WORKAROUND"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2630/default-remediation-status"
            }
        ]
    }
}