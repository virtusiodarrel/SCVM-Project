{
    "source": "BDSA",
    "name": "BDSA-2020-1437",
    "title": "Drupal Core Vulnerable to Remote Code Execution (RCE) via Maliciously Crafted Website",
    "description": "Drupal core allows for a remote attacker, who can trick an authenticated administrator into visiting a specially-crafted website, to create a directory within the file system. This directory can then be leveraged to execute arbitrary code via a brute force effort.\n\nWindows systems are most likely to be affected by this.",
    "technicalDescription": "The flaw lies in the function `drupal_valid_test_ua()` within the `includes/bootstrap.inc` file. It does not check whether a `$key_file` variable is a directory, and if it is, it should reject access. It also does not check that the `$private_key` variable is valid (non-empty and at least 74 bytes).\n\nA cross-site request forgery issue in the \"interface translation\" core module could be abused to trick a victim into creating arbitrary directories on the server. Drupal tries to determine whether a request is meant for a \"test site\", whereby it inspects the value of every request\u2019s `User-Agent` HTTP header against a pseudo-random value calculated by combining various sources of entropy. Most of these sources of entropy can be determined by the attacker because of the first flaw, leaving only the change date property of the `bootstrap.inc` file, which can be bruted forced in real time by an attacker.\n\nBy combining these flaws the attacker can configure the \"test site\" to use an external database controlled by the attacker. Finally, by injecting a deserialization primitive into this database the attacker can trigger the creation of arbitrary content on the root of the web server. This can be leveraged to create a PHP shell for instance, which will run arbitrary commands.",
    "publishedDate": "2020-06-18T14:20:51.499Z",
    "updatedDate": "2020-08-10T12:13:17.997Z",
    "disclosureDate": "2020-06-17T00:00:00.000Z",
    "exploitPublishDate": "2020-07-02T00:00:00.000Z",
    "solution": "Fixed in:\n* [**8.8.8**](https://github.com/drupal/core/releases/tag/8.8.8) by [this](https://github.com/drupal/core/commit/2a3dc22a5364bc5b38eb55fe1bd24f389854e9e3) commit.\n* [**8.9.1**](https://github.com/drupal/core/releases/tag/8.9.1) by [this](https://github.com/drupal/core/commit/0c36474abfcfa25de8ac4b21f184d9c8f09d2214) commit.\n* [**9.0.1**](https://github.com/drupal/core/releases/tag/9.0.1) by [this](https://github.com/drupal/core/commit/9dd8f1645252ac5bfa3c4aa35db8d38c0efe43d6) commit.",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 5.1,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 4.9,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.0
        },
        "vector": "(AV:N/AC:H/Au:N/C:P/I:P/A:P/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 7.5,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 1.6,
        "severity": "MEDIUM",
        "attackVector": "NETWORK",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "REQUIRED",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 6.7
        },
        "vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:U/C:H/I:H/A:H/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Lorenzo G, Sam Thomas",
    "workaround": "",
    "vendorFixDate": "2020-06-17T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 6.7,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-1437",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-552"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2020-13664",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-1437/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/drupal/core/commit/0c36474abfcfa25de8ac4b21f184d9c8f09d2214",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/drupal/core/commit/2a3dc22a5364bc5b38eb55fe1bd24f389854e9e3",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/drupal/core/commit/9dd8f1645252ac5bfa3c4aa35db8d38c0efe43d6",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/drupal/core/releases/tag/8.8.8",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/drupal/core/releases/tag/8.9.1",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/drupal/core/releases/tag/9.0.1",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://pentest.co.uk/labs/research/drupal-8-remote-code-execution-by-estimating-installation-time-of-site/",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://pentest.co.uk/labs/research/drupal-8-remote-code-execution-by-estimating-installation-time-of-site/",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://www.drupal.org/sa-core-2020-005",
                "label": "ADVISORY"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-1437/default-remediation-status"
            }
        ]
    }
}