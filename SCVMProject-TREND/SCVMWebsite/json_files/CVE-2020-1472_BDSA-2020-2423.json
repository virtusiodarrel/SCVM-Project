{
    "source": "BDSA",
    "name": "BDSA-2020-2423",
    "title": "Samba Vulnerable to Authentication Bypass via Cryptographic Flaw in Netlogon Protocol",
    "description": "Samba is vulnerable to authentication bypass via a cryptographic flaw in Microsoft's Netlogon protocol. An attacker can take advantage of this to achieve full Windows domain compromise, particularly for active directory domains. \n\nThis is exploitable by an unauthenticated attacker with access to the internal network and the ability to establish TCP/IP connections with the domain controller.\n\nThe issue only affects Samba servers configured as domain controllers. Installations that run Samba as a file server only are not directly affected by this issue. File servers and domain members do not run the `NETLOGON` service in supported Samba versions.   \n\nVersions **4.7** and below are vulnerable unless they have `server channel = yes ` in `smb.conf`.\n\nVersions **4.8** and later are not vulnerable unless they have\nthe `smb.conf` lines `server schannel = no` or `server schannel = auto`.\n\nThis vulnerability is listed as exploitable by the Cybersecurity & Infrastructure Security Agency in their [Known Exploited Vulnerabilities Catalog](https://www.cisa.gov/known-exploited-vulnerabilities-catalog).",
    "technicalDescription": "The Microsoft Netlogon remote protocol is an RPC interface available on Windows domain controllers. This protocol uses a custom cryptographic protocol to allow a client and server to prove to each other that they both know a shared secret. \n\nUsing this protocol a computer can update its password within the domain. Due to a flaw in the cryptographic authentication protocol an attacker is able to change the machine account password on active directory. They can achieve this by sending Netlogon messages in which various fields are filled with zeros. As a result they will be able to obtain domain admin credentials.\n\nSamba implemented the AES Netlogon protocol faithfully exposing it to the same problem in the cryptosystem design.\n\nIn an active directory domain changing the domain controller password will result in full password database disclosure including the krbtgt password, unsalted MD4 password hash (the 'NT Hash') for each user, and the LM password hash if stored (via DRS replication). Using the krbtgt password an attacker can issue a 'golden ticket' to themselves and return to take over the domain at a point of their choosing. Other consequences include session key disclosure and denial-of-service (DoS) of the selected trust account. \n\nSince Samba **4.8** the `require schannel` option has been to `yes` by default. This is equivalent to having server `schannel`  set to `yes` in `smb.conf`.",
    "publishedDate": "2020-09-18T13:12:29.719Z",
    "updatedDate": "2022-05-06T11:19:03.235Z",
    "disclosureDate": "2020-08-11T00:00:00.000Z",
    "exploitPublishDate": "2020-09-14T00:00:00.000Z",
    "solution": "* Fixed in [**4.10.18**](https://download.samba.org/pub/samba/) by [this](https://download.samba.org/pub/samba/patches/security/samba-4.10.17-security-2020-09-18.patch) commit.\n* Fixed in [**4.11.13**](https://download.samba.org/pub/samba/) by [this](https://download.samba.org/pub/samba/patches/security/samba-4.11.12-security-2020-09-18.patch) commit.\n* Fixed in [**4.12.7**](https://download.samba.org/pub/samba/) by [this](https://download.samba.org/pub/samba/patches/security/samba-4.12.6-security-2020-09-18.patch) commit.",
    "severity": "CRITICAL",
    "cvss2": {
        "baseScore": 6.8,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 8.6,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "MEDIUM",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.6
        },
        "vector": "(AV:N/AC:M/Au:N/C:P/I:P/A:P/E:F/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 10.0,
        "impactSubscore": 6.0,
        "exploitabilitySubscore": 3.9,
        "severity": "CRITICAL",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "CHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 9.3
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H/E:F/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Tom Tervoort of Secura",
    "workaround": "A fix is proposed in the patches [here](https://bugzilla.samba.org/show_bug.cgi?id=14497) which are not yet merged. \n\nUsers of versions of Samba before **4.8** should set\n\n`server schannel = yes`\n\nin their `smb.conf` and restart Samba. \n\nUsers of versions **4.8** and above should ensure their `smb.conf` either\na) has the `server schannel = yes` line, or\nb) has no `server schannel` line.",
    "vendorFixDate": "2020-09-18T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 9.3,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-2423",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-310"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2020-1472",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-2423/ranges"
            },
            {
                "rel": "reference",
                "href": "https://bugzilla.samba.org/show_bug.cgi?id=14497",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://bugzilla.samba.org/show_bug.cgi?id=14497",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://download.samba.org/pub/samba/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://download.samba.org/pub/samba/patches/security/samba-4.10.17-security-2020-09-18.patch",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://download.samba.org/pub/samba/patches/security/samba-4.11.12-security-2020-09-18.patch",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://download.samba.org/pub/samba/patches/security/samba-4.12.6-security-2020-09-18.patch",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/dirkjanm/CVE-2020-1472",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://portal.msrc.microsoft.com/en-us/security-guidance/advisory/CVE-2020-1472#ID0EUGAC",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.cisa.gov/known-exploited-vulnerabilities-catalog",
                "label": "EXPLOIT"
            },
            {
                "rel": "reference",
                "href": "https://www.samba.org/samba/security/CVE-2020-1472.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.secura.com/blog/zero-logon",
                "label": "ADVISORY"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-2423/default-remediation-status"
            }
        ]
    }
}