{
    "source": "BDSA",
    "name": "BDSA-2022-0331",
    "title": "Samba Vulnerable to File Metadata Attacks via SMB1 Symlink Race Condition",
    "description": "Samba file server contains a race condition that allows malicious clients to access and modify the file metadata in an area of the file system not exported under the share definition. Successful exploitation of this vulnerability requires that the client has a write access to the exported part of the file system via SMB1 (Server Message Block version 1.0) Unix extensions or via NFS (Network File Sharing) protocol.",
    "technicalDescription": "The vulnerability can be exploited by creating symlinks that can race the server by renaming an existing path and then replacing it with a symlink. If the client wins the race, the metadata of the symlink target will be modified.\n\n**Note:** the symlink race is difficult to win and the proof-of-concept (undisclosed) has been delivered under heavy server load in research conditions.",
    "publishedDate": "2022-02-03T17:17:31.186Z",
    "updatedDate": "2022-02-03T17:17:31.170Z",
    "disclosureDate": "2022-01-10T00:00:00.000Z",
    "solution": "Fixed in [**4.15.0**](https://github.com/samba-team/samba/releases/tag/samba-4.15.0).\n\nThe latest stable releases can be found [here](https://download.samba.org/pub/samba/).",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 3.6,
        "impactSubscore": 4.9,
        "exploitabilitySubscore": 3.9,
        "severity": "LOW",
        "accessVector": "NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "SINGLE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 2.6
        },
        "vector": "(AV:N/AC:H/Au:S/C:P/I:P/A:N/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 5.9,
        "impactSubscore": 4.2,
        "exploitabilitySubscore": 1.6,
        "severity": "MEDIUM",
        "attackVector": "NETWORK",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "LOW",
        "integrityImpact": "HIGH",
        "availabilityImpact": "NONE",
        "privilegesRequired": "LOW",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.2
        },
        "vector": "CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:L/I:H/A:N/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Michael Hanselmann",
    "workaround": "The vendor has proposed the following workaround:\n\n> Do not enable SMB1 (please note SMB1 is disabled by default in Samba\n> from version 4.11.0 and onwards). This prevents the creation of\n> symbolic links via SMB1. If SMB1 must be enabled for backwards\n> compatibility then add the parameter:\n> \n> `unix extensions = no`\n> \n> to the [global] section of your smb.conf and restart smbd. This\n> prevents SMB1 clients from creating symlinks on the exported file\n> system.\n> \n> However, if the same region of the file system is also exported using\n> NFS, NFS clients can create symlinks that potentially can also hit the\n> race condition. For non-patched versions of Samba we recommend only\n> exporting areas of the file system by either SMB2 or NFS, not both.",
    "vendorFixDate": "2021-09-20T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 5.2,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-0331",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-362"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-20316",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-0331/ranges"
            },
            {
                "rel": "reference",
                "href": "https://attachments.samba.org/attachment.cgi?id=16817",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://attachments.samba.org/attachment.cgi?id=16817",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://bugzilla.redhat.com/show_bug.cgi?id=2009673",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://download.samba.org/pub/samba/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/samba-team/samba/releases/tag/samba-4.15.0",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-0331/default-remediation-status"
            }
        ]
    }
}