{
    "source": "BDSA",
    "name": "BDSA-2022-0152",
    "title": "Umbraco Vulnerable to Account Takeover via Persistent Password Reset URL Manipulation",
    "description": "A vulnerability has been found in Umbraco whereby it is possible to persistently overwrite the `UmbracoApplicationUrl`. An unauthenticated remote attacker could exploit this by manipulating this value by sending a host header value that is set to point to a malicious server in order to view the password reset token once a reset link has been followed, or indeed the invite if an administrator invites a new user to the site. This could lead to subsequent account takeover attacks. \n\nThe ability to manipulate the `{request.Host}` variable is only possible when the Microsoft IIS Server bindings have not been configured to lock the server down to a specific hostname.",
    "technicalDescription": "This issue occurs because `UmbracoApplicationUrl` or `ApplicationUrl` configuration element is used in instances where the application code needs to construct a URL pointing back to the site such as when a password reset is required. If this element has not been specifically set, then its value can be manipulated. \n\nIt was mitigated by ensuring that the cached `ApplicationUrl` is no longer used for password resets and user invites. If this value has not been configured then it is enumerated to utilize the hostname that is requesting the password reset.  \n\nAn additional warning has always been added informing the administrator that the `ApplicationUrl` has not been configured and providing the recommendation to set one.\n\n**Note:** Although this issue has been mitigated, a related vulnerability **CVE-2022-22691** exists wherein an attacker can still manipulate the `ApplicationUrl` value but now can only invoke the password reset process on behalf of a user, and thus would likely occur unexpectedly as opposed to upon request by the user.",
    "publishedDate": "2022-01-20T12:37:17.587Z",
    "updatedDate": "2022-01-20T12:37:17.573Z",
    "disclosureDate": "2022-01-18T00:00:00.000Z",
    "exploitPublishDate": "2022-01-18T00:00:00.000Z",
    "solution": "Fixed in [**9.2.0**](https://github.com/umbraco/Umbraco-CMS/releases/tag/release-9.2.0) by the following commits:\n* [Commit 1](https://github.com/umbraco/Umbraco-CMS/commit/be53ccf1fd088d638cdd0ce2be2100f9402d7365),\n* [Commit 2](https://github.com/umbraco/Umbraco-CMS/commit/0ea5f6a02c2497c69446bf3e65e4e54b24d7093e),\n* [Commit 3](https://github.com/umbraco/Umbraco-CMS/commit/65c0d8fceca475d8a77ffb9289c4217b2bfeb3a6).\n\nThe latest stable releases can be found [here](https://github.com/umbraco/Umbraco-CMS/tags).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 5.1,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 4.9,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.0
        },
        "vector": "(AV:N/AC:H/Au:N/C:P/I:P/A:P/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.3,
        "impactSubscore": 6.0,
        "exploitabilitySubscore": 1.6,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "CHANGED",
        "userInteraction": "REQUIRED",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.5
        },
        "vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:C/C:H/I:H/A:H/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "AppCheck",
    "workaround": "As a workaround specifically set the `UmbracoApplicationUrl` within the Umbraco Configuration. Specifying a specific hostname within the IIS bindings will also prevent this vulnerability from being exploited.",
    "vendorFixDate": "2021-12-21T00:00:00.000Z",
    "vendorNotifiedDate": "2021-07-15T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 7.5,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-0152",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-640"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2022-22690",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-0152/ranges"
            },
            {
                "rel": "reference",
                "href": "https://appcheck-ng.com/umbraco-applicationurl-overwrite-persistent-password-reset-poison-cve-2022-22690-cve-2022-22691/",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://appcheck-ng.com/umbraco-applicationurl-overwrite-persistent-password-reset-poison-cve-2022-22690-cve-2022-22691/",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://appcheck-ng.com/umbraco-applicationurl-overwrite-persistent-password-reset-poison-cve-2022-22690-cve-2022-22691/",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://github.com/umbraco/Umbraco-CMS/commit/0ea5f6a02c2497c69446bf3e65e4e54b24d7093e",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/umbraco/Umbraco-CMS/commit/65c0d8fceca475d8a77ffb9289c4217b2bfeb3a6",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/umbraco/Umbraco-CMS/commit/be53ccf1fd088d638cdd0ce2be2100f9402d7365",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/umbraco/Umbraco-CMS/releases/tag/release-9.2.0",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/umbraco/Umbraco-CMS/tags",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-0152/default-remediation-status"
            }
        ]
    }
}