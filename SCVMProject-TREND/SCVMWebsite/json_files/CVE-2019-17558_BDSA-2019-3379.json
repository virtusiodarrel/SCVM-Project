{
    "source": "BDSA",
    "name": "BDSA-2019-3379",
    "title": "Apache Solr Vulnerable to Remote Code Execution (RCE) via Velocity Templates",
    "description": "Apache Solr is vulnerable to remote code execution (RCE) due to improper validation of Velocity templates. An attacker with configuration API access could exploit this vulnerability by supplying a system with maliciously crafted requests.\n\nThis vulnerability is listed as exploitable by the Cybersecurity & Infrastructure Security Agency in their [Known Exploited Vulnerabilities Catalog](https://www.cisa.gov/known-exploited-vulnerabilities-catalog).",
    "technicalDescription": "Solr does not sufficiently restrict the execution of untrusted code in the response writer `VelocityResponseWriter`. If a Solr instance allows untrusted access to the configuration API, an attacker can define `VelocityResponseWriter` with the parameter `params.resource.loader.enabled` set to `true`. This can allow them to supply a malicious Velocity template as a parameter request, which when rendered could allow code execution within the privileges of the application.\n\nThe vendor addressed this issue by removing the ability to provide Velocity templates through request parameters, only allowing templates to be rendered which have been provided by an authenticated user in a `velocity/` configset.",
    "publishedDate": "2019-11-04T17:06:41.393Z",
    "updatedDate": "2022-05-05T14:58:10.889Z",
    "disclosureDate": "2019-10-30T00:00:00.000Z",
    "exploitPublishDate": "2019-10-30T00:00:00.000Z",
    "solution": "Fixed in **[8.4.0](https://github.com/apache/lucene-solr/releases/tag/releases%2Flucene-solr%2F8.4.0)** by these commits:\n* [Commit 1](https://github.com/apache/lucene-solr/commit/05c5bcc8b3654b887944997add19f78eed9f927c),\n* [Commit 2](https://github.com/apache/lucene-solr/commit/bf2899fb00b55e612e5b0402989388b88b18b2b5),\n* [Commit 3](https://github.com/apache/lucene-solr/commit/8b2d8d0947082bf69002260337bda14553c6619b),\n* [Commit 4](https://github.com/apache/lucene-solr/commit/9dfee35b9facbcbc9342d8bbbe52667cb6d1dced).",
    "severity": "CRITICAL",
    "cvss2": {
        "baseScore": 7.5,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 10.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 6.2
        },
        "vector": "(AV:N/AC:L/Au:N/C:P/I:P/A:P/E:F/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 9.8,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 3.9,
        "severity": "CRITICAL",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 9.1
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H/E:F/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "",
    "workaround": "If upgrading to a fixed version cannot be performed immediately, the vendor states that configuration APIs should be disabled using the parameter `-Ddisable.configEdit=false`.",
    "vendorFixDate": "2019-12-11T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 9.1,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-3379",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-94"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-17558",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-3379/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/lucene-solr/commit/05c5bcc8b3654b887944997add19f78eed9f927c",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/lucene-solr/commit/8b2d8d0947082bf69002260337bda14553c6619b",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/lucene-solr/commit/9dfee35b9facbcbc9342d8bbbe52667cb6d1dced",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/lucene-solr/commit/bf2899fb00b55e612e5b0402989388b88b18b2b5",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/lucene-solr/releases/tag/releases%2Flucene-solr%2F8.4.0",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/jas502n/solr_rce",
                "label": "EXPLOIT"
            },
            {
                "rel": "reference",
                "href": "https://github.com/veracode-research/solr-injection",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://issues.apache.org/jira/browse/SOLR-13971",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://issues.apache.org/jira/browse/SOLR-13971",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://issues.apache.org/jira/browse/SOLR-14025",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://seclists.org/oss-sec/2019/q4/175",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.cisa.gov/known-exploited-vulnerabilities-catalog",
                "label": "EXPLOIT"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-3379/default-remediation-status"
            }
        ]
    }
}