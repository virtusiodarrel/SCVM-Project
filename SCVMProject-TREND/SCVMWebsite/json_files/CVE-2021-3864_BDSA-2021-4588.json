{
    "source": "BDSA",
    "name": "BDSA-2021-4588",
    "title": "Linux Kernel Vulnerable to Arbitrary Code Execution via Privilege Escalation using Coredump Files written to Arbitrary Directories",
    "description": "Linux Kernel contains a flaw in its coredump handling mechanism that can allow an attacker to conduct a local privilege escalation attack. This can subsequently lead to arbitrary code execution.",
    "technicalDescription": "To exploit this flaw, an attacker needs a root `suid` binary that uses `execve` function and also sets `uid` and `gid` values to 0. By crashing the process that executes after `execve` function, the attacker can generate a coredump file with `uid:gid` permissions and a coredump value of `SUID_DUMP_USER (1)`. The attacker can then use these coredump files to execute arbitrary code. \nAs demonstrated in the PoC, the `sudo` binary can be used to conduct this attack on a machine that allows a low-privileged user to run commands as root. `sudo` will set `uid` and `gid` values to 0 and fork a process in order to call `execve()` function for any command. An attacker can crash any child process of `sudo` by setting `RLIMIT_CPU` to 0 in the parent process that calls `sudo`. Alternatively, the attacker can fork a new process and execute the `suid` binary and then use `CTRL+\\ (SIGQUIT)` character in order to crash the child process. Either way, this crash will result in the generation of coredump file in the current working directory. The attacker can set the current working directory to `/etc/logrotate.d/` and include a valid `logrotate` configuration by passing it through specific environment variables that will be inherited by the child processes of `sudo`. By using this coredump file created in `/etc/logrotate.d/` directory, the attacker can then execute arbitrary code on the machine.",
    "publishedDate": "2022-08-29T16:28:29.019Z",
    "updatedDate": "2022-09-26T09:07:21.389Z",
    "disclosureDate": "2021-10-20T00:00:00.000Z",
    "exploitPublishDate": "2021-10-20T00:00:00.000Z",
    "solution": "",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 6.0,
        "impactSubscore": 10.0,
        "exploitabilitySubscore": 1.5,
        "severity": "MEDIUM",
        "accessVector": "LOCAL",
        "accessComplexity": "HIGH",
        "authentication": "SINGLE",
        "confidentialityImpact": "COMPLETE",
        "integrityImpact": "COMPLETE",
        "availabilityImpact": "COMPLETE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "WORKAROUND",
            "reportConfidence": "CONFIRMED",
            "score": 5.1
        },
        "vector": "(AV:L/AC:H/Au:S/C:C/I:C/A:C/E:POC/RL:W/RC:C)"
    },
    "cvss3": {
        "baseScore": 7.0,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 1.0,
        "severity": "MEDIUM",
        "attackVector": "LOCAL",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "LOW",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "WORKAROUND",
            "reportConfidence": "CONFIRMED",
            "score": 6.4
        },
        "vector": "CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:H/E:P/RL:W/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": true,
    "parentAdvisory": false,
    "credit": "Itai Greenhut",
    "workaround": "It is recommended to:\n* change `/proc/sys/kernel/core_pattern` to an absolute, safe directory. This will prevent logrotate from being triggered.\n* add `pam_limits.so` module to the PAM configuration of `sudo` and setting `RLIMIT_CORE` value to 0. This will make `sudo` immune to this vulnerability.\n\nA patch has been proposed [here](https://lore.kernel.org/lkml/20211228170910.623156-1-wander@redhat.com/T/#t) that has not been merged upstream yet.",
    "bdsaTags": [],
    "overallScore": 6.4,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-4588",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-94"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-3864",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-4588/ranges"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2bbdbdae05167c688b6d3499a7dab74208b80a22",
                "label": "INTRODUCTORY_COMMIT"
            },
            {
                "rel": "reference",
                "href": "https://lore.kernel.org/lkml/20211228170910.623156-1-wander@redhat.com/T/#t",
                "label": "LINK"
            },
            {
                "rel": "reference",
                "href": "https://www.openwall.com/lists/oss-security/2021/10/20/2",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.openwall.com/lists/oss-security/2021/10/20/2",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://www.openwall.com/lists/oss-security/2021/10/20/2",
                "label": "WORKAROUND"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-4588/default-remediation-status"
            }
        ]
    }
}