{
    "source": "BDSA",
    "name": "BDSA-2021-1737",
    "title": "Zephyr L2CAP Implementation Vulnerable to  Denial-of-Service (DoS) or Remote Code Execution (RCE) via Stack Based Buffer Overflow",
    "description": "Synopsys Cybersecurity Research Center (CyRC) has discovered that Zephyr's Bluetooth host is vulnerable to a denial-of-service (DoS) and potentially remote code execution via a stack overflow vulnerability in Zephyrs L2CAP Implementation.\n\nTriggering this vulnerability does not require authentication or encryption. The only requirement is that the device is in advertising mode and accepting connections, and that the attacker is within range of the Bluetooth device.",
    "technicalDescription": "This vulnerability occurs in  `le_ecred_conn_req()` function in `subsys/bluetooth/host/l2cap.c`  where there is no check on the size of a received   `L2CAP_CREDIT_BASED_CONNECTION_REQ`. If a very large connection request is received the excess data is interpreted as a large list of Source CIDs. The variable `chan` is allocated memory from stack for `L2CAP_ECRED_CHAN_MAX` number of pointers to `bt_l2cap_chan` structs. Variable `dcid` is allocated memory from stack for `L2CAP_ECRED_CHAN_MAX` number of `uint16_t values`.  `L2CAP_ECRED_CHAN_MAX` has been given a value of  5.\n\nA buffer overflow occurs when `l2cap_chan_accept()` is called for all the Source CIDs one by one. This doesn\u2019t yet freeze the execution. Another overflow happened on line 1152 where `dcid` is overflown.\nFinally, there was yet another buffer overflow happening when constructing the `L2CAP_CREDIT_BASED_CONNECTION_RSP` which finally caused the device to  freeze and leads to denial of service.\n\nIf assertions were enabled, the vulnerability leads to assertion failure when trying to copy too much data into the outgoing `L2CAP_CREDIT_BASED_CONNECTION_RSP`\npacket.\n\nAn attacker can force a denial of service through the provision of a over-large `L2CAP_CREDIT_BASED_CONNECTION_REQ` connection request, and can potentially achieve remote code execution.",
    "publishedDate": "2021-06-22T15:04:52.382Z",
    "updatedDate": "2022-07-12T11:04:06.446Z",
    "disclosureDate": "2021-06-11T00:00:00.000Z",
    "solution": "Fixed in [**2.6.0-rc1**](https://github.com/zephyrproject-rtos/zephyr/releases/tag/v2.6.0-rc1) with the following commits:\n*  [Bluetooth: L2CAP: Fix not checking for L2CAP_ECRED_CHAN_MAX](https://github.com/zephyrproject-rtos/zephyr/commit/39a3dee29d673a007ffd88161b46fde3ee02af40)\n*  [Bluetooth: L2CAP: Fix invalid BT_L2CAP_ECRED_CONN_RSP](https://github.com/zephyrproject-rtos/zephyr/commit/168389cccda30fc70605bc6a9fc8b498168ba197)\n*  [Bluetooth: L2CAP: Fix not including all DCIDs](https://github.com/zephyrproject-rtos/zephyr/commit/06e18c6df5bc9857d414687a6046fea6213c6506)\n\nFixed in [**2.5.1-rc1**](https://github.com/zephyrproject-rtos/zephyr/releases/tag/v2.5.1-rc1) with the following commits:\n*  [Bluetooth: L2CAP: Fix not checking for L2CAP_ECRED_CHAN_MAX](https://github.com/zephyrproject-rtos/zephyr/commit/ab2476d88e7695163c8328697da76ef788ade834)\n*  [Bluetooth: L2CAP: Fix invalid BT_L2CAP_ECRED_CONN_RSP](https://github.com/zephyrproject-rtos/zephyr/commit/56c712d2ca823f0780b609cc6b8315c092a7c63e)\n*  [Bluetooth: L2CAP: Fix not including all DCIDs](https://github.com/zephyrproject-rtos/zephyr/commit/550939e44128a106ba9040e1b68ae08558d4f40f)\n\nThe fix was backported to the [**2.4-branch**](https://github.com/zephyrproject-rtos/zephyr/tree/v2.4-branch) with the following commits:\n*  [Bluetooth: L2CAP: Fix not checking for L2CAP_ECRED_CHAN_MAX](https://github.com/zephyrproject-rtos/zephyr/commit/0a14470645991d87f01ce6566543c7f89dd29912)\n*  [Bluetooth: L2CAP: Fix invalid BT_L2CAP_ECRED_CONN_RSP](https://github.com/zephyrproject-rtos/zephyr/commit/de142e438de543692ca7ece7285d6c9a363d072d)\n*  [Bluetooth: L2CAP: Fix not including all DCIDs](https://github.com/zephyrproject-rtos/zephyr/commit/cf3b638fcbfc422be665286a944dda2e518b9a9d)\n\nThe most recent release can be found [here](https://www.zephyrproject.org/developer-resources/#current-release).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 5.8,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 6.5,
        "severity": "MEDIUM",
        "accessVector": "ADJACENT_NETWORK",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.3
        },
        "vector": "(AV:A/AC:L/Au:N/C:P/I:P/A:P/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.8,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 2.8,
        "severity": "HIGH",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.7
        },
        "vector": "CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Matias Karhumaa (Synopsys Cybersecurity Research Center (CyRC))",
    "workaround": "",
    "vendorFixDate": "2021-03-17T00:00:00.000Z",
    "discoveryDate": "2021-02-02T00:00:00.000Z",
    "vendorNotifiedDate": "2021-03-11T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 7.7,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-1737",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-121"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-3434",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-1737/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/zephyrproject-rtos/zephyr/commit/06e18c6df5bc9857d414687a6046fea6213c6506",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/zephyrproject-rtos/zephyr/commit/0a14470645991d87f01ce6566543c7f89dd29912",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/zephyrproject-rtos/zephyr/commit/168389cccda30fc70605bc6a9fc8b498168ba197",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/zephyrproject-rtos/zephyr/commit/39a3dee29d673a007ffd88161b46fde3ee02af40",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/zephyrproject-rtos/zephyr/commit/550939e44128a106ba9040e1b68ae08558d4f40f",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/zephyrproject-rtos/zephyr/commit/56c712d2ca823f0780b609cc6b8315c092a7c63e",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/zephyrproject-rtos/zephyr/commit/ab2476d88e7695163c8328697da76ef788ade834",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/zephyrproject-rtos/zephyr/commit/cf3b638fcbfc422be665286a944dda2e518b9a9d",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/zephyrproject-rtos/zephyr/commit/de142e438de543692ca7ece7285d6c9a363d072d",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/zephyrproject-rtos/zephyr/pull/33305",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/zephyrproject-rtos/zephyr/releases/tag/v2.5.1-rc1",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/zephyrproject-rtos/zephyr/releases/tag/v2.6.0-rc1",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/zephyrproject-rtos/zephyr/security/policy",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/zephyrproject-rtos/zephyr/tree/v2.4-branch",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://www.synopsys.com/blogs/software-security/cyrc-advisory-zephyr-vulnerability/",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.zephyrproject.org/developer-resources/#current",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://zephyrprojectsec.atlassian.net/browse/ZEPSEC-136",
                "label": "ADVISORY"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-1737/default-remediation-status"
            }
        ]
    }
}