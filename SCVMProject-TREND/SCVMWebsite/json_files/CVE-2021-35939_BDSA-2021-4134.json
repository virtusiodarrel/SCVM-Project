{
    "source": "BDSA",
    "name": "BDSA-2021-4134",
    "title": "RPM Vulnerable to Privilege Escalation via Flawed Ancestor Directory Validation in Symbolic Link Checks",
    "description": "RPM is vulnerable to a privilege escalation issue due to a flaw in ancestor directory validation that is performed in the checks to ensure that RPM only follows directory symbolic links owned by a target directory owner or root. These flawed checks were implemented in response to the previously reported privilege escalation issues **CVE-2017-7500** (**BDSA-2017-3497**) and **CVE-2017-7501** (**BDSA-2017-3660**).\n\nAn \"unprivileged\" user that owns another ancestor directory could abuse this issue in order to cause the policy to not be enforced and gain root privileges.\n\n**Note**: A Red Hat engineer has stated [here](https://bugzilla.redhat.com/show_bug.cgi?id=1964129#c9) that in this context, \"unprivileged\" users are system accounts, like `pcpqa` for example, that are usually more tightly controlled than ordinary users. Accessing files and directories installed by RPMs requires high privileges.",
    "technicalDescription": "RPM is vulnerable to privilege escalation because only the parent directory of a file that is to be created is checked during RPM's validation of directory symbolic links. If an untrusted user owns another ancestor directory, it can be possible for RPM to incorrectly follow an unsafe symbolic link.\n\n**Note**: The vulnerability reporter suggests [here](https://bugzilla.suse.com/show_bug.cgi?id=1157883#c0) that an exploit for this issue requires a similar directory structure exists both at the location where RPM operates, and for the files the attacker wishes to control. In an example of such a scenario, the reporter noted that in openSUSE, both `matomo` and `icinga2` ship a `Pdo/Mysql.php` file in the file system. If a compromised `matomo` user can create a symlink `/srv/www/matomo/core/Tracker/Db ->\n/usr/share/icingaweb2/library/vendor/Zend/Db/Adapter/`, the next update of `matomo` could cause RPM to replace the `Pdo/Mysql.php` file of `icinga2` and give ownership to the `matomo` user.",
    "publishedDate": "2022-02-18T10:50:12.497Z",
    "updatedDate": "2022-06-30T08:14:46.788Z",
    "disclosureDate": "2021-06-30T00:00:00.000Z",
    "exploitPublishDate": "2021-06-30T00:00:00.000Z",
    "solution": "",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 3.5,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 1.5,
        "severity": "LOW",
        "accessVector": "LOCAL",
        "accessComplexity": "HIGH",
        "authentication": "SINGLE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "WORKAROUND",
            "reportConfidence": "CONFIRMED",
            "score": 3.0
        },
        "vector": "(AV:L/AC:H/Au:S/C:P/I:P/A:P/E:POC/RL:W/RC:C)"
    },
    "cvss3": {
        "baseScore": 6.5,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 0.6,
        "severity": "MEDIUM",
        "attackVector": "LOCAL",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "HIGH",
        "scope": "UNCHANGED",
        "userInteraction": "REQUIRED",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "WORKAROUND",
            "reportConfidence": "CONFIRMED",
            "score": 6.0
        },
        "vector": "CVSS:3.1/AV:L/AC:L/PR:H/UI:R/S:U/C:H/I:H/A:H/E:P/RL:W/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "workaround": "Fixes are proposed in [this](https://github.com/rpm-software-management/rpm/pull/1919) pull request. The author has stated [here](https://github.com/rpm-software-management/rpm/pull/1919#issuecomment-1041258659) that these fixes are not complete. Users of RPM daily snapshots should remain vigilant as bugs are most likely present.\n\nA fix covering **CVE-2021-35939** specifically can be found [here](https://github.com/rpm-software-management/rpm/commit/96ec957e281220f8e137a2d5eb23b83a6377d556).",
    "bdsaTags": [],
    "overallScore": 6.0,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-4134",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-59"
            },
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-61"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-35939",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-4134/ranges"
            },
            {
                "rel": "reference",
                "href": "https://access.redhat.com/security/cve/cve-2021-35939",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://bugzilla.redhat.com/show_bug.cgi?id=1964129",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://bugzilla.redhat.com/show_bug.cgi?id=1964129#c9",
                "label": "LINK"
            },
            {
                "rel": "reference",
                "href": "https://bugzilla.suse.com/show_bug.cgi?id=1157883",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://bugzilla.suse.com/show_bug.cgi?id=1157883#c0",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rpm-software-management/rpm/commit/96ec957e281220f8e137a2d5eb23b83a6377d556",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rpm-software-management/rpm/pull/1919",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rpm-software-management/rpm/pull/1919#issuecomment-1041258659",
                "label": "ADVISORY"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-4134/default-remediation-status"
            }
        ]
    }
}