{
    "source": "BDSA",
    "name": "BDSA-2019-3772",
    "title": "Xen Vulnerable to Denial-of-service (DoS) due to Missing Preemption in x86 PV Page Table Unvalidation",
    "description": "Xen is vulnerable to denial-of-service (DoS) due to reachable assertion in the x86 PV page table unvalidation code. A malicious or buggy PV guest can leverage this flaw to cause a crash of the underlying host.",
    "technicalDescription": "Previous changes to the memory management module required making any page table entries (PTE) updates restartable. These changes assumed that L2 cache pagetables would always be promoted [preemptibly](https://en.wikipedia.org/wiki/Preemption_%28computing%29) but failed to consider a possibility of using the [linear pagetable](https://silentming.net/blog/2016/11/30/xen-log-7-guest-linear-page-table/) feature. The assumption may not be true in cases where this feature is used, which can cause improper handling of interrupted operations.\n\nSpecifically, an assumption in `put_page_from_l2e()`  that` _put_page_type()` will always succeed is incorrect.\n\nAnother set of patches making pagetable update preemptible failed to account for linear pagetables at L3 and L4 levels. This allows operations to run for longer than acceptable times.\n\nThe denial-of-service (DoS) is due to a recursive page table cleanup taking a long time to complete under certain conditions.  \n\nVulnerable hosts:\n\n* Only x86 systems are affected.  ARM systems are not affected.\n* Only Xen versions which permit linear page table use by PV guests are vulnerable.\n* Only x86 PV guests can exploit this vulnerability.  x86 HVM guests cannot exploit this vulnerability.",
    "publishedDate": "2019-11-29T16:57:28.171Z",
    "updatedDate": "2019-11-29T16:57:28.158Z",
    "disclosureDate": "2019-03-05T00:00:00.000Z",
    "solution": "Fixed in versions:\n\n* [**4.10.4**](https://xenproject.org/downloads/) by [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=f6f1e948873ed601d3d743a2586619b763acd084) commit.\n* [**4.11.2**](https://xenproject.org/downloads/) by [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=4835974065cce110c917bae37c43ef3b58c9a710) commit.\n* [**4.12.0-rc5**](https://xenproject.org/downloads/) by [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=176ebf9c8bc2828f6637eb61cc1cf166e302c699) commit.",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 2.1,
        "impactSubscore": 2.9,
        "exploitabilitySubscore": 3.9,
        "severity": "LOW",
        "accessVector": "LOCAL",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "NONE",
        "integrityImpact": "NONE",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 1.6
        },
        "vector": "(AV:L/AC:L/Au:N/C:N/I:N/A:P/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 7.1,
        "impactSubscore": 4.0,
        "exploitabilitySubscore": 2.5,
        "severity": "MEDIUM",
        "attackVector": "LOCAL",
        "attackComplexity": "LOW",
        "confidentialityImpact": "NONE",
        "integrityImpact": "NONE",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "CHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 6.2
        },
        "vector": "CVSS:3.0/AV:L/AC:L/PR:N/UI:N/S:C/C:N/I:N/A:H/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Manuel Bouyer",
    "workaround": "Vendor supplied patches can be applied to vulnerable versions to mitigate this vulnerability.  The patch and corresponding versions can be found [here](http://xenbits.xen.org/xsa/advisory-290.html).\n\nThe vendor has provided these instructions as means of mitigation prior to upgrading:\n\n* Not permitting linear page table use by PV guests avoids the vulnerability.  This can be done both at build time, by turning off the PV_LINEAR_PT configure option, or at runtime, by passing specifying \"pv-linear-pt=0\" on the hypervisor command line. Doing so would, however, render PV guests using the functionality, like NetBSD, unusable.\n* On systems where the guest kernel is controlled by the host rather than guest administrator, running only kernels which only issue sane hypercalls will prevent untrusted guest users from exploiting this issue.  However untrusted guest administrators can still trigger it unless further steps are taken to prevent them from loading code into the kernel (e.g by disabling loadable modules etc) or from using other mechanisms which allow them to run code at kernel privilege.\n* Running only HVM guests will avoid this vulnerability.",
    "vendorFixDate": "2019-03-05T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 6.2,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-3772",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-617"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-17344",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-3772/ranges"
            },
            {
                "rel": "reference",
                "href": "http://xenbits.xen.org/xsa/advisory-290.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "http://xenbits.xen.org/xsa/advisory-290.html",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=176ebf9c8bc2828f6637eb61cc1cf166e302c699",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=4835974065cce110c917bae37c43ef3b58c9a710",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=c612481d1c",
                "label": "INTRODUCTORY_COMMIT"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=f6f1e948873ed601d3d743a2586619b763acd084",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenproject.org/downloads/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-3772/default-remediation-status"
            }
        ]
    }
}