{
    "source": "BDSA",
    "name": "BDSA-2018-4394",
    "title": "NSS Vulnerable to Information Disclosure via Cache Side-channel Bleichenbacher Attack",
    "description": "Mozilla Network Security Services (NSS) is vulnerable to information disclosure due to a faulty implementation of TLS. Although the software incorporates protections for padding oracle attacks, they do not consider the possibility of data leaks via microarchitectural channels. This makes cache side-channel attacks feasible.\n\nIn cases where the victim and attacker share the same physical machine (e.g. shared hosting/cloud environments), the attacker may be able to break the encryption by monitoring the victim's data access patterns. The attack is possible because the padding oracle gets exposed during all stages of handling PKCS #1 v1.5 padding. This can allow an attacker to retrieve the cryptographic key and to perform RSA secret key operations, e.g. to decrypt encrypted data or forge signatures.",
    "technicalDescription": "This attack is subject to some limitations which an attacker must overcome. Firstly, in order to mount a microarchitectural side channel attack, the attacker and the victim must share some CPU caching components (which can be monitored for patterns). Secondly, the attacker must achieve a man-in-the-middle (MITM) position on the network to be able to decrypt a ciphertext and make use of the results. Lastly, the attacker needs to be able to force the victim server to decrypt ciphertexts chosen by them.\n\nAdditionally the attacker will usually have to perform an active protocol downgrade attack to get over the limitations imposed by TLS and force the use of RSA in the communication. Another technique will have to be used to keep the TLS handshake alive to prevent the browser from timing out while performing the attack.\n\nIf these condition are met then the attacker can exploit the following flaws in the implementation of NSS.\n\nThe first problem is a leak during the conversion stage in the `mp_to_fixlen_octets()` function which converts a large number into a fixed-length  byte array. The padding is not performed in constant time, making it possible for an attacker to determine the amount of leading zeros in the RSA decrypted plaintext. This can be done by counting the number of iterations of the `for` loop within the function via a cache side channel technique.\n\nThe second issue is a leak from the code responsible for PKCS #1 v1.5 format verification. The problem is that the code in `RSA_DecryptBlock()` will terminate early in case of a failure, which can be leveraged for a padding oracle via a branch prediction attack. The padding oracle can become even more effective if an attacker were to monitor the call to `PORT_Memcpy()` via a cache side-channel, which only checks for a zero anywhere after the 2 leading bytes.\n\nThe last flaw lies in the code meant for mitigation of padding oracle attacks. The current implementation uses an if statement that translates to a conditional branch in order to check the result of the PKCS #1 v1.5 verification. This also makes it vulnerable to leakage via branch monitoring, allowing an attacker to implement a padding oracle.",
    "publishedDate": "2018-12-18T14:02:34.689Z",
    "updatedDate": "2019-02-19T09:36:27.931Z",
    "disclosureDate": "2018-11-30T00:00:00.000Z",
    "solution": "Fixed in:\n* [**3.36.6**](https://ftp.mozilla.org/pub/security/nss/releases/) by [commit1](https://github.com/nss-dev/nss/commit/ef50ebb15c398be404e75f180edaf2a16bc57046), [commit2](https://github.com/nss-dev/nss/commit/81660a34bcfc47f1a7da6f4d2a84fadf637d9ccb), and [commit3](https://github.com/nss-dev/nss/commit/fa5a258d5d9f4e8dd13ee158cb9c2c4013e057a7)\n* [**3.40.1**](https://ftp.mozilla.org/pub/security/nss/releases/) by [commit1](https://github.com/nss-dev/nss/commit/5cbd94f6a12d34019dfd9edd661a4095aa379a45), [commit2](https://github.com/nss-dev/nss/commit/b77f8476966ca170f42bbfa8c5e659b94ebdc914), and [commit3](https://github.com/nss-dev/nss/commit/fef8e7235096aa090eb24342ad3a5b8190851803)\n* [**3.41-beta1**](https://ftp.mozilla.org/pub/security/nss/releases/) by [commit1](https://github.com/nss-dev/nss/commit/65efd2b077dbc8a28fd07cd0ea6f03535310338b), [commit2](https://github.com/nss-dev/nss/commit/7ebab8fd82d7b2b80cb5e644bba3e1f2b13f6864), and [commit3](https://github.com/nss-dev/nss/commit/56785267fba008ade9254155a05d6d7c51809020)",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 2.6,
        "impactSubscore": 2.9,
        "exploitabilitySubscore": 4.9,
        "severity": "LOW",
        "accessVector": "NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "NONE",
        "availabilityImpact": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 1.9
        },
        "vector": "(AV:N/AC:H/Au:N/C:P/I:N/A:N/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 5.9,
        "impactSubscore": 3.6,
        "exploitabilitySubscore": 2.2,
        "severity": "MEDIUM",
        "attackVector": "NETWORK",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "NONE",
        "availabilityImpact": "NONE",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.2
        },
        "vector": "CVSS:3.0/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:N/A:N/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Eyal Ronen, Robert Gillham, Daniel Genkin, Adi Shamir, David Wong, and Yuval Yarom",
    "workaround": "",
    "vendorFixDate": "2018-11-30T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 5.2,
    "_meta": {
        "allow": [],
        "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/BDSA-2018-4394",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro.app.blackduck.com/api/cwes/CWE-200"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/CVE-2018-12404",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/BDSA-2018-4394/ranges"
            },
            {
                "rel": "reference",
                "href": "https://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSS/NSS_3.41_release_notes",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://eprint.iacr.org/2016/613.pdf",
                "label": "LINK"
            },
            {
                "rel": "reference",
                "href": "https://eprint.iacr.org/2018/1173.pdf",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://ftp.mozilla.org/pub/security/nss/releases/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nss-dev/nss/commit/56785267fba008ade9254155a05d6d7c51809020",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nss-dev/nss/commit/5cbd94f6a12d34019dfd9edd661a4095aa379a45",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nss-dev/nss/commit/65efd2b077dbc8a28fd07cd0ea6f03535310338b",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nss-dev/nss/commit/7ebab8fd82d7b2b80cb5e644bba3e1f2b13f6864",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nss-dev/nss/commit/81660a34bcfc47f1a7da6f4d2a84fadf637d9ccb",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nss-dev/nss/commit/b77f8476966ca170f42bbfa8c5e659b94ebdc914",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nss-dev/nss/commit/ef50ebb15c398be404e75f180edaf2a16bc57046",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nss-dev/nss/commit/fa5a258d5d9f4e8dd13ee158cb9c2c4013e057a7",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nss-dev/nss/commit/fef8e7235096aa090eb24342ad3a5b8190851803",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://www.blackhat.com/docs/asia-17/materials/asia-17-Irazoqui-Cache-Side-Channel-Attack-Exploitability-And-Countermeasures.pdf",
                "label": "LINK"
            }
        ]
    }
}