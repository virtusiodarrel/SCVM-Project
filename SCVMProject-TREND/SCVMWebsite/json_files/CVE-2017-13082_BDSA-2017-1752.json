{
    "source": "BDSA",
    "name": "BDSA-2017-1752",
    "title": "wpa_supplicant and hostapd Vulnerable to Man-in-the-Middle Attacks via Protocol Handshake Allows Reinstalling Pairwise Transient Key",
    "description": "KRACK (Key Re-installation Attack) refers to a collection of vulnerabilities affecting products supporting the Wi-Fi Protected Access (WPA) and Wi-Fi Protected Access II (WPA2) protocols.  These vulnerabilities arise from design and implementation flaws in the underlying protocol itself.\n\nWPA and WPA2 in multiple products, including wpa_supplicant and hostapd, suffer from key re-installation attacks via protocol handshakes which can compromise the data-confidentiality layer.  Once encryption has been compromised, further attacks can be mounted against applications at the network layer.",
    "technicalDescription": "The Fast Basic Service Set (BSS) Transition (FT) handshake reduces the roaming time when a client moves from one Access Point (AP), to another one of the same protected network.  It was first described in IEEE specification 802.11r-2008, but researchers should refer to IEEE 802.11-2016 or latest available for the most recent revision.\n\nAn FT handshake is initiated by the supplicant. The first two messages are an Authentication Request (AuthReq), and an Authentication Response (AuthResp).  They are functionally equivalent to Message 1 and 2 of the 4-way handshake, and carry randomly generated nonces that\nwill be used to derive a new Pairwise Transient Key (PTK).\n\nAfter this, the supplicant sends a Reassociation Request (ReassoReq), and the AP replies with a Reassociaton Response (ReassoResp). They are similar in functionality to Message 3 and 4 of the 4-way handshake, which is to finalize the FT handshake, and transport the Group Temporal Key (GTK) to the supplicant.\n\nOnly the two reassociation messages are authenticated using a Message Integrity Code (MIC).  Additionally, none of the messages in the FT\nhandshake contain a replay counter.  Instead, the FT handshake relies on the random SNonce and ANonce to provide replay protection\nbetween different invocations of the handshake.\n\nAccording to the standard, the PTK must be installed after the authentication response is sent or received.\n\nAn attacker can eavesdrop and replay/inject frames into the network to perform key reinstallation attack against both the supplicant/client and authenticator/access point. In practice, APs must accept retransmissions of reassociation requests.\n\nBecause a re-association request does not contain a replay counter, and has a valid MIC attached, the AP will accept and process the replayed frame.  As a result, the AP will reinstall the PTK in stage 3 of the attack, thereby resetting the associated nonce and replay counter. \n\nIn order for an attack to succeed, the AP of a network must support 802.11r.   An attacker would then clone a real AP of the protected network and conduct a wormhole attack against the client.  This makes the client think another AP of the targeted network is nearby. \n\nFinally, the attacker sends a BSS Transition Management Request to the client, re-installing the key.",
    "publishedDate": "2017-10-24T15:22:34.029Z",
    "updatedDate": "2020-02-20T10:26:38.842Z",
    "disclosureDate": "2017-10-16T00:00:00.000Z",
    "exploitPublishDate": "2017-10-18T00:00:00.000Z",
    "solution": "Fixed in wpa_supplicant and hostapd version **[2.7](https://w1.fi/releases/)**.",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 6.2,
        "impactSubscore": 9.2,
        "exploitabilitySubscore": 3.2,
        "severity": "MEDIUM",
        "accessVector": "ADJACENT_NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "COMPLETE",
        "integrityImpact": "COMPLETE",
        "availabilityImpact": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.9
        },
        "vector": "(AV:A/AC:H/Au:N/C:C/I:C/A:N/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 6.8,
        "impactSubscore": 5.2,
        "exploitabilitySubscore": 1.6,
        "severity": "MEDIUM",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "NONE",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 6.1
        },
        "vector": "CVSS:3.0/AV:A/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:N/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Mathy Vanhoef and Frank Piessens",
    "workaround": "If upgrading to a fixed version cannot be performed immediately, the vendor recommends as a temporary measure disabling the FT handshake in runtime configuration.",
    "vendorFixDate": "2017-10-02T00:00:00.000Z",
    "vendorNotifiedDate": "2017-07-14T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 6.1,
    "_meta": {
        "allow": [],
        "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/BDSA-2017-1752",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro.app.blackduck.com/api/cwes/CWE-323"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/CVE-2017-13082",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/BDSA-2017-1752/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/vanhoefm/krackattacks-test-ap-ft",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://w1.fi/releases/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://w1.fi/security/2017-1/wpa-packet-number-reuse-with-replayed-messages.txt",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.krackattacks.com/",
                "label": "ADVISORY"
            }
        ]
    }
}