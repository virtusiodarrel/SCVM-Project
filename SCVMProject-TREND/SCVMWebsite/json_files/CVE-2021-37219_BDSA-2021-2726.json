{
    "source": "BDSA",
    "name": "BDSA-2021-2726",
    "title": "HashiCorp Consul Vulnerable to Privilege Escalation via Improper Agent Certificate Validation",
    "description": "HashiCorp Consul is vulnerable to privilege escalation due to the improper authorization of certificates that are being used for Raft requests. A remote attacker that has a non-server certificate that has been signed by the Consul certificate authority could access server-only Raft RPC functionality.",
    "technicalDescription": "HashiCorp Consul can communicate with Consul client agents and Consul server agents using mTLS. Consul uses certificates in order to authenticate agents and negotiate a secure connection. After the connection has been negotiated, agents can invoke Raft RPC functionality on the Consul server. \n\nSome of this functionality is only supposed to be available to server agents. However, the logic that is used to permit access to this functionality is flawed. This can allow client agents to invoke the server agent RPC functionality in an unauthorized manner. A remote attacker could therefore use a valid non-server certificate in order to access privileged functionality on a Consul server.\n\nThe vulnerability was fixed by correcting the flawed logic so that it checks that the certificate has been signed by the appropriate authority.",
    "publishedDate": "2021-09-08T13:18:21.631Z",
    "updatedDate": "2021-12-28T13:13:20.474Z",
    "disclosureDate": "2021-09-01T00:00:00.000Z",
    "solution": "Fixed in versions:\n* [**1.10.2**](https://github.com/hashicorp/consul/releases/tag/v1.10.2) by [this](https://github.com/hashicorp/consul/commit/3357e57dac9aadabd476f7a14973e47f003c4cf0) commit.\n* [**1.9.9**](https://github.com/hashicorp/consul/releases/tag/v1.9.9) by [this](https://github.com/hashicorp/consul/commit/473edd1764b6739e2e4610ea5dede4c2bc6009d1) commit.\n* [**1.8.15**](https://github.com/hashicorp/consul/releases/tag/v1.8.15) by [this](https://github.com/hashicorp/consul/commit/ccf8eb1947357434eb6e66303ddab79f4c9d4103) commit.\n\nFixed in [**API/1.10.0**](https://github.com/hashicorp/consul/releases/tag/api%2Fv1.10.0) by [this](https://github.com/hashicorp/consul/commit/79c7e73618683444fc37f97d19619175c4e622a0) commit.\n\nThe latest stable releases can be found [here](https://github.com/hashicorp/consul/releases).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 6.5,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 8.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "SINGLE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.8
        },
        "vector": "(AV:N/AC:L/Au:S/C:P/I:P/A:P/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.8,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 2.8,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "LOW",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.7
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "HashiCorp Engineering Team",
    "workaround": "",
    "vendorFixDate": "2021-08-26T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 7.7,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2726",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-285"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-37219",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2726/ranges"
            },
            {
                "rel": "reference",
                "href": "https://discuss.hashicorp.com/t/hcsec-2021-22-consul-raft-rpc-privilege-escalation/29024",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/hashicorp/consul/commit/3357e57dac9aadabd476f7a14973e47f003c4cf0",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/hashicorp/consul/commit/473edd1764b6739e2e4610ea5dede4c2bc6009d1",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/hashicorp/consul/commit/79c7e73618683444fc37f97d19619175c4e622a0",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/hashicorp/consul/commit/ccf8eb1947357434eb6e66303ddab79f4c9d4103",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/hashicorp/consul/releases",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/hashicorp/consul/releases/tag/api%2Fv1.10.0",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/hashicorp/consul/releases/tag/v1.10.2",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/hashicorp/consul/releases/tag/v1.8.15",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/hashicorp/consul/releases/tag/v1.9.9",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2726/default-remediation-status"
            }
        ]
    }
}