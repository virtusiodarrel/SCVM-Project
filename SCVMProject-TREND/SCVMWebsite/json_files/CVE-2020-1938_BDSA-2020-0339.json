{
    "source": "BDSA",
    "name": "BDSA-2020-0339",
    "title": "Apache Tomcat Vulnerable to Information Disclosure and Potential Remote Code Execution via Apache JServ Protocol (AJP) Connector",
    "description": "Apache Tomcat is vulnerable to information disclosure due to Apache JServ Protocol (AJP) connections being given higher privileges than that of an equivalent HTTP client connection. An attacker who is able to reach the Tomcat AJP connector could return arbitrary files from the target web application which may contain sensitive information.  \n\nThis vulnerability does not allow remote code execution by default.\n\nThis vulnerability is listed as exploitable by the Cybersecurity & Infrastructure Security Agency in their [Known Exploited Vulnerabilities Catalog](https://www.cisa.gov/known-exploited-vulnerabilities-catalog).",
    "technicalDescription": "Apache Tomcat includes the AJP connector which is enabled by default and listens on all addresses on port 8009. This connection is treated with more trust than a connection such as HTTP, allowing an attacker to exploit it to perform actions that are not intended for an untrusted user.\n\nThis vulnerability allows an attacker to retrieve arbitrary files from anywhere in the web application including the `WEB-INF` and `META-INF` directories and any other location which can be reached via `ServletContext.getResourceAsStream()`. It also allows processing any file in the web application as JSP.  \n\nRemote code execution is not possible by default. If an application running on an affected version of Tomcat contains a file upload vulnerability an attacker can exploit it in combination with Ghostcat to achieve remote code execution. However this requires that uploaded files are saved to the document root and attackers must also be able to reach the AJP port directly from outside the victim's network.",
    "publishedDate": "2020-02-28T17:02:57.376Z",
    "updatedDate": "2022-03-04T09:15:59.044Z",
    "disclosureDate": "2020-02-24T00:00:00.000Z",
    "exploitPublishDate": "2020-02-20T00:00:00.000Z",
    "solution": "Fixed in versions:\n* [**7.0.100**](https://github.com/apache/tomcat/releases/tag/7.0.100) by the following commits:\n\t* [Commit 1](https://github.com/apache/tomcat/commit/0d633e72ebc7b3c242d0081c23bba5e4dacd9b72)\n\t* [Commit 2](https://github.com/apache/tomcat/commit/40d5d93bd284033cf4a1f77f5492444f83d803e2)\n\t* [Commit 3](https://github.com/apache/tomcat/commit/b99fba5bd796d876ea536e83299603443842feba)\n\t* [Commit 4](https://github.com/apache/tomcat/commit/f7180bafc74cb1250c9e9287b68a230f0e1f4645)\n* [**8.5.51**](https://github.com/apache/tomcat/releases/tag/8.5.51) by the following commits:\n\t* [Commit 1](https://github.com/apache/tomcat/commit/69c56080fb3355507e1b55d014ec0ee6767a6150)\n\t* [Commit 2](https://github.com/apache/tomcat/commit/b962835f98b905286b78c414d5aaec2d0e711f75)\n\t* [Commit 3](https://github.com/apache/tomcat/commit/5a5494f023e81aa353e262fb14fff4cd0338a67c)\n\t* [Commit 4](https://github.com/apache/tomcat/commit/9be57601efb8a81e3832feb0dd60b1eb9d2b61d5)\n\t* [Commit 5](https://github.com/apache/tomcat/commit/64159aa1d7cdc2c118fcb5eac098e70129d54a19)\n\t* [Commit 6](https://github.com/apache/tomcat/commit/03c436126db6794db5277a3b3d871016fb9a3f23)\n* [**9.0.31**](https://github.com/apache/tomcat/releases/tag/9.0.31) by the following commits:\n\t* [Commit 1](https://github.com/apache/tomcat/commit/0e8a50f0a5958744bea1fd6768c862e04d3b7e75)\n\t* [Commit 2](https://github.com/apache/tomcat/commit/9ac90532e9a7d239f90952edb229b07c80a9a3eb)\n\t* [Commit 3](https://github.com/apache/tomcat/commit/64fa5b99442589ef0bf2a7fcd71ad2bc68b35fad)\n\t* [Commit 4](https://github.com/apache/tomcat/commit/7a1406a3cd20fdd90656add6cd8f27ef8f24e957)\n\t* [Commit 5](https://github.com/apache/tomcat/commit/49ad3f954f69c6e838c8cd112ad79aa5fa8e7153)",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 5.1,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 4.9,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.2
        },
        "vector": "(AV:N/AC:H/Au:N/C:P/I:P/A:P/E:F/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.1,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 2.2,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.5
        },
        "vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H/E:F/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Chaitin Tech",
    "workaround": "The AJP connector service can be disabled by commenting out or removing the appropriate line from the `$CATALINA_HOME/conf/server.xml` file and restarting Tomcat. \n\nIf an upgrade is not possible the `requiredSecret` attribute can be configured to set AJP protocol authentication credentials like so:\n\n`<Connector port=\"8009\" protocol=\"AJP/1.3\" redirectPort=\"8443\" address=\"YOUR_TOMCAT_IP_ADDRESS\" secret=\"YOUR_TOMCAT_AJP_SECRET\" />`\n\nIn the fixed versions of Tomcat this attribute was renamed `secret` but can be configured in the same way.",
    "vendorFixDate": "2020-02-05T00:00:00.000Z",
    "vendorNotifiedDate": "2020-01-03T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 7.5,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-0339",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-200"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2020-1938",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-0339/ranges"
            },
            {
                "rel": "reference",
                "href": "http://tomcat.apache.org/security-7.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "http://tomcat.apache.org/security-8.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "http://tomcat.apache.org/security-9.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/00theway/Ghostcat-CNVD-2020-10487",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/tomcat/commit/03c436126db6794db5277a3b3d871016fb9a3f23",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/tomcat/commit/0d633e72ebc7b3c242d0081c23bba5e4dacd9b72",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/tomcat/commit/0e8a50f0a5958744bea1fd6768c862e04d3b7e75",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/tomcat/commit/40d5d93bd284033cf4a1f77f5492444f83d803e2",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/tomcat/commit/49ad3f954f69c6e838c8cd112ad79aa5fa8e7153",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/tomcat/commit/5a5494f023e81aa353e262fb14fff4cd0338a67c",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/tomcat/commit/64159aa1d7cdc2c118fcb5eac098e70129d54a19",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/tomcat/commit/64fa5b99442589ef0bf2a7fcd71ad2bc68b35fad",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/tomcat/commit/69c56080fb3355507e1b55d014ec0ee6767a6150",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/tomcat/commit/7a1406a3cd20fdd90656add6cd8f27ef8f24e957",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/tomcat/commit/9ac90532e9a7d239f90952edb229b07c80a9a3eb",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/tomcat/commit/9be57601efb8a81e3832feb0dd60b1eb9d2b61d5",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/tomcat/commit/b962835f98b905286b78c414d5aaec2d0e711f75",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/tomcat/commit/b99fba5bd796d876ea536e83299603443842feba",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/tomcat/commit/f7180bafc74cb1250c9e9287b68a230f0e1f4645",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/tomcat/releases/tag/7.0.100",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/tomcat/releases/tag/8.5.51",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/tomcat/releases/tag/9.0.31",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://www.chaitin.cn/en/ghostcat",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.cisa.gov/known-exploited-vulnerabilities-catalog",
                "label": "EXPLOIT"
            },
            {
                "rel": "reference",
                "href": "https://www.exploit-db.com/exploits/48143",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://www.tenable.com/blog/cve-2020-1938-ghostcat-apache-tomcat-ajp-file-readinclusion-vulnerability-cnvd-2020-10487",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.tenable.com/blog/cve-2020-1938-ghostcat-apache-tomcat-ajp-file-readinclusion-vulnerability-cnvd-2020-10487",
                "label": "WORKAROUND"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-0339/default-remediation-status"
            }
        ]
    }
}