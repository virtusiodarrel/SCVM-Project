{
    "source": "BDSA",
    "name": "BDSA-2021-1308",
    "title": "Puma Vulnerable to Denial-of-Service (DoS) via Incomplete Fix to CVE-2019-16770",
    "description": "Puma is vulnerable to denial-of-service (DoS) due to an incomplete fix to `CVE-2019-16770`. Despite the fix, a malicious client could still deny the service to new connections by saturating all threads in all processes within the cluster.",
    "technicalDescription": "The original vulnerability (`CVE-2019-16770`) lies in a lack of restriction on the number of `keep-alive` requests a single client can make before it is returned to the `reactor` to be subjected to normal sequencing. The fix to this ensured that already existing connections could not be starved of resources by greedy persistent connections saturating all threads in the same process.\n\nHowever, it was found that new connections could still be denied by persistent connections saturating all threads in all processes within the cluster. This new issue has been assigned a new CVE identifier, `CVE-2021-29509`. This vulnerability has also been fixed. The fix closes `keepalive` sockets in `lib/puma/server.rb` after they make more requests than is defined by `@max_fast_inline`.",
    "publishedDate": "2021-05-12T13:15:52.606Z",
    "updatedDate": "2022-06-06T14:01:54.788Z",
    "disclosureDate": "2021-05-11T00:00:00.000Z",
    "solution": "An attempt to fix `CVE-2019-16770` has been made in **4.3.1** by [this](https://github.com/puma/puma/commit/98a1f03e5ebe40cf56b65b0bf60adf97057e0eaf) commit and **3.12.2** by [this](https://github.com/puma/puma/commit/06053e60908074bb38293d4449ea261cb009b53e) commit. However, the fixes were found to be incomplete, resulting in `CVE-2021-29509`.\n\nThe vulnerability was fully fixed in **[4.3.8](https://github.com/puma/puma/releases/tag/v4.3.8)** by [this](https://github.com/puma/puma/commit/8088950a) commit and **[5.3.1](https://github.com/puma/puma/releases/tag/v5.3.1)** by [this](https://github.com/puma/puma/commit/df728871) commit.\n\nThe latest stable releases are available [here](https://github.com/puma/puma/releases).",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 5.0,
        "impactSubscore": 2.9,
        "exploitabilitySubscore": 10.0,
        "severity": "LOW",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "NONE",
        "integrityImpact": "NONE",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 3.7
        },
        "vector": "(AV:N/AC:L/Au:N/C:N/I:N/A:P/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 7.5,
        "impactSubscore": 3.6,
        "exploitabilitySubscore": 3.9,
        "severity": "MEDIUM",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "NONE",
        "integrityImpact": "NONE",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 6.5
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "workaround": "If an upgrade is not possible, apply the official [patch](https://gist.github.com/nateberkopec/4b3ea5676c0d70cbb37c82d54be25837).\n\nThe vendor also provides the following workaround:\n\nSetting `queue_requests` `false` also fixes the issue. This is not advised when using puma without a reverse proxy, such as nginx or apache, because you will open yourself to slow client attacks (e.g. [slowloris](https://en.wikipedia.org/wiki/Slowloris_(computer_security))).",
    "vendorFixDate": "2021-05-11T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 6.5,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-1308",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-400"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-29509",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-1308/ranges"
            },
            {
                "rel": "reference",
                "href": "https://en.wikipedia.org/wiki/Slowloris_(computer_security)",
                "label": "LINK"
            },
            {
                "rel": "reference",
                "href": "https://gist.github.com/nateberkopec/4b3ea5676c0d70cbb37c82d54be25837",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/puma/puma/commit/06053e60908074bb38293d4449ea261cb009b53e",
                "label": "LINK"
            },
            {
                "rel": "reference",
                "href": "https://github.com/puma/puma/commit/8088950a",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/puma/puma/commit/98a1f03e5ebe40cf56b65b0bf60adf97057e0eaf",
                "label": "LINK"
            },
            {
                "rel": "reference",
                "href": "https://github.com/puma/puma/commit/df728871",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/puma/puma/releases",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/puma/puma/releases/tag/v4.3.8",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/puma/puma/releases/tag/v5.3.1",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/puma/puma/security/advisories/GHSA-q28m-8xjw-8vr5",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/puma/puma/security/advisories/GHSA-q28m-8xjw-8vr5",
                "label": "WORKAROUND"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-1308/default-remediation-status"
            }
        ]
    }
}