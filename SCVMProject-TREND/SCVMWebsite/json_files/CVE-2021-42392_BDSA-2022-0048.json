{
    "source": "BDSA",
    "name": "BDSA-2022-0048",
    "title": "H2 Database Vulnerable to Remote Code Execution (RCE) via Unsafe JNDI Class Loading Functionality",
    "description": "H2 Database is vulnerable to remote code execution (RCE) due to the inclusion of unsafe Java Naming and Directory Interface (JNDI) functionality in its \"Console\" component. A remote attacker could leverage this functionality in order to load malicious classes into memory.\n\n**Note**: This is a different vulnerability than **CVE-2021-23221** (**BDSA-2022-0186**).",
    "technicalDescription": "The \"Console\" component of H2 Database implements the JNDI API. This API allows users to perform lookups, which can in turn cause remotely hosted Java classes to be loaded onto the server. The `getConnection()` method, of file `h2/src/main/org/h2/util/JdbcUtils.java`, does not restrict the protocols that can be used to perform these lookups. An attacker could therefore leverage this functionality in order to load maliciously crafted Java classes from a remote web server. These classes will contain arbitrary payloads within their constructors or static initialization blocks, which will be executed whenever the class is instantiated. A server must be configured to explicitly allow for remote access in order for the attacker to be able to exploit this issue. Alternatively, an attacker with `ADMIN` privileges could exploit this vulnerability by creating a malicious linked table.\n\nThe vulnerability was fixed by restricting the application's JNDI functionality so that it can only load locally stored classes.",
    "publishedDate": "2022-01-10T16:54:37.777Z",
    "updatedDate": "2022-02-04T15:43:01.773Z",
    "disclosureDate": "2022-01-05T00:00:00.000Z",
    "exploitPublishDate": "2022-01-06T00:00:00.000Z",
    "solution": "Fixed in version [**2.0.206**](https://github.com/h2database/h2database/releases/tag/version-2.0.206) by [this](https://github.com/h2database/h2database/commit/b24aa46f48904ce64443f8f4353d70a2eed09037) commit and [this](https://github.com/h2database/h2database/commit/4a2e677bfb6bfee59bff1ce1dfb6f28ce5109d8c) commit.\n\nThe latest stable releases can be found [here](https://github.com/h2database/h2database/releases).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 5.1,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 4.9,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.0
        },
        "vector": "(AV:N/AC:H/Au:N/C:P/I:P/A:P/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.1,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 2.2,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.3
        },
        "vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "JFrog Vulnerability Research Team",
    "workaround": "The vendor has stated [here](https://github.com/h2database/h2database/security/advisories/GHSA-h376-j262-vhq6) that the following workarounds can be used:\n\n> H2 Console should never be available to untrusted users.\n\n> -webAllowOthers is a dangerous setting that should be avoided.\n\n> H2 Console Servlet deployed on a web server can be protected with a security constraint: https://h2database.com/html/tutorial.html#usingH2ConsoleServlet\n> If `webAllowOthers` is specified, you need to uncomment and edit `<security-role>` and `<security-constraint>` as necessary. See documentation of your web server for more details.",
    "vendorFixDate": "2022-01-04T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 7.3,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-0048",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-749"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-42392",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-0048/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/h2database/h2database/commit/4a2e677bfb6bfee59bff1ce1dfb6f28ce5109d8c",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/h2database/h2database/commit/b24aa46f48904ce64443f8f4353d70a2eed09037",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/h2database/h2database/releases",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/h2database/h2database/releases/tag/version-2.0.206",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/h2database/h2database/security/advisories/GHSA-h376-j262-vhq6",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/h2database/h2database/security/advisories/GHSA-h376-j262-vhq6",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://jfrog.com/blog/the-jndi-strikes-back-unauthenticated-rce-in-h2-database-console/",
                "label": "POC"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-0048/default-remediation-status"
            }
        ]
    }
}