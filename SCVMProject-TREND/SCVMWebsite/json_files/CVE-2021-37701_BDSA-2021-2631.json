{
    "source": "BDSA",
    "name": "BDSA-2021-2631",
    "title": "tar Vulnerable to Arbitrary File Creation/Overwrite/Code Execution via Directory Cache Poisoning",
    "description": "The tar package for Node.js is vulnerable to arbitrary file creation/overwrite and arbitrary code execution via directory cache poisoning.",
    "technicalDescription": "node-tar tries to ensure that files whose location could be changed by a symlink are not extracted. This is achieved by checking that extracted directories are not symlinks and by caching paths when directories are created. This logic is insufficient when extracting tar files that contain both a directory and a symlink with the same name as the directory, where the names used backslashes on POSIX systems.\n\nBy creating a directory and replacing it with a symlink, an attacker could bypass node-tar symlink checks on directories, allowing an untrusted tar file to symlink to an arbitrary location and then extract arbitrary files into that location. A similar issue can happen on case-insensitive filesystems involving directory caches. \n\nThis issue was addressed by normalizing paths to use `/` as a path separator on Windows and leaving `\\` unchanged on POSIX systems. Directory cache pruning is performed case-insensitively.",
    "publishedDate": "2021-09-01T14:07:01.964Z",
    "updatedDate": "2021-09-01T14:07:01.942Z",
    "disclosureDate": "2021-08-31T00:00:00.000Z",
    "solution": "Fixed in:\n* [**4.4.16**](https://github.com/npm/node-tar/releases/tag/v4.4.16) by [this](https://github.com/npm/node-tar/commit/3f2e2da3866c4e5f26ca0c0d6721cb371c5a3933) commit. \n* [**5.0.8**](https://github.com/npm/node-tar/releases/tag/v5.0.8) by [this](https://github.com/npm/node-tar/commit/ab3e9036dc4504413fb6f154ea6943af5c187e26)commit. \n* [**6.1.7**](https://github.com/npm/node-tar/releases/tag/v6.1.7) by [this](https://github.com/npm/node-tar/commit/53602669f58ddbeb3294d7196b3320aaaed22728) commit.\n\nThe latest stable releases are available [here](https://github.com/npm/node-tar/tags).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 4.4,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 3.4,
        "severity": "LOW",
        "accessVector": "LOCAL",
        "accessComplexity": "MEDIUM",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 3.2
        },
        "vector": "(AV:L/AC:M/Au:N/C:P/I:P/A:P/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.6,
        "impactSubscore": 6.0,
        "exploitabilitySubscore": 1.8,
        "severity": "HIGH",
        "attackVector": "LOCAL",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "CHANGED",
        "userInteraction": "REQUIRED",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.5
        },
        "vector": "CVSS:3.1/AV:L/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:H/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Robert Chen",
    "workaround": "Users can workaround this vulnerability by creating a custom filter method (`x` in this example) which prevents all symbolic links from being extracted:\n\n```\nconst tar = require('tar')\n\ntar.x({\n  file: 'archive.tgz',\n  filter: (file, entry) => {\n    if (entry.type === 'SymbolicLink') {\n      return false\n    } else {\n      return true\n    }\n  }\n})\n```",
    "vendorFixDate": "2021-07-23T00:00:00.000Z",
    "vendorNotifiedDate": "2021-08-03T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 7.5,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2631",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-22"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-37701",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2631/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/commit/3f2e2da3866c4e5f26ca0c0d6721cb371c5a3933",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/commit/53602669f58ddbeb3294d7196b3320aaaed22728",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/commit/ab3e9036dc4504413fb6f154ea6943af5c187e26",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/releases/tag/v4.4.16",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/releases/tag/v5.0.8",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/releases/tag/v6.1.7",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/security/advisories/GHSA-9r2w-394v-53qc",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/tags",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://www.npmjs.com/advisories/1779",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.npmjs.com/advisories/1779",
                "label": "WORKAROUND"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2631/default-remediation-status"
            }
        ]
    }
}