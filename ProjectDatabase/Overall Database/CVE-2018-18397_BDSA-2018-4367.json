{
    "source": "BDSA",
    "name": "BDSA-2018-4367",
    "title": "Linux Kernel Vulnerable to TMPFS/HUGETLBFS File Permission Bypass via 'userfaultfd' API",
    "description": "Linux kernel is vulnerable to permission bypass in tmpfs/hugetlbfs file systems due to a missing permission check in `userfaultfd`. An attacker with read-only access to a tmpfs/hugetlbfs file can abuse the `userfaultfd` API to perform arbitrary writes to that file. This allows them to change the content of a file held in memory without authorization.",
    "technicalDescription": "Tmpfs is a file system which keeps all files in virtual memory, while hugetlbfs allows the virtual memory management subsystem to hold big memory pages (for efficiency). Userfaults allow userland to take control of memory page faults, which normally only the kernel can do.\n\nUserfaults can be delivered and resolved via the `userfaultfd()` syscall which creates a file descriptor for handling page faults in user space. Current implementation of the API which allows to interact with `userfaultfd` can be abused to perform arbitrary writes to files associated with such `userfaultfd` objects.\n\nThis is possible because of a missing permission check in the `userfaultfd_register()` function of the `/fs/userfaultfd.c` source file. The function does not check the `VM_MAYWRITE` flag before registering a `uffd` onto a particular virtual memory area (VMA). Therefore it is possible to, for example, register `userfaulfd` regions for shared read-only mappings of tmpfs files. Only VMAs that can pass the `vma_can_userfault()` check can be used for this attack.\n\nAn attacker can subsequently perform an arbitrary write to the associated region if there are any holes in the file's mapping. The holes in shared memory and hugetlbfs can be filled with `UFFDIO_COPY` ioctl, which will essentially change the file's content.",
    "publishedDate": "2018-12-14T12:27:02.604Z",
    "updatedDate": "2018-12-14T14:49:05.827Z",
    "disclosureDate": "2018-12-07T00:00:00.000Z",
    "exploitPublishDate": "2018-12-07T00:00:00.000Z",
    "solution": "Fixed in:\n* [**4.14.87**](https://www.kernel.org/) by [this](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=705a2810a314ccf06fe6190ea555e586975f9b28) commit,\n* [**4.19.7**](https://www.kernel.org/) by [this](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=34b7a7cc5321a1b5e13320443557ba1cb11b42e7) commit and\n* [**4.20-rc5**](https://www.kernel.org/) by [this](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=29ec90660d68bbdd69507c1c8b4e33aa299278b1) commit.",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 1.5,
        "impactSubscore": 2.9,
        "exploitabilitySubscore": 2.7,
        "severity": "LOW",
        "accessVector": "LOCAL",
        "accessComplexity": "MEDIUM",
        "authentication": "SINGLE",
        "confidentialityImpact": "NONE",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 1.2
        },
        "vector": "(AV:L/AC:M/Au:S/C:N/I:P/A:N/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 5.5,
        "impactSubscore": 3.6,
        "exploitabilitySubscore": 1.8,
        "severity": "MEDIUM",
        "attackVector": "LOCAL",
        "attackComplexity": "LOW",
        "confidentialityImpact": "NONE",
        "integrityImpact": "HIGH",
        "availabilityImpact": "NONE",
        "privilegesRequired": "LOW",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.0
        },
        "vector": "CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:H/A:N/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Jann Horn",
    "workaround": "",
    "vendorFixDate": "2018-11-30T00:00:00.000Z",
    "vendorNotifiedDate": "2018-10-16T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 5.0,
    "_meta": {
        "allow": [],
        "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/BDSA-2018-4367",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro.app.blackduck.com/api/cwes/CWE-862"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/CVE-2018-18397",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/BDSA-2018-4367/ranges"
            },
            {
                "rel": "reference",
                "href": "https://bugs.chromium.org/p/project-zero/issues/detail?id=1700",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://bugs.chromium.org/p/project-zero/issues/detail?id=1700",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=29ec90660d68bbdd69507c1c8b4e33aa299278b1",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=34b7a7cc5321a1b5e13320443557ba1cb11b42e7",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=705a2810a314ccf06fe6190ea555e586975f9b28",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://www.kernel.org/",
                "label": "VENDOR_UPGRADE"
            }
        ]
    }
}