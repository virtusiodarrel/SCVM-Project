{
    "source": "BDSA",
    "name": "BDSA-2021-0094",
    "title": "Dnsmasq Vulnerable to DNS Cache Poisoning via Insufficient 'RRNAME' Checks in 'reply_query' Function",
    "description": "Dnsmasq is vulnerable to DNS cache poisoning due to insufficient query resource name (`RRNAME`) checks in the `reply_query()` function.\n\nAn attacker could use this issue to place a malicious entry in the DNS server cache and redirect traffic to an attacker-controlled server.",
    "technicalDescription": "Dnsmasq is vulnerable to DNS cache poisoning because the `reply_query()` function in the `src/forward.c` file lacks sufficient query resource name (`RRNAME`) checks. \n\nWhen getting a reply from a forwarded query, the `reply_query()` function uses a weak hash of the query name to check for the forwarded query that matches the reply. When Dnsmasq is compiled with `DNSSEC`, SHA-1 is used for query identification. CRC32 is used when compiled without `DNSSEC` support. These hash functions are insecure and can allow for several different domains to have the same hash.",
    "publishedDate": "2021-01-20T14:13:33.902Z",
    "updatedDate": "2021-01-29T12:39:52.698Z",
    "disclosureDate": "2021-01-19T00:00:00.000Z",
    "exploitPublishDate": "2021-01-19T00:00:00.000Z",
    "solution": "Fixed in [**2.83**](http://thekelleys.org.uk/gitweb/?p=dnsmasq.git;a=tag;h=47b4f0e37558e7a947bbf1c5c41e6bc87f1c9ebb) by [this](http://thekelleys.org.uk/gitweb/?p=dnsmasq.git;a=commit;h=2d765867c597db18be9d876c9c17e2c0fe1953cd) commit and [this](http://thekelleys.org.uk/gitweb/?p=dnsmasq.git;a=commit;h=2024f9729713fd657d65e64c2e4e471baa0a3e5b) commit.\n\nThe latest stable releases are available [here](http://thekelleys.org.uk/gitweb/?p=dnsmasq.git;a=tags).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 4.0,
        "impactSubscore": 4.9,
        "exploitabilitySubscore": 4.9,
        "severity": "LOW",
        "accessVector": "NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 3.2
        },
        "vector": "(AV:N/AC:H/Au:N/C:P/I:P/A:N/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.7,
        "impactSubscore": 5.8,
        "exploitabilitySubscore": 2.2,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "NONE",
        "privilegesRequired": "NONE",
        "scope": "CHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.8
        },
        "vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:N/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Moshe Kol and Shlomi Oberman",
    "workaround": "Third-party mitigations have been proposed [here](https://www.jsof-tech.com/wp-content/uploads/2021/01/DNSpooq_Technical-Whitepaper.pdf):\n\n\u2022 Configure dnsmasq not to listen on WAN interfaces if unnecessary in your environment.\n\u2022 Reduce the maximum queries allowed to be forwarded with the option `--dns-forward-max=<queries>`. The default is 150, but it could be lowered.\n\u2022 Temporarily disable `DNSSEC` validation option until you get a patch.\n\u2022 Use protocols that provide transport security for DNS (such as DoT or DoH). This will mitigate Dnspooq but may have other security and privacy implications. Consider your own setup, security goals, and risks before doing this.\n\u2022 Reducing the maximum size of EDNS messages will likely mitigate some of the vulnerabilities. This, however, has not been tested and is against the recommendation of the relevant RFC5625.",
    "vendorFixDate": "2020-12-16T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 7.8,
    "_meta": {
        "allow": [],
        "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/BDSA-2021-0094",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro.app.blackduck.com/api/cwes/CWE-330"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/CVE-2020-25685",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/BDSA-2021-0094/ranges"
            },
            {
                "rel": "reference",
                "href": "http://lists.thekelleys.org.uk/pipermail/dnsmasq-discuss/2021q1/014599.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "http://thekelleys.org.uk/gitweb/?p=dnsmasq.git;a=commit;h=2024f9729713fd657d65e64c2e4e471baa0a3e5b",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "http://thekelleys.org.uk/gitweb/?p=dnsmasq.git;a=commit;h=2d765867c597db18be9d876c9c17e2c0fe1953cd",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "http://thekelleys.org.uk/gitweb/?p=dnsmasq.git;a=tag;h=47b4f0e37558e7a947bbf1c5c41e6bc87f1c9ebb",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "http://thekelleys.org.uk/gitweb/?p=dnsmasq.git;a=tags",
                "label": "LINK"
            },
            {
                "rel": "reference",
                "href": "https://www.jsof-tech.com/disclosures/dnspooq/",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.jsof-tech.com/wp-content/uploads/2021/01/DNSpooq_Technical-Whitepaper.pdf",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.jsof-tech.com/wp-content/uploads/2021/01/DNSpooq_Technical-Whitepaper.pdf",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://www.jsof-tech.com/wp-content/uploads/2021/01/DNSpooq_Technical-Whitepaper.pdf",
                "label": "WORKAROUND"
            }
        ]
    }
}