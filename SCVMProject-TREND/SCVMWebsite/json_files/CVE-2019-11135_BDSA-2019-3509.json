{
    "source": "BDSA",
    "name": "BDSA-2019-3509",
    "title": "Linux Kernel Vulnerable to Information Disclosure via TSX Asynchronous Abort (TAA) CPU Side Channel Attack on Certain Intel CPUs (RIDL Addendum)",
    "description": "Certain Intel CPUs are vulnerable to a side-channel information leak. An attacker running code locally on the machine could leak sensitive information across privilege boundaries such as process, user/kernel, virtual machine and secure enclaves (SGX). A new CVE (CVE-2019-19338) was issued since the fix for this vulnerability was incomplete.",
    "technicalDescription": "Aborting a TSX transaction by flushing a cache line before the transaction then loading the same cache line inside the transaction still allows the processor to continue executing instructions in the pipeline until retirement.  This allows information to be leaked by monitoring the load from various internal CPU buffers (such as store buffers) using the original RIDL attack pattern. This particular variant allows a RIDL attack on the system passwords to take place in under 30 seconds, even on systems with existing in-silicon/microcode MDS mitigations enabled.\n\nThe Linux kernel provides a user interface through `/sys/devices/system/cpu/vulnerabilities/tsx_async_abort` that contains information on the current vulnerability status of the system. A microcode update to the CPU is required to enable the mitigations.\n\nXen is also vulnerable.\n\nThe current Kernel fixes for TAA (TSX Asynchronous Abort) don't completely fix the issue for guest VMs. If a guest is running on a host CPU affected by TAA (`TAA_NO=0`) but not affected by the MDS issue (`MDS_NO=1`) the guest was to clear the affected buffers using the `VERW` instruction mechanism. When the `MDS_NO=1` bit was exported to the guests, it did not correctly use the `VERW` mechanism to clear the affected buffers. \n\nThis issue affects guests running on Cascade Lake CPUs, which are affected by the TAA issue but not by the MDS issue. The host must have TSX enabled.",
    "publishedDate": "2019-11-18T12:55:25.573Z",
    "updatedDate": "2020-02-14T15:40:47.773Z",
    "disclosureDate": "2019-11-12T00:00:00.000Z",
    "exploitPublishDate": "2019-11-12T00:00:00.000Z",
    "solution": "Fixed in:\n* [**3.16.77**](https://www.kernel.org)\n* [**4.4.202**](https://www.kernel.org)\n* [**4.9.202**](https://www.kernel.org)\n* [**4.14.154**](https://www.kernel.org)\n* [**4.19.84**](https://www.kernel.org)\n* [**5.3.11**](https://www.kernel.org)\n* [**5.4-rc8**](https://www.kernel.org)\nFixed by the following commits:\n* [Commit 1](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=6608b45ac5ecb56f9e171252229c39580cc85f0f)\n* [Commit 2](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=3087c94f2194269e6e3efb87ee88daa74dbcf8fc)\n* [Commit 3](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=15dfa5d706df85506a527c5572be5ff322031a01)\n* [Commit 4](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=79373f485f7be07cb097a49aa200f80914407ae9)\n* [Commit 5](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=9392b2dda0aedff871f10eae4e9b1e7d7e7bc3f9)\n* [Commit 6](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=d601096be42c88a20240dddd426c6273899f2468)\n* [Commit 7](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=f21f3516be7ce2340f1afd5c3513c6319ca23d2f)\n* [Commit 8](https://git.kernel.org/linus/cbbaa2727aa3ae9e0a844803da7cef7fd3b94f2b)\n* [Commit 9](https://git.kernel.org/linus/c11f83e0626bdc2b6c550fc8b9b6eeefbd8cefaa)\n* [Commit 10](https://git.kernel.org/linus/b07a5c53d42a8c87b208614129e947dd2338ff9c)\n\nFixed in Xen:\n* [**4.11.3**](http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=f137d4c8df08b202a34e5e092f1ab14a97c7144e) by [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=56590acd7fe460514e27d520d28ec5dc66535b1e) and [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=74507046dbd2c5d2991eeabd1af39af0d6b29d70) commit,\n* [**4.13.0-rc3**](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=183f354e1430087879de071f0c7122e42703916e) by [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=070e8ce9d3ace4624bb0fa87252a516e6fb0e2ea) and [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=8c4330818f6ee70cbf7428a40a28a73df1272d10) commit.\n\nFixed in other versions of Xen by the patches listed in [this](https://xenbits.xen.org/xsa/advisory-305.html) advisory.",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 4.9,
        "impactSubscore": 6.9,
        "exploitabilitySubscore": 3.9,
        "severity": "LOW",
        "accessVector": "LOCAL",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "COMPLETE",
        "integrityImpact": "NONE",
        "availabilityImpact": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 3.9
        },
        "vector": "(AV:L/AC:L/Au:N/C:C/I:N/A:N/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 7.1,
        "impactSubscore": 4.0,
        "exploitabilitySubscore": 2.5,
        "severity": "MEDIUM",
        "attackVector": "LOCAL",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "NONE",
        "availabilityImpact": "NONE",
        "privilegesRequired": "NONE",
        "scope": "CHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 6.4
        },
        "vector": "CVSS:3.0/AV:L/AC:L/PR:N/UI:N/S:C/C:H/I:N/A:N/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Stephan van Schaik , Alyssa Milburn , Sebastian Osterlund, Pietro Frigo, Giorgi Maisuradze, Kaveh Razavi, Herbert Bos, and Cristiano Giuffrida",
    "workaround": "The Linux kernel now has options to enable TAA mitigations if available on the CPU via a microcode update.  The boot time option `tsx_async_abort=` takes one of the followiing 3 options: `off`, `full`, or `full,nosmt`. The `off` option disables the mitigations, while `full`, If TSX is enabled, will clear CPU buffers on ring transitions. On systems which are MDS-affected and deploy MDS mitigation, TAA is also mitigated. Specifying the `full` option on those systems will have no effect. The `full,nosmt` argument is the same as `tsx_async_abort=full`, but with SMT disabled on vulnerable CPUs that have TSX enabled.\n\nThe alternative is to disable TSX entirely with the `tsx=off` kernel boot time parameter. This is the default on the vanilla kernel.\n\nTo address the incomplete fix (CVE-2019-11135) another option besides applying the upstream patches is to export `MDS_NO=0` to guests when TSX is enabled by applying the following [patch](https://git.kernel.org/linus/e1d38b63acd843cfdd4222bf19a26700fd5c699e).",
    "vendorFixDate": "2019-10-23T00:00:00.000Z",
    "vendorNotifiedDate": "2018-09-12T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 6.4,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-3509",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-208"
            },
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-385"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-11135",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-3509/ranges"
            },
            {
                "rel": "reference",
                "href": "https://cs.vu.nl/~herbertb/download/ridlers/files/ridl.pdf",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/linus/b07a5c53d42a8c87b208614129e947dd2338ff9c",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/linus/c11f83e0626bdc2b6c550fc8b9b6eeefbd8cefaa",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/linus/cbbaa2727aa3ae9e0a844803da7cef7fd3b94f2b",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/linus/e1d38b63acd843cfdd4222bf19a26700fd5c699e",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=15dfa5d706df85506a527c5572be5ff322031a01",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=3087c94f2194269e6e3efb87ee88daa74dbcf8fc",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=6608b45ac5ecb56f9e171252229c39580cc85f0f",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=79373f485f7be07cb097a49aa200f80914407ae9",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=9392b2dda0aedff871f10eae4e9b1e7d7e7bc3f9",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=d601096be42c88a20240dddd426c6273899f2468",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=f21f3516be7ce2340f1afd5c3513c6319ca23d2f",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/intel/Intel-Linux-Processor-Microcode-Data-Files/releases/tag/microcode-20191112",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://mdsattacks.com",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://mdsattacks.com",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://www.intel.com/content/www/us/en/security-center/advisory/intel-sa-00270.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.kernel.org/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/tsx_async_abort.html",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://www.openwall.com/lists/oss-security/2019/12/10/3",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/xsa/advisory-305.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/xsa/advisory-305.html",
                "label": "PATCH"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-3509/default-remediation-status"
            }
        ]
    }
}