{
    "source": "BDSA",
    "name": "BDSA-2020-2848",
    "title": "Xen Vulnerable to Privilege Escalation and Denial-of-Service (DoS) via Incorrect Deferral of IOMMU TLB Flush",
    "description": "Xen is vulnerable to a flaw whereby it handles a certain memory management routine with an incorrect optimization. A local attacker on the machine may potentially cause privilege escalation, or a denial-of-service (DoS) of the host and guest operating systems.",
    "technicalDescription": "There is an incorrect optimization to coalesce per-page IOMMU TLB flushes into a single flush. This fails to take into account certain edge cases where removal of pages from such guests during this operation should not be included. The final reference of these pages is dropped before the coalesced flush and they may have been put to a different use even though DMA initiated by their original owner might still be in progress. This can lead to data corruption and leaks of information which could be leveraged by an attacker to cause privilege escalation, or a DoS of the host or guest operating system.\n\nThe following are required to leverage the vulnerability:\n* Xen versions from **4.2** onwards\n* x86 HVM and PVH guests\n* x86 HVM and PVH guests which have physical devices passed through to them\n* x86 HVM and PVH guests configured to not share IOMMU and CPU page tables (not the default on  Intel (VT-d) hardware, and not possible on AMD hardware)\n* Guests run in shadow mode",
    "publishedDate": "2020-10-21T15:29:18.442Z",
    "updatedDate": "2021-10-20T08:52:37.419Z",
    "disclosureDate": "2020-10-20T00:00:00.000Z",
    "solution": "Fixed in [**4.12.4**](https://github.com/xen-project/xen/releases/tag/RELEASE-4.12.4) by [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=37f45de9083eea558437c6175884d31642671d7d) commit and [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=b402e2a14bdc70b5e40a597c0bf14af0ab6354b5) commit.\n\nFixed in [**4.13.2**](https://github.com/xen-project/xen/releases/tag/RELEASE-4.13.2) by [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=6e237b616091a573c1c3bef63a5d02f1d0ad0916) commit and [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=745652fec903701ff160c6def509c01c8a668d4b) commit.\n\nFixed in [**4.14.1**](https://github.com/xen-project/xen/releases/tag/RELEASE-4.14.1) by [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=79f17015e7f45e51de87dda7ff9d6fac104e1cc6) commit and [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=94c157f2e3eaf036e04ba5e7186b6f1d5671fa93) commit.\n\nFixed in the following branches which are not yet included in any release:\n* **4.10** branch by [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=6f012ec24294993d59bac9b9caae7d3c4dae347d) commit and [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=d73e9720545d6acb376bd7c2b1b1d7c92aec6e30) commit.\n* **4.11** branch by [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=490c517168bc1cb72c43a02a1ff48bbc25934ffa) commit and [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=4f35f7fa29a0f87dcfdbd3f1a43dbd08b072ac4e) commit.",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 7.2,
        "impactSubscore": 10.0,
        "exploitabilitySubscore": 3.9,
        "severity": "MEDIUM",
        "accessVector": "LOCAL",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "COMPLETE",
        "integrityImpact": "COMPLETE",
        "availabilityImpact": "COMPLETE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.3
        },
        "vector": "(AV:L/AC:L/Au:N/C:C/I:C/A:C/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.4,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 2.5,
        "severity": "HIGH",
        "attackVector": "LOCAL",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.3
        },
        "vector": "CVSS:3.1/AV:L/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Jan Beulich of SUSE",
    "workaround": "The vendor supplies the following workarounds:\n> Not passing through physical devices to untrusted guests will avoid\n> the vulnerability.\n> \n> On systems permitting page table sharing, not suppressing use of the\n> functionality will allow to avoid the vulnerability. This means guests\n> should not be run in\n> * shadow mode, i.e. hardware needs to be HAP (Hardware Assisted Paging)\n>   capable, there should not be \"hap=0\" in the guest's xl configuration\n>   file, and there should not be \"hap=0\" or equivalent on Xen's command\n>   line,\n> * non-shared page table mode, i.e. hardware needs to be capable of\n>   sharing, there should not be \"passthrough=sync_pt\" in the guest's xl\n>   configuration file, and there should not be \"iommu=no-sharept\" or\n>   equivalent on Xen's command line.",
    "vendorFixDate": "2020-10-20T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 7.3,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-2848",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-362"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2020-27671",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-2848/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/releases/tag/RELEASE-4.12.4",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/releases/tag/RELEASE-4.13.2",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/releases/tag/RELEASE-4.14.1",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=37f45de9083eea558437c6175884d31642671d7d",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=490c517168bc1cb72c43a02a1ff48bbc25934ffa",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=4f35f7fa29a0f87dcfdbd3f1a43dbd08b072ac4e",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=6e237b616091a573c1c3bef63a5d02f1d0ad0916",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=6f012ec24294993d59bac9b9caae7d3c4dae347d",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=745652fec903701ff160c6def509c01c8a668d4b",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=79f17015e7f45e51de87dda7ff9d6fac104e1cc6",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=94c157f2e3eaf036e04ba5e7186b6f1d5671fa93",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=b402e2a14bdc70b5e40a597c0bf14af0ab6354b5",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=d73e9720545d6acb376bd7c2b1b1d7c92aec6e30",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/xsa/advisory-346.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/xsa/advisory-346.html",
                "label": "WORKAROUND"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-2848/default-remediation-status"
            }
        ]
    }
}