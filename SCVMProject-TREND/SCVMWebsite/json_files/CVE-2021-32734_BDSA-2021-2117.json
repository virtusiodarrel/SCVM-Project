{
    "source": "BDSA",
    "name": "BDSA-2021-2117",
    "title": "Nextcloud Text Vulnerable to Information Exposure via File Path Disclosure in Exception Messages",
    "description": "Nextcloud Text is vulnerable to information exposure due to the disclosure of file path information in error messages. A remote authenticated attacker could learn the full path of files by sending malicious web requests to a vulnerable server.",
    "technicalDescription": "The Nextcloud Text file API is implemented using code that is contained within `lib/Service/ApiService.php`. The function `create()` can be used to initiate document sessions, which can be used to read files on the Nextcloud server. This function contains numerous try-catch blocks. Some of these blocks catch and handle specific exception, such as `NotFoundException`, which is raised if the specified file is not found on the server. \n\nThese blocks are wrapped in a larger try-catch block, which catches generic `Exception` instances. This ensures that unknown or unanticipated exceptions will also be handled. The exception handling code of this try-catch block will return an HTTP 500 error response. The server's response will also contain information about the exception, which is retrieved by calling the exception instance's `getMessage()` method.\n\nThe message that is returned by `getMessage()` is not sanitized, and may contain sensitive information. For example, the full path of a shared file that the Nextcloud server attempted to find may be disclosed. A similar issue occurs in the `sync()` function, which is used to implement the file API's autosave functionality. This function also contains a try-catch block which is used to handle unexpected exceptions, and the catch block also returns the output of `getMessage()` in the HTTP error response.\n\nAn attacker could recover sensitive information relating to the directory structure of the Nextcloud server by examining the responses that are generated by unexpected exceptions. This may assist them in conducting further attacks. \n\nThe vulnerability was fixed by ensuring that a generic, hard-coded error message is returned, instead of that which is produced by the `getMessage()` method.",
    "publishedDate": "2021-07-26T12:09:19.438Z",
    "updatedDate": "2021-09-01T13:08:00.239Z",
    "disclosureDate": "2021-06-29T00:00:00.000Z",
    "exploitPublishDate": "2021-08-11T00:00:00.000Z",
    "solution": "Fixed in:\n* [**22.0.0-rc2**](https://github.com/nextcloud/text/releases/tag/v22.0.0rc2) by [this](https://github.com/nextcloud/text/commit/73e97b1a560767960e3dc62237cca5a6d5fa744a) commit.\n* [**21.0.3**](https://github.com/nextcloud/text/releases/tag/v21.0.3) by [this](https://github.com/nextcloud/text/commit/6ea959f10039b5b1a79ca5e68eb0a5926f7ae257) commit.\n* [**20.0.11**](https://github.com/nextcloud/text/releases/tag/v20.0.11) by [this](https://github.com/nextcloud/text/commit/28b718a639bd2ab59742c07afdf2c3b0e6419a6d) commit.\n* [**19.0.13**](https://github.com/nextcloud/text/releases/tag/v19.0.13) by [this](https://github.com/nextcloud/text/commit/c617f89d00809d26a54dee5a30946da48fd20e03) commit.\n\nThe latest stable releases can be found [here](https://github.com/nextcloud/text/releases).",
    "severity": "LOW",
    "cvss2": {
        "baseScore": 2.1,
        "impactSubscore": 2.9,
        "exploitabilitySubscore": 3.9,
        "severity": "LOW",
        "accessVector": "NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "SINGLE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "NONE",
        "availabilityImpact": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 1.6
        },
        "vector": "(AV:N/AC:H/Au:S/C:P/I:N/A:N/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 3.1,
        "impactSubscore": 1.4,
        "exploitabilitySubscore": 1.6,
        "severity": "LOW",
        "attackVector": "NETWORK",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "LOW",
        "integrityImpact": "NONE",
        "availabilityImpact": "NONE",
        "privilegesRequired": "LOW",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 2.8
        },
        "vector": "CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:L/I:N/A:N/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Lukas Reschke",
    "workaround": "The vulnerability can be mitigated by disabling the Text component in the Nextcloud application settings.",
    "vendorFixDate": "2021-06-29T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 2.8,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2117",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-209"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-32734",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2117/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nextcloud/security-advisories/security/advisories/GHSA-6hf5-c2c4-2526",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nextcloud/text/commit/28b718a639bd2ab59742c07afdf2c3b0e6419a6d",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nextcloud/text/commit/6ea959f10039b5b1a79ca5e68eb0a5926f7ae257",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nextcloud/text/commit/73e97b1a560767960e3dc62237cca5a6d5fa744a",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nextcloud/text/commit/c617f89d00809d26a54dee5a30946da48fd20e03",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nextcloud/text/pull/1695",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nextcloud/text/releases",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nextcloud/text/releases/tag/v19.0.13",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nextcloud/text/releases/tag/v20.0.11",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nextcloud/text/releases/tag/v21.0.3",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/nextcloud/text/releases/tag/v22.0.0rc2",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://hackerone.com/reports/1246721",
                "label": "POC"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2117/default-remediation-status"
            }
        ]
    }
}