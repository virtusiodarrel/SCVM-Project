{
    "source": "BDSA",
    "name": "BDSA-2019-2299",
    "title": "Gitaly and GitLab Vulnerable to Remote Code Execution (RCE) via Arbitrary File Overwrite in 'handleArchive()' Function",
    "description": "Gitaly and Gitlab are vulnerable to remote code execution (RCE) due to the unsafe utilization  of a function input parameter. A remote attacker could overwrite arbitrary files on a server by using a crafted repository structure in conjunction with crafted input parameters.",
    "technicalDescription": "The Gitaly function `handleArchive()`, which is defined within the script `archive.go`, accepts the `string` type input parameter `path`. \nThis function will be used to dynamically construct a series of arguments for the `git` command. The `path` variable is intended to denote the command line argument that specifies the path of the repository directory that is to be downloaded. However, the value of this variable is not validated or sanitized prior to its utilization. \n\nIf the initial directory name in the path is equivalent to a legitimate `git` command line flag, then it will be interpreted as being a legitimate instance of that flag. If the flag in question is `--output=`, the rest of the path will be interpreted as the location to which the contents of the repository resource should be written. An attacker could therefore carefully craft a directory structure that contains a directory titled `--output=` and is followed by the path to a sensitive file on the target system. That file will then be overwritten by an attacker-controlled repository file whenever the `handleArchive()` function is invoked (using the `download directory as tar` button). This can be leveraged in order to achieve arbitrary code execution on the target machine.\n\nGitaly is used as a dependency within GitLab and so any GitLab instance that utilizes a vulnerable Gitaly version will itself be vulnerable.",
    "publishedDate": "2019-07-24T15:24:20.077Z",
    "updatedDate": "2020-07-15T10:27:41.614Z",
    "disclosureDate": "2019-07-17T00:00:00.000Z",
    "exploitPublishDate": "2019-05-22T00:00:00.000Z",
    "solution": "Fixed in version [**1.42.2**](https://gitlab.com/gitlab-org/gitaly/-/tags/v1.42.2) of Gitaly by [this](https://gitlab.com/gitlab-org/gitaly/commit/235500cc937379607a2bd60158ebc83dcf4d8293) commit.\n\nFixed in version [**11.11.1**](https://github.com/gitlabhq/gitlabhq/releases/tag/v11.11.1) of GitLab by [this](https://github.com/gitlabhq/gitlabhq/commit/7961a5dc91b95e80b5b567a9b222cf08ffbca04c) commit.",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 6.5,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 8.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "SINGLE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.1
        },
        "vector": "(AV:N/AC:L/Au:S/C:P/I:P/A:P/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 9.9,
        "impactSubscore": 6.0,
        "exploitabilitySubscore": 3.1,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "LOW",
        "scope": "CHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 8.9
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "nyangawa of Chaitin Tech",
    "workaround": "",
    "vendorFixDate": "2019-05-22T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 8.9,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-2299",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-77"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-12430",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-2299/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/gitlabhq/gitlabhq/commit/7961a5dc91b95e80b5b567a9b222cf08ffbca04c",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/gitlabhq/gitlabhq/releases/tag/v11.11.1",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://gitlab.com/gitlab-org/gitaly/-/tags/v1.42.2",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://gitlab.com/gitlab-org/gitaly/commit/235500cc937379607a2bd60158ebc83dcf4d8293",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://hackerone.com/reports/587854",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://hackerone.com/reports/587854",
                "label": "POC"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-2299/default-remediation-status"
            }
        ]
    }
}