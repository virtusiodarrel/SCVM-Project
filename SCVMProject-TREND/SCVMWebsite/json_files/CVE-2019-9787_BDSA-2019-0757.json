{
    "source": "BDSA",
    "name": "BDSA-2019-0757",
    "title": "WordPress Vulnerable to Remote Code Execution (RCE) via Cross-site Scripting (XSS) in 'wp_filter_post_kses()'",
    "description": "A cross-site request forgery (CSRF) protection flaw related to WordPress comment fields can be combined with a cross-site scripting (XSS) attack to target HTML attributes and achieve remote code execution (RCE). An attacker could leverage these flaws by tricking an authenticated WordPress administrator into following a link to a malicious site. This can effectively allow the attacker to perform actions on behalf of the administrator, modify the site's PHP code, and embed a backdoor. Such a payload is capable of, for example, spawning a web shell which would allow a remote attacker to execute arbitrary commands on the underlying host.",
    "technicalDescription": "CSRF protection on comments could not be enabled due to compatibility problems with some WordPress features e.g.  trackbacks or pingbacks. Another protection (utilizing a nonce) has been used to mitigate opportunities for an attack, however, the code's logic still allows the administrator to perform XSS.\n\nThe process of comment sanitization for an administrator, which is different from the one used for normal users, contains a flaw due to use of the `wp_filter_post_kses` function. The core of the issue lies in the functionality which modifies `<a>` tags within the comment string to optimize for SEO purposes. As part of it the attribute values are concatenated together without being escaped. This process can be abused to bypass sanitization and perform XSS via HTML attribute injection, which will embed malicious JavaScript code in the website.\n\nSince the frontend is not protected by the `X-Frame-Options` header an attacker could trick the admin into visiting a malicious site and leverage an `<iframe>` to trigger the XSS payload on the target site.\n\nWith the ability to execute arbitrary JavaScript code in an admin authenticated session an attacker can edit the `.php` files of themes and plugins from the dashboard. They can subsequently embed a backdoor in the code and achieve arbitrary PHP code execution.",
    "publishedDate": "2019-03-19T16:37:34.994Z",
    "updatedDate": "2019-03-19T16:38:56.003Z",
    "disclosureDate": "2019-03-13T00:00:00.000Z",
    "exploitPublishDate": "2019-03-13T00:00:00.000Z",
    "solution": "Fixed in [**5.1.1**](https://wordpress.org/download/releases/) by [this](https://github.com/WordPress/WordPress/commit/630bd653051f4bc44ee1c5593a4bce14c52dbc38) commit.\n\nThe fix was also backported to:\n\n* [**3.7.29**](https://wordpress.org/download/releases/) in [this](https://github.com/WordPress/WordPress/commit/d2398ee562a0b5c95e5bdea22f688f9bbceb72f1) commit,\n* [**3.8.29**](https://wordpress.org/download/releases/) in [this](https://github.com/WordPress/WordPress/commit/5a03d23f2c1c1d296407b481a180a51c68b7bec5) commit,\n* [**3.9.27**](https://wordpress.org/download/releases/) in [this](https://github.com/WordPress/WordPress/commit/df6538cd9e12c1d3ca33dcb576882df09cf6b797) commit,\n* [**4.0.26**](https://wordpress.org/download/releases/) in [this](https://github.com/WordPress/WordPress/commit/33938f5991c95299afa5eb7c68234386e73fb82e) commit,\n* [**4.1.26**](https://wordpress.org/download/releases/) in [this](https://github.com/WordPress/WordPress/commit/577c83bd6066c7f3698faafbb06a9d20212b36b4) commit,\n* [**4.2.23**](https://wordpress.org/download/releases/) in [this](https://github.com/WordPress/WordPress/commit/bc4ed1a93ede422685fb9b4ff37a281c44f253c8) commit,\n* [**4.3.19**](https://wordpress.org/download/releases/) in [this](https://github.com/WordPress/WordPress/commit/ffaeca3c2d4be87feb14f68d2d9deb45a195cc83) commit,\n* [**4.4.18**](https://wordpress.org/download/releases/) in [this](https://github.com/WordPress/WordPress/commit/f797452514613f32ac12866234992ff0f880f44a) commit,\n* [**4.5.17**](https://wordpress.org/download/releases/) in [this](https://github.com/WordPress/WordPress/commit/fb7f4bf7b698150b36ba75845a5f04667589739e) commit,\n* [**4.6.14**](https://wordpress.org/download/releases/) in [this](https://github.com/WordPress/WordPress/commit/1ff333ca3bc3eed743bebbcfb44aa7280020a7cc) commit,\n* [**4.7.13**](https://wordpress.org/download/releases/) in [this](https://github.com/WordPress/WordPress/commit/c088a3b0258ea6f87fd7900bace3035299f24bf5) commit,\n* [**4.8.9**](https://wordpress.org/download/releases/) in [this](https://github.com/WordPress/WordPress/commit/a32075cd83557fb86be22f3533956ccdf78ebf64) commit,\n* [**4.9.10**](https://wordpress.org/download/releases/) in [this](https://github.com/WordPress/WordPress/commit/176bfb26946a8e91447cecbe0c68011bc7ca1b1a) commit,\n* [**5.0.4**](https://wordpress.org/download/releases/) in [this](https://github.com/WordPress/WordPress/commit/ed88ef20727ce994be28420ff3f2ab4637cb1755) commit.",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 6.8,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 8.6,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "MEDIUM",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.3
        },
        "vector": "(AV:N/AC:M/Au:N/C:P/I:P/A:P/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.8,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 2.8,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "REQUIRED",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.9
        },
        "vector": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Simon Scannell",
    "workaround": "",
    "vendorFixDate": "2019-03-13T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 7.9,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0757",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-352"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-9787",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0757/ranges"
            },
            {
                "rel": "reference",
                "href": "https://blog.ripstech.com/2019/wordpress-csrf-to-rce/",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://github.com/WordPress/WordPress/commit/176bfb26946a8e91447cecbe0c68011bc7ca1b1a",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/WordPress/WordPress/commit/1ff333ca3bc3eed743bebbcfb44aa7280020a7cc",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/WordPress/WordPress/commit/33938f5991c95299afa5eb7c68234386e73fb82e",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/WordPress/WordPress/commit/577c83bd6066c7f3698faafbb06a9d20212b36b4",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/WordPress/WordPress/commit/5a03d23f2c1c1d296407b481a180a51c68b7bec5",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/WordPress/WordPress/commit/630bd653051f4bc44ee1c5593a4bce14c52dbc38",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/WordPress/WordPress/commit/a32075cd83557fb86be22f3533956ccdf78ebf64",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/WordPress/WordPress/commit/bc4ed1a93ede422685fb9b4ff37a281c44f253c8",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/WordPress/WordPress/commit/c088a3b0258ea6f87fd7900bace3035299f24bf5",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/WordPress/WordPress/commit/d2398ee562a0b5c95e5bdea22f688f9bbceb72f1",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/WordPress/WordPress/commit/df6538cd9e12c1d3ca33dcb576882df09cf6b797",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/WordPress/WordPress/commit/ed88ef20727ce994be28420ff3f2ab4637cb1755",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/WordPress/WordPress/commit/f797452514613f32ac12866234992ff0f880f44a",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/WordPress/WordPress/commit/fb7f4bf7b698150b36ba75845a5f04667589739e",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/WordPress/WordPress/commit/ffaeca3c2d4be87feb14f68d2d9deb45a195cc83",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://wordpress.org/download/releases/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://wordpress.org/news/2019/03/wordpress-5-1-1-security-and-maintenance-release/",
                "label": "ADVISORY"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0757/default-remediation-status"
            }
        ]
    }
}