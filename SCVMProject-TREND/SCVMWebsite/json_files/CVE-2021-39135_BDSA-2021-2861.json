{
    "source": "BDSA",
    "name": "BDSA-2021-2861",
    "title": "Arborist Vulnerable to Arbitrary File Writes via Unsafe 'node_modules' Symlink Handling",
    "description": "Arborist is vulnerable to symlink following due to the unsafe implementation of package contents extraction functionality. An attacker could write data to arbitrary locations on the file system by tricking a victim into installing a malicious package.",
    "technicalDescription": "Arborist contains functionality that allows package contents to be extracted into the folder that is specified by the `node_modules` field during package installation. If the folder that is specified is a symbolic link, the link will be followed, which means that the contents of the package could be written to arbitrary locations on the system. This is due to insufficient validation of the `node_modules` parameter in the `_extractOrLink()` function of file `lib/arborist/reify.js`.\n\nIn order to leverage this issue, an attacker needs to trick a victim into running `npm install` against a malicious package. The attacker also needs to ensure that the folder that is specified by the malicious `node_modules` value is a symlink which points to the location that they want to write to. They could potentially achieve this using a `preinstall` script that creates the required symlink. Alternatively, the attacker could trick a victim into performing the installation via a git repository.\n\nThe vulnerability was fixed via the addition of a method, `_validateNodeModules()`, which ensures that `node_modules` does not refer to a symlink.",
    "publishedDate": "2021-09-28T11:54:37.428Z",
    "updatedDate": "2021-09-28T11:54:37.415Z",
    "disclosureDate": "2021-08-31T00:00:00.000Z",
    "solution": "Fixed in version [**2.8.2**](https://github.com/npm/arborist/releases/tag/v2.8.2) by [this](https://github.com/npm/arborist/commit/f2b0ceebfe94123f162c3652af46f9c4c473cc36) commit.\n\nThe latest stable releases can be found [here](https://www.npmjs.com/package/@npmcli/arborist).",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 4.3,
        "impactSubscore": 2.9,
        "exploitabilitySubscore": 8.6,
        "severity": "LOW",
        "accessVector": "NETWORK",
        "accessComplexity": "MEDIUM",
        "authentication": "NONE",
        "confidentialityImpact": "NONE",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 3.2
        },
        "vector": "(AV:N/AC:M/Au:N/C:N/I:P/A:N/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 6.5,
        "impactSubscore": 3.6,
        "exploitabilitySubscore": 2.8,
        "severity": "MEDIUM",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "NONE",
        "integrityImpact": "HIGH",
        "availabilityImpact": "NONE",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "REQUIRED",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.7
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:H/A:N/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Jaroslav Loba\u010devski",
    "workaround": "The vendor has stated [here](https://github.com/npm/arborist/security/advisories/GHSA-gmw6-94gg-2rc2) that the following workaround can be used:\n\n> Do not run npm install on untrusted codebases, without first ensuring that the node_modules directory in the project is not a symbolic link.",
    "vendorFixDate": "2021-08-18T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 5.7,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2861",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-61"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-39135",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2861/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/arborist/commit/f2b0ceebfe94123f162c3652af46f9c4c473cc36",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/arborist/releases/tag/v2.8.2",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/arborist/security/advisories/GHSA-gmw6-94gg-2rc2",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/arborist/security/advisories/GHSA-gmw6-94gg-2rc2",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://www.npmjs.com/package/@npmcli/arborist",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2861/default-remediation-status"
            }
        ]
    }
}