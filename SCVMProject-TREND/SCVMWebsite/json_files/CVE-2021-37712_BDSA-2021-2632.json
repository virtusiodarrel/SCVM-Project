{
    "source": "BDSA",
    "name": "BDSA-2021-2632",
    "title": "tar Vulnerable to Arbitrary File Creation/Overwrite/Code Execution via Directory Cache Poisoning",
    "description": "The tar package for Node.js is vulnerable to arbitrary file creation/overwrite and arbitrary code execution via directory cache poisoning.",
    "technicalDescription": "node-tar tries to ensure that files whose location could be changed by a symlink are not extracted. This is achieved by checking that extracted directories are not symlinks and by caching paths when directories are created. This logic is insufficient when extracting tar files that contain two directories and a symlink with names containing unicode values that normalized to the same value. Also on Windows systems, long path portions would resolve to the same file system entities as their \"short path\" counterparts.  \n\nBy creating a crafted tar file an attacker could include directories with two forms of the path that resolve to the same file system entity, followed by a symlink with a name in the first form, lastly followed by a file in the second form. This leads to a bypass of node-tar symlink checks on directories, allowing an untrusted tar file to symlink to an arbitrary location.  \n\nThis issue was addressed by using the `String.normalize('NFKD')` method is used to first normalize all unicode to its maximally compatible and multi-code-point form. In addition paths are normalized to use `/` as a path separator on Windows and leaving `\\` unchanged on POSIX systems. The entire directory cache is also cleared when a symlink is encountered on Windows systems.",
    "publishedDate": "2021-09-01T15:10:22.688Z",
    "updatedDate": "2021-09-01T15:10:22.674Z",
    "disclosureDate": "2021-08-31T00:00:00.000Z",
    "solution": "Fixed in:\n* [**4.4.18**](https://github.com/npm/node-tar/releases/tag/v4.4.18) by [this](https://github.com/npm/node-tar/commit/3f2e2da3866c4e5f26ca0c0d6721cb371c5a3933) commit and [this](https://github.com/npm/node-tar/commit/bb93ba243746f705092905da1955ac3b0509ba1e). \n* [**5.0.10**](https://github.com/npm/node-tar/releases/tag/v5.0.10) by [this](https://github.com/npm/node-tar/commit/ab3e9036dc4504413fb6f154ea6943af5c187e26) commit and [this](https://github.com/npm/node-tar/commit/1739408d3122af897caefd09662bce2ea477533b) commit. \n* [**6.1.9**](https://github.com/npm/node-tar/releases/tag/v6.1.9) by [this](https://github.com/npm/node-tar/commit/b6162c7fafe797f856564ef37f4b82747f051455) commit and [this](https://github.com/npm/node-tar/commit/53602669f58ddbeb3294d7196b3320aaaed22728) commit.\n\nThe latest stable releases are available [here](https://github.com/npm/node-tar/tags).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 4.6,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 3.9,
        "severity": "LOW",
        "accessVector": "LOCAL",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 3.4
        },
        "vector": "(AV:L/AC:L/Au:N/C:P/I:P/A:P/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 9.3,
        "impactSubscore": 6.0,
        "exploitabilitySubscore": 2.5,
        "severity": "HIGH",
        "attackVector": "LOCAL",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "CHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 8.1
        },
        "vector": "CVSS:3.1/AV:L/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Robert Chen",
    "workaround": "Users can workaround this vulnerability by creating a custom filter method (`x` in this example) which prevents all symbolic links from being extracted:\n\n```\nconst tar = require('tar')\n\ntar.x({\n  file: 'archive.tgz',\n  filter: (file, entry) => {\n    if (entry.type === 'SymbolicLink') {\n      return false\n    } else {\n      return true\n    }\n  }\n})\n```",
    "vendorFixDate": "2021-08-09T00:00:00.000Z",
    "vendorNotifiedDate": "2021-08-03T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 8.1,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2632",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-22"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-37712",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2632/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/commit/1739408d3122af897caefd09662bce2ea477533b",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/commit/3f2e2da3866c4e5f26ca0c0d6721cb371c5a3933",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/commit/53602669f58ddbeb3294d7196b3320aaaed22728",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/commit/ab3e9036dc4504413fb6f154ea6943af5c187e26",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/commit/b6162c7fafe797f856564ef37f4b82747f051455",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/commit/bb93ba243746f705092905da1955ac3b0509ba1e",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/releases/tag/v4.4.18",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/releases/tag/v5.0.10",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/releases/tag/v6.1.9",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/security/advisories/GHSA-qq89-hq3f-393p",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/tags",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://www.npmjs.com/advisories/1780",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.npmjs.com/advisories/1780",
                "label": "WORKAROUND"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2632/default-remediation-status"
            }
        ]
    }
}