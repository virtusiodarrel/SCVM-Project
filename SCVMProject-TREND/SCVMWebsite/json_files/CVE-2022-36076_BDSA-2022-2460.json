{
    "source": "BDSA",
    "name": "BDSA-2022-2460",
    "title": "NodeBB Vulnerable to Account Takeover via Cross-Site Request Forgery (CSRF) during Single-Sign On Process",
    "description": "NodeBB contains a cross-site request forgery (CSRF) vulnerability because of an unnecessarily strict condition for checking the single-sign on (SSO) state. An attacker could leverage this flaw and take over a victim's account by associating it with the attacker's SSO account.",
    "technicalDescription": "This vulnerability exists in `src/routes/authentication.js` file. It contains an unnecessarily strict condition for checking the single-sign on (SSO) state i.e. `strategy.checkState`. This strict condition makes the checking opt-in instead of opt-out. This flaw can allow an attacker to take over a victim's account via cross-site request forgery (CSRF). As specified in the PoC, the attacker can first create their own account in the application and then enable Google SSO in order to create a SSO authorization code. The attacker can intercept the URL related to the authorization code that looks similar to this: `/auth/google/callback?code=XXXX`. Using CSRF, the attacker can then trick an authenticated victim into navigating to this URL and thus cause the victim's account to be associated with the attacker's own SSO account. This will enable the attacker to take over the victim's account.\n\nThis flaw has been mitigated in `src/routes/authentication.js` file by fixing the strict conditional check for `strategy.checkState`.\n\n**Note** The CSRF issue was originally mitigated in June 2018 with [this](https://github.com/NodeBB/NodeBB/commit/ec91ef1c644044bba44198b031913655e784b4bb) commit. However, the vulnerability was reintroduced with [this](https://github.com/NodeBB/NodeBB/commit/ab11435ed5d949866edc42843a222ca930758815) commit via the introduction of strict condition checking for the SSO state.",
    "publishedDate": "2022-09-05T08:58:08.670Z",
    "updatedDate": "2022-09-05T08:58:08.658Z",
    "disclosureDate": "2022-03-25T00:00:00.000Z",
    "exploitPublishDate": "2022-03-25T00:00:00.000Z",
    "solution": "Fixed in version [**1.17.2-beta.1**](https://github.com/NodeBB/NodeBB/releases/tag/v1.17.2-beta.1) by [this](https://github.com/NodeBB/NodeBB/commit/a2400f6baff44cb2996487bcd0cc6e2acc74b3d4) commit.\n\nThe latest stable releases can be found [here](https://github.com/NodeBB/NodeBB/tags).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 6.0,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 6.8,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "MEDIUM",
        "authentication": "SINGLE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.7
        },
        "vector": "(AV:N/AC:M/Au:S/C:P/I:P/A:P/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.0,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 2.1,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "LOW",
        "scope": "UNCHANGED",
        "userInteraction": "REQUIRED",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.2
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:H/A:H/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Mar0uane",
    "workaround": "",
    "vendorFixDate": "2021-06-14T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 7.2,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-2460",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-352"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2022-36076",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-2460/ranges"
            },
            {
                "rel": "reference",
                "href": "https://blogs.opera.com/security/2022/03/bug-bounty-adventures-a-nodebb-0-day/",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://github.com/NodeBB/NodeBB/commit/a2400f6baff44cb2996487bcd0cc6e2acc74b3d4",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/NodeBB/NodeBB/commit/ab11435ed5d949866edc42843a222ca930758815",
                "label": "INTRODUCTORY_COMMIT"
            },
            {
                "rel": "reference",
                "href": "https://github.com/NodeBB/NodeBB/commit/ec91ef1c644044bba44198b031913655e784b4bb",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/NodeBB/NodeBB/releases/tag/v1.17.2-beta.1",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/NodeBB/NodeBB/security/advisories/GHSA-xmgg-fx9p-prq6",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/NodeBB/NodeBB/tags",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-2460/default-remediation-status"
            }
        ]
    }
}