{
    "source": "BDSA",
    "name": "BDSA-2021-4618",
    "title": "ua-parser-js Users Vulnerable to Full Compromise via Embedded Malware",
    "description": "It has been discovered that ua-parser-js has been hijacked to contain malicious code designed to install password stealers and cryptominers. In order to achieve this bad actors published compromised versions after hijacking the NPM account of the developer. \n\n**Note:**  Versions **0.7.29**, **0.8.0**, and **1.0.0** are affected.",
    "technicalDescription": "If the compromised packages are installed on a device a `preinstall.js` script will determine the operating system used by the device and launch either a Linux shell script or Windows batch file. On Linux devices an additional `preinstall.sh` script will execute in order to determine if the user is located in Russia, Ukraine, Belarus, and Kazakhstan. If not then the script will download and execute the 'jsextension' program. This program is a XMRig Monero miner but it will only utilize 50% of the available CPU in an attempt to avoid detection. \n\nOn Windows systems the batch file will also download and execute the cryptominer and additionally download a `sdd.dll` file which is a password stealing trojan which will attempt to steal passwords for a wide variety of programs. A PowerShell script will also execute and attempt to steal passwords from the Windows credential manager.\n\nWhile the PoC shows only Windows being infected with the password stealing trojan Linux users should assume that their devices may also be fully compromised. \n\nIt was mitigated by removing the malicious versions of ua-parser-js.",
    "publishedDate": "2022-09-27T14:10:44.595Z",
    "updatedDate": "2022-09-27T14:10:44.581Z",
    "disclosureDate": "2021-10-22T00:00:00.000Z",
    "exploitPublishDate": "2021-10-23T00:00:00.000Z",
    "solution": "Fixed by [this](https://github.com/faisalman/ua-parser-js/commit/139fbc321a36ff663aac471a61d109728ac17f0b) commit in:\n* [**0.7.30**](https://github.com/faisalman/ua-parser-js/releases/tag/0.7.30),\n* [**0.8.1**](https://github.com/faisalman/ua-parser-js/releases/tag/0.8.1),\n* [**1.0.1**](https://github.com/faisalman/ua-parser-js/releases/tag/1.0.1).\n\nThe latest stable releases can be found [here](https://www.npmjs.com/package/ua-parser-js).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 7.5,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 10.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.9
        },
        "vector": "(AV:N/AC:L/Au:N/C:P/I:P/A:P/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 9.8,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 3.9,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 8.8
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "workaround": "",
    "vendorFixDate": "2021-10-22T00:00:00.000Z",
    "vendorNotifiedDate": "2022-09-22T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 8.8,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-4618",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-506"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-4229",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-4618/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/advisories/GHSA-pjwm-rvh2-c87w",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/faisalman/ua-parser-js/commit/139fbc321a36ff663aac471a61d109728ac17f0b",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/faisalman/ua-parser-js/issues/536",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/faisalman/ua-parser-js/releases/tag/0.7.30",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/faisalman/ua-parser-js/releases/tag/0.8.1",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/faisalman/ua-parser-js/releases/tag/1.0.1",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://www.bleepingcomputer.com/news/security/popular-npm-library-hijacked-to-install-password-stealers-miners/amp/",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.bleepingcomputer.com/news/security/popular-npm-library-hijacked-to-install-password-stealers-miners/amp/",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://www.npmjs.com/package/ua-parser-js",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-4618/default-remediation-status"
            }
        ]
    }
}