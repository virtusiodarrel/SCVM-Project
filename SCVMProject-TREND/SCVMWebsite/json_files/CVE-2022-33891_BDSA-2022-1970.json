{
    "source": "BDSA",
    "name": "BDSA-2022-1970",
    "title": "Apache Spark Vulnerable to Arbitrary Command Execution via User Impersonation in 'HttpSecurityFilter' Class",
    "description": "Apache Spark is vulnerable to arbitrary command execution due to improper handling of user validation when access control lists (ACLs) are configured. This could allow an attacker to bypass permissions checks and execute arbitrary shell commands within the privileges of the current user.",
    "technicalDescription": "The issue exists within the class `HttpSecurityFilter`. Improper user validation when ACLs are enabled can allow impersonation of a user that can bypass permissions checks and supply arbitrary input to a `bash -c` command.\n\nThe vendor addressed this issue by removing the use of `bash -c` within the file `ShellBasedGroupsMappingProvider.scala`.",
    "publishedDate": "2022-07-18T15:26:48.943Z",
    "updatedDate": "2022-09-08T15:19:47.295Z",
    "disclosureDate": "2022-07-18T00:00:00.000Z",
    "exploitPublishDate": "2022-07-21T00:00:00.000Z",
    "solution": "Fixed by [this](https://github.com/apache/spark/commit/c83618e4e5fc092829a1f2a726f12fb832e802cc) commit in:\n* [**3.3.0**](https://github.com/apache/spark/releases/tag/v3.3.0),\n* [**3.2.2**](https://github.com/apache/spark/releases/tag/v3.2.2),\n* [**3.1.3**](https://github.com/apache/spark/releases/tag/v3.1.3).\n\nThe latest stable releases can be found [here](https://spark.apache.org/downloads.html).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 7.5,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 10.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.9
        },
        "vector": "(AV:N/AC:L/Au:N/C:P/I:P/A:P/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 9.8,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 3.9,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 8.8
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Kostya Kortchinsky (Databricks)",
    "workaround": "",
    "vendorFixDate": "2022-04-22T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 8.8,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-1970",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-77"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2022-33891",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-1970/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/spark/commit/c83618e4e5fc092829a1f2a726f12fb832e802cc",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/spark/releases/tag/v3.1.3",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/spark/releases/tag/v3.2.2",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/spark/releases/tag/v3.3.0",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/west-wind/CVE-2022-33891",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://lists.apache.org/thread/p847l3kopoo5bjtmxrcwk21xp6tjxqlc",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://packetstormsecurity.com/files/168309/apache_spark_rce_cve_2022_33891.rb.txt",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://spark.apache.org/downloads.html",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-1970/default-remediation-status"
            }
        ]
    }
}