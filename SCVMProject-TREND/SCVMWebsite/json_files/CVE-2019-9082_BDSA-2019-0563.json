{
    "source": "BDSA",
    "name": "BDSA-2019-0563",
    "title": "ThinkPHP Vulnerable to Remote Code Execution (RCE) via Improper Parsing of URL Parameters",
    "description": "ThinkPHP is vulnerable to remote code execution(RCE) due to unrestricted parsing of URL query parameters. Successful exploits can allow an attacker to execute commands or code on the user's system.\n\nThis vulnerability is listed as exploitable by the Cybersecurity & Infrastructure Security Agency in their [Known Exploited Vulnerabilities Catalog](https://www.cisa.gov/known-exploited-vulnerabilities-catalog).",
    "technicalDescription": "ThinkPHP retrieves module, controller and the function details after parsing URL query parameters. It checks for the bypassed controller class name if this class exists then it will create and instantiate an object. This object will invoke the parsed method.\n\nFor example, for the passed URL query `?s=index/\\think\\app/invokefunction&function=call_user_func_array&vars[0]=system&vars[1][]=`, the separator character `/` is used to parse the URL query. The controller class should avoid `\\` in the name. Due to this bug `\\think\\app` in the URL query is parsed as the controller class name. This will create an instance of the `App` controller class within `think` and will call the `invokefunction` method. RCE is possible due to the lack of validations on the passed argument while calling the `invokefunction` method.",
    "publishedDate": "2019-03-08T11:22:20.989Z",
    "updatedDate": "2022-05-06T11:31:42.296Z",
    "disclosureDate": "2018-12-09T00:00:00.000Z",
    "exploitPublishDate": "2018-12-09T00:00:00.000Z",
    "solution": "Fixed in [**5.0.23**](https://github.com/top-think/framework/releases/tag/v5.0.23) by [this](https://github.com/top-think/framework/commit/b797d72352e6b4eb0e11b6bc2a2ef25907b7756f) commit.\nFixed in **[5.1.31](https://github.com/top-think/framework/releases/tag/v5.1.31)** by the following commits:\n* [commit1](https://github.com/top-think/framework/commit/802f284bec821a608e7543d91126abc5901b2815).\n* [commit2](https://github.com/top-think/framework/commit/93339b1a4df5a73e0143db0847a4c5e0b2e46fb0).",
    "severity": "CRITICAL",
    "cvss2": {
        "baseScore": 7.5,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 10.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 6.2
        },
        "vector": "(AV:N/AC:L/Au:N/C:P/I:P/A:P/E:F/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 9.8,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 3.9,
        "severity": "CRITICAL",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 9.1
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H/E:F/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "",
    "workaround": "",
    "vendorFixDate": "2018-12-09T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 9.1,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0563",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-233"
            },
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-94"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-9082",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0563/ranges"
            },
            {
                "rel": "reference",
                "href": "https://blog.thinkphp.cn/869075",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/top-think/framework/commit/802f284bec821a608e7543d91126abc5901b2815",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/top-think/framework/commit/93339b1a4df5a73e0143db0847a4c5e0b2e46fb0",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/top-think/framework/commit/b797d72352e6b4eb0e11b6bc2a2ef25907b7756f",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/top-think/framework/releases/tag/v5.0.23",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/top-think/framework/releases/tag/v5.1.31",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xiayulei/open_source_bms/issues/33",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xiayulei/open_source_bms/issues/33",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://securitynews.sonicwall.com/xmlpost/thinkphp-remote-code-execution-rce-bug-is-actively-being-exploited/",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.cisa.gov/known-exploited-vulnerabilities-catalog",
                "label": "EXPLOIT"
            },
            {
                "rel": "reference",
                "href": "https://www.exploit-db.com/exploits/48333",
                "label": "EXPLOIT"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0563/default-remediation-status"
            }
        ]
    }
}