{
    "source": "BDSA",
    "name": "BDSA-2020-1014",
    "title": "Salt Vulnerable to Remote Code Execution (RCE) via Improper Method Call Validation in 'ClearFuncs' Class",
    "description": "Salt is vulnerable to remote code execution (RCE) due to the improper validation of client requests. A remote unauthenticated attacker could retrieve user tokens from a Salt master instance, and/or execute arbitrary commands on Salt minion instances, by sending crafted requests to a vulnerable server.\n\nThis vulnerability is listed as exploitable by the Cybersecurity & Infrastructure Security Agency in their [Known Exploited Vulnerabilities Catalog](https://www.cisa.gov/known-exploited-vulnerabilities-catalog).",
    "technicalDescription": "The `salt-master` process that exists within a Salt cluster utilizes the `ClearFuncs` class, which is defined within `master.py`. This class contains a variety of methods that allow users to execute certain commands on the master instance. The client can specify the method to be executed via the `cmd` request parameter. The `_prep_auth_info()` method returns user keys, whilst the `_send_pub()` method can be used to send payloads to be processed by minion instances on the cluster. \n\nIt is possible for a client to execute the aforementioned methods without authenticating themselves to the `salt-master` process. This could potentially allow the attacker to obtain valid user tokens via the `_prep_auth_info()` method, or to run arbitrary commands on Salt minions by calling the `_send_pub()` method and providing crafted payloads. This combination of issues means that a remote unauthenticated attacker could achieve full remote code execution with root privileges on a vulnerable Salt cluster.",
    "publishedDate": "2020-05-06T15:31:19.682Z",
    "updatedDate": "2022-05-06T11:25:41.591Z",
    "disclosureDate": "2020-04-29T00:00:00.000Z",
    "exploitPublishDate": "2020-05-04T00:00:00.000Z",
    "solution": "Fixed in [**3000.2**](https://github.com/saltstack/salt/releases/tag/v3000.2) by [this](https://github.com/saltstack/salt/commit/a67d76b15615983d467ed81371b38b4a17e4f3b7) commit.\n\nFixed in [**2019.2.4**](https://github.com/saltstack/salt/releases/tag/v2019.2.4) by [this](https://github.com/saltstack/salt/commit/f47e4856497231eb672da2ce0df3e641581d47e6) commit.\n\nThe latest stable releases can be found [here](https://github.com/saltstack/salt/releases).",
    "severity": "CRITICAL",
    "cvss2": {
        "baseScore": 10.0,
        "impactSubscore": 10.0,
        "exploitabilitySubscore": 10.0,
        "severity": "HIGH",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "COMPLETE",
        "integrityImpact": "COMPLETE",
        "availabilityImpact": "COMPLETE",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 8.3
        },
        "vector": "(AV:N/AC:L/Au:N/C:C/I:C/A:C/E:F/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 9.8,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 3.9,
        "severity": "CRITICAL",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 9.1
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H/E:F/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "F-Secure",
    "workaround": "It has been advised by the vendor that if the patch cannot be applied, then you should implement \"network security controls that restrict access to the salt master (ports 4505 and 4506 being the defaults) to known minions, or at least block the wider Internet\".",
    "vendorFixDate": "2020-04-13T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 9.1,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-1014",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-284"
            },
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-749"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2020-11651",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-1014/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/saltstack/salt/blob/v3000.2_docs/doc/topics/releases/3000.2.rst",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/saltstack/salt/commit/a67d76b15615983d467ed81371b38b4a17e4f3b7",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/saltstack/salt/commit/f47e4856497231eb672da2ce0df3e641581d47e6",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/saltstack/salt/releases",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/saltstack/salt/releases/tag/v2019.2.4",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/saltstack/salt/releases/tag/v3000.2",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://www.cisa.gov/known-exploited-vulnerabilities-catalog",
                "label": "EXPLOIT"
            },
            {
                "rel": "reference",
                "href": "https://www.tenable.com/blog/cve-2020-11651-cve-2020-11652-critical-salt-framework-vulnerabilities-exploited-in-the-wild",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://www.tenable.com/blog/cve-2020-11651-cve-2020-11652-critical-salt-framework-vulnerabilities-exploited-in-the-wild",
                "label": "WORKAROUND"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-1014/default-remediation-status"
            }
        ]
    }
}