{
    "source": "BDSA",
    "name": "BDSA-2021-2126",
    "title": "fail2ban Vulnerable to Remote Code Execution (RCE) Unescaped Sequences in Mailing Action",
    "description": "fail2ban is vulnerable to remote code execution (RCE) due to the mailing command allowing to execute unescaped sequences as OS commands. An attacker that is able to control the `whois` output for their IP address could take over the machine running fail2ban without any authentication.",
    "technicalDescription": "fail2ban uses `mailutils` package which allows to send `whois` reports via email. The problem is that in `mailutils` there are sequences which allow to execute a command (`~!`) as well as pipe the composed email message into the shell command (`~|`) and return its output back into the email. When mailing the report, fail2ban uses `whois` lookup command for the given IP. If an attacker is able to control the `whois` output for their IP, they would be able include the sequences which would allow to execute arbitrary OS commands on the host. There are multiple ways the attacker could control the `whois` output:\n* MITM attacks (the `whois` protocol is not encrypted)\n* owning a referral whois (rwhois) entry - in that case `whois` will redirect to the referral server which will return the output entered by the attacker. Getting a referral whois entry requires owning a wide address class and a permission from American Registry for Internet Numbers (ARIN)\n* finding a 0day exploit in rwhois servers and using them to attack fail2ban instances\n\nThe vulnerability was fixed by escaping the command sequences in the mailing action.",
    "publishedDate": "2021-07-20T09:38:54.450Z",
    "updatedDate": "2022-08-02T13:57:56.110Z",
    "disclosureDate": "2021-07-16T00:00:00.000Z",
    "exploitPublishDate": "2021-07-16T00:00:00.000Z",
    "solution": "Fixed in the **master** branch by [this](https://github.com/fail2ban/fail2ban/commit/2ed414ed) and [this](https://github.com/fail2ban/fail2ban/commit/410a6ce5) commit. The commits are not yet included in any release.",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 7.6,
        "impactSubscore": 10.0,
        "exploitabilitySubscore": 4.9,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "COMPLETE",
        "integrityImpact": "COMPLETE",
        "availabilityImpact": "COMPLETE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 6.0
        },
        "vector": "(AV:N/AC:H/Au:N/C:C/I:C/A:C/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.1,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 2.2,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.3
        },
        "vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": true,
    "parentAdvisory": false,
    "credit": "Jakub \u017boczek",
    "workaround": "Patch for **0.9** version series is available [here](https://github.com/fail2ban/fail2ban/commit/2ed414ed09b3bb4c478abc9366a1ff22024a33c9).\nPatch for **0.10**, **0.11** and **1.0** version series is available [here](https://github.com/fail2ban/fail2ban/commit/410a6ce5c80dd981c22752da034f2529b5eee844).",
    "vendorFixDate": "2021-07-07T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 7.3,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2126",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-78"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-32749",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2126/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/fail2ban/fail2ban/commit/2ed414ed",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/fail2ban/fail2ban/commit/410a6ce5",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/fail2ban/fail2ban/security/advisories/GHSA-m985-3f3v-cwmm",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/fail2ban/fail2ban/security/advisories/GHSA-m985-3f3v-cwmm",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://github.com/fail2ban/fail2ban/security/advisories/GHSA-m985-3f3v-cwmm",
                "label": "WORKAROUND"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2126/default-remediation-status"
            }
        ]
    }
}