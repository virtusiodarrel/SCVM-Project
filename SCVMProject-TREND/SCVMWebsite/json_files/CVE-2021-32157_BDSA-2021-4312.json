{
    "source": "BDSA",
    "name": "BDSA-2021-4312",
    "title": "Webmin Vulnerable to Remote Command Execution via Cross-Site Request Forgery (CSRF) and Reflected Cross-Site Scripting (XSS) through Scheduled Cron Jobs Feature",
    "description": "Webmin has a reflected cross-site scripting (XSS) and a cross-site request forgery (CSRF) vulnerability due to an absence of correct parameter input validation. This could allow a remote attacker to inject malicious code and obtain a command shell on the server. The attacker could then execute arbitrary commands on the server.\n\n**Note:** this vulnerability only affects Webmin instances that were set up using the Perl installation script, which is mainly used on Windows systems. Although the Perl installation script is also available to Linux users, it is not used by default during regular installation procedures.",
    "technicalDescription": "The vulnerability exists due to the cross-site request forgery (CSRF) protection setting `referers_none` not being enabled if Perl-based (`setup.pl`) installation is used. This causes CSRF to be disabled site-wide, meaning multiple admin endpoints can be targeted to achieve remote code execution (RCE).\n\nTo exploit this particular vulnerability (`CVE-2021-32157`), the attacker has to use the `/cron/save_cron.cgi` endpoint.  The exploit code uses this endpoint to submit a form that contains a command to open a reverse shell. It is possible for the attacker to open a reverse shell for Bash, Python, PHP, Ruby and Perl. The exploit code embeds these actions in a generated URL. Once generated, the attacker can send this crafted link to a victim user. When the victim accesses this URL, the aforementioned actions will be completed on the server and the attacker will obtain a reverse shell. The attacker can use this flaw to execute malicious code on the server.\n\nThe issue was fixed by adding a statement in `setup.pl` that sets `referers_none=1` in the config file.",
    "publishedDate": "2022-04-11T13:32:31.024Z",
    "updatedDate": "2022-07-07T09:46:51.158Z",
    "disclosureDate": "2021-04-25T00:00:00.000Z",
    "exploitPublishDate": "2021-04-26T00:00:00.000Z",
    "solution": "Fixed in [**1.974**](https://github.com/webmin/webmin/releases/tag/1.974) by [this](https://github.com/webmin/webmin/commit/0c85e067df477fe4ace6e9447706ea488dc70a8d) commit.\n\nThe latest stable releases are available [here](https://www.webmin.com/download.html).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 9.3,
        "impactSubscore": 10.0,
        "exploitabilitySubscore": 8.6,
        "severity": "HIGH",
        "accessVector": "NETWORK",
        "accessComplexity": "MEDIUM",
        "authentication": "NONE",
        "confidentialityImpact": "COMPLETE",
        "integrityImpact": "COMPLETE",
        "availabilityImpact": "COMPLETE",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.7
        },
        "vector": "(AV:N/AC:M/Au:N/C:C/I:C/A:C/E:F/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.8,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 2.8,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "REQUIRED",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 8.2
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H/E:F/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Mesh3l_911 & Z0ldyck",
    "workaround": "The vulnerability can be mitigated by manually setting `referers_none=1` in the config.",
    "vendorFixDate": "2021-04-22T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 8.2,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-4312",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-352"
            },
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-79"
            },
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-94"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-32157",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-4312/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/Mesh3l911/CVE-2021-32157",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/Mesh3l911/CVE-2021-32157",
                "label": "EXPLOIT"
            },
            {
                "rel": "reference",
                "href": "https://github.com/webmin/webmin/commit/0c85e067df477fe4ace6e9447706ea488dc70a8d",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/webmin/webmin/commit/0c85e067df477fe4ace6e9447706ea488dc70a8d",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://github.com/webmin/webmin/releases/tag/1.974",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://www.webmin.com/download.html",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-4312/default-remediation-status"
            }
        ]
    }
}