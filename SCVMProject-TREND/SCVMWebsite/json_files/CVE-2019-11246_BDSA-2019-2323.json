{
    "source": "BDSA",
    "name": "BDSA-2019-2323",
    "title": "Kubernetes Vulnerable to Arbitrary Code Execution via Path Traversal in 'kubectl cp' Command",
    "description": "Kubernetes is vulnerable to arbitrary code execution due to how it handles copying files between containers and the user machine. It has been discovered that the fix for CVE-2019-1002101 was incomplete and can be bypassed.\n\nAn attacker who is able to breach a container or trick a victim into downloading a malicious image can exploit this flaw via a maliciously crafted `tar` archive. Unsafe handling of the extraction process can be leveraged via a symlink attack technique to overwrite arbitrary files on the host.",
    "technicalDescription": "The `kubectl cp` command used to copy files between containers and the host will firstly crate a `tar` archive and then extract it in the target destination. If files are packed or extracted inside a container, `kubectl` will make use of the container's `tar` binary for the operation. Otherwise, if the archive is to be created or unpacked on the host, `kubectl` will rely on the `tar` parsing code located in `cmd/cp/cp.go`.\n\nIf an attacker is able to control the contents of the `tar` archive prepared in the container they can attempt to abuse the logic of `cp.go` to overwrite system files. Incomplete fix for CVE-2019-1002101, that was supposed to prevent path traversals, can be bypassed by chaining together symlinks that step back. This will create an appearance that the target relative to the path is within the destination directory. In reality, after stepping through the whole path the target will end up outside the destination directory.\n\nThis can be leveraged to overwrite files that the symlink points to, which can lead to arbitrary code execution. System can be compromised by overwriting files such as `/etc/profile`, `.bashrc` or cron files.",
    "publishedDate": "2019-07-26T14:43:56.616Z",
    "updatedDate": "2020-07-23T14:25:33.325Z",
    "disclosureDate": "2019-06-21T00:00:00.000Z",
    "solution": "Fixed in:\n* [**1.12.9**](https://github.com/kubernetes/kubernetes/releases/tag/v1.12.9) by [this](https://github.com/kubernetes/kubernetes/commit/13f82a4cfdc7508c517b8dd21c5616f8ca30a522) and [this](https://github.com/kubernetes/kubernetes/commit/8649b4d9ebad4e3b6ae01619585237ec5863b92b) commit,\n* [**1.13.6**](https://github.com/kubernetes/kubernetes/releases/tag/v1.13.6) by [this](https://github.com/kubernetes/kubernetes/commit/fc412469dae5d28461a061a05188d64a6d238020) and [this](https://github.com/kubernetes/kubernetes/commit/8f8227f90d540dfb0f01efc3fd1f3eff87bf596a) commit,\n* [**1.14.2**](https://github.com/kubernetes/kubernetes/releases/tag/v1.14.2) by [this](https://github.com/kubernetes/kubernetes/commit/fe44df8bd4ef4a97c0ebdc722d07657cd4935e6c) and [this](https://github.com/kubernetes/kubernetes/commit/8db8423eea628d3696157cf8d3fbc261781a4302) commit,\n* [**1.15.0-alpha.3**](https://github.com/kubernetes/kubernetes/releases/tag/v1.15.0-alpha.3) by [this](https://github.com/kubernetes/kubernetes/commit/a867b399affc687468102fc1cedf0f79aedc73df) and [this](https://github.com/kubernetes/kubernetes/commit/7962231a8074eca544701b875cb52dcc4429903c) commit.\n\nAll releases can be found [here](https://github.com/kubernetes/kubernetes/releases).",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 5.1,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 4.9,
        "severity": "LOW",
        "accessVector": "NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 3.8
        },
        "vector": "(AV:N/AC:H/Au:N/C:P/I:P/A:P/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 7.5,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 1.6,
        "severity": "MEDIUM",
        "attackVector": "NETWORK",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "REQUIRED",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 6.5
        },
        "vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:U/C:H/I:H/A:H/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Charles Holmes, Atredis Partners",
    "workaround": "",
    "vendorFixDate": "2019-04-13T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 6.5,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-2323",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-23"
            },
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-59"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-11246",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-2323/ranges"
            },
            {
                "rel": "reference",
                "href": "https://bugzilla.redhat.com/show_bug.cgi?id=1721704",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kubernetes/kubernetes/commit/13f82a4cfdc7508c517b8dd21c5616f8ca30a522",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kubernetes/kubernetes/commit/7962231a8074eca544701b875cb52dcc4429903c",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kubernetes/kubernetes/commit/8649b4d9ebad4e3b6ae01619585237ec5863b92b",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kubernetes/kubernetes/commit/8db8423eea628d3696157cf8d3fbc261781a4302",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kubernetes/kubernetes/commit/8f8227f90d540dfb0f01efc3fd1f3eff87bf596a",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kubernetes/kubernetes/commit/a867b399affc687468102fc1cedf0f79aedc73df",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kubernetes/kubernetes/commit/fc412469dae5d28461a061a05188d64a6d238020",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kubernetes/kubernetes/commit/fe44df8bd4ef4a97c0ebdc722d07657cd4935e6c",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kubernetes/kubernetes/pull/76788",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kubernetes/kubernetes/releases",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kubernetes/kubernetes/releases/tag/v1.12.9",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kubernetes/kubernetes/releases/tag/v1.13.6",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kubernetes/kubernetes/releases/tag/v1.14.2",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/kubernetes/kubernetes/releases/tag/v1.15.0-alpha.3",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://groups.google.com/forum/#!topic/kubernetes-dev/OxFMDVnqk60",
                "label": "ADVISORY"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-2323/default-remediation-status"
            }
        ]
    }
}