{
    "source": "BDSA",
    "name": "BDSA-2021-4074",
    "title": "Zabbix Vulnerable to Remote Code Execution (RCE) via Custom Scripts",
    "description": "Zabbix is vulnerable to remote code execution (RCE). This could allow a user with the `Zabbix Admin` role to run a custom shell script on the application server in the context of the application user. This could result in multiple impacts including, but not limited to, full database access and access to other secrets stored on the application server.\n\n**Note**: In versions 5.4 onwards the vendor changed the way that scripts are managed. This means that users would need to be granted access to the `Administration->Scripts` UI element in order to execute scripts.",
    "technicalDescription": "This vulnerability exist due to the ability for users with the `Zabbix Admin` role to create actions that use remote commands and custom scripts. An attacker can take advantage of this in order to run custom scripts on the application server.",
    "publishedDate": "2022-01-28T11:48:15.751Z",
    "updatedDate": "2022-09-27T13:45:17.467Z",
    "disclosureDate": "2021-12-18T00:00:00.000Z",
    "exploitPublishDate": "2021-12-18T00:00:00.000Z",
    "solution": "",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 6.5,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 8.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "SINGLE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "WORKAROUND",
            "reportConfidence": "CONFIRMED",
            "score": 5.6
        },
        "vector": "(AV:N/AC:L/Au:S/C:P/I:P/A:P/E:POC/RL:W/RC:C)"
    },
    "cvss3": {
        "baseScore": 7.2,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 1.2,
        "severity": "MEDIUM",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "HIGH",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "WORKAROUND",
            "reportConfidence": "CONFIRMED",
            "score": 6.6
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H/E:P/RL:W/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": true,
    "parentAdvisory": false,
    "credit": "Paal Braathen (paalbra)",
    "workaround": "A workaround has been proposed [here](https://github.com/paalbra/zabbix-zbxsec-7/blob/master/README.md) which makes use of database triggers that prevent users from adding custom scripts.\n\nPostgres:\n```\nCREATE FUNCTION raise_exception() RETURNS trigger AS $$\n  DECLARE\n    message TEXT;\n  BEGIN\n    message := TG_ARGV[0];\n    RAISE exception '%', message;\n  END;\n$$ LANGUAGE plpgsql;\n\nCREATE TRIGGER no_custom_script\nBEFORE INSERT OR UPDATE ON opcommand\nFOR EACH ROW\nWHEN (NEW.type = 0)\nEXECUTE FUNCTION raise_exception('No custom script');\n```\n\nMySQL:\n```\nDELIMITER //\nCREATE TRIGGER no_custom_script_update\n  BEFORE UPDATE ON opcommand\n  FOR EACH ROW\nBEGIN\n  IF (NEW.type = 0) THEN\n    SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'No custom script';\n  END IF;\nEND //\nCREATE TRIGGER no_custom_script_insert\n  BEFORE INSERT ON opcommand\n  FOR EACH ROW\nBEGIN\n  IF (NEW.type = 0) THEN\n    SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'No custom script';\n  END IF;\nEND //\nDELIMITER ;\n```",
    "vendorNotifiedDate": "2019-07-30T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 6.6,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-4074",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-94"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-46088",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-4074/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/paalbra/zabbix-zbxsec-7/blob/master/README.md",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/paalbra/zabbix-zbxsec-7/blob/master/README.md",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://github.com/paalbra/zabbix-zbxsec-7/blob/master/README.md",
                "label": "WORKAROUND"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-4074/default-remediation-status"
            }
        ]
    }
}