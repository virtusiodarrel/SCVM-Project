{
    "source": "BDSA",
    "name": "BDSA-2020-0635",
    "title": "HAProxy Vulnerable to Denial-of-Service (DoS) via Out-of-Bounds Write in 'hpack-tbl.c' File",
    "description": "HAProxy contains an out-of-bounds write which leads to a heap-based buffer overflow. An attacker could exploit this vulnerability by sending a specially crafted request to cause a denial-of-service (DoS) and could lead to remote code execution.",
    "technicalDescription": "The `hpack_dht_insert` function in `src/hpack-tbl.c` does not sufficiently manage all scenarios when handling header names and values of certain HTTP/2 requests. \n\nThe HPACK header table is filled in a wrapping list where header names and values are stored from right to left and indexes are stored from left to right. When there is no room for the next header, the function will wrap to the right or defragment the header if needed. Using the right part is called the tailroom and the left part is called the headroom, to determine which should be used, depends on the last inserted header.\n\nAfter wrapping occurs, the code will stick to assigning tailroom by pretending there's no more headroom, so that the size fit always fails.\n\nAn attacker can exploit this by using a header with an empty name and empty value, resulting in a size of zero bytes, satisfying the condition to continue to use the headroom, Resulting in the `front` header index being changed and causing miscalculations for the next headers, which could allow the attacker to overwrite memory unexpectedly into a 32-bit relative address space potentially causing denial of service and could lead to remote code execution.",
    "publishedDate": "2020-04-06T15:59:10.855Z",
    "updatedDate": "2020-05-22T15:48:35.609Z",
    "disclosureDate": "2020-04-02T00:00:00.000Z",
    "exploitPublishDate": "2020-05-21T00:00:00.000Z",
    "solution": "Fixed in versions:\n* [**2.1.4**](http://www.haproxy.org/download/2.1/src/),\n* [**2.0.14**](http://www.haproxy.org/download/2.0/src/),\n* [**1.9.15**](http://www.haproxy.org/download/1.9/src/),\n* [**1.8.25**](http://www.haproxy.org/download/1.8/src/) by [this](https://git.haproxy.org/?p=haproxy.git;a=commit;h=5dfc5d5cd0d2128d77253ead3acf03a421ab5b88) commit.\n\nThe latest stable releases are available [here](http://www.haproxy.org/).",
    "severity": "CRITICAL",
    "cvss2": {
        "baseScore": 7.5,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 10.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 6.2
        },
        "vector": "(AV:N/AC:L/Au:N/C:P/I:P/A:P/E:F/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 9.8,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 3.9,
        "severity": "CRITICAL",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 9.1
        },
        "vector": "CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H/E:F/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Felix Wilhelm of Google Project Zero",
    "workaround": "If upgrading to a fixed version cannot be performed immediately, the vendor suggests the following workarounds:\n* For versions **1.8.0**-**1.8.24**, remove `npn h2` or `alpn h2` from the `bind` lines\n* For versions **1.9.0**-**1.9.14**, remove `npn h2`, `alpn h2`, or `proto h2` from the `bind` lines\n* For versions **2.0.0**-**2.0.13**, disable HTX by adding `no option http-use-htx` and remove `npn h2`, `alpn h2`, or `proto h2` from the `bind` lines\n* For versions **2.1.0**-**2.1.3**, there is no workaround available.",
    "vendorFixDate": "2020-03-29T00:00:00.000Z",
    "vendorNotifiedDate": "2020-03-24T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 9.1,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-0635",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-122"
            },
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-787"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2020-11100",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-0635/ranges"
            },
            {
                "rel": "reference",
                "href": "http://www.haproxy.org/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "http://www.haproxy.org/download/1.8/src/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "http://www.haproxy.org/download/1.9/src/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "http://www.haproxy.org/download/2.0/src/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "http://www.haproxy.org/download/2.1/src/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://bugs.chromium.org/p/project-zero/issues/detail?id=2023",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://bugs.chromium.org/p/project-zero/issues/detail?id=2023",
                "label": "EXPLOIT"
            },
            {
                "rel": "reference",
                "href": "https://git.haproxy.org/?p=haproxy.git;a=commit;h=5dfc5d5cd0d2128d77253ead3acf03a421ab5b88",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://www.haproxy.com/blog/haproxy-1-8-http-2-hpack-decoder-vulnerability-fixed/",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.haproxy.com/blog/haproxy-1-8-http-2-hpack-decoder-vulnerability-fixed/",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://www.mail-archive.com/haproxy@formilux.org/msg36876.html",
                "label": "ADVISORY"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-0635/default-remediation-status"
            }
        ]
    }
}