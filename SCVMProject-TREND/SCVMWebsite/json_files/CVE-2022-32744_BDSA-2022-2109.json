{
    "source": "BDSA",
    "name": "BDSA-2022-2109",
    "title": "Samba Vulnerable to Full Domain Takeover via Forged Password Change Requests",
    "description": "A domain takeover vulnerability has been discovered in Samba. Since the Key Distribution Center (KDC) accepts `kpasswd` requests encrypted with any key known to it by encrypting forged `kpasswd` requests with their own key, a malicious user can change the passwords of other users, including admin users, and subsequently achieve full domain takeover.",
    "technicalDescription": "This issue occurs because tickets received by the `kpasswd` service were incorrectly being decrypted without specifying that only that service's own keys should be tried. By setting the ticket's server name to a principal associated with an account in their control, or by exploiting a fallback where known keys would be tried until a suitable one was found, an attacker could make the server accept tickets encrypted with any key, including their own.\n\nAn attacker could then potentially change the password of the Administrator account and gain total control over the domain. Complete loss of confidentiality and integrity may then be possible, as well as of availability via denying users access to their accounts.\n\nAdditionally the `kpasswd` service improperly accepted tickets encrypted by the `krbtgt` key of a read-only domain controller (RODC), despite RODCs ideally not being able to authorize password changes.\n\nIt was mitigated as part of broader changes relating to the handing of password change requests.",
    "publishedDate": "2022-07-28T14:08:56.578Z",
    "updatedDate": "2022-09-26T11:40:40.725Z",
    "disclosureDate": "2022-07-27T00:00:00.000Z",
    "solution": "Fixed in:\n* [**4.16.4**](https://github.com/samba-team/samba/releases/tag/samba-4.16.4),\n* [**4.15.9**](https://github.com/samba-team/samba/releases/tag/samba-4.15.9),\n* [**4.14.14**](https://github.com/samba-team/samba/releases/tag/samba-4.14.14).\n\nThe latest stable releases can be found [here](https://download.samba.org/pub/samba/).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 6.5,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 8.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "SINGLE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.8
        },
        "vector": "(AV:N/AC:L/Au:S/C:P/I:P/A:P/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.8,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 2.8,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "LOW",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.7
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Joseph Sutton of Catalyst and the Samba Team",
    "workaround": "Per the vendor,\n> `kpasswd` is not a critical protocol for the AD DC in most installations, it can be disabled by setting `kpasswd port = 0` in the `smb.conf`.",
    "vendorFixDate": "2022-07-27T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 7.7,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-2109",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-264"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2022-32744",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-2109/ranges"
            },
            {
                "rel": "reference",
                "href": "https://bugzilla.samba.org/show_bug.cgi?id=15074",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://download.samba.org/pub/samba/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/samba-team/samba/releases/tag/samba-4.14.14",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/samba-team/samba/releases/tag/samba-4.15.9",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/samba-team/samba/releases/tag/samba-4.16.4",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://www.samba.org/samba/history/samba-4.16.4.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.samba.org/samba/security/CVE-2022-32744.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.samba.org/samba/security/CVE-2022-32744.html",
                "label": "WORKAROUND"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-2109/default-remediation-status"
            }
        ]
    }
}