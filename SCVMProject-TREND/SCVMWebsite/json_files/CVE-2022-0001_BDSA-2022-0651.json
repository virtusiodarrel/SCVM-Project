{
    "source": "BDSA",
    "name": "BDSA-2022-0651",
    "title": "Linux Kernel Vulnerable to Sensitive Information Disclosure via Branch History Injection (BHI) Attacks on Intel Processors",
    "description": "The Linux Kernel is vulnerable to a sensitive information disclosure issue on some Intel processors due to non-transparent sharing of branch predictor selectors between contexts. This issue may allow an authorized user to leak arbitrary kernel memory via local access.\n\nThe vulnerability researchers consider this issue to be an extension of Branch Target Injection (BTI, Spectre Variant 2, **CVE-2017-5715** (**BDSA-2018-0009**)). See their [advisory](https://www.vusec.net/projects/bhi-spectre-bhb/) for more information.\n\n**Note**: Intel has indicated that Branch History Injection (BHI), **CVE-2022-0001**, and Intra-Mode Branch Target Injection (IMBTI), **CVE-2022-0002** (**BDSA-2022-0652**), are more complex attacks than Branch Target Injection (BTI), and systems for which BTI mitigations were not needed (for example, because all code executed on the system is trusted) are expected to find that BHI and intra-mode BTI will not need mitigating. Intel has published information on which processors are affected [here](https://www.intel.com/content/www/us/en/developer/topic-technology/software-security-guidance/processors-affected-consolidated-product-cpu-model.html).",
    "technicalDescription": "Branch History Injection (BHI), **CVE-2022-0001**, is an Intel proposed name to define a specific form of Intra-Mode Branch Target Injection (IMBTI), where an attacker may manipulate branch history before transitioning from user to supervisor mode (or from VMX non-root/guest to root mode) in an effort to cause an indirect branch predictor to select a specific predictor entry for an indirect branch, and a disclosure gadget at the predicted target will transiently execute. This may be possible since the relevant branch history may contain branches taken in previous security contexts, and in particular, in other predictor modes. \n\nThis is one of two reported attack models. The other named attack model is IMBTI, **CVE-2022-0002** (**BDSA-2022-0652**). The vulnerability researchers have named these models together as **Spectre-BHB** (Spectre-v2 aided by the Branch History Buffer (BHB)).",
    "publishedDate": "2022-03-11T15:29:29.783Z",
    "updatedDate": "2022-07-11T08:45:31.390Z",
    "disclosureDate": "2022-03-08T00:00:00.000Z",
    "exploitPublishDate": "2022-03-08T00:00:00.000Z",
    "solution": "Fixed in Linux Kernel version [**5.17-rc8**](https://www.kernel.org) by [this](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4a01e748a51cdc0527fdc913546dd46e822aa00d) commit.\n\n\nXen has made [patches](https://xenbits.xen.org/xsa/advisory-398.html) available for the following stable branches:\n* **4.16.x**\n* **4.15.x**\n* **4.14.x**\n* **4.13.x**\n* **4.12.x**",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 1.0,
        "impactSubscore": 2.9,
        "exploitabilitySubscore": 1.5,
        "severity": "LOW",
        "accessVector": "LOCAL",
        "accessComplexity": "HIGH",
        "authentication": "SINGLE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "NONE",
        "availabilityImpact": "NONE",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 0.8
        },
        "vector": "(AV:L/AC:H/Au:S/C:P/I:N/A:N/E:F/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 4.7,
        "impactSubscore": 3.6,
        "exploitabilitySubscore": 1.0,
        "severity": "MEDIUM",
        "attackVector": "LOCAL",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "NONE",
        "availabilityImpact": "NONE",
        "privilegesRequired": "LOW",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.4
        },
        "vector": "CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:H/I:N/A:N/E:F/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": true,
    "parentAdvisory": false,
    "credit": "Pietro Frigo, Enrico Barberis, Marius Muench, Herbert Bos, Cristiano Giuffrida from the VUSec group at VU Amsterdam",
    "workaround": "Intel has suggested a couple of near-term mitigations in their [advisory](https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/technical-documentation/branch-history-injection.html) for this issue:\n\n* Disable Unpriviliged eBPF:\nThe kernel can be configured to deny access to unprivileged eBPF by default, while still allowing administrators to enable it at runtime where needed. This was already the default for many Linux distributions and is the default for Linux **5.16+**. Other Linux kernels can set this default using `CONFIG_BPF_UNPRIV_DEFAULT_OFF` (which should be available in Linux kernel **5.13+**, as well as recent stable kernels). Unprivileged eBPF can be also be disabled or enabled at runtime using the `kernel.unprivileged_bpf_disabled sysctl`.\n* Continue to Enable `SMEP` and enhanced `eIBRS`:\n`SMEP` and `enhanced IBRS` are hardware mitigations which are already enabled by default by most operating systems when supported. Intel recommends continuing to enable both `SMEP` and `eIBRS` by default and using `IBPB` on context switches where needed. `eIBRS` prevents Spectre Variant 2 (Branch Target Injection), **CVE-2017-5715** (**BDSA-2018-0009**), by preventing less privileged modes from specifying the predicted targets of indirect jumps. `SMEP` prevents supervisor mode execution from user mode pages, including transient execution. `IBPB` is a branch prediction barrier which can be used to isolate different contexts from each other.  These are important for defense-in-depth in addition to mitigating the original Branch Target Injection attack.\nOn parts that do not support `eIBRS`, these BHI attacks can be mitigated by following the [existing guidance](https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/technical-documentation/retpoline-branch-target-injection-mitigation.html) for related branch target injection attacks.\n\nIntel has also suggested a series of additional hardening options which can be viewed [here](https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/technical-documentation/branch-history-injection.html#additional-hardening-options).",
    "vendorFixDate": "2022-03-05T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 4.4,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-0651",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-208"
            },
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-226"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2022-0001",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-0651/ranges"
            },
            {
                "rel": "reference",
                "href": "https://bugzilla.redhat.com/show_bug.cgi?id=2061712",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://community.intel.com/t5/Blogs/Products-and-Solutions/Security/Chips-Salsa-Episode-12-March-2022-Security-Advisories/post/1365250",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://download.vusec.net/papers/bhi-spectre-bhb_sec22.pdf",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4a01e748a51cdc0527fdc913546dd46e822aa00d",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/vusec/bhi-spectre-bhb",
                "label": "EXPLOIT"
            },
            {
                "rel": "reference",
                "href": "https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/technical-documentation/branch-history-injection.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/technical-documentation/branch-history-injection.html",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/technical-documentation/branch-history-injection.html#additional-hardening-options",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/technical-documentation/retpoline-branch-target-injection-mitigation.html",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://www.intel.com/content/www/us/en/developer/topic-technology/software-security-guidance/processors-affected-consolidated-product-cpu-model.html",
                "label": "LINK"
            },
            {
                "rel": "reference",
                "href": "https://www.intel.com/content/www/us/en/security-center/advisory/intel-sa-00598.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.kernel.org",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://www.vusec.net/projects/bhi-spectre-bhb/",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.vusec.net/projects/bhi-spectre-bhb/",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/xsa/advisory-398.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/xsa/advisory-398.html",
                "label": "PATCH"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-0651/default-remediation-status"
            }
        ]
    }
}