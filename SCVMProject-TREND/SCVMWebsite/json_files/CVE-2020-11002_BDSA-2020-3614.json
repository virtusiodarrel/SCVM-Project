{
    "source": "BDSA",
    "name": "BDSA-2020-3614",
    "title": "Dropwizard Vulnerable to Remote Code Execution (RCE) via '@SelfValidating' Feature",
    "description": "Dropwizard is vulnerable to a server-side template injection. A remote attacker could inject Java Expression Language (EL) in order to execute arbitrary server-side code with the privileges of the Dropwizard service account.",
    "technicalDescription": "The vulnerability manifests in the self-validating (`@SelfValidating`) feature of the `dropwizard-validation` package. Remote code execution is possible if the attacker manages to inject arbitrary data in the error message template passed to a Java Bean Validation (JSR 380) custom constraint validator named `ConstraintValidatorContext.buildConstraintViolationWithTemplate()`. DropWizard's `io.dropwizard.validation.selfvalidating.ViolationCollector.addViolation()` passes its argument to the validator without performing any further validation, meaning untrusted data passed to `addViolation()` will be evaluated as an EL expression and the code provided by the attacker will be executed.\n\nTo fix the issue the evaluation of EL expressions has been disabled by default. In order to use some interpolation in the violation messages added to `ViolationCollector`, it has to be explicitly allowed by setting `elfValidating#escapeExpressions()` to `false`.\n\n**Note:** This vulnerability is present due to the unsuccessful fix attempt of `CVE-2020-5245` (also described in `BDSA-2020-0337`).",
    "publishedDate": "2020-12-02T15:00:41.797Z",
    "updatedDate": "2021-02-10T15:27:59.248Z",
    "disclosureDate": "2020-02-24T00:00:00.000Z",
    "exploitPublishDate": "2020-04-15T00:00:00.000Z",
    "solution": "Fixed in:\n* [**1.3.21**](https://github.com/dropwizard/dropwizard/releases/tag/v1.3.21) by [this](https://github.com/dropwizard/dropwizard/commit/74e211514db951a67b0e9ff75b0102704d4b2049) and [this](https://github.com/dropwizard/dropwizard/commit/28479f743a9d0aab6d0e963fc07f3dd98e8c8236) commit\n* [**2.0.3**](https://github.com/dropwizard/dropwizard/releases/tag/v2.0.3) by [this](https://github.com/dropwizard/dropwizard/commit/d87d1e4f8e20f6494c0232bf8560c961b46db634) and [this](https://github.com/dropwizard/dropwizard/commit/d5a512f7abf965275f2a6b913ac4fe778e424242) commit\n\nThe latest stable releases are available [here](https://github.com/dropwizard/dropwizard/releases).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 7.5,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 10.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.9
        },
        "vector": "(AV:N/AC:L/Au:N/C:P/I:P/A:P/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 9.8,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 3.9,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 8.8
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Alvaro Mu\u00f1oz, GHSL",
    "workaround": "If immediate upgrade is not possible, the vendor advises sanitizing any messages added to a `ViolationCollector` object in a method annotated with `@SelfValidation`.\n\nThe credited researcher also suggests the following approaches:\n* Do not include validated bean properties in the custom error message\n* Disable the EL interpolation and only use `ParameterMessageInterpolator`:\n ```\n Validator validator = Validation.byDefaultProvider()\n    .configure()\n    .messageInterpolator( new ParameterMessageInterpolator() )\n    .buildValidatorFactory()\n    .getValidator();\n ```\n* Replace Hibernate-Validator with Apache BVal which in its latest version does not interpolate EL expressions by default. Note that this replacement may not be a simple drop-in replacement",
    "vendorFixDate": "2020-03-26T00:00:00.000Z",
    "vendorNotifiedDate": "2020-02-19T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 8.8,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-3614",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-20"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2020-11002",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-3614/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/dropwizard/dropwizard/commit/28479f743a9d0aab6d0e963fc07f3dd98e8c8236",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/dropwizard/dropwizard/commit/74e211514db951a67b0e9ff75b0102704d4b2049",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/dropwizard/dropwizard/commit/d5a512f7abf965275f2a6b913ac4fe778e424242",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/dropwizard/dropwizard/commit/d87d1e4f8e20f6494c0232bf8560c961b46db634",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/dropwizard/dropwizard/releases",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/dropwizard/dropwizard/releases/tag/v1.3.21",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/dropwizard/dropwizard/releases/tag/v2.0.3",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/dropwizard/dropwizard/security/advisories/GHSA-3mcp-9wr4-cjqf",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/dropwizard/dropwizard/security/advisories/GHSA-8jpx-m2wh-2v34",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/dropwizard/dropwizard/security/advisories/GHSA-8jpx-m2wh-2v34",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://securitylab.github.com/advisories/GHSL-2020-030-dropwizard",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://securitylab.github.com/advisories/GHSL-2020-030-dropwizard",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://securitylab.github.com/advisories/GHSL-2020-030-dropwizard",
                "label": "WORKAROUND"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-3614/default-remediation-status"
            }
        ]
    }
}