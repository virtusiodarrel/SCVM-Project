{
    "source": "BDSA",
    "name": "BDSA-2020-0182",
    "title": "Squid Vulnerable to Remote Code Execution (RCE) via Stack-based Buffer Overflow in 'prepareAcceleratedURL' Function",
    "description": "Squid Cache is vulnerable to a stack-based buffer overflow. An attacker could exploit this vulnerability by sending maliciously crafted requests from a remote client to a Squid deployment acting as a reverse-proxy in order to cause a denial-of-service (DoS), a small data leak and under certain circumstances remote code execution (RCE).",
    "technicalDescription": "The issue exists in the function `prepareAcceleratedURL()` within the file `src/client_side.cc`. Improper buffer management in this function can result in a buffer overflow.\n\nThis vulnerability is due to how Squid parses `Host` headers when Squid is acting like a reverse proxy. An attacker can exploit this vulnerability by sending a crafted GET request with a specific length `Host` header, causing Squid to crash and denying service to any clients using Squid.\n\nWith certain length payloads, rather than crashing squid the payload will instead cause Squid to return uninitialized bytes after the string buffer until a NULL byte is reached. \n\nThe researcher and vendor both state that remote code execution (RCE) is possible as a result of this vulnerability. Although restricted to a low privilege level it would allow an attacker to gain a significant amount of information about the network structure as well as other clients using the proxy.\n\n**Note:** This vulnerability is trivial to exploit on 32-bit Squid installations, on 64-bit it becomes more difficult for an attacker (but not impossible). Unspecified effects of exploitation also require `allow_direct` permissions to function. \n\nThe vendor states that the following configurations of Squid, acting as a reverse proxy, are affected by this vulnerability:\n* **2.x** up to and including **2.7.STABLE9** with `http_port`: `accel` or `vhost` options configured,\n* **3.x** up to and including **3.5.28** with `http_port`: `accel` or `vhost` options configured,\n*  **4.x** up to and including **4.9** with with `http_port`: `accel` option configured.",
    "publishedDate": "2020-02-06T17:10:08.452Z",
    "updatedDate": "2021-09-01T09:40:06.264Z",
    "disclosureDate": "2020-02-03T00:00:00.000Z",
    "solution": "Fixed in **[4.10](https://github.com/squid-cache/squid/releases/tag/SQUID_4_10)** by [this](https://github.com/squid-cache/squid/commit/d8e4715992d0e530871519549add5519cbac0598) commit and [this](https://github.com/squid-cache/squid/commit/b3a0719affab099c684f1cd62b79ab02816fa962) commit.\n\nIf upgrading to a fixed version can not be done immediately, the vendor has supplied patches for these vulnerable versions.\n*  Squid **3.5.x** branch with these commits: \n1. [Commit 1](https://github.com/squid-cache/squid/commit/8e657e835965c3a011375feaa0359921c5b3e2dd)\n2.  [Commit 2](https://github.com/squid-cache/squid/commit/d29ac78fd203f55bf391bcb24348ed43ea469d21)\n3. \t[Commit 3](https://github.com/squid-cache/squid/commit/21d99bdeaed7b2208098d824496da954920ea720)\n* [**Squid 4.x => 4.8**](http://www.squid-cache.org/Versions/v4/changesets/SQUID-2020_1.patch)\n* [**Squid 4.9**](http://www.squid-cache.org/Versions/v4/changesets/squid-4-b3a0719affab099c684f1cd62b79ab02816fa962.patch)\n\nThe latest stable releases are available [here](http://www.squid-cache.org/Versions/).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 7.5,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 10.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.5
        },
        "vector": "(AV:N/AC:L/Au:N/C:P/I:P/A:P/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.6,
        "impactSubscore": 4.7,
        "exploitabilitySubscore": 3.9,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "LOW",
        "availabilityImpact": "LOW",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.5
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:L/A:L/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Guido Vranken",
    "workaround": "The researcher mentions that exploitation of this vulnerability is impossible when `-fstack-protector` is enabled.",
    "vendorFixDate": "2019-12-12T00:00:00.000Z",
    "vendorNotifiedDate": "2019-07-24T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 7.5,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-0182",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-120"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2020-8450",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-0182/ranges"
            },
            {
                "rel": "reference",
                "href": "http://www.squid-cache.org/Advisories/SQUID-2020_1.txt",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "http://www.squid-cache.org/Advisories/SQUID-2020_1.txt",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "http://www.squid-cache.org/Versions/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "http://www.squid-cache.org/Versions/v4/changesets/SQUID-2020_1.patch",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "http://www.squid-cache.org/Versions/v4/changesets/squid-4-b3a0719affab099c684f1cd62b79ab02816fa962.patch",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/squid-cache/squid/commit/21d99bdeaed7b2208098d824496da954920ea720",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/squid-cache/squid/commit/8e657e835965c3a011375feaa0359921c5b3e2dd",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/squid-cache/squid/commit/b3a0719affab099c684f1cd62b79ab02816fa962",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/squid-cache/squid/commit/d29ac78fd203f55bf391bcb24348ed43ea469d21",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/squid-cache/squid/commit/d8e4715992d0e530871519549add5519cbac0598",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/squid-cache/squid/releases/tag/SQUID_4_10",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-0182/default-remediation-status"
            }
        ]
    }
}