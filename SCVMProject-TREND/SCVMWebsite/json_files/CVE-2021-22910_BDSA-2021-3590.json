{
    "source": "BDSA",
    "name": "BDSA-2021-3590",
    "title": "Rocket.Chat Vulnerable to NoSQL Injection via Insufficient 'query' and 'selector' Parameter Validation",
    "description": "Rocket.Chat is vulnerable to NoSQL injection due to the insufficient validation of an HTTP request parameter. A remote authenticated attacker could recover arbitrary fields from the `users` collection by sending requests which specify a maliciously crafted `query` parameter to the `users.list` API endpoint. The `selector` parameter, as used with the `users.autocomplete` endpoint, is also vulnerable. An attacker can use the information that is obtained from the database to take over the accounts of other users. Taking over the account of an administrator will allow the attacker to achieve remote code execution (RCE).",
    "technicalDescription": "The `users.list` API endpoint uses the `query` HTTP GET request parameter to dynamically construct NoSQL queries. The `users.autocomplete` API endpoint dynamically constructs NoSQL queries using the value of the `selector ` HTTP GET request parameter. Both of these endpoints are implemented using code which is contained in the file `app/api/server/v1/users.js`. The application fails to validate the values of these parameters prior to their use. An attacker could craft malicious values for these parameters in order to perform blind NoSQL injection attacks. This could allow the attacker to recover data from the `users` collection, including data that is used for multi-factor authentication. An attacker could leverage this issue in order to gain access to arbitrary user accounts. If the attacker gains access to an administrator's account, then they could achieve arbitrary code execution using malicious web hooks.",
    "publishedDate": "2021-11-29T17:35:07.781Z",
    "updatedDate": "2022-02-22T10:57:10.184Z",
    "disclosureDate": "2021-07-31T00:00:00.000Z",
    "exploitPublishDate": "2021-07-31T00:00:00.000Z",
    "solution": "Fixed in versions:\n* [**3.14.2**](https://github.com/RocketChat/Rocket.Chat/releases/tag/3.14.2),\n* [**3.13.4**](https://github.com/RocketChat/Rocket.Chat/releases/tag/3.13.4),\n* [**3.12.6**](https://github.com/RocketChat/Rocket.Chat/releases/tag/3.12.6).\n\nThe latest stable releases are available [here](https://github.com/RocketChat/Rocket.Chat/releases).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 6.5,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 8.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "SINGLE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.1
        },
        "vector": "(AV:N/AC:L/Au:S/C:P/I:P/A:P/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.8,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 2.8,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "LOW",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.9
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Researchers at SonarSource",
    "workaround": "",
    "vendorFixDate": "2021-05-25T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 7.9,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-3590",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-74"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-22910",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-3590/ranges"
            },
            {
                "rel": "reference",
                "href": "https://blog.sonarsource.com/nosql-injections-in-rocket-chat",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://docs.rocket.chat/guides/security/security-updates",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/RocketChat/Rocket.Chat/commit/3112d225fe1533dd77cfad7fff085d53d78c19f2",
                "label": "INTRODUCTORY_COMMIT"
            },
            {
                "rel": "reference",
                "href": "https://github.com/RocketChat/Rocket.Chat/releases",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/RocketChat/Rocket.Chat/releases/tag/3.12.6",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/RocketChat/Rocket.Chat/releases/tag/3.13.4",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/RocketChat/Rocket.Chat/releases/tag/3.14.2",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://hackerone.com/reports/1130874",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://hackerone.com/reports/1130874",
                "label": "POC"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-3590/default-remediation-status"
            }
        ]
    }
}