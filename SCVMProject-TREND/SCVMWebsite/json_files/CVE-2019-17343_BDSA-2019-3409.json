{
    "source": "BDSA",
    "name": "BDSA-2019-3409",
    "title": "Xen Vulnerable to Privilege Escalation via Race Conditions in 'physmap' Page Mapping Functionality",
    "description": "Xen is vulnerable to privilege escalation due to the improper management of memory configuration information. A local attacker could obtain elevated privileges on a vulnerable system by using a malicious PV domain that has access to a physical device. Only PV domains running on x86 systems are vulnerable.",
    "technicalDescription": "A PV domain page must be mapped within the IOMMU to become accessible to passed-through devices via Direct Memory Access (DMA). Certain PV pages can have special properties. For example, they can contain a page table or descriptor table. It is important that such pages are not listed as being writable in the IOMMU. Xen implements a safety mechanism in order to prevent these special pages from being mapped into the IOMMU at all. Xen performs the page mapping process using its `physmap` functionality. A PV page is mapped as writable in the IOMMU via the `guest_physmap_add_entry()` function.\nThis mapping can be removed later via the `guest_physmap_remove_entry()` function. PV pages can be mapped upon creation, and also when they are marked as being writable i.e. when they obtain the `PGT_writable` type. This process has been derived from HVM domain functionality, which uses a locked-and-gated approach for page table management. The page table management approach used by Xen's PV domains is the lock-free approach. The contrast between these two approaches means that race conditions can arise in the PV domain implementation of  `physmap`. These race conditions can cause special memory pages to be listed as writable in the IOMMU, which can allow malicious PV domains with access to a physical device to DMA into their own page tables and escalate their privileges.\n\nIt should be noted that only x86 systems in which PV guests are given direct access to physical devices via PCI pass-through are vulnerable. Systems that only use HVM guests or do not use PCI pass-through are not vulnerable.",
    "publishedDate": "2019-11-06T11:47:15.072Z",
    "updatedDate": "2021-01-22T16:38:28.304Z",
    "disclosureDate": "2019-03-05T00:00:00.000Z",
    "solution": "Fixed in version [**4.12.0-rc5**](https://github.com/xen-project/xen/releases/tag/4.12.0-rc5) by [this](https://github.com/xen-project/xen/commit/fe21b78ef99a1b505cfb6d3789ede9591609dd70) commit.\n\nFixed in version [**4.11.2**](https://github.com/xen-project/xen/releases/tag/RELEASE-4.11.2) by [this](https://github.com/xen-project/xen/commit/be58f861234c667ee7583be24149e5c1192ccc9c) commit.\n\nFixed in version [**4.10.4**](https://github.com/xen-project/xen/releases/tag/RELEASE-4.10.4) by [this](https://github.com/xen-project/xen/commit/b450b2007d1975730eb75be5a050591fd00e2024) commit.\n\nFixed by [this](https://github.com/xen-project/xen/commit/55d36e28913e363926cbd62b88621079815624aa) commit in the `4.9` branch, which is not yet included in any release.\n\nFixed by [this](https://github.com/xen-project/xen/commit/44aba8be05fd59104e7c6a4be86345a3a806730c) commit in the `4.8` branch, which is not yet included in any release.\n\nFixed by [this](https://github.com/xen-project/xen/commit/384a6ddf3dc522dce1ac37735fd7e7128c4bd5e9) commit in the `4.7` branch, which is not yet included in any release.\n\nThe latest stable releases can be found [here](https://github.com/xen-project/xen/releases).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 4.6,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 3.9,
        "severity": "LOW",
        "accessVector": "LOCAL",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 3.4
        },
        "vector": "(AV:L/AC:L/Au:N/C:P/I:P/A:P/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.4,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 2.5,
        "severity": "HIGH",
        "attackVector": "LOCAL",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.3
        },
        "vector": "CVSS:3.1/AV:L/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": true,
    "parentAdvisory": false,
    "credit": "Paul Durrant of Citrix",
    "workaround": "The vendor states that only assigning devices to HVM guests will avoid these vulnerabilities.",
    "vendorFixDate": "2019-03-05T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 7.3,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-3409",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-265"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-17343",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-3409/ranges"
            },
            {
                "rel": "reference",
                "href": "http://xenbits.xen.org/xsa/advisory-288.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "http://xenbits.xen.org/xsa/advisory-288.html",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/commit/384a6ddf3dc522dce1ac37735fd7e7128c4bd5e9",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/commit/44aba8be05fd59104e7c6a4be86345a3a806730c",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/commit/55d36e28913e363926cbd62b88621079815624aa",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/commit/b450b2007d1975730eb75be5a050591fd00e2024",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/commit/be58f861234c667ee7583be24149e5c1192ccc9c",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/commit/fe21b78ef99a1b505cfb6d3789ede9591609dd70",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/releases",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/releases/tag/4.12.0-rc5",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/releases/tag/RELEASE-4.10.4",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/xen-project/xen/releases/tag/RELEASE-4.11.2",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-3409/default-remediation-status"
            }
        ]
    }
}