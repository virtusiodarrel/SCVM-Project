{
    "source": "BDSA",
    "name": "BDSA-2021-3845",
    "title": "Linux Kernel Vulnerable to Privilege Escalation via OverlayFS Rename Operation Race Condition",
    "description": "The Linux kernel is vulnerable to privilege escalation due to improper checks being performed during OverlayFS rename operations. A local attacker could gain root privileges on a vulnerable host by running a malicious binary on that host.",
    "technicalDescription": "The function `ovl_rename()`, of file `fs/overlayfs/dir.c`, improperly handles situations where `newdentry` is negative and the `RENAME_EXCHANGE` flag is set. In such cases, the regular execution flow of the function should be halted, and `newdentry` should be released via a call to `dput()`. However, the code fails to enforce this, meaning that the function can continue as normal. An attacker can leverage this to perform problematic OverlayFS renaming operations. This could potentially allow the attacker to elevate their privileges to that of the root user.\n\nThe vulnerability was fixed via the addition of code which redirects execution to error handling code whenever `newdentry` is negative and the `RENAME_EXCHANGE` flag is set.",
    "publishedDate": "2021-12-22T12:47:17.518Z",
    "updatedDate": "2022-08-25T10:52:30.351Z",
    "disclosureDate": "2021-10-12T00:00:00.000Z",
    "exploitPublishDate": "2021-09-24T00:00:00.000Z",
    "solution": "Fixed in:\n* [**4.4.290**](https://www.kernel.org) by [this](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=a4f281ffc1d128d7ea693cbc3a796e56e919fd7c) commit,\n* [**4.9.287**](https://www.kernel.org) by [this](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=286f94453fb34f7bd6b696861c89f9a13f498721) commit,\n* [**4.14.251**](https://www.kernel.org) by [this](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=1caaa820915d802328bc72e4de0d5b1629eab5da) commit,\n* [**4.19.211**](https://www.kernel.org) by [this](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=9d4969d8b5073d02059bae3f1b8d9a20cf023c55) commit,\n* [**5.4.153**](https://www.kernel.org) by [this](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=fab338f33c25c4816ca0b2d83a04a0097c2c4aaf) commit,\n* [**5.10.73**](https://www.kernel.org) by [this](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=9763ffd4da217adfcbdcd519e9f434dfa3952fc3) commit,\n* [**5.14.12**](https://www.kernel.org) by [this](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=71b8b36187af58f9e67b25021f5debbc04a18a5d) commit,\n* [**5.15-rc5**](https://www.kernel.org) by [this](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=a295aef603e109a47af355477326bd41151765b6) commit.",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 6.0,
        "impactSubscore": 10.0,
        "exploitabilitySubscore": 1.5,
        "severity": "MEDIUM",
        "accessVector": "LOCAL",
        "accessComplexity": "HIGH",
        "authentication": "SINGLE",
        "confidentialityImpact": "COMPLETE",
        "integrityImpact": "COMPLETE",
        "availabilityImpact": "COMPLETE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.7
        },
        "vector": "(AV:L/AC:H/Au:S/C:C/I:C/A:C/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 7.0,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 1.0,
        "severity": "MEDIUM",
        "attackVector": "LOCAL",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "LOW",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 6.3
        },
        "vector": "CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:H/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "workaround": "",
    "vendorFixDate": "2021-09-24T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 6.3,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-3845",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-362"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-20321",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-3845/ranges"
            },
            {
                "rel": "reference",
                "href": "https://bugzilla.redhat.com/show_bug.cgi?id=2013242",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=1caaa820915d802328bc72e4de0d5b1629eab5da",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=286f94453fb34f7bd6b696861c89f9a13f498721",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=71b8b36187af58f9e67b25021f5debbc04a18a5d",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=9763ffd4da217adfcbdcd519e9f434dfa3952fc3",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=9d4969d8b5073d02059bae3f1b8d9a20cf023c55",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=a295aef603e109a47af355477326bd41151765b6",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=a4f281ffc1d128d7ea693cbc3a796e56e919fd7c",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=fab338f33c25c4816ca0b2d83a04a0097c2c4aaf",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a295aef603e109a47af355477326bd41151765b6",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e9be9d5e76e34872f0c37d72e25bc27fe9e2c54c",
                "label": "INTRODUCTORY_COMMIT"
            },
            {
                "rel": "reference",
                "href": "https://www.kernel.org",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-3845/default-remediation-status"
            }
        ]
    }
}