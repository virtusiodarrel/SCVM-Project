{
    "source": "BDSA",
    "name": "BDSA-2019-2398",
    "title": "QEMU Vulnerable to Remote Code Execution (RCE) via Heap-based Buffer Overflow Vulnerability in libslirp during Packet Reassembly",
    "description": "Slirp libslirp, as used in QEMU, is vulnerable to a heap-based buffer overflow vulnerability due to a pointer miscalculation during packet reassembly. This issue allows a malicious remote user/process to perform remote code execution in QEMU where Slirp is used as a network back end. Unsuccessful attacks can result in denial-of-service (DoS) conditions.",
    "technicalDescription": "Slirp is used as network back end to put packets onto the host's network in QEMU. The fragmented network packets coming from guests are reassambled  by `static struct ip *ip_reass(Slirp *slirp, struct ip *ip, struct ipq *fp)` function in `libslirp/src/ip_input.c`. During the reassembly, when a fragment of IP data does not fit into the preallocated buffer, an external buffer, `m_ext`, is utilized and the pointer for the IP data, `q`, is updated with the external buffer's address. However, due to a missing check whether the pointer `q` is updated or not, it is recalculated. Later, `q` is converted into IP data structure and its values are modified as they were sent by the guest. This issue can be exploited to write arbitrary data on the calculated location, beyond the allocated buffer, of the memory by sending crafted network packages from a guest. It enables an attacker to run arbitrary commands or perform a denial-of-service attack if `q` points to an unmapped address. The impact of an attack depends on the privileges of the QEMU process, if it is admin/root than complete loss of confidentiality, integrity and availability is possible.",
    "publishedDate": "2019-08-01T15:40:07.428Z",
    "updatedDate": "2019-12-23T11:57:40.770Z",
    "disclosureDate": "2019-08-01T00:00:00.000Z",
    "exploitPublishDate": "2019-08-24T00:00:00.000Z",
    "solution": "Fixed in QEMU **[4.1.0 RC4](https://github.com/qemu/qemu/releases/tag/v4.1.0-rc4)** by [this](https://github.com/qemu/qemu/commit/e1a4a24d26) commit.\n\nFixed in libslirp **[4.1.0](https://gitlab.freedesktop.org/slirp/libslirp/-/tags/v4.1.0)** by [this](https://gitlab.freedesktop.org/slirp/libslirp/commit/126c04acbabd7ad32c2b018fe10dfac2a3bc1210) commit.",
    "severity": "CRITICAL",
    "cvss2": {
        "baseScore": 10.0,
        "impactSubscore": 10.0,
        "exploitabilitySubscore": 10.0,
        "severity": "HIGH",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "COMPLETE",
        "integrityImpact": "COMPLETE",
        "availabilityImpact": "COMPLETE",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 8.3
        },
        "vector": "(AV:N/AC:L/Au:N/C:C/I:C/A:C/E:F/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 10.0,
        "impactSubscore": 6.0,
        "exploitabilitySubscore": 3.9,
        "severity": "CRITICAL",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "CHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 9.3
        },
        "vector": "CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H/E:F/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Prasad J Pandit",
    "workaround": "",
    "vendorFixDate": "2019-07-28T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 9.3,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-2398",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-122"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-14378",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-2398/ranges"
            },
            {
                "rel": "reference",
                "href": "https://blog.bi0s.in/2019/08/24/Pwn/VM-Escape/2019-07-29-qemu-vm-escape-cve-2019-14378/",
                "label": "EXPLOIT"
            },
            {
                "rel": "reference",
                "href": "https://bugzilla.redhat.com/show_bug.cgi?id=1734745",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/qemu/qemu/commit/e1a4a24d26",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/qemu/qemu/releases/tag/v4.1.0-rc4",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/vishnudevtj/exploits/tree/master/qemu/CVE-2019-14378",
                "label": "EXPLOIT"
            },
            {
                "rel": "reference",
                "href": "https://gitlab.freedesktop.org/slirp/libslirp/-/tags/v4.1.0",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://gitlab.freedesktop.org/slirp/libslirp/commit/126c04acbabd7ad32c2b018fe10dfac2a3bc1210",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://www.openwall.com/lists/oss-security/2019/08/01/2",
                "label": "ADVISORY"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-2398/default-remediation-status"
            }
        ]
    }
}