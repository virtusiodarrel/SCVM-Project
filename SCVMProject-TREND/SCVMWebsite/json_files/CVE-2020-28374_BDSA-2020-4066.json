{
    "source": "BDSA",
    "name": "BDSA-2020-4066",
    "title": "Linux Kernel Vulnerable to Unauthorized Reads and Writes via Insufficient Identifier Checking",
    "description": "Insufficient identifier checking in the LIO SCSI target code in the Linux Kernel can be used by remote attackers to read or write files via directory traversal in an `XCOPY` request. \n\nAttackers can exploit this vulnerability over a network provided they have access to one iSCSI LUN. The attacker can control file access because I/O operations are proxied via an attacker-selected backstore. \n\nThis vulnerability only affects systems with:\n\n* Linux Kernel **3.12-rc1** and later\n* LIO SCSI target (`target_core_mod`) loaded\n* At least two configured backstores\n* One backstore must be exposed via a SCSI transport with ACL settings which permit access to a potential attacker\n* Backstores must allow and use in-kernel LIO XCOPY command emulation",
    "technicalDescription": "This issue occurs due to how LIO (Linux SCSI Target) behaves when processing XCOPY copy-source/copy-destination descriptors. When trying to match CSCD descriptors with corresponding `se_devices`, `target_xcopy_locate_se_dev_e4()` iterates over LIO's global devices list which includes all configured backstores rather than being restricted to backstores which are exposed to the initiator via transport layer access control settings. \n\nIn addition when LIO is configured to forward SCSI requests to the user-space tcmu-runner daemon, the daemon's `xcopy_locate_udev()` function will iterate over all tcmu-runner devices without considering transport layer restrictions. \n\nSCSI \"Extended Copy\" (XCOPY) requests sent to a LIO allow an attacker to read or write anywhere on any LIO backstore configured on the host as long as the attacker has access to one LUN and knowledge of the victim backstore's `vpd_unit_serial` (aka \"wwn\"). This is possible regardless of the transport/HBA settings for the victim backstore. \n\n* In a multi-tenant vhost-scsi environment this can allow guests to read or write to images assigned to other Qemu processes.  \n* For iSCSI this allows CHAP, ACL and network portal isolation bypass. \n* Backstores with no corresponding transport LUN mapping remain vulnerable.\n* All other LIO transports and backstores which allow for XCOPY processing by LIO's `target_core_xcopy` handler should be considered vulnerable. \n* tcmu-runner based user backstores are also vulnerable via a similar bug.",
    "publishedDate": "2021-01-13T12:59:57.787Z",
    "updatedDate": "2021-01-27T15:50:17.725Z",
    "disclosureDate": "2021-01-12T00:00:00.000Z",
    "solution": "Fixed in Linux Kernel:\n* [**4.14.215**](https://www.kernel.org) by [this](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=c842ead67ae3cac58e84e7880153e68cccd59773) commit\n* [**4.19.167**](https://www.kernel.org) by [this](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=fff1180d24e68d697f98642d71444316036a81ff) commit\n* [**5.4.89**](https://www.kernel.org) by [this](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=485e21729b1e1235e6075318225c09e76b376e81) commit\n* [**5.10.7**](https://www.kernel.org) by [this](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=6f1e88527c1869de08632efa2cc796e0131850dc) commit",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 5.1,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 4.9,
        "severity": "LOW",
        "accessVector": "NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 3.8
        },
        "vector": "(AV:N/AC:H/Au:N/C:P/I:P/A:P/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.1,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 2.2,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.1
        },
        "vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "David Disseldorp",
    "workaround": "Support for `XCOPY` is enabled by default but can be disabled via either:\n\n`echo 0 > /sys/kernel/config/target/core/<backstore>/<name>/attrib/emulate_3pc` or\n\n` targetcli /backstores/<backstore>/<name> set attribute emulate_3pc=0`\n\nwhere `backstore` and `name` should be set appropriately\n\nIt should be noted that this workaround doesn't affect `XCOPY ` requests sent to tcmu-runner based backstores. It's only suitable for disabling kernel (`target_core_xcopy`) support for `XCOPY` requests. \n\nThe workaround requires a kernel version **3.12-rc7** or later.",
    "vendorFixDate": "2021-01-12T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 7.1,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-4066",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-264"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2020-28374",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-4066/ranges"
            },
            {
                "rel": "reference",
                "href": "https://bugzilla.suse.com/attachment.cgi?id=844938",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://bugzilla.suse.com/attachment.cgi?id=844938",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://bugzilla.suse.com/show_bug.cgi?id=1178372",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://cdn.kernel.org/pub/linux/kernel/v5.x/ChangeLog-5.10.7",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=485e21729b1e1235e6075318225c09e76b376e81",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=6f1e88527c1869de08632efa2cc796e0131850dc",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=c842ead67ae3cac58e84e7880153e68cccd59773",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=fff1180d24e68d697f98642d71444316036a81ff",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cbf031f425fd0b30ff10ba83b612753189a6bbbf",
                "label": "INTRODUCTORY_COMMIT"
            },
            {
                "rel": "reference",
                "href": "https://www.kernel.org",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2020-4066/default-remediation-status"
            }
        ]
    }
}