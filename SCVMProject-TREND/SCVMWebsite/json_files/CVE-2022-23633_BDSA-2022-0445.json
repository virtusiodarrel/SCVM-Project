{
    "source": "BDSA",
    "name": "BDSA-2022-0445",
    "title": "Ruby on Rails Action Pack Vulnerable to Information Disclosure via Failure to Close Response Bodies",
    "description": "The Action Pack functionality in Ruby on Rails is vulnerable to an information disclosure issue due to how, under certain circumstances, response bodies will not be closed. Such circumstances could include a bug in a webserver or Rack middleware.\n\n**Note**: The vendor has referred to **CVE-2022-23634** (**BDSA-2022-0460**) as an example of a potential bug in a webserver. See the [Puma security advisory](https://github.com/puma/puma/security/advisories/GHSA-rmj8-8hhh-gv5h) for more details on this issue.",
    "technicalDescription": "The Action Pack functionality in Ruby on Rails is vulnerable to information disclosure because `ActionDispatch::Executor` does not reset the thread local state for other requests when a response is not notified of a `close`. This can lead to data being leaked to subsequent requests, especially when interacting with `ActiveSupport::CurrentAttributes`.",
    "publishedDate": "2022-02-14T16:50:58.069Z",
    "updatedDate": "2022-04-18T10:22:54.852Z",
    "disclosureDate": "2022-02-11T00:00:00.000Z",
    "solution": "Fixed in:\n* [**7.0.2.2**](https://github.com/rails/rails/releases/tag/v7.0.2.2) by [this](https://github.com/rails/rails/commit/3c0420c431954d05fef2015a27281069e68cce0c) commit and [this](https://github.com/rails/rails/commit/1b5aadc0182adcb4dc10b42de88a1ad3e870abe7) commit,\n* [**6.1.4.6**](https://github.com/rails/rails/releases/tag/v6.1.4.6) by [this](https://github.com/rails/rails/commit/07d9600172a18b45791c89e95a642e13fc367545) commit and [this](https://github.com/rails/rails/commit/d1267768e9f57ebcf86ff7f011aca7fb08e733eb) commit,\n* [**6.0.4.6**](https://github.com/rails/rails/releases/tag/v6.0.4.6) by [this](https://github.com/rails/rails/commit/e9015f91dd685472f915f8aa1eb18b0e0763e013) commit and [this](https://github.com/rails/rails/commit/f85b396e5a0019eb614e4ee436ea713089696833) commit,\n* [**5.2.6.2**](https://github.com/rails/rails/releases/tag/v5.2.6.2) by [this](https://github.com/rails/rails/commit/ddaf5058350b3a72f59b7c3e0d713678354b9a08) commit and [this](https://github.com/rails/rails/commit/676ad96fa5d9d0213babc32c9bad8190597a00d1) commit.\n\nThe latest stable releases of Rails are available [here](https://github.com/rails/rails/releases).\n\nThe latest stable releases of Action Pack are available [here](https://rubygems.org/gems/actionpack)",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 2.6,
        "impactSubscore": 2.9,
        "exploitabilitySubscore": 4.9,
        "severity": "LOW",
        "accessVector": "NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "NONE",
        "availabilityImpact": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 1.9
        },
        "vector": "(AV:N/AC:H/Au:N/C:P/I:N/A:N/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 5.9,
        "impactSubscore": 3.6,
        "exploitabilitySubscore": 2.2,
        "severity": "MEDIUM",
        "attackVector": "NETWORK",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "NONE",
        "availabilityImpact": "NONE",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.2
        },
        "vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:N/A:N/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Jean Boussier",
    "workaround": "For users who are not able to upgrade, the vendor has made patches available for the two supported release series [here](https://discuss.rubyonrails.org/t/cve-2022-23633-possible-exposure-of-information-vulnerability-in-action-pack/80016).\n\nThe vendor has also suggested that while upgrading is highly recommended, users can choose to work around this problem by using the following middleware:\n\n```\nclass GuardedExecutor < ActionDispatch::Executor\n  def call(env)\n    ensure_completed!\n    super\n  end\n\n  private\n\n    def ensure_completed!\n      @executor.new.complete! if @executor.active?\n    end\nend\n\n# Ensure the guard is inserted before ActionDispatch::Executor\nRails.application.configure do\n  config.middleware.swap ActionDispatch::Executor, GuardedExecutor, executor\nend\n```",
    "vendorFixDate": "2022-02-11T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 5.2,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-0445",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-200"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2022-23633",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-0445/ranges"
            },
            {
                "rel": "reference",
                "href": "https://discuss.rubyonrails.org/t/cve-2022-23633-possible-exposure-of-information-vulnerability-in-action-pack/80016",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://discuss.rubyonrails.org/t/cve-2022-23633-possible-exposure-of-information-vulnerability-in-action-pack/80016",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://discuss.rubyonrails.org/t/cve-2022-23633-possible-exposure-of-information-vulnerability-in-action-pack/80016",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://github.com/advisories/GHSA-wh98-p28r-vrc9",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/puma/puma/security/advisories/GHSA-rmj8-8hhh-gv5h",
                "label": "LINK"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rails/rails/commit/07d9600172a18b45791c89e95a642e13fc367545",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rails/rails/commit/1b5aadc0182adcb4dc10b42de88a1ad3e870abe7",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rails/rails/commit/3c0420c431954d05fef2015a27281069e68cce0c",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rails/rails/commit/676ad96fa5d9d0213babc32c9bad8190597a00d1",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rails/rails/commit/d1267768e9f57ebcf86ff7f011aca7fb08e733eb",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rails/rails/commit/ddaf5058350b3a72f59b7c3e0d713678354b9a08",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rails/rails/commit/e9015f91dd685472f915f8aa1eb18b0e0763e013",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rails/rails/commit/f85b396e5a0019eb614e4ee436ea713089696833",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rails/rails/releases",
                "label": "LINK"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rails/rails/releases/tag/v5.2.6.2",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rails/rails/releases/tag/v6.0.4.6",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rails/rails/releases/tag/v6.1.4.6",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rails/rails/releases/tag/v7.0.2.2",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/rails/rails/security/advisories/GHSA-wh98-p28r-vrc9",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://rubygems.org/gems/actionpack",
                "label": "LINK"
            },
            {
                "rel": "reference",
                "href": "https://rubyonrails.org/2022/2/11/Rails-7-0-2-2-6-1-4-6-6-0-4-6-and-5-2-6-2-have-been-released",
                "label": "ADVISORY"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-0445/default-remediation-status"
            }
        ]
    }
}