{
    "source": "BDSA",
    "name": "BDSA-2021-0099",
    "title": "Dnsmasq Vulnerable to DNS Cache Poisoning via 'Birthday Attack' Flaw with Multiple DNS Query Requests",
    "description": "Dnsmasq is vulnerable to DNS cache poisoning due to how there are insufficient checks for existing, pending requests before forwarding a new request.\n\nUsing this flaw, an attacker could perform a 'Birthday Attack' in order to spoof DNS traffic and lead to cache poisoning.",
    "technicalDescription": "Dnsmasq is vulnerable to DNS cache poisoning because new requests can be forwarded despite how an existing pending request for the same resource name (`RRNAME`) may already exist. Dnsmasq does not check for the existing request meaning multiple DNS query requests for the same `RRNAME` can be created leaving Dnsmasq susceptible to 'Birthday Attacks'.\n\nThe 'Birthday Attack' relies upon there being multiple DNS query requests for the same `RRNAME`. With a large number of these requests, an attacker has a higher chance of performing a successful 'Birthday Attack' through submitting a malicious packet.",
    "publishedDate": "2021-01-20T14:22:13.639Z",
    "updatedDate": "2021-01-29T12:40:58.935Z",
    "disclosureDate": "2021-01-19T00:00:00.000Z",
    "exploitPublishDate": "2021-01-19T00:00:00.000Z",
    "solution": "Fixed in [**2.83**](http://thekelleys.org.uk/gitweb/?p=dnsmasq.git;a=tag;h=47b4f0e37558e7a947bbf1c5c41e6bc87f1c9ebb) by [this](http://thekelleys.org.uk/gitweb/?p=dnsmasq.git;a=commit;h=15b60ddf935a531269bb8c68198de012a4967156) commit and [this](http://thekelleys.org.uk/gitweb/?p=dnsmasq.git;a=commit;h=6a6e06fbb0d4690507ceaf2bb6f0d8910f3d4914) commit.\n\nThe latest stable releases are available [here](http://thekelleys.org.uk/gitweb/?p=dnsmasq.git;a=tags).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 4.0,
        "impactSubscore": 4.9,
        "exploitabilitySubscore": 4.9,
        "severity": "LOW",
        "accessVector": "NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 3.2
        },
        "vector": "(AV:N/AC:H/Au:N/C:P/I:P/A:N/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.7,
        "impactSubscore": 5.8,
        "exploitabilitySubscore": 2.2,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "NONE",
        "privilegesRequired": "NONE",
        "scope": "CHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.8
        },
        "vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:N/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Moshe Kol and Shlomi Oberman",
    "workaround": "Third-party mitigations have been proposed [here](https://www.jsof-tech.com/wp-content/uploads/2021/01/DNSpooq_Technical-Whitepaper.pdf):\n\n\u2022 Configure dnsmasq not to listen on WAN interfaces if unnecessary in your environment.\n\u2022 Reduce the maximum queries allowed to be forwarded with the option `--dns-forward-max=<queries>`. The default is 150, but it could be lowered.\n\u2022 Temporarily disable `DNSSEC` validation option until you get a patch.\n\u2022 Use protocols that provide transport security for DNS (such as DoT or DoH). This will mitigate Dnspooq but may have other security and privacy implications. Consider your own setup, security goals, and risks before doing this.\n\u2022 Reducing the maximum size of EDNS messages will likely mitigate some of the vulnerabilities. This, however, has not been tested and is against the recommendation of the relevant RFC5625.",
    "vendorFixDate": "2020-12-16T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 7.8,
    "_meta": {
        "allow": [],
        "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/BDSA-2021-0099",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro.app.blackduck.com/api/cwes/CWE-20"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/CVE-2020-25686",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/BDSA-2021-0099/ranges"
            },
            {
                "rel": "reference",
                "href": "http://lists.thekelleys.org.uk/pipermail/dnsmasq-discuss/2021q1/014599.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "http://thekelleys.org.uk/gitweb/?p=dnsmasq.git;a=commit;h=15b60ddf935a531269bb8c68198de012a4967156",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "http://thekelleys.org.uk/gitweb/?p=dnsmasq.git;a=commit;h=6a6e06fbb0d4690507ceaf2bb6f0d8910f3d4914",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "http://thekelleys.org.uk/gitweb/?p=dnsmasq.git;a=tag;h=47b4f0e37558e7a947bbf1c5c41e6bc87f1c9ebb",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "http://thekelleys.org.uk/gitweb/?p=dnsmasq.git;a=tags",
                "label": "LINK"
            },
            {
                "rel": "reference",
                "href": "https://www.jsof-tech.com/disclosures/dnspooq/",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.jsof-tech.com/wp-content/uploads/2021/01/DNSpooq_Technical-Whitepaper.pdf",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.jsof-tech.com/wp-content/uploads/2021/01/DNSpooq_Technical-Whitepaper.pdf",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://www.jsof-tech.com/wp-content/uploads/2021/01/DNSpooq_Technical-Whitepaper.pdf",
                "label": "WORKAROUND"
            }
        ]
    }
}