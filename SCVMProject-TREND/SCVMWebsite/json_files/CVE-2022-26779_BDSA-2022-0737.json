{
    "source": "BDSA",
    "name": "BDSA-2022-0737",
    "title": "Apache Cloudstack Vulnerable to Privilege Escalation via Predictable Seed in Pseudo-Random Number Generator (PRNG)",
    "description": "Apache Cloudstack contains a privilege escalation vulnerability due to a predictable seed used in a Pseudo-Random Number Generator (PRNG). If a user or account is invited to a project via an email, an attacker is able to compute the value of the secret invite token, and accept the project invitation even if they were never sent it.",
    "technicalDescription": "This vulnerability exists in the `generateToken()` method of `server/src/main/java/com/cloud/projects/ProjectManagerImpl.java` in Apache Cloudstack. When a user or account is invited to a project via an email, then the methods `ProjectManagerImpl.inviteAccountToProject` or `ProjectManagerImpl.inviteUserToProject` will be invoked and a secret invite token emailed to the invitee. However, the `generateToken()` method uses the value of `10` and `System.currentTimeMillis()` as the seed for the random number generator, meaning that if an attacker knows the time an invite was generated to invite another user, they will be able to compute the value of the secret invite token. This will allow the attacker to leverage an invite to a project that they were never sent, letting them elevate their privileges. \n\nThe vendor has fixed this by replacing `rand.nextInt` with `secureRandom.nextInt` in order to ensure an attacker cannot compute the secret invite token.",
    "publishedDate": "2022-03-17T17:00:46.256Z",
    "updatedDate": "2022-08-15T14:26:16.770Z",
    "disclosureDate": "2022-03-10T00:00:00.000Z",
    "exploitPublishDate": "2022-03-10T00:00:00.000Z",
    "solution": "Fixed in [**4.16.1.0**](https://github.com/apache/cloudstack/releases/tag/4.16.1.0) by [this](https://github.com/apache/cloudstack/commit/3fc4ef478d03cd20169d5a3dcdef6233724446be) commit.\n\nThe latest stable releases are available [here](https://cloudstack.apache.org/downloads.html).",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 3.6,
        "impactSubscore": 4.9,
        "exploitabilitySubscore": 3.9,
        "severity": "LOW",
        "accessVector": "NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "SINGLE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 2.8
        },
        "vector": "(AV:N/AC:H/Au:S/C:P/I:P/A:N/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 6.8,
        "impactSubscore": 5.2,
        "exploitabilitySubscore": 1.6,
        "severity": "MEDIUM",
        "attackVector": "NETWORK",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "NONE",
        "privilegesRequired": "LOW",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 6.1
        },
        "vector": "CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:N/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "JLLeitschuh (Jonathan Leitschuh)",
    "workaround": "The following [workaround](https://github.com/JLLeitschuh/security-research/security/advisories/GHSA-vpcc-9rh2-8jfp) has been provided\"\n\n\"When executing the `addAccountToProject` API call, don't invite by email. Only invite by existing account or user.\"",
    "vendorFixDate": "2022-02-09T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 6.1,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-0737",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-330"
            },
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-338"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2022-26779",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-0737/ranges"
            },
            {
                "rel": "reference",
                "href": "https://cloudstack.apache.org/downloads.html",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/JLLeitschuh/security-research/security/advisories/GHSA-vpcc-9rh2-8jfp",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/JLLeitschuh/security-research/security/advisories/GHSA-vpcc-9rh2-8jfp",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://github.com/JLLeitschuh/security-research/security/advisories/GHSA-vpcc-9rh2-8jfp",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/cloudstack/commit/3fc4ef478d03cd20169d5a3dcdef6233724446be",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/cloudstack/commit/a17570ef51b3c4de6cced915f0a9286983296192",
                "label": "INTRODUCTORY_COMMIT"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/cloudstack/releases/tag/4.16.1.0",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-0737/default-remediation-status"
            }
        ]
    }
}