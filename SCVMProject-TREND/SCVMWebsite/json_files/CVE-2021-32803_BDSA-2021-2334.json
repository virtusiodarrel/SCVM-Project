{
    "source": "BDSA",
    "name": "BDSA-2021-2334",
    "title": "node-tar Vulnerable to Arbitrary File Creation/Overwrite via Insufficient Symlink Protection due to Directory Cache Poisoning",
    "description": "The node-tar package is vulnerable to arbitrary file creation/overwrite issues due to a flaw in the symlink protection measures that allows for an untrusted tar file to symlink into an arbitrary location.\n\nAn attacker could poison the directory cache by first creating a directory and replacing it with a symlink with the same name. This allows the attacker to bypass symlink checks on directories and enable them to extract arbitrary files into potentially sensitive locations. The attacker could use this flaw to overwrite files to enable arbitrary code execution attacks.",
    "technicalDescription": "The node-tar package is vulnerable to arbitrary file creation/overwrites because the symlink protection logic mishandles cases where a tar file contains both a directory and a symlink with the same name. Firstly, the directory is created and added to the node-tar directory cache where then subsequent calls to `mkdir` for this directory are skipped. This causes a problem as this is where the symlink checks are performed. \n\nIf an attacker can replace the directory with a symlink after it has been added to the cache, they can bypass the symlink checks on directories and potentially extract arbitrary files to the affected location.",
    "publishedDate": "2021-08-06T09:07:25.819Z",
    "updatedDate": "2022-08-03T09:24:47.407Z",
    "disclosureDate": "2021-08-03T00:00:00.000Z",
    "solution": "Fixed in:\n* [**3.2.3**](https://github.com/npm/node-tar/releases/tag/v3.2.3) by [this](https://github.com/npm/node-tar/commit/85d3a942b4064e4ff171f91696fced7975167349) commit,\n* [**4.4.15**](https://github.com/npm/node-tar/releases/tag/v4.4.15) by [this](https://github.com/npm/node-tar/commit/46fe35083e2676e31c4e0a81639dce6da7aaa356) commit, \n* [**5.0.7**](https://github.com/npm/node-tar/releases/tag/v5.0.7) by [this](https://github.com/npm/node-tar/commit/5987d9a41f6bfbf1ddab1098e1fdcf1a5618f571) commit, \n* [**6.1.2**](https://github.com/npm/node-tar/releases/tag/v6.1.2) by [this](https://github.com/npm/node-tar/commit/9dbdeb6df8e9dbd96fa9e84341b9d74734be6c20) commit.\n\nThe latest stable releases are available [here](https://github.com/npm/node-tar/releases).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 5.1,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 4.9,
        "severity": "LOW",
        "accessVector": "NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 3.8
        },
        "vector": "(AV:N/AC:H/Au:N/C:P/I:P/A:P/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 9.0,
        "impactSubscore": 6.0,
        "exploitabilitySubscore": 2.2,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "CHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.8
        },
        "vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:H/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "ginkoid, chen-robert",
    "workaround": "It is suggested on [npmjs.com](https://www.npmjs.com/advisories/1771#workarounds) that it is possible to mitigate the vulnerability by creating a custom `onentry` method which sanitizes the `entry.path` or a `filter` method which removes entries with absolute paths.",
    "vendorFixDate": "2021-06-23T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 7.8,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2334",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-20"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-32803",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2334/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/commit/46fe35083e2676e31c4e0a81639dce6da7aaa356",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/commit/5987d9a41f6bfbf1ddab1098e1fdcf1a5618f571",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/commit/85d3a942b4064e4ff171f91696fced7975167349",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/commit/9dbdeb6df8e9dbd96fa9e84341b9d74734be6c20",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/releases",
                "label": "LINK"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/releases/tag/v3.2.3",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/releases/tag/v4.4.15",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/releases/tag/v5.0.7",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/releases/tag/v6.1.2",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/npm/node-tar/security/advisories/GHSA-r628-mhmh-qjhw",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.npmjs.com/advisories/1771",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.npmjs.com/advisories/1771#workarounds",
                "label": "WORKAROUND"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2334/default-remediation-status"
            }
        ]
    }
}