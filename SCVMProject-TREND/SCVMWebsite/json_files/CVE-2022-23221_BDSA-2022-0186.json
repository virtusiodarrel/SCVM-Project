{
    "source": "BDSA",
    "name": "BDSA-2022-0186",
    "title": "H2 Database Vulnerable to Remote Code Execution (RCE) via Arbitrary Class Loading Through JNDI",
    "description": "H2 Console (a component of H2 Database) is vulnerable to remote code execution (RCE) due to allowing custom classes to be loaded from remote servers through JNDI (Java Naming and Directory Interface). This can only be exploited if H2 Console has remote access configured and no protection methods are set.\n\n**Note**: This is a different vulnerability than **CVE-2021-42392** (**BDSA-2022-0048**).",
    "technicalDescription": "The RCE is possible via a `jdbc:h2:mem` `JDBC` URL containing the `IGNORE_UNKNOWN_SETTINGS=TRUE;FORBID_CREATION=FALSE;INIT=RUNSCRIPT` substring. It is also possible to load classes remotely by creating a linked table, but it requires `ADMIN` privileges which already gives full access to the Java process by design.\n\nThe vulnerability was fixed in the `getConnection()` method in the `h2/src/main/org/h2/util/JdbcUtils.java` file by only allowing JNDI lookup URL schemes to start with `java:`.",
    "publishedDate": "2022-01-20T13:19:20.575Z",
    "updatedDate": "2022-02-04T15:31:02.573Z",
    "disclosureDate": "2022-01-05T00:00:00.000Z",
    "exploitPublishDate": "2022-01-19T00:00:00.000Z",
    "solution": "Fixed in [**2.0.206**](https://github.com/h2database/h2database/releases/tag/version-2.0.206) by [this](https://github.com/h2database/h2database/commit/b24aa46f48904ce64443f8f4353d70a2eed09037) commit and [this](https://github.com/h2database/h2database/commit/4a2e677bfb6bfee59bff1ce1dfb6f28ce5109d8c) commit.\n\nThe latest stable releases are available [here](http://www.h2database.com/html/download.html).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 5.1,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 4.9,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.0
        },
        "vector": "(AV:N/AC:H/Au:N/C:P/I:P/A:P/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.1,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 2.2,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.3
        },
        "vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "JFrog Security",
    "workaround": "The vendor suggests not giving H2 Console access to untrusted users and avoiding `-webAllowOthers` setting.\n\nH2 Console Servlet deployed on a web server can also be protected with a [security constraint](https://h2database.com/html/tutorial.html#usingH2ConsoleServlet). If `webAllowOthers` is specified, you need to uncomment and edit `<security-role>` and `<security-constraint>` as necessary. See documentation of your web server for more details.",
    "vendorFixDate": "2022-01-04T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 7.3,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-0186",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-95"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2022-23221",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-0186/ranges"
            },
            {
                "rel": "reference",
                "href": "http://www.h2database.com/html/download.html",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/h2database/h2database/commit/4a2e677bfb6bfee59bff1ce1dfb6f28ce5109d8c",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/h2database/h2database/commit/b24aa46f48904ce64443f8f4353d70a2eed09037",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/h2database/h2database/releases/tag/version-2.0.206",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/h2database/h2database/security/advisories/GHSA-h376-j262-vhq6",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/h2database/h2database/security/advisories/GHSA-h376-j262-vhq6",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://h2database.com/html/tutorial.html#usingH2ConsoleServlet",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://twitter.com/d0nkey_man/status/1483824727936450564",
                "label": "POC"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-0186/default-remediation-status"
            }
        ]
    }
}