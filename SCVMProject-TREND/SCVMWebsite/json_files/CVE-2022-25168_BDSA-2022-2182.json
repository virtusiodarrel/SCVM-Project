{
    "source": "BDSA",
    "name": "BDSA-2022-2182",
    "title": "Apache Hadoop Vulnerable to Command Injection via Improper Filename Sanitization in 'FileUtil.unTar'",
    "description": "Apache Hadoop's file unpacking utility does not escape the input file name before being passed to the shell. In Hadoop **3.3**, a local user could abuse this flaw to inject arbitrary commands. Hadoop **2.x** is also vulnerable to remote code execution (RCE) due to the utility being used for yarn localization.",
    "technicalDescription": "The vulnerable method is `unTar` of `FileUtil` class in `hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/FileUtil.java`. The method works by calling `unTarUsingTar` which attempts to sanitize the file path before it is used in a `gzip` unpacking command. The issue is that the sanitization of the input filename is constructed so that the file path is evaluated first before being used in the sanitized bash command. This allows filename manipulations to be used in order to inject OS commands.",
    "publishedDate": "2022-08-05T11:38:35.415Z",
    "updatedDate": "2022-09-30T13:14:33.959Z",
    "disclosureDate": "2022-08-04T00:00:00.000Z",
    "solution": "Fixed in:\n* **[2.10.2](https://github.com/apache/hadoop/releases/tag/rel/release-2.10.2)** by [this](https://github.com/apache/hadoop/commit/4313bec40a9) commit,\n* **[3.2.4](https://github.com/apache/hadoop/releases/tag/rel/release-3.2.4)** by [this](https://github.com/apache/hadoop/commit/a8512d66271) commit,\n* **[3.3.3](https://github.com/apache/hadoop/releases/tag/rel/release-3.3.3)** by [this](https://github.com/apache/hadoop/commit/7f33a4e9920) commit.\n\nThe latest stable releases can be found [here](https://hadoop.apache.org/releases.html).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 6.5,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 8.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "SINGLE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.8
        },
        "vector": "(AV:N/AC:L/Au:S/C:P/I:P/A:P/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.8,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 2.8,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "LOW",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.7
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": true,
    "parentAdvisory": false,
    "credit": "Kostya Kortchinsky",
    "workaround": "",
    "vendorFixDate": "2022-02-21T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 7.7,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-2182",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-78"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2022-25168",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-2182/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/hadoop/commit/4313bec40a9",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/hadoop/commit/7f33a4e9920",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/hadoop/commit/a8512d66271",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/hadoop/releases/tag/rel/release-2.10.2",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/hadoop/releases/tag/rel/release-3.2.4",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/hadoop/releases/tag/rel/release-3.3.3",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://hadoop.apache.org/releases.html",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://lists.apache.org/thread/mxqnb39jfrwgs3j6phwvlrfq4mlox130",
                "label": "ADVISORY"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2022-2182/default-remediation-status"
            }
        ]
    }
}