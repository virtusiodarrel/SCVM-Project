{
    "source": "BDSA",
    "name": "BDSA-2019-0865",
    "title": "Moodle Vulnerable to Information Disclosure via 'Referer' Header in Assignment Submission Comments",
    "description": "Moodle is vulnerable to information disclosure due to to incorrect handling of links within assignment submission comments. An attacker could leverage this flaw by submitting a comment with a link to a site that is under their control and tricking a victim into clicking on it. The malicious site will then be able to access potentially sensitive information contained in the URL of the Moodle page where the link was clicked.",
    "technicalDescription": "This flaw lies in several classes associated with parsing of user comments in `external.php`, `lib.php`, and `locallib.php`. Current implementation relies on the functionality provided by `TargetNoreferrer.php` to add a `rel=\"noreferrer\"` attribute to any link which targets a different window. The problem is that this security mechanism will not be triggered if the link opens in the same window (which is what actually happens). If `rel=\"noreferrer\"` is not applied then the page the link points to will have access to the `Referer` header which may contain sensitive data about the Moodle page.\n\nThe issue has been fixed by adding the `blanktarget` option to the parsing process which will add the `target=\"_blank\"` attribute to any `<a>` tags. This makes the links open in a new window or tab instead of the same page, triggering the `TargetNoreferrer.php` functionality. This in turn will add the `rel=\"noreferrer\"` attribute to the request, stopping the `Referer` header from being sent.",
    "publishedDate": "2019-03-29T16:01:26.426Z",
    "updatedDate": "2019-03-29T16:01:26.411Z",
    "disclosureDate": "2019-03-19T00:00:00.000Z",
    "solution": "Fixed in:\n* [**3.1.17**](https://download.moodle.org/) by [this](http://git.moodle.org/gw?p=moodle.git;a=commit;h=772c908d40a944efd91d897d524b255626d330d4) commit,\n* [**3.4.8**](https://download.moodle.org/) by [this](http://git.moodle.org/gw?p=moodle.git;a=commit;h=907b377e51c32ea37feef53e10684b504e103273) commit,\n* [**3.5.5**](https://download.moodle.org/) by [this](http://git.moodle.org/gw?p=moodle.git;a=commit;h=d3f2f990dd3c5d4e6073a77154c6423d1c304647) commit, and\n* [**3.6.3**](https://download.moodle.org/) by [this](http://git.moodle.org/gw?p=moodle.git;a=commit;h=1fc481dd7b09e08e85824c1fe6733b303a36bdce) commit.",
    "severity": "LOW",
    "cvss2": {
        "baseScore": 3.5,
        "impactSubscore": 2.9,
        "exploitabilitySubscore": 6.8,
        "severity": "LOW",
        "accessVector": "NETWORK",
        "accessComplexity": "MEDIUM",
        "authentication": "SINGLE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "NONE",
        "availabilityImpact": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 2.6
        },
        "vector": "(AV:N/AC:M/Au:S/C:P/I:N/A:N/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 3.5,
        "impactSubscore": 1.4,
        "exploitabilitySubscore": 2.1,
        "severity": "LOW",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "LOW",
        "integrityImpact": "NONE",
        "availabilityImpact": "NONE",
        "privilegesRequired": "LOW",
        "scope": "UNCHANGED",
        "userInteraction": "REQUIRED",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 3.1
        },
        "vector": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:U/C:L/I:N/A:N/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Steeven George",
    "workaround": "",
    "vendorFixDate": "2019-03-05T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 3.1,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0865",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-200"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-3850",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0865/ranges"
            },
            {
                "rel": "reference",
                "href": "http://git.moodle.org/gw?p=moodle.git;a=commit;h=1fc481dd7b09e08e85824c1fe6733b303a36bdce",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "http://git.moodle.org/gw?p=moodle.git;a=commit;h=772c908d40a944efd91d897d524b255626d330d4",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "http://git.moodle.org/gw?p=moodle.git;a=commit;h=907b377e51c32ea37feef53e10684b504e103273",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "http://git.moodle.org/gw?p=moodle.git;a=commit;h=d3f2f990dd3c5d4e6073a77154c6423d1c304647",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://developer.mozilla.org/en-US/docs/Web/Security/Referer_header:_privacy_and_security_concerns",
                "label": "LINK"
            },
            {
                "rel": "reference",
                "href": "https://download.moodle.org/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://moodle.org/mod/forum/discuss.php?d=384013#p1547745",
                "label": "ADVISORY"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-0865/default-remediation-status"
            }
        ]
    }
}