{
    "source": "BDSA",
    "name": "BDSA-2019-1089",
    "title": "Xen Vulnerable to Privilege Escalation via PV Kernel Context Switch Corruption",
    "description": "Xen is vulnerable to privilege escalation due to a failure to communicate a change of a virtualized control register's control bit to the hardware. 64bit PV guests appear to set and clear a certain flag used for decisions during context switching while not actually unsetting the bit in hardware. This is a problem because values of a certain control register are affected by the flag.\n\nThis issue affects hardware that supports the `fsgsbase` feature.",
    "technicalDescription": "When Xen appears to clear the `FSGSBASE` control bit in of a virtualized `%cr4` (control register) the bit erroneously remains set in hardware. This means that associated instructions `{RD,WR} {FS,GS}BASE` can still be used. This is a problem because the `FSGSBASE` feature isn't currently supported in Linux, and its context switch path contains optimizations which rely on userspace not being able to use them.\n\nA userspace process can abuse this flaw and corrupt `fsbase` or `gsbase` in the next thread to be scheduled on the current vcpu. This in turn can be leveraged to escalate privileges and completely compromise the guest's operating system. It is also possible for this bug to be triggered accidentally by the software running on the guest which could result in a crash.",
    "publishedDate": "2019-04-17T11:16:16.105Z",
    "updatedDate": "2019-12-11T09:24:56.210Z",
    "disclosureDate": "2019-03-05T00:00:00.000Z",
    "solution": "Fixed in versions:\n\n* [**4.12.0-rc5**](https://downloads.xenproject.org/release/xen/) by [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=b2dd00574a4fc87ca964177f8e752a968c27efb2) and [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=eccc170053e46b4ab1d9e7485c09e210be15bbd7) commit.\n* [**4.11.2**](https://downloads.xenproject.org/release/xen/) by [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=c567b053e807cc3b55c9d8e8b714dee00a0bf4f4) and [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=4f9ab5f75c120a2cc0b58d651da75e03fc50d9e9) commit.\n* [**4.10.4**](https://downloads.xenproject.org/release/xen/) by [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=d176cd6194b10628a7c3059df72de6a3197554b2) and [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=9f663d2ab1d429a7de1ccda8166d619f90ace6ea) commit.\n\nManual patch files:\n* **xen-unstable** - [patch1](https://xenbits.xen.org/xsa/xsa293/unstable-1.patch), [patch2](https://xenbits.xen.org/xsa/xsa293/unstable-2.patch),\n* xen **4.7.x** - [patch1](https://xenbits.xen.org/xsa/xsa293/4.7-1.patch), [patch2](https://xenbits.xen.org/xsa/xsa293/4.7-2.patch), [patch3](https://xenbits.xen.org/xsa/xsa293/4.7-3.patch),\n* xen **4.8.x** - [patch1](https://xenbits.xen.org/xsa/xsa293/4.8-1.patch), [patch2](https://xenbits.xen.org/xsa/xsa293/4.8-2.patch), [patch3](https://xenbits.xen.org/xsa/xsa293/4.8-3.patch),\n* xen **4.9.x** - [patch1](https://xenbits.xen.org/xsa/xsa293/4.9-1.patch), [patch2](https://xenbits.xen.org/xsa/xsa293/4.9-2.patch),\n* xen **4.10.x** -[patch1](https://xenbits.xen.org/xsa/xsa293/4.10-1.patch), [patch2](https://xenbits.xen.org/xsa/xsa293/4.10-2.patch),\n* xen **4.11.x** - [patch1](https://xenbits.xen.org/xsa/xsa293/4.11-1.patch), [patch2](https://xenbits.xen.org/xsa/xsa293/4.11-2.patch).",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 3.7,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 1.9,
        "severity": "LOW",
        "accessVector": "LOCAL",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 2.7
        },
        "vector": "(AV:L/AC:H/Au:N/C:P/I:P/A:P/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 7.4,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 1.4,
        "severity": "MEDIUM",
        "attackVector": "LOCAL",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 6.4
        },
        "vector": "CVSS:3.0/AV:L/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": true,
    "parentAdvisory": false,
    "credit": "Andy Lutomirski",
    "workaround": "Mitigation instructions from vendor:\n* Running only 32bit PV or HVM/PVH guests will prevent exploitation.",
    "vendorFixDate": "2019-03-05T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 6.4,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-1089",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-755"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-17347",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-1089/ranges"
            },
            {
                "rel": "reference",
                "href": "https://downloads.xenproject.org/release/xen/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=b2dd00574a4fc87ca964177f8e752a968c27efb2",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=eccc170053e46b4ab1d9e7485c09e210be15bbd7",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/xsa/advisory-293.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/xsa/advisory-293.html",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/xsa/xsa293/4.10-1.patch",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/xsa/xsa293/4.10-2.patch",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/xsa/xsa293/4.11-1.patch",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/xsa/xsa293/4.11-2.patch",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/xsa/xsa293/4.7-1.patch",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/xsa/xsa293/4.7-2.patch",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/xsa/xsa293/4.7-3.patch",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/xsa/xsa293/4.8-1.patch",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/xsa/xsa293/4.8-2.patch",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/xsa/xsa293/4.8-3.patch",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/xsa/xsa293/4.9-1.patch",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/xsa/xsa293/4.9-2.patch",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/xsa/xsa293/unstable-1.patch",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/xsa/xsa293/unstable-2.patch",
                "label": "PATCH"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-1089/default-remediation-status"
            }
        ]
    }
}