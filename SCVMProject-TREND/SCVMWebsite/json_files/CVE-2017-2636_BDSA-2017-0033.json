{
    "source": "BDSA",
    "name": "BDSA-2017-0033",
    "title": "Linux Kernel Local Privilege Escalation Flaw in n_hdlc",
    "description": "There is a race condition in the n_hdlc Linux kernel driver that leads to a kernel heap double free.  It can be exploited to gain a local privilege escalation.  This driver provides HDLC serial line discipline and comes as a kernel module in many Linux distributions, which have CONFIG_N_HDLC=m in the kernel config.  Exploiting the flaw does not require the Microgate or SyncLink hardware.  The module can be automatically loaded by an unprivileged user.\n\nThe vulnerability was introduced to the kernel on 22 June 2009.",
    "technicalDescription": "A local attacker can open a pseudoterminal and call TIOCSETD ioctl to set the N_HDLC line discipline.\n\nN_HDLC line discipline uses a self-made singly linked list for data buffers and has`n_hdlc.tbuf` pointer for buffer re-transmitting after an error. If sending of a data buffer is not successful, then its address is saved in `n_hdlc.tbuf` and the next time `n_hdlc_send_frames()` will try to resend it first of all.\n\nThere exist a race condition where  after a transmission error concurrent `flush_tx_queue()` and `n_hdlc_send_frames()` both put a buffer pointed by `n_hdlc.tbuf `to `tx_free_buf_list`. That causes an exploitable double free error in `n_hdlc_release()`.\n\nThis double free can be leveraged by a local attacker to overwrite other kernel data to perform arbitrary code execution in the kernel and to gain increased user privileges.",
    "publishedDate": "2017-03-21T10:01:47.884Z",
    "updatedDate": "2018-10-03T07:02:06.186Z",
    "disclosureDate": "2017-03-22T00:00:00.000Z",
    "exploitPublishDate": "2017-03-24T00:00:00.000Z",
    "solution": "This is an old local vulnerability that spans a large number of kernel versions. Fixed in the following versions.\n\n* **3.2.87**\n* **3.12.72**\n* **3.16.42**\n* **4.4.54**\n* **4.9.15**\n*  **4.10.3**\n\nAlternatively, apply the [patch](https://git.kernel.org/pub/scm/linux/kernel/git/gregkh/tty.git/commit/?h=tty-linus&id=82f2341c94d270421f383641b7cd670e474db56b).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 6.6,
        "impactSubscore": 10.0,
        "exploitabilitySubscore": 2.7,
        "severity": "MEDIUM",
        "accessVector": "LOCAL",
        "accessComplexity": "MEDIUM",
        "authentication": "SINGLE",
        "confidentialityImpact": "COMPLETE",
        "integrityImpact": "COMPLETE",
        "availabilityImpact": "COMPLETE",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.4
        },
        "vector": "(AV:L/AC:M/Au:S/C:C/I:C/A:C/E:F/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.8,
        "impactSubscore": 6.0,
        "exploitabilitySubscore": 2.0,
        "severity": "HIGH",
        "attackVector": "LOCAL",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "LOW",
        "scope": "CHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 8.2
        },
        "vector": "CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H/E:F/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Alexander Popov",
    "workaround": "An alternative but complete workaround is to remove the module if the Microgate or SyncLink hardware are not in use on the server.  This will prevent any exploitation.  Search for the file n_hdlc.o in /lib/modules/ and remove it.\nA further alternative is to ensure that that CONFIG_N_HDLC is not set in the kernel configuration and to rebuild the kernel.",
    "vendorFixDate": "2017-03-18T00:00:00.000Z",
    "discoveryDate": "2017-02-28T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 8.2,
    "_meta": {
        "allow": [],
        "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/BDSA-2017-0033",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro.app.blackduck.com/api/cwes/CWE-415"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/CVE-2017-2636",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro.app.blackduck.com/api/vulnerabilities/BDSA-2017-0033/ranges"
            },
            {
                "rel": "reference",
                "href": "http://www.openwall.com/lists/oss-security/2017/03/07/6",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://a13xp0p0v.github.io/2017/03/24/CVE-2017-2636.html",
                "label": "EXPLOIT"
            },
            {
                "rel": "reference",
                "href": "https://bugzilla.redhat.com/show_bug.cgi?id=1428319",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/gregkh/tty.git/commit/?h=tty-linus&id=82f2341c94d270421f383641b7cd670e474db56b",
                "label": "PATCH"
            }
        ]
    }
}