{
    "source": "BDSA",
    "name": "BDSA-2021-2611",
    "title": "Xen Vulnerable to Information Exposure via Failure to Remove Identity Mappings on Device Removal",
    "description": "Xen is vulnerable to information exposure due to a failure to remove memory mappings that are no longer required. A local attacker could potentially recover sensitive information from memory that is associated with leftover mappings by running a malicious guest. This vulnerability can only be exploited by guests that have been granted access to physical devices.\n\nIt should be noted that this vulnerability only affects AMD systems.",
    "technicalDescription": "The vulnerability exists due to issues in several functions and files. One such function is `amd_iommu_domain_destroy()`, of file `xen/drivers/passthrough/amd/pci_amd_iommu.c`. This function fails to tear down unity mappings whenever device de-assignment or re-assignment occurs. As a consequence of this, the identity mappings of a physical device remain in place after that device has been removed from a guest. This could allow a guest to access ranges of memory that it should no longer have access to.\n\nAn attacker could potentially use a malicious guest in order to recover sensitive information from these ranges of memory. The malicious guest must have been granted access to physical devices in order for the attack to succeed.\n\nThe vulnerability was fixed by calling `iommu_identity_map_teardown()` within `amd_iommu_domain_destroy()` in order to remove the relevant mappings, and also by the addition of code which ensures devices do not get associated with their new owner until all assignment steps have been completed successfully.\n\nIt should be noted that this vulnerability only affects AMD systems.",
    "publishedDate": "2021-08-27T16:21:37.981Z",
    "updatedDate": "2022-08-10T15:39:32.812Z",
    "disclosureDate": "2021-08-25T00:00:00.000Z",
    "solution": "Fixed in:\n* [**4.13.4**](https://xenproject.org/downloads/) by [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=2357043846efeaa7a8b14791413103bb693dca52) commit.\n* [**4.14.3**](https://xenproject.org/downloads/) by [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=19587584f2f780547a8216b1b9d5cdf3dde29131) commit.\n* [**4.15.1**](https://xenproject.org/downloads/) by [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=d39756f0539cfe85742687e8134fdf1181139390) commit.\n* [**4.16.0-rc1**](https://xenproject.org/downloads/) by [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=899272539cbe1acda736a850015416fff653a1b6) commit.\n\nFixed in the **stable-4.11** and **staging-4.11** branches by [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=ba79e525c1c7982e93d5f889cd66c783ecdf499a) commit and in the **stable-4.12** and **staging-4.12** branches by [this](https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=52ee570d15cd949472c9e7e2832f39d24254208d) commit.",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 3.2,
        "impactSubscore": 4.9,
        "exploitabilitySubscore": 3.1,
        "severity": "LOW",
        "accessVector": "LOCAL",
        "accessComplexity": "LOW",
        "authentication": "SINGLE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "NONE",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 2.4
        },
        "vector": "(AV:L/AC:L/Au:S/C:P/I:N/A:P/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 7.1,
        "impactSubscore": 5.2,
        "exploitabilitySubscore": 1.8,
        "severity": "MEDIUM",
        "attackVector": "LOCAL",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "NONE",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "LOW",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 6.2
        },
        "vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:H/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Jan Beulich (SUSE)",
    "workaround": "The vendor has stated that the vulnerability can be mitigated by preventing guests from accessing physical devices. \n\nAn alternative workaround is to only allow untrusted guests to access physical devices \"whose firmware-provided ACPI tables declar identity mappings ... (Provided that there are no identity mapped regions which are specified by the ACPI tables to apply globally.)\".\n\nDetails on these workarounds can be found [here](http://xenbits.xen.org/xsa/advisory-378.html).",
    "vendorFixDate": "2021-08-25T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 6.2,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2611",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-664"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-28696",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2611/ranges"
            },
            {
                "rel": "reference",
                "href": "http://xenbits.xen.org/xsa/advisory-378.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "http://xenbits.xen.org/xsa/advisory-378.html",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "http://xenbits.xen.org/xsa/xsa378/xsa378-4.11-5.patch",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "http://xenbits.xen.org/xsa/xsa378/xsa378-4.12-5.patch",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "http://xenbits.xen.org/xsa/xsa378/xsa378-4.13-5.patch",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "http://xenbits.xen.org/xsa/xsa378/xsa378-4.14-5.patch",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "http://xenbits.xen.org/xsa/xsa378/xsa378-4.15-5.patch",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=19587584f2f780547a8216b1b9d5cdf3dde29131",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=2357043846efeaa7a8b14791413103bb693dca52",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=52ee570d15cd949472c9e7e2832f39d24254208d",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=899272539cbe1acda736a850015416fff653a1b6",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=ba79e525c1c7982e93d5f889cd66c783ecdf499a",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=d39756f0539cfe85742687e8134fdf1181139390",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://xenproject.org/downloads/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2611/default-remediation-status"
            }
        ]
    }
}