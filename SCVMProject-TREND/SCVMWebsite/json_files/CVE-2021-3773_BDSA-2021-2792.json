{
    "source": "BDSA",
    "name": "BDSA-2021-2792",
    "title": "OpenVPN Vulnerable to Man-in-the-Middle (MitM) Attacks via Netfilter's NAT Port Mismanagement",
    "description": "OpenVPN is vulnerable to deanonymization and man-in-the-middle (MitM) attacks. An attacker that connects to the same OpenVPN server as the victim could, with enough effort, identify their IP address or redirect their web connections to an attacker-controlled server.",
    "technicalDescription": "The core issue is caused by the usage of Netfilter whose NAT module mishandles specific packets if the same machine hosts a server. Netfilter is designed in such a way that if a machine behind the NAT uses the same source port as an application listening on the same port as the NAT, then Netfilter translates and routes received packets intended for the NAT\u2019s own listening port to a host behind the NAT using the same port. This attack primitive could be abused to deanonymize users that are connected to the server by sending out crafted requests to their potential IP addresses (a packet for each port in IANA ephemeral port range), and sending back crafted responses to all such requests from outside of the VPN. If any of the sent packets for an IP address do not return, it means that the case above was triggered and that IP is connected to the OpenVPN server. If the victim's IP is already known, a similar attack could be used to perform a Client-to-Man-in-the-Middle (c2mitm) as described in the credited researchers' [blog post](https://breakpointingbad.com/2021/09/08/Port-Shadows-via-Network-Alchemy.html).",
    "publishedDate": "2021-09-17T14:34:07.977Z",
    "updatedDate": "2022-09-08T11:04:37.301Z",
    "disclosureDate": "2021-09-08T00:00:00.000Z",
    "exploitPublishDate": "2021-09-08T00:00:00.000Z",
    "solution": "",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 4.3,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 3.2,
        "severity": "LOW",
        "accessVector": "ADJACENT_NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "WORKAROUND",
            "reportConfidence": "UNCORROBORATED",
            "score": 3.5
        },
        "vector": "(AV:A/AC:H/Au:N/C:P/I:P/A:P/E:POC/RL:W/RC:UR)"
    },
    "cvss3": {
        "baseScore": 7.5,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 1.6,
        "severity": "MEDIUM",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "WORKAROUND",
            "reportConfidence": "REASONABLE",
            "score": 6.6
        },
        "vector": "CVSS:3.1/AV:A/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H/E:P/RL:W/RC:R"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": true,
    "underReview": true,
    "parentAdvisory": false,
    "credit": "Benjamin Mixon-Baca, Jedidiah R. Crandall",
    "workaround": "The credited researchers suggest applying the following mitigations:\n1. The server could add firewall rules to prevent the port the VPN service is listening on from being used as a source port by clients\n2. The NAT functionality could be changed (e.g., as the VPN server is sending decrypted packets over the virtual interface, or by changing the conntrack module of Netfilter upstream) so that any port not designated as \u201cDynamic and/or Private\u201d by IANA is translated into such a port",
    "bdsaTags": [],
    "overallScore": 6.6,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2792",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-207"
            },
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-300"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-3773",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2792/ranges"
            },
            {
                "rel": "reference",
                "href": "https://breakpointingbad.com/2021/09/08/Port-Shadows-via-Network-Alchemy.html",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://breakpointingbad.com/2021/09/08/Port-Shadows-via-Network-Alchemy.html",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://breakpointingbad.com/2021/09/08/Port-Shadows-via-Network-Alchemy.html",
                "label": "WORKAROUND"
            },
            {
                "rel": "reference",
                "href": "https://seclists.org/oss-sec/2021/q3/159",
                "label": "ADVISORY"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2792/default-remediation-status"
            }
        ]
    }
}