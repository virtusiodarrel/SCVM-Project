{
    "source": "BDSA",
    "name": "BDSA-2021-2584",
    "title": "OpenSSL Vulnerable to Remote Code Execution (RCE) via Erroneous Calculation in 'sm2_plaintext_size()' Function",
    "description": "OpenSSL is vulnerable to remote code execution due to an problematic buffer length calculation. A remote attacker could potentially execute arbitrary code on a vulnerable server, or cause that server to crash, by sending maliciously crafted SM2 data to that server.",
    "technicalDescription": "The function `EVP_PKEY_decrypt()` can be used to decrypt SM2 ciphertext. This usually involves calling the function twice, with the first call being used to obtain the length of the buffer that is required to store the plaintext. \n\nThe function `sm2_plaintext_size()`, of file `crypto/sm2/sm2_crypt.c`, is used to calculate the length of the plaintext. Callers of `sm2_plaintext_size()` can pass a pointer to a `size_t` variable via the `pt_size` parameter. `sm2_plaintext_size()` will calculate the plaintext size and then store that value in the variable that `pt_size` points to. The plaintext size is obtained via the calculation `msg_len - overhead`, where `msg_len` corresponds to the length of the ciphertext. The value of `overhead` is obtained via the calculation `10 + 2 * field_size + (size_t)md_size;`. This calculation is erroneous for several reasons:\n\n* The integer constant `10` corresponds to an overhead element which is assumed to always be ten bytes in length. This element may, in fact, be larger than ten bytes in length.\n* The overhead includes two integers, C1x and C1y. The length of each of these integers is assumed to match that of the field size. This is where the `2 * field_size` component of the aforementioned calculation comes from. However, it is possible for the length of these integers to be less than, or greater than, the length of the field size (due to padding etc.).\n\nThese issues can cause the value of `overhead` to be larger than the actual overhead length. This will cause the calculated plaintext length value to be too small, which in turn can cause the application to allocate a plaintext buffer that is too small. Whenever the plaintext is written to the allocated buffer, a buffer overflow will occur. \n\nAn attacker could exploit this issue via maliciously crafted SM2 data in order to potentially execute arbitrary code on a vulnerable server. It may also be possible for an attacker to cause the application to crash. The attacker is limited to 62 bytes of overflowed data.",
    "publishedDate": "2021-08-25T12:24:47.985Z",
    "updatedDate": "2021-09-30T09:14:02.322Z",
    "disclosureDate": "2021-08-24T00:00:00.000Z",
    "exploitPublishDate": "2021-09-27T00:00:00.000Z",
    "solution": "Fixed in version [**1.1.1l**](https://github.com/openssl/openssl/releases/tag/OpenSSL_1_1_1l) by [this](https://github.com/openssl/openssl/commit/59f5e75f3bced8fc0e130d72a3f582cf7b480b46) commit and [**3.0.0**](https://github.com/openssl/openssl/releases/tag/openssl-3.0.0) by [this](https://github.com/openssl/openssl/commit/36cf45ef3ba71e44a8be06ee81cb31aa02cb0010) commit.\n\nThe latest stable releases can be found [here](https://github.com/openssl/openssl/releases).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 5.1,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 4.9,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.0
        },
        "vector": "(AV:N/AC:H/Au:N/C:P/I:P/A:P/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.1,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 2.2,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.3
        },
        "vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "John Ouyang",
    "workaround": "",
    "vendorFixDate": "2021-08-24T00:00:00.000Z",
    "vendorNotifiedDate": "2021-08-12T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 7.3,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2584",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-120"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2021-3711",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2584/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/openssl/openssl/commit/36cf45ef3ba71e44a8be06ee81cb31aa02cb0010",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/openssl/openssl/commit/59f5e75f3bced8fc0e130d72a3f582cf7b480b46",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/openssl/openssl/releases",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/openssl/openssl/releases/tag/OpenSSL_1_1_1l",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/openssl/openssl/releases/tag/openssl-3.0.0",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://hackerone.com/reports/1352429",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://www.openssl.org/news/secadv/20210824.txt",
                "label": "ADVISORY"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-2584/default-remediation-status"
            }
        ]
    }
}