{
    "source": "BDSA",
    "name": "BDSA-2018-4765",
    "title": "Linux Kernel Vulnerable to Denial-of-Service (DoS) via Infinite Loop in 'update_blocked_averages()' Function",
    "description": "Linux kernel is vulnerable to denial-of-service (DoS) due to errors in the operation of the scheduler under high loads. The list that is used for updating the load of the task group may become corrupted due to unforeseen interaction between Completely Fair Scheduler optimization patches. An attacker can leverage this flaw to force the kernel into an infinite loop resulting in core lockups and overconsumption of resources.",
    "technicalDescription": "This flaw lies in the `update_blocked_averages()` function of the `kernel/sched/fair.c` source file. The problem is with the handling of runqueues (`rq`) in the completely fair scheduler module (`cfs`). Since commit [a9e7f6544b9c](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a9e7f6544b9cebdae54d29f87a7ba2a83c0471b5), it became possible to delete a `cfs_rq` from `rq->leaf_cfs_rq_list` which was not considered in the subsequent optimization patches. This list of scheduled group of the `rq` is used to to keep track of the the load of each `cfs_rq` and the load of the task group.\n\nThe patch can lead to situations where the load of a task group (TG) `cfs_rq` becomes `NULL`, leading to the TG being removed from the list before being throttled. This in turn, can cause a problem after that TG is forked and the `cfs_rq` of the new child TG gets added to the beginning of the `rq->leaf_cfs_rq_list`. The `tmp_alone_branch` pointer will still point to the child's `cfs_rq` instead of the new beginning of `rq->leaf_cfs_rq_list` because its throttled parent can't be enqueued when the lock is released.\n\nIf the child TG `cfs_rq` is removed or destroyed before `tmp_alone_branch` points on another TG `cfs_rq`, the list may become corrupted. This is because any new TG `cfs_rq` that will be subsequently added will be linked outside `rq->leaf_cfs_rq_list`. This means that the `list_add_leaf_cfs_rq()` operation could attempt to add to an already removed entry.",
    "publishedDate": "2019-02-27T15:52:34.020Z",
    "updatedDate": "2019-05-14T15:41:42.281Z",
    "disclosureDate": "2018-12-28T00:00:00.000Z",
    "solution": "Fixed in:\n* [**4.14.93**](https://www.kernel.org/) by [this](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c6a9a1ccafc49fe95d8de54eef154ad5c3b94077) commit,\n* [**4.19.15**](https://www.kernel.org/) by [this](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=dc8408ea0b22ab181ee541f3786b4fd6161e0ce3) commit,\n* [**4.20.2**](https://www.kernel.org/) by [this](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7a400b91868336b50ef75b0223f90a99ba5f7d51) commit, and\n* [**5.0-rc1**](https://www.kernel.org/) by [this](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c40f7d74c741a907cfaeb73a7697081881c497d0) commit.",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 5.0,
        "impactSubscore": 2.9,
        "exploitabilitySubscore": 10.0,
        "severity": "LOW",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "NONE",
        "confidentialityImpact": "NONE",
        "integrityImpact": "NONE",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 3.7
        },
        "vector": "(AV:N/AC:L/Au:N/C:N/I:N/A:P/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 7.5,
        "impactSubscore": 3.6,
        "exploitabilitySubscore": 3.9,
        "severity": "MEDIUM",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "NONE",
        "integrityImpact": "NONE",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 6.5
        },
        "vector": "CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Zhipeng Xie, Xie XiuQi and Sargun Dhillon",
    "workaround": "",
    "vendorFixDate": "2018-12-30T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 6.5,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2018-4765",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-400"
            },
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-835"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2018-20784",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2018-4765/ranges"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7a400b91868336b50ef75b0223f90a99ba5f7d51",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c40f7d74c741a907cfaeb73a7697081881c497d0",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c6a9a1ccafc49fe95d8de54eef154ad5c3b94077",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=dc8408ea0b22ab181ee541f3786b4fd6161e0ce3",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://josefbacik.github.io/kernel/scheduler/2017/07/14/scheduler-basics.html",
                "label": "LINK"
            },
            {
                "rel": "reference",
                "href": "https://lore.kernel.org/lkml/1545879866-27809-1-git-send-email-xiexiuqi@huawei.com/T/#u",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.kernel.org/",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2018-4765/default-remediation-status"
            }
        ]
    }
}