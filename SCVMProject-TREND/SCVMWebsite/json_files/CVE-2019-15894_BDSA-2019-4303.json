{
    "source": "BDSA",
    "name": "BDSA-2019-4303",
    "title": "Espressif ESP-IDF Vulnerable to Secure Boot Bypass via Fault Injection Attack",
    "description": "Espressif ESP-IDF is vulnerable to the bypassing of its secure boot process due to the behavior of the CPU whenever a fault is being handled. A local attacker could cause the CPU to execute arbitrary code by using physical fault injection.",
    "technicalDescription": "Espressif ESP-IDF implements secure boot functionality that involves the verification of the kernel image's hash. The flash memory that contains the kernel image and bootloader can also be protected using flash encryption. This is configured using the options contained within the file `Kconfig.projbuild`. The instruction sequence that conducts the hash verification process can be avoided using fault injection. A local attacker who is physically able to conduct this fault injection could bypass the hash verification process and hijack the boot chain, which will allow them to execute arbitrary code on the CPU. It should be noted that flash encryption must be disabled in order for such an attack to be possible.",
    "publishedDate": "2020-03-19T18:31:12.595Z",
    "updatedDate": "2020-03-19T18:31:12.586Z",
    "disclosureDate": "2019-09-03T00:00:00.000Z",
    "solution": "Fixed in:\n* [**3.0.9**](https://github.com/espressif/esp-idf/releases/tag/v3.0.9) by [this](https://github.com/espressif/esp-idf/commit/8df3c666db10a1b9ecd0080944d86a2ca2804e59) commit.\n* [**3.1.6**](https://github.com/espressif/esp-idf/releases/tag/v3.1.6) by [this](https://github.com/espressif/esp-idf/commit/7648859a27cb0d3a834dd8eed21b5a5842b5734d) commit.\n* [**3.2.3**](https://github.com/espressif/esp-idf/releases/tag/v3.2.3) by [this](https://github.com/espressif/esp-idf/commit/ec331b397922272cf9ff017616991c29f95f66f8) commit.\n* [**3.3.1**](https://github.com/espressif/esp-idf/releases/tag/v3.3.1) by [this](https://github.com/espressif/esp-idf/commit/e8a4e70c422ac18f178e5f57b359a176243c464e) commit.\n\nThe latest stable releases can be found [here](https://github.com/espressif/esp-idf/releases).",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 6.2,
        "impactSubscore": 10.0,
        "exploitabilitySubscore": 1.9,
        "severity": "MEDIUM",
        "accessVector": "LOCAL",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "COMPLETE",
        "integrityImpact": "COMPLETE",
        "availabilityImpact": "COMPLETE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.6
        },
        "vector": "(AV:L/AC:H/Au:N/C:C/I:C/A:C/E:U/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 6.4,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 0.5,
        "severity": "MEDIUM",
        "attackVector": "PHYSICAL",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "UNPROVEN",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.6
        },
        "vector": "CVSS:3.0/AV:P/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H/E:U/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Riscure",
    "workaround": "The vendor states that the following workaround can be implemented:\n\n\"Users who do not wish to wait for the new ESP-IDF release can patch ESP-IDF **3.2.x** apps to call the following API as part of startup in the `app_main()` function or similar:\n\n`#include <esp_flash_encrypt.h>\n\nvoid app_main()\n\n{\n\n   if (esp_flash_encryption_enabled()) {\n\n       esp_flash_write_protect_crypt_cnt();\n\n   }\n\n   // continue normal startup\n\n}`\n\nESP-IDF versions prior to **v3.2** can either update ESP-IDF, or copy the `esp_flash_write_protect_crypt_cnt()` function from newer ESP-IDF into the firmware app and then call it as shown above. Please contact Espressif if you require technical assistance with this process.\"",
    "vendorFixDate": "2019-06-12T00:00:00.000Z",
    "vendorNotifiedDate": "2019-04-08T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 5.6,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-4303",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-693"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-15894",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-4303/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/esp-idf/commit/7648859a27cb0d3a834dd8eed21b5a5842b5734d",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/esp-idf/commit/8df3c666db10a1b9ecd0080944d86a2ca2804e59",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/esp-idf/commit/e8a4e70c422ac18f178e5f57b359a176243c464e",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/esp-idf/commit/ec331b397922272cf9ff017616991c29f95f66f8",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/esp-idf/releases",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/esp-idf/releases/tag/v3.0.9",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/esp-idf/releases/tag/v3.1.6",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/esp-idf/releases/tag/v3.2.3",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/espressif/esp-idf/releases/tag/v3.3.1",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://www.espressif.com/en/news/Espressif_Security_Advisory_Concerning_Fault_Injection_and_Secure_Boot",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://www.espressif.com/en/news/Espressif_Security_Advisory_Concerning_Fault_Injection_and_Secure_Boot",
                "label": "WORKAROUND"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-4303/default-remediation-status"
            }
        ]
    }
}