{
    "source": "BDSA",
    "name": "BDSA-2019-1729",
    "title": "Vim/Neovim Vulnerable to Arbitrary Code Execution via Modelines Feature",
    "description": "Vim and Neovim are vulnerable to arbitrary code execution due to a sandbox escape flaw in the modelines feature. An attacker could leverage this flaw by tricking a user into downloading and loading a crafted file. Only certain configurations that run with the feature enabled are affected.",
    "technicalDescription": "This flaw lies in the `openscript()` function of the `src/getchar.c` source file. The modeline feature can be used to specify custom Vim options within a file. When opening such files Vim will execute the modeline and apply the setting to the opened file. If the modeline contains an expression it will be executed in a sandbox.\n\nThe problem is that this sandbox can be sidestepped by using a `:source!` modifier which will run the command in normal mode (outside of the sandbox). This allows the attacker to easily construct a file which will execute arbitrary commands on the underlying host when opened with Vim. This can be leveraged to send a reverse shell back to the attacker, allowing arbitrary code execution.\n\nSome notable distributions (e.g. Debian, Ubuntu, Gentoo, OSX) disable modelines by default for security reasons.\n\nVim will be vulnerable only if all of the following apply:\n* `modeline` is set to `modeline` (not `nomodeline`),\n* `modelines` is set to a positive integer (not `0`),\n* User is not root.\n\nYou can check your current settings by running the following command inside Vim:\n* `:verbose set modeline? modelines?`",
    "publishedDate": "2019-06-07T09:16:20.206Z",
    "updatedDate": "2019-06-07T09:16:20.197Z",
    "disclosureDate": "2019-06-04T00:00:00.000Z",
    "exploitPublishDate": "2019-06-04T00:00:00.000Z",
    "solution": "Fixed in Vim [**8.1.1365**](https://github.com/vim/vim/releases/tag/v8.1.1365) by [this](https://github.com/vim/vim/commit/53575521406739cf20bbe4e384d88e7dca11f040) commit.\n\nFixed in Neovim [**0.3.6**](https://github.com/neovim/neovim/releases/tag/v0.3.6) by [this](https://github.com/neovim/neovim/commit/4553fc5e6cb6c8c43f57c173d01b31a61e51d13f) commit.",
    "severity": "MEDIUM",
    "cvss2": {
        "baseScore": 5.1,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 4.9,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "HIGH",
        "authentication": "NONE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 4.2
        },
        "vector": "(AV:N/AC:H/Au:N/C:P/I:P/A:P/E:F/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 7.0,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 1.0,
        "severity": "MEDIUM",
        "attackVector": "LOCAL",
        "attackComplexity": "HIGH",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "NONE",
        "scope": "UNCHANGED",
        "userInteraction": "REQUIRED",
        "temporalMetrics": {
            "exploitability": "FUNCTIONAL",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 6.5
        },
        "vector": "CVSS:3.0/AV:L/AC:H/PR:N/UI:R/S:U/C:H/I:H/A:H/E:F/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Armin Razmjou",
    "workaround": "Vim installations that launch with at least one the following settings are not vulnerable:\n* `set nomodeline`\n* `set modelines=0`\n\nYou can check your current settings by running the following command inside Vim:\n* `:verbose set modeline? modelines?`\n\nIf this command returns both `modeline` (indicating that it is set) and `modelines=5` (5 is a default but anything above 0 makes Vim vulnerable) then your configuration is vulnerable. Add `set nomodeline` to your `~/.vimrc` configuration file to turn modelines off.",
    "vendorFixDate": "2019-05-22T00:00:00.000Z",
    "vendorNotifiedDate": "2019-05-22T00:00:00.000Z",
    "bdsaTags": [],
    "overallScore": 6.5,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-1729",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-265"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2019-12735",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-1729/ranges"
            },
            {
                "rel": "reference",
                "href": "https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=930020",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=930024",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/neovim/neovim/commit/4553fc5e6cb6c8c43f57c173d01b31a61e51d13f",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/neovim/neovim/releases/tag/v0.3.6",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://github.com/numirias/security/blob/master/doc/2019-06-04_ace-vim-neovim.md",
                "label": "EXPLOIT"
            },
            {
                "rel": "reference",
                "href": "https://github.com/vim/vim/commit/53575521406739cf20bbe4e384d88e7dca11f040",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/vim/vim/releases/tag/v8.1.1365",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://vim.fandom.com/wiki/Modeline_magic",
                "label": "WORKAROUND"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2019-1729/default-remediation-status"
            }
        ]
    }
}