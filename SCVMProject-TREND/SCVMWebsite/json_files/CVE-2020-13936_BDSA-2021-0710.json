{
    "source": "BDSA",
    "name": "BDSA-2021-0710",
    "title": "Apache Velocity Vulnerable to Remote Code Execution (RCE) via Improper BlockList Verification",
    "description": "Apache Velocity is vulnerable to remote code execution (RCE) and arbitrary command execution due to how the SecureUberspector functionality does not sufficiently prevent access to dangerous classes and packages.\n\nAn attacker with the ability to modify Velocity templates could use this issue to execute arbitrary Java code or system commands with the privileges of the account running the Servlet container.",
    "technicalDescription": "Apache Velocity is vulnerable to remote code execution (RCE) and arbitrary command execution because Velocity SecureUberspector does not prevent access to dangerous classes. The complete class hierarchy of the object where the method is invoked is not considered. This means that the invocation of methods that are called on an object of a type that extends a class or implements an interface on the BlockList, are not blocked.\n\nDangerous classes or objects such as `java.lang.ClassLoader`, or `servletContext` could be accessed with malicious templates in order to execute arbitrary Java code.\n\nTo remedy this issue, the vendor has explicitly disallowed the use of  `ClassLoader`.",
    "publishedDate": "2021-03-22T16:01:20.894Z",
    "updatedDate": "2021-11-08T14:16:56.623Z",
    "disclosureDate": "2021-02-26T00:00:00.000Z",
    "exploitPublishDate": "2021-03-03T00:00:00.000Z",
    "solution": "Fixed in [**2.3-rc1**](https://github.com/apache/velocity-engine/releases/tag/2.3-RC1) by [this](https://github.com/apache/velocity-engine/commit/f355cec739d4e705e541a149ff2d8806ed565401) commit.\n\nThe latest stable releases are available [here](https://velocity.apache.org/download.cgi).",
    "severity": "HIGH",
    "cvss2": {
        "baseScore": 6.5,
        "impactSubscore": 6.4,
        "exploitabilitySubscore": 8.0,
        "severity": "MEDIUM",
        "accessVector": "NETWORK",
        "accessComplexity": "LOW",
        "authentication": "SINGLE",
        "confidentialityImpact": "PARTIAL",
        "integrityImpact": "PARTIAL",
        "availabilityImpact": "PARTIAL",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 5.1
        },
        "vector": "(AV:N/AC:L/Au:S/C:P/I:P/A:P/E:POC/RL:OF/RC:C)"
    },
    "cvss3": {
        "baseScore": 8.8,
        "impactSubscore": 5.9,
        "exploitabilitySubscore": 2.8,
        "severity": "HIGH",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "confidentialityImpact": "HIGH",
        "integrityImpact": "HIGH",
        "availabilityImpact": "HIGH",
        "privilegesRequired": "LOW",
        "scope": "UNCHANGED",
        "userInteraction": "NONE",
        "temporalMetrics": {
            "exploitability": "PROOF_OF_CONCEPT",
            "remediationLevel": "OFFICIAL_FIX",
            "reportConfidence": "CONFIRMED",
            "score": 7.9
        },
        "vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H/E:P/RL:O/RC:C"
    },
    "useCvss3": true,
    "classifications": [],
    "zeroDay": false,
    "underReview": false,
    "parentAdvisory": false,
    "credit": "Alvaro Munoz",
    "workaround": "",
    "vendorFixDate": "2021-02-25T00:00:00.000Z",
    "vendorNotifiedDate": "2020-03-23T00:00:00.000Z",
    "bdsaTags": [
        "RCE"
    ],
    "overallScore": 7.9,
    "_meta": {
        "allow": [
            "GET"
        ],
        "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-0710",
        "links": [
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-20"
            },
            {
                "rel": "cwes",
                "href": "https://trendmicro2.app.blackduck.com/api/cwes/CWE-94"
            },
            {
                "rel": "related-vulnerability",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/CVE-2020-13936",
                "label": "NVD"
            },
            {
                "rel": "bdsa-ranges",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-0710/ranges"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/velocity-engine/commit/f355cec739d4e705e541a149ff2d8806ed565401",
                "label": "PATCH"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/velocity-engine/pull/16",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://github.com/apache/velocity-engine/releases/tag/2.3-RC1",
                "label": "VENDOR_UPGRADE"
            },
            {
                "rel": "reference",
                "href": "https://issues.apache.org/jira/browse/VELOCITY-931",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://securitylab.github.com/advisories/GHSL-2020-048-apache-velocity",
                "label": "ADVISORY"
            },
            {
                "rel": "reference",
                "href": "https://securitylab.github.com/advisories/GHSL-2020-048-apache-velocity",
                "label": "POC"
            },
            {
                "rel": "reference",
                "href": "https://velocity.apache.org/download.cgi",
                "label": "LINK"
            },
            {
                "rel": "reference",
                "href": "https://www.openwall.com/lists/oss-security/2021/03/10/1",
                "label": "ADVISORY"
            },
            {
                "rel": "default-remediation-status",
                "href": "https://trendmicro2.app.blackduck.com/api/vulnerabilities/BDSA-2021-0710/default-remediation-status"
            }
        ]
    }
}